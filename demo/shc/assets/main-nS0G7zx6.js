var pr=Object.defineProperty,Sr=Object.defineProperties;var Er=Object.getOwnPropertyDescriptors;var Ke=Object.getOwnPropertySymbols;var kt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var Ot=t=>{throw TypeError(t)},Jt=Math.pow,qe=(t,e,n)=>e in t?pr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$=(t,e)=>{for(var n in e||(e={}))kt.call(e,n)&&qe(t,n,e[n]);if(Ke)for(var n of Ke(e))$t.call(e,n)&&qe(t,n,e[n]);return t},ue=(t,e)=>Sr(t,Er(e));var Ge=(t,e)=>{var n={};for(var r in t)kt.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Ke)for(var r of Ke(t))e.indexOf(r)<0&&$t.call(t,r)&&(n[r]=t[r]);return n};var D=(t,e,n)=>qe(t,typeof e!="symbol"?e+"":e,n),Wt=(t,e,n)=>e.has(t)||Ot("Cannot "+n);var K=(t,e,n)=>(Wt(t,e,"read from private field"),n?n.call(t):e.get(t)),xe=(t,e,n)=>e.has(t)?Ot("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Re=(t,e,n,r)=>(Wt(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);var M=(t,e,n)=>new Promise((r,o)=>{var i=c=>{try{a(n.next(c))}catch(l){o(l)}},s=c=>{try{a(n.throw(c))}catch(l){o(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(i,s);a((n=n.apply(t,e)).next())});function br(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in t)){const i=Object.getOwnPropertyDescriptor(r,o);i&&Object.defineProperty(t,o,i.get?i:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const Cr="modulepreload",Ar=function(t,e){return new URL(t,e).href},Ht={},zt=function(e,n,r){let o=Promise.resolve();if(n&&n.length>0){let l=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const s=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=l(n.map(d=>{if(d=Ar(d,r),d in Ht)return;Ht[d]=!0;const u=d.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(r)for(let m=s.length-1;m>=0;m--){const y=s[m];if(y.href===d&&(!u||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Cr,u||(h.as="script"),h.crossOrigin="",h.href=d,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((m,y)=>{h.addEventListener("load",m),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},ee=new TextEncoder,ge=new TextDecoder;function Un(...t){const e=t.reduce((o,{length:i})=>o+i,0),n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return n}function vr(t){if(Uint8Array.prototype.toBase64)return t.toBase64();const e=32768,n=[];for(let r=0;r<t.length;r+=e)n.push(String.fromCharCode.apply(null,t.subarray(r,r+e)));return btoa(n.join(""))}function Rt(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(t);const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}function fe(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof t=="string"?t:ge.decode(t),{alphabet:"base64url"});let e=t;e instanceof Uint8Array&&(e=ge.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Rt(e)}catch(n){throw new TypeError("The input to be decoded is not correctly encoded.")}}function Te(t){let e=t;return typeof e=="string"&&(e=ee.encode(e)),Uint8Array.prototype.toBase64?e.toBase64({alphabet:"base64url",omitPadding:!0}):vr(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class Ue extends Error{constructor(n,r){var o;super(n,r);D(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}}D(Ue,"code","ERR_JOSE_GENERIC");class V extends Ue{constructor(){super(...arguments);D(this,"code","ERR_JOSE_NOT_SUPPORTED")}}D(V,"code","ERR_JOSE_NOT_SUPPORTED");class L extends Ue{constructor(){super(...arguments);D(this,"code","ERR_JWS_INVALID")}}D(L,"code","ERR_JWS_INVALID");class Ln extends Ue{constructor(){super(...arguments);D(this,"code","ERR_JWK_INVALID")}}D(Ln,"code","ERR_JWK_INVALID");class Kn extends Ue{constructor(n="signature verification failed",r){super(n,r);D(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}D(Kn,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function oe(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function Be(t,e){return t.name===e}function je(t){return parseInt(t.name.slice(4),10)}function xr(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Rr(t,e){if(e&&!t.usages.includes(e))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${e}.`)}function Br(t,e,n){switch(e){case"HS256":case"HS384":case"HS512":{if(!Be(t.algorithm,"HMAC"))throw oe("HMAC");const r=parseInt(e.slice(2),10);if(je(t.algorithm.hash)!==r)throw oe(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Be(t.algorithm,"RSASSA-PKCS1-v1_5"))throw oe("RSASSA-PKCS1-v1_5");const r=parseInt(e.slice(2),10);if(je(t.algorithm.hash)!==r)throw oe(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Be(t.algorithm,"RSA-PSS"))throw oe("RSA-PSS");const r=parseInt(e.slice(2),10);if(je(t.algorithm.hash)!==r)throw oe(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Be(t.algorithm,"Ed25519"))throw oe("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!Be(t.algorithm,"ECDSA"))throw oe("ECDSA");const r=xr(e);if(t.algorithm.namedCurve!==r)throw oe(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Rr(t,n)}function kn(t,e,...n){var r;if(n=n.filter(Boolean),n.length>2){const o=n.pop();t+=`one of type ${n.join(", ")}, or ${o}.`}else n.length===2?t+=`one of type ${n[0]} or ${n[1]}.`:t+=`of type ${n[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(r=e.constructor)!=null&&r.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const Bt=(t,...e)=>kn("Key must be ",t,...e);function $n(t,e,...n){return kn(`Key for the ${t} algorithm must be `,e,...n)}function Pt(t){return(t==null?void 0:t[Symbol.toStringTag])==="CryptoKey"}function It(t){return(t==null?void 0:t[Symbol.toStringTag])==="KeyObject"}const Tt=t=>Pt(t)||It(t),On=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let n;for(const r of e){const o=Object.keys(r);if(!n||n.size===0){n=new Set(o);continue}for(const i of o){if(n.has(i))return!1;n.add(i)}}return!0};function Pr(t){return typeof t=="object"&&t!==null}const Ne=t=>{if(!Pr(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Ir=(t,e)=>M(null,null,function*(){const n=`SHA-${t.slice(-3)}`;return new Uint8Array(yield crypto.subtle.digest(n,e))}),Jn=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:n}=e.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}},Tr=t=>{const e=Object.entries({"P-256":[6,8,42,134,72,206,61,3,1,7],"P-384":[6,5,43,129,4,0,34],"P-521":[6,5,43,129,4,0,35]}),n=Math.max(...e.map(([,r])=>r.length));for(let r=0;r<=t.byteLength-n;r++)for(const[o,i]of e)if(r<=t.byteLength-i.length&&t.subarray(r,r+i.length).every((s,a)=>s===i[a]))return o},Wn=(t,e,n,r)=>M(null,null,function*(){let o,i;const s=t==="spki",a=()=>s?["verify"]:["sign"],c=()=>s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];switch(n){case"PS256":case"PS384":case"PS512":o={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`},i=a();break;case"RS256":case"RS384":case"RS512":o={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`},i=a();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`},i=c();break;case"ES256":case"ES384":case"ES512":{o={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[n]},i=a();break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{const l=Tr(e);o=l?{name:"ECDH",namedCurve:l}:{name:"X25519"},i=s?[]:["deriveBits"];break}case"Ed25519":case"EdDSA":o={name:"Ed25519"},i=a();break;default:throw new V('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(t,e,o,!!s,i)}),Mr=(t,e,n)=>{const r=Rt(t.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""));return Wn("pkcs8",r,e)},Nr=(t,e,n)=>{const r=Rt(t.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,""));return Wn("spki",r,e)};function Dr(t){let e,n;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},n=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new V('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},n=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},n=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new V('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"Ed25519":case"EdDSA":e={name:"Ed25519"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new V('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new V('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:n}}const Hn=t=>M(null,null,function*(){var o,i;if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:n}=Dr(t),r=$({},t);return delete r.alg,delete r.use,crypto.subtle.importKey("jwk",r,e,(o=t.ext)!=null?o:!t.d,(i=t.key_ops)!=null?i:n)});function _t(t,e,n){return M(this,null,function*(){if(typeof t!="string"||t.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return Nr(t,e)})}function Ur(t,e,n){return M(this,null,function*(){if(typeof t!="string"||t.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return Mr(t,e)})}function Ee(t,e,n){return M(this,null,function*(){if(!Ne(t))throw new TypeError("JWK must be an object");let r;switch(e!=null||(e=t.alg),r!=null||(r=t.ext),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return fe(t.k);case"RSA":if("oth"in t&&t.oth!==void 0)throw new V('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Hn(ue($({},t),{alg:e,ext:r}));default:throw new V('Unsupported "kty" (Key Type) Parameter value')}})}const zn=(t,e,n,r,o)=>{if(o.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(s=>typeof s!="string"||s.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;n!==void 0?i=new Map([...Object.entries(n),...e.entries()]):i=e;for(const s of r.crit){if(!i.has(s))throw new V(`Extension Header Parameter "${s}" is not recognized`);if(o[s]===void 0)throw new t(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&r[s]===void 0)throw new t(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(r.crit)};function ze(t){return Ne(t)&&typeof t.kty=="string"}function Lr(t){return t.kty!=="oct"&&typeof t.d=="string"}function Kr(t){return t.kty!=="oct"&&typeof t.d=="undefined"}function kr(t){return t.kty==="oct"&&typeof t.k=="string"}let be;const Qt=(t,e,n,r=!1)=>M(null,null,function*(){be||(be=new WeakMap);let o=be.get(t);if(o!=null&&o[n])return o[n];const i=yield Hn(ue($({},e),{alg:n}));return r&&Object.freeze(t),o?o[n]=i:be.set(t,{[n]:i}),i}),$r=(t,e)=>{var s;be||(be=new WeakMap);let n=be.get(t);if(n!=null&&n[e])return n[e];const r=t.type==="public",o=!!r;let i;if(t.asymmetricKeyType==="x25519"){switch(e){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=t.toCryptoKey(t.asymmetricKeyType,o,r?[]:["deriveBits"])}if(t.asymmetricKeyType==="ed25519"){if(e!=="EdDSA"&&e!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=t.toCryptoKey(t.asymmetricKeyType,o,[r?"verify":"sign"])}if(t.asymmetricKeyType==="rsa"){let a;switch(e){case"RSA-OAEP":a="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":a="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":a="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":a="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(e.startsWith("RSA-OAEP"))return t.toCryptoKey({name:"RSA-OAEP",hash:a},o,r?["encrypt"]:["decrypt"]);i=t.toCryptoKey({name:e.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:a},o,[r?"verify":"sign"])}if(t.asymmetricKeyType==="ec"){const c=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((s=t.asymmetricKeyDetails)==null?void 0:s.namedCurve);if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");e==="ES256"&&c==="P-256"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[r?"verify":"sign"])),e==="ES384"&&c==="P-384"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[r?"verify":"sign"])),e==="ES512"&&c==="P-521"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[r?"verify":"sign"])),e.startsWith("ECDH-ES")&&(i=t.toCryptoKey({name:"ECDH",namedCurve:c},o,r?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[e]=i:be.set(t,{[e]:i}),i},_n=(t,e)=>M(null,null,function*(){if(t instanceof Uint8Array||Pt(t))return t;if(It(t)){if(t.type==="secret")return t.export();if("toCryptoKey"in t&&typeof t.toCryptoKey=="function")try{return $r(t,e)}catch(r){if(r instanceof TypeError)throw r}let n=t.export({format:"jwk"});return Qt(t,n,e)}if(ze(t))return t.k?fe(t.k):Qt(t,t,e,!0);throw new Error("unreachable")}),Se=t=>t==null?void 0:t[Symbol.toStringTag],bt=(t,e,n)=>{var r,o;if(e.use!==void 0){let i;switch(n){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc";break}if(e.use!==i)throw new TypeError(`Invalid key for this operation, its "use" must be "${i}" when present`)}if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, its "alg" must be "${t}" when present`);if(Array.isArray(e.key_ops)){let i;switch(!0){case(n==="sign"||n==="verify"):case t==="dir":case t.includes("CBC-HS"):i=n;break;case t.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(t):!t.includes("GCM")&&t.endsWith("KW")?i=n==="encrypt"?"wrapKey":"unwrapKey":i=n;break;case(n==="encrypt"&&t.startsWith("RSA")):i="wrapKey";break;case n==="decrypt":i=t.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(i&&((o=(r=e.key_ops)==null?void 0:r.includes)==null?void 0:o.call(r,i))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${i}" when present`)}return!0},Or=(t,e,n)=>{if(!(e instanceof Uint8Array)){if(ze(e)){if(kr(e)&&bt(t,e,n))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Tt(e))throw new TypeError($n(t,e,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Se(e)} instances for symmetric algorithms must be of type "secret"`)}},Jr=(t,e,n)=>{if(ze(e))switch(n){case"decrypt":case"sign":if(Lr(e)&&bt(t,e,n))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(Kr(e)&&bt(t,e,n))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Tt(e))throw new TypeError($n(t,e,"CryptoKey","KeyObject","JSON Web Key"));if(e.type==="secret")throw new TypeError(`${Se(e)} instances for asymmetric algorithms must not be of type "secret"`);if(e.type==="public")switch(n){case"sign":throw new TypeError(`${Se(e)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${Se(e)} instances for asymmetric algorithm decryption must be of type "private"`)}if(e.type==="private")switch(n){case"verify":throw new TypeError(`${Se(e)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${Se(e)} instances for asymmetric algorithm encryption must be of type "public"`)}},Qn=(t,e,n)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(t)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(t)?Or(t,e,n):Jr(t,e,n)};function Wr(t){return M(this,null,function*(){if(It(t))if(t.type==="secret")t=t.export();else return t.export({format:"jwk"});if(t instanceof Uint8Array)return{kty:"oct",k:Te(t)};if(!Pt(t))throw new TypeError(Bt(t,"CryptoKey","KeyObject","Uint8Array"));if(!t.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const s=yield crypto.subtle.exportKey("jwk",t),{ext:e,key_ops:n,alg:r,use:o}=s;return Ge(s,["ext","key_ops","alg","use"])})}function Fn(t){return M(this,null,function*(){return Wr(t)})}const Vn=(t,e)=>{const n=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:parseInt(t.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new V(`alg ${t} is not supported either by JOSE or your javascript runtime`)}},qn=(t,e,n)=>M(null,null,function*(){if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Bt(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[n])}return Br(e,t,n),e}),Hr=(t,e,n,r)=>M(null,null,function*(){const o=yield qn(t,e,"verify");Jn(t,o);const i=Vn(t,o.algorithm);try{return yield crypto.subtle.verify(i,o,n,r)}catch(s){return!1}});function zr(t,e,n){return M(this,null,function*(){var y;if(!Ne(t))throw new L("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new L('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new L("JWS Protected Header incorrect type");if(t.payload===void 0)throw new L("JWS Payload missing");if(typeof t.signature!="string")throw new L("JWS Signature missing or incorrect type");if(t.header!==void 0&&!Ne(t.header))throw new L("JWS Unprotected Header incorrect type");let r={};if(t.protected)try{const x=fe(t.protected);r=JSON.parse(ge.decode(x))}catch(x){throw new L("JWS Protected Header is invalid")}if(!On(r,t.header))throw new L("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o=$($({},r),t.header),i=zn(L,new Map([["b64",!0]]),n==null?void 0:n.crit,r,o);let s=!0;if(i.has("b64")&&(s=r.b64,typeof s!="boolean"))throw new L('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=o;if(typeof a!="string"||!a)throw new L('JWS "alg" (Algorithm) Header Parameter missing or invalid');if(s){if(typeof t.payload!="string")throw new L("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new L("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=yield e(r,t),c=!0),Qn(a,e,"verify");const l=Un(ee.encode((y=t.protected)!=null?y:""),ee.encode("."),typeof t.payload=="string"?ee.encode(t.payload):t.payload);let d;try{d=fe(t.signature)}catch(x){throw new L("Failed to base64url decode the signature")}const u=yield _n(e,a);if(!(yield Hr(a,u,d,l)))throw new Kn;let h;if(s)try{h=fe(t.payload)}catch(x){throw new L("Failed to base64url decode the payload")}else typeof t.payload=="string"?h=ee.encode(t.payload):h=t.payload;const m={payload:h};return t.protected!==void 0&&(m.protectedHeader=r),t.header!==void 0&&(m.unprotectedHeader=t.header),c?ue($({},m),{key:u}):m})}function _r(t,e,n){return M(this,null,function*(){if(t instanceof Uint8Array&&(t=ge.decode(t)),typeof t!="string")throw new L("Compact JWS must be a string or Uint8Array");const{0:r,1:o,2:i,length:s}=t.split(".");if(s!==3)throw new L("Invalid Compact JWS");const a=yield zr({payload:o,protected:r,signature:i},e,n),c={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?ue($({},c),{key:a.key}):c})}const Qr=(t,e,n)=>M(null,null,function*(){const r=yield qn(t,e,"sign");Jn(t,r);const o=yield crypto.subtle.sign(Vn(t,r.algorithm),r,n);return new Uint8Array(o)});var De,_,Z;class Fr{constructor(e){xe(this,De);xe(this,_);xe(this,Z);if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");Re(this,De,e)}setProtectedHeader(e){if(K(this,_))throw new TypeError("setProtectedHeader can only be called once");return Re(this,_,e),this}setUnprotectedHeader(e){if(K(this,Z))throw new TypeError("setUnprotectedHeader can only be called once");return Re(this,Z,e),this}sign(e,n){return M(this,null,function*(){if(!K(this,_)&&!K(this,Z))throw new L("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!On(K(this,_),K(this,Z)))throw new L("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r=$($({},K(this,_)),K(this,Z)),o=zn(L,new Map([["b64",!0]]),n==null?void 0:n.crit,K(this,_),r);let i=!0;if(o.has("b64")&&(i=K(this,_).b64,typeof i!="boolean"))throw new L('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=r;if(typeof s!="string"||!s)throw new L('JWS "alg" (Algorithm) Header Parameter missing or invalid');Qn(s,e,"sign");let a=K(this,De);i&&(a=ee.encode(Te(a)));let c;K(this,_)?c=ee.encode(Te(JSON.stringify(K(this,_)))):c=ee.encode("");const l=Un(c,ee.encode("."),a),d=yield _n(e,s),u=yield Qr(s,d,l),f={signature:Te(u),payload:""};return i&&(f.payload=ge.decode(a)),K(this,Z)&&(f.header=K(this,Z)),K(this,_)&&(f.protected=ge.decode(c)),f})}}De=new WeakMap,_=new WeakMap,Z=new WeakMap;var ve;class Vr{constructor(e){xe(this,ve);Re(this,ve,new Fr(e))}setProtectedHeader(e){return K(this,ve).setProtectedHeader(e),this}sign(e,n){return M(this,null,function*(){const r=yield K(this,ve).sign(e,n);if(r.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`})}}ve=new WeakMap;const ie=(t,e)=>{if(typeof t!="string"||!t)throw new Ln(`${e} missing or invalid`)};function qr(t,e){return M(this,null,function*(){let n;if(ze(t))n=t;else if(Tt(t))n=yield Fn(t);else throw new TypeError(Bt(t,"CryptoKey","KeyObject","JSON Web Key"));if(e!=null||(e="sha256"),e!=="sha256"&&e!=="sha384"&&e!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(n.kty){case"EC":ie(n.crv,'"crv" (Curve) Parameter'),ie(n.x,'"x" (X Coordinate) Parameter'),ie(n.y,'"y" (Y Coordinate) Parameter'),r={crv:n.crv,kty:n.kty,x:n.x,y:n.y};break;case"OKP":ie(n.crv,'"crv" (Subtype of Key Pair) Parameter'),ie(n.x,'"x" (Public Key) Parameter'),r={crv:n.crv,kty:n.kty,x:n.x};break;case"RSA":ie(n.e,'"e" (Exponent) Parameter'),ie(n.n,'"n" (Modulus) Parameter'),r={e:n.e,kty:n.kty,n:n.n};break;case"oct":ie(n.k,'"k" (Key Value) Parameter'),r={k:n.k,kty:n.kty};break;default:throw new V('"kty" (Key Type) Parameter missing or unsupported')}const o=ee.encode(JSON.stringify(r));return Te(yield Ir(e,o))})}function Gr(t){let e;if(typeof t=="string"){const n=t.split(".");(n.length===3||n.length===5)&&([e]=n)}else if(typeof t=="object"&&t)if("protected"in t)e=t.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof e!="string"||!e)throw new Error;const n=JSON.parse(ge.decode(fe(e)));if(!Ne(n))throw new Error;return n}catch(n){throw new TypeError("Invalid Token or Protected Header formatting")}}function jr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var pe={},Ye,Ft;function Yr(){return Ft||(Ft=1,Ye=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Ye}var Xe={},se={},Vt;function ye(){if(Vt)return se;Vt=1;let t;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return se.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},se.getSymbolTotalCodewords=function(r){return e[r]},se.getBCHDigit=function(n){let r=0;for(;n!==0;)r++,n>>>=1;return r},se.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');t=r},se.isKanjiModeEnabled=function(){return typeof t!="undefined"},se.toSJIS=function(r){return t(r)},se}var Ze={},qt;function Mt(){return qt||(qt=1,(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit!="undefined"&&r.bit>=0&&r.bit<4},t.from=function(r,o){if(t.isValid(r))return r;try{return e(r)}catch(i){return o}}})(Ze)),Ze}var et,Gt;function Xr(){if(Gt)return et;Gt=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(e){const n=Math.floor(e/8);return(this.buffer[n]>>>7-e%8&1)===1},put:function(e,n){for(let r=0;r<n;r++)this.putBit((e>>>n-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),e&&(this.buffer[n]|=128>>>this.length%8),this.length++}},et=t,et}var tt,jt;function Zr(){if(jt)return tt;jt=1;function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return t.prototype.set=function(e,n,r,o){const i=e*this.size+n;this.data[i]=r,o&&(this.reservedBit[i]=!0)},t.prototype.get=function(e,n){return this.data[e*this.size+n]},t.prototype.xor=function(e,n,r){this.data[e*this.size+n]^=r},t.prototype.isReserved=function(e,n){return this.reservedBit[e*this.size+n]},tt=t,tt}var nt={},Yt;function eo(){return Yt||(Yt=1,(function(t){const e=ye().getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const o=Math.floor(r/7)+2,i=e(r),s=i===145?26:Math.ceil((i-13)/(2*o-2))*2,a=[i-7];for(let c=1;c<o-1;c++)a[c]=a[c-1]-s;return a.push(6),a.reverse()},t.getPositions=function(r){const o=[],i=t.getRowColCoords(r),s=i.length;for(let a=0;a<s;a++)for(let c=0;c<s;c++)a===0&&c===0||a===0&&c===s-1||a===s-1&&c===0||o.push([i[a],i[c]]);return o}})(nt)),nt}var rt={},Xt;function to(){if(Xt)return rt;Xt=1;const t=ye().getSymbolSize,e=7;return rt.getPositions=function(r){const o=t(r);return[[0,0],[o-e,0],[0,o-e]]},rt}var ot={},Zt;function no(){return Zt||(Zt=1,(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},t.from=function(o){return t.isValid(o)?parseInt(o,10):void 0},t.getPenaltyN1=function(o){const i=o.size;let s=0,a=0,c=0,l=null,d=null;for(let u=0;u<i;u++){a=c=0,l=d=null;for(let f=0;f<i;f++){let h=o.get(u,f);h===l?a++:(a>=5&&(s+=e.N1+(a-5)),l=h,a=1),h=o.get(f,u),h===d?c++:(c>=5&&(s+=e.N1+(c-5)),d=h,c=1)}a>=5&&(s+=e.N1+(a-5)),c>=5&&(s+=e.N1+(c-5))}return s},t.getPenaltyN2=function(o){const i=o.size;let s=0;for(let a=0;a<i-1;a++)for(let c=0;c<i-1;c++){const l=o.get(a,c)+o.get(a,c+1)+o.get(a+1,c)+o.get(a+1,c+1);(l===4||l===0)&&s++}return s*e.N2},t.getPenaltyN3=function(o){const i=o.size;let s=0,a=0,c=0;for(let l=0;l<i;l++){a=c=0;for(let d=0;d<i;d++)a=a<<1&2047|o.get(l,d),d>=10&&(a===1488||a===93)&&s++,c=c<<1&2047|o.get(d,l),d>=10&&(c===1488||c===93)&&s++}return s*e.N3},t.getPenaltyN4=function(o){let i=0;const s=o.data.length;for(let c=0;c<s;c++)i+=o.data[c];return Math.abs(Math.ceil(i*100/s/5)-10)*e.N4};function n(r,o,i){switch(r){case t.Patterns.PATTERN000:return(o+i)%2===0;case t.Patterns.PATTERN001:return o%2===0;case t.Patterns.PATTERN010:return i%3===0;case t.Patterns.PATTERN011:return(o+i)%3===0;case t.Patterns.PATTERN100:return(Math.floor(o/2)+Math.floor(i/3))%2===0;case t.Patterns.PATTERN101:return o*i%2+o*i%3===0;case t.Patterns.PATTERN110:return(o*i%2+o*i%3)%2===0;case t.Patterns.PATTERN111:return(o*i%3+(o+i)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(o,i){const s=i.size;for(let a=0;a<s;a++)for(let c=0;c<s;c++)i.isReserved(c,a)||i.xor(c,a,n(o,c,a))},t.getBestMask=function(o,i){const s=Object.keys(t.Patterns).length;let a=0,c=1/0;for(let l=0;l<s;l++){i(l),t.applyMask(l,o);const d=t.getPenaltyN1(o)+t.getPenaltyN2(o)+t.getPenaltyN3(o)+t.getPenaltyN4(o);t.applyMask(l,o),d<c&&(c=d,a=l)}return a}})(ot)),ot}var ke={},en;function Gn(){if(en)return ke;en=1;const t=Mt(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ke.getBlocksCount=function(o,i){switch(i){case t.L:return e[(o-1)*4+0];case t.M:return e[(o-1)*4+1];case t.Q:return e[(o-1)*4+2];case t.H:return e[(o-1)*4+3];default:return}},ke.getTotalCodewordsCount=function(o,i){switch(i){case t.L:return n[(o-1)*4+0];case t.M:return n[(o-1)*4+1];case t.Q:return n[(o-1)*4+2];case t.H:return n[(o-1)*4+3];default:return}},ke}var it={},Pe={},tn;function ro(){if(tn)return Pe;tn=1;const t=new Uint8Array(512),e=new Uint8Array(256);return(function(){let r=1;for(let o=0;o<255;o++)t[o]=r,e[r]=o,r<<=1,r&256&&(r^=285);for(let o=255;o<512;o++)t[o]=t[o-255]})(),Pe.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},Pe.exp=function(r){return t[r]},Pe.mul=function(r,o){return r===0||o===0?0:t[e[r]+e[o]]},Pe}var nn;function oo(){return nn||(nn=1,(function(t){const e=ro();t.mul=function(r,o){const i=new Uint8Array(r.length+o.length-1);for(let s=0;s<r.length;s++)for(let a=0;a<o.length;a++)i[s+a]^=e.mul(r[s],o[a]);return i},t.mod=function(r,o){let i=new Uint8Array(r);for(;i.length-o.length>=0;){const s=i[0];for(let c=0;c<o.length;c++)i[c]^=e.mul(o[c],s);let a=0;for(;a<i.length&&i[a]===0;)a++;i=i.slice(a)}return i},t.generateECPolynomial=function(r){let o=new Uint8Array([1]);for(let i=0;i<r;i++)o=t.mul(o,new Uint8Array([1,e.exp(i)]));return o}})(it)),it}var st,rn;function io(){if(rn)return st;rn=1;const t=oo();function e(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=t.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const o=new Uint8Array(r.length+this.degree);o.set(r);const i=t.mod(o,this.genPoly),s=this.degree-i.length;if(s>0){const a=new Uint8Array(this.degree);return a.set(i,s),a}return i},st=e,st}var at={},ct={},lt={},on;function jn(){return on||(on=1,lt.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),lt}var Y={},sn;function Yn(){if(sn)return Y;sn=1;const t="[0-9]+",e="[A-Z $%*+\\-./:]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+`)(?:.|[\r
]))+`;Y.KANJI=new RegExp(n,"g"),Y.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Y.BYTE=new RegExp(r,"g"),Y.NUMERIC=new RegExp(t,"g"),Y.ALPHANUMERIC=new RegExp(e,"g");const o=new RegExp("^"+n+"$"),i=new RegExp("^"+t+"$"),s=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Y.testKanji=function(c){return o.test(c)},Y.testNumeric=function(c){return i.test(c)},Y.testAlphanumeric=function(c){return s.test(c)},Y}var an;function me(){return an||(an=1,(function(t){const e=jn(),n=Yn();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(i,s){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!e.isValid(s))throw new Error("Invalid version: "+s);return s>=1&&s<10?i.ccBits[0]:s<27?i.ccBits[1]:i.ccBits[2]},t.getBestModeForData=function(i){return n.testNumeric(i)?t.NUMERIC:n.testAlphanumeric(i)?t.ALPHANUMERIC:n.testKanji(i)?t.KANJI:t.BYTE},t.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},t.isValid=function(i){return i&&i.bit&&i.ccBits};function r(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+o)}}t.from=function(i,s){if(t.isValid(i))return i;try{return r(i)}catch(a){return s}}})(ct)),ct}var cn;function so(){return cn||(cn=1,(function(t){const e=ye(),n=Gn(),r=Mt(),o=me(),i=jn(),s=7973,a=e.getBCHDigit(s);function c(f,h,m){for(let y=1;y<=40;y++)if(h<=t.getCapacity(y,m,f))return y}function l(f,h){return o.getCharCountIndicator(f,h)+4}function d(f,h){let m=0;return f.forEach(function(y){const x=l(y.mode,h);m+=x+y.getBitsLength()}),m}function u(f,h){for(let m=1;m<=40;m++)if(d(f,m)<=t.getCapacity(m,h,o.MIXED))return m}t.from=function(h,m){return i.isValid(h)?parseInt(h,10):m},t.getCapacity=function(h,m,y){if(!i.isValid(h))throw new Error("Invalid QR Code version");typeof y=="undefined"&&(y=o.BYTE);const x=e.getSymbolTotalCodewords(h),S=n.getTotalCodewordsCount(h,m),C=(x-S)*8;if(y===o.MIXED)return C;const w=C-l(y,h);switch(y){case o.NUMERIC:return Math.floor(w/10*3);case o.ALPHANUMERIC:return Math.floor(w/11*2);case o.KANJI:return Math.floor(w/13);case o.BYTE:default:return Math.floor(w/8)}},t.getBestVersionForData=function(h,m){let y;const x=r.from(m,r.M);if(Array.isArray(h)){if(h.length>1)return u(h,x);if(h.length===0)return 1;y=h[0]}else y=h;return c(y.mode,y.getLength(),x)},t.getEncodedBits=function(h){if(!i.isValid(h)||h<7)throw new Error("Invalid QR Code version");let m=h<<12;for(;e.getBCHDigit(m)-a>=0;)m^=s<<e.getBCHDigit(m)-a;return h<<12|m}})(at)),at}var ut={},ln;function ao(){if(ln)return ut;ln=1;const t=ye(),e=1335,n=21522,r=t.getBCHDigit(e);return ut.getEncodedBits=function(i,s){const a=i.bit<<3|s;let c=a<<10;for(;t.getBCHDigit(c)-r>=0;)c^=e<<t.getBCHDigit(c)-r;return(a<<10|c)^n},ut}var dt={},ft,un;function co(){if(un)return ft;un=1;const t=me();function e(n){this.mode=t.NUMERIC,this.data=n.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let o,i,s;for(o=0;o+3<=this.data.length;o+=3)i=this.data.substr(o,3),s=parseInt(i,10),r.put(s,10);const a=this.data.length-o;a>0&&(i=this.data.substr(o),s=parseInt(i,10),r.put(s,a*3+1))},ft=e,ft}var ht,dn;function lo(){if(dn)return ht;dn=1;const t=me(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(r){this.mode=t.ALPHANUMERIC,this.data=r}return n.getBitsLength=function(o){return 11*Math.floor(o/2)+6*(o%2)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(o){let i;for(i=0;i+2<=this.data.length;i+=2){let s=e.indexOf(this.data[i])*45;s+=e.indexOf(this.data[i+1]),o.put(s,11)}this.data.length%2&&o.put(e.indexOf(this.data[i]),6)},ht=n,ht}var gt,fn;function uo(){if(fn)return gt;fn=1;const t=me();function e(n){this.mode=t.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){for(let r=0,o=this.data.length;r<o;r++)n.put(this.data[r],8)},gt=e,gt}var yt,hn;function fo(){if(hn)return yt;hn=1;const t=me(),e=ye();function n(r){this.mode=t.KANJI,this.data=r}return n.getBitsLength=function(o){return o*13},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(r){let o;for(o=0;o<this.data.length;o++){let i=e.toSJIS(this.data[o]);if(i>=33088&&i<=40956)i-=33088;else if(i>=57408&&i<=60351)i-=49472;else throw new Error("Invalid SJIS character: "+this.data[o]+`
Make sure your charset is UTF-8`);i=(i>>>8&255)*192+(i&255),r.put(i,13)}},yt=n,yt}var mt={exports:{}},gn;function ho(){return gn||(gn=1,(function(t){var e={single_source_shortest_paths:function(n,r,o){var i={},s={};s[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var c,l,d,u,f,h,m,y,x;!a.empty();){c=a.pop(),l=c.value,u=c.cost,f=n[l]||{};for(d in f)f.hasOwnProperty(d)&&(h=f[d],m=u+h,y=s[d],x=typeof s[d]=="undefined",(x||y>m)&&(s[d]=m,a.push(d,m),i[d]=l))}if(typeof o!="undefined"&&typeof s[o]=="undefined"){var S=["Could not find a path from ",r," to ",o,"."].join("");throw new Error(S)}return i},extract_shortest_path_from_predecessor_list:function(n,r){for(var o=[],i=r;i;)o.push(i),n[i],i=n[i];return o.reverse(),o},find_path:function(n,r,o){var i=e.single_source_shortest_paths(n,r,o);return e.extract_shortest_path_from_predecessor_list(i,o)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,o={},i;n=n||{};for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);return o.queue=[],o.sorter=n.sorter||r.default_sorter,o},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var o={value:n,cost:r};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(mt)),mt.exports}var yn;function go(){return yn||(yn=1,(function(t){const e=me(),n=co(),r=lo(),o=uo(),i=fo(),s=Yn(),a=ye(),c=ho();function l(S){return unescape(encodeURIComponent(S)).length}function d(S,C,w){const g=[];let P;for(;(P=S.exec(w))!==null;)g.push({data:P[0],index:P.index,mode:C,length:P[0].length});return g}function u(S){const C=d(s.NUMERIC,e.NUMERIC,S),w=d(s.ALPHANUMERIC,e.ALPHANUMERIC,S);let g,P;return a.isKanjiModeEnabled()?(g=d(s.BYTE,e.BYTE,S),P=d(s.KANJI,e.KANJI,S)):(g=d(s.BYTE_KANJI,e.BYTE,S),P=[]),C.concat(w,g,P).sort(function(A,b){return A.index-b.index}).map(function(A){return{data:A.data,mode:A.mode,length:A.length}})}function f(S,C){switch(C){case e.NUMERIC:return n.getBitsLength(S);case e.ALPHANUMERIC:return r.getBitsLength(S);case e.KANJI:return i.getBitsLength(S);case e.BYTE:return o.getBitsLength(S)}}function h(S){return S.reduce(function(C,w){const g=C.length-1>=0?C[C.length-1]:null;return g&&g.mode===w.mode?(C[C.length-1].data+=w.data,C):(C.push(w),C)},[])}function m(S){const C=[];for(let w=0;w<S.length;w++){const g=S[w];switch(g.mode){case e.NUMERIC:C.push([g,{data:g.data,mode:e.ALPHANUMERIC,length:g.length},{data:g.data,mode:e.BYTE,length:g.length}]);break;case e.ALPHANUMERIC:C.push([g,{data:g.data,mode:e.BYTE,length:g.length}]);break;case e.KANJI:C.push([g,{data:g.data,mode:e.BYTE,length:l(g.data)}]);break;case e.BYTE:C.push([{data:g.data,mode:e.BYTE,length:l(g.data)}])}}return C}function y(S,C){const w={},g={start:{}};let P=["start"];for(let p=0;p<S.length;p++){const A=S[p],b=[];for(let E=0;E<A.length;E++){const B=A[E],R=""+p+E;b.push(R),w[R]={node:B,lastCount:0},g[R]={};for(let T=0;T<P.length;T++){const I=P[T];w[I]&&w[I].node.mode===B.mode?(g[I][R]=f(w[I].lastCount+B.length,B.mode)-f(w[I].lastCount,B.mode),w[I].lastCount+=B.length):(w[I]&&(w[I].lastCount=B.length),g[I][R]=f(B.length,B.mode)+4+e.getCharCountIndicator(B.mode,C))}}P=b}for(let p=0;p<P.length;p++)g[P[p]].end=0;return{map:g,table:w}}function x(S,C){let w;const g=e.getBestModeForData(S);if(w=e.from(C,g),w!==e.BYTE&&w.bit<g.bit)throw new Error('"'+S+'" cannot be encoded with mode '+e.toString(w)+`.
 Suggested mode is: `+e.toString(g));switch(w===e.KANJI&&!a.isKanjiModeEnabled()&&(w=e.BYTE),w){case e.NUMERIC:return new n(S);case e.ALPHANUMERIC:return new r(S);case e.KANJI:return new i(S);case e.BYTE:return new o(S)}}t.fromArray=function(C){return C.reduce(function(w,g){return typeof g=="string"?w.push(x(g,null)):g.data&&w.push(x(g.data,g.mode)),w},[])},t.fromString=function(C,w){const g=u(C,a.isKanjiModeEnabled()),P=m(g),p=y(P,w),A=c.find_path(p.map,"start","end"),b=[];for(let E=1;E<A.length-1;E++)b.push(p.table[A[E]].node);return t.fromArray(h(b))},t.rawSplit=function(C){return t.fromArray(u(C,a.isKanjiModeEnabled()))}})(dt)),dt}var mn;function yo(){if(mn)return Xe;mn=1;const t=ye(),e=Mt(),n=Xr(),r=Zr(),o=eo(),i=to(),s=no(),a=Gn(),c=io(),l=so(),d=ao(),u=me(),f=go();function h(p,A){const b=p.size,E=i.getPositions(A);for(let B=0;B<E.length;B++){const R=E[B][0],T=E[B][1];for(let I=-1;I<=7;I++)if(!(R+I<=-1||b<=R+I))for(let N=-1;N<=7;N++)T+N<=-1||b<=T+N||(I>=0&&I<=6&&(N===0||N===6)||N>=0&&N<=6&&(I===0||I===6)||I>=2&&I<=4&&N>=2&&N<=4?p.set(R+I,T+N,!0,!0):p.set(R+I,T+N,!1,!0))}}function m(p){const A=p.size;for(let b=8;b<A-8;b++){const E=b%2===0;p.set(b,6,E,!0),p.set(6,b,E,!0)}}function y(p,A){const b=o.getPositions(A);for(let E=0;E<b.length;E++){const B=b[E][0],R=b[E][1];for(let T=-2;T<=2;T++)for(let I=-2;I<=2;I++)T===-2||T===2||I===-2||I===2||T===0&&I===0?p.set(B+T,R+I,!0,!0):p.set(B+T,R+I,!1,!0)}}function x(p,A){const b=p.size,E=l.getEncodedBits(A);let B,R,T;for(let I=0;I<18;I++)B=Math.floor(I/3),R=I%3+b-8-3,T=(E>>I&1)===1,p.set(B,R,T,!0),p.set(R,B,T,!0)}function S(p,A,b){const E=p.size,B=d.getEncodedBits(A,b);let R,T;for(R=0;R<15;R++)T=(B>>R&1)===1,R<6?p.set(R,8,T,!0):R<8?p.set(R+1,8,T,!0):p.set(E-15+R,8,T,!0),R<8?p.set(8,E-R-1,T,!0):R<9?p.set(8,15-R-1+1,T,!0):p.set(8,15-R-1,T,!0);p.set(E-8,8,1,!0)}function C(p,A){const b=p.size;let E=-1,B=b-1,R=7,T=0;for(let I=b-1;I>0;I-=2)for(I===6&&I--;;){for(let N=0;N<2;N++)if(!p.isReserved(B,I-N)){let j=!1;T<A.length&&(j=(A[T]>>>R&1)===1),p.set(B,I-N,j),R--,R===-1&&(T++,R=7)}if(B+=E,B<0||b<=B){B-=E,E=-E;break}}}function w(p,A,b){const E=new n;b.forEach(function(N){E.put(N.mode.bit,4),E.put(N.getLength(),u.getCharCountIndicator(N.mode,p)),N.write(E)});const B=t.getSymbolTotalCodewords(p),R=a.getTotalCodewordsCount(p,A),T=(B-R)*8;for(E.getLengthInBits()+4<=T&&E.put(0,4);E.getLengthInBits()%8!==0;)E.putBit(0);const I=(T-E.getLengthInBits())/8;for(let N=0;N<I;N++)E.put(N%2?17:236,8);return g(E,p,A)}function g(p,A,b){const E=t.getSymbolTotalCodewords(A),B=a.getTotalCodewordsCount(A,b),R=E-B,T=a.getBlocksCount(A,b),I=E%T,N=T-I,j=Math.floor(E/T),le=Math.floor(R/T),yr=le+1,Ut=j-le,mr=new c(Ut);let _e=0;const Le=new Array(T),Lt=new Array(T);let Qe=0;const wr=new Uint8Array(p.buffer);for(let we=0;we<T;we++){const Ve=we<N?le:yr;Le[we]=wr.slice(_e,_e+Ve),Lt[we]=mr.encode(Le[we]),_e+=Ve,Qe=Math.max(Qe,Ve)}const Fe=new Uint8Array(E);let Kt=0,ne,re;for(ne=0;ne<Qe;ne++)for(re=0;re<T;re++)ne<Le[re].length&&(Fe[Kt++]=Le[re][ne]);for(ne=0;ne<Ut;ne++)for(re=0;re<T;re++)Fe[Kt++]=Lt[re][ne];return Fe}function P(p,A,b,E){let B;if(Array.isArray(p))B=f.fromArray(p);else if(typeof p=="string"){let j=A;if(!j){const le=f.rawSplit(p);j=l.getBestVersionForData(le,b)}B=f.fromString(p,j||40)}else throw new Error("Invalid data");const R=l.getBestVersionForData(B,b);if(!R)throw new Error("The amount of data is too big to be stored in a QR Code");if(!A)A=R;else if(A<R)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+R+`.
`);const T=w(A,b,B),I=t.getSymbolSize(A),N=new r(I);return h(N,A),m(N),y(N,A),S(N,b,0),A>=7&&x(N,A),C(N,T),isNaN(E)&&(E=s.getBestMask(N,S.bind(null,N,b))),s.applyMask(E,N),S(N,b,E),{modules:N,version:A,errorCorrectionLevel:b,maskPattern:E,segments:B}}return Xe.create=function(A,b){if(typeof A=="undefined"||A==="")throw new Error("No input text");let E=e.M,B,R;return typeof b!="undefined"&&(E=e.from(b.errorCorrectionLevel,e.M),B=l.from(b.version),R=s.from(b.maskPattern),b.toSJISFunc&&t.setToSJISFunction(b.toSJISFunc)),P(A,B,E,R)},Xe}var wt={},pt={},wn;function Xn(){return wn||(wn=1,(function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(i){return[i,i]}))),r.length===6&&r.push("F","F");const o=parseInt(r.join(""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:o&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const o=typeof r.margin=="undefined"||r.margin===null||r.margin<0?4:r.margin,i=r.width&&r.width>=21?r.width:void 0,s=r.scale||4;return{width:i,scale:i?4:s,margin:o,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,o){return o.width&&o.width>=r+o.margin*2?o.width/(r+o.margin*2):o.scale},t.getImageWidth=function(r,o){const i=t.getScale(r,o);return Math.floor((r+o.margin*2)*i)},t.qrToImageData=function(r,o,i){const s=o.modules.size,a=o.modules.data,c=t.getScale(s,i),l=Math.floor((s+i.margin*2)*c),d=i.margin*c,u=[i.color.light,i.color.dark];for(let f=0;f<l;f++)for(let h=0;h<l;h++){let m=(f*l+h)*4,y=i.color.light;if(f>=d&&h>=d&&f<l-d&&h<l-d){const x=Math.floor((f-d)/c),S=Math.floor((h-d)/c);y=u[a[x*s+S]?1:0]}r[m++]=y.r,r[m++]=y.g,r[m++]=y.b,r[m]=y.a}}})(pt)),pt}var pn;function mo(){return pn||(pn=1,(function(t){const e=Xn();function n(o,i,s){o.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=s,i.width=s,i.style.height=s+"px",i.style.width=s+"px"}function r(){try{return document.createElement("canvas")}catch(o){throw new Error("You need to specify a canvas element")}}t.render=function(i,s,a){let c=a,l=s;typeof c=="undefined"&&(!s||!s.getContext)&&(c=s,s=void 0),s||(l=r()),c=e.getOptions(c);const d=e.getImageWidth(i.modules.size,c),u=l.getContext("2d"),f=u.createImageData(d,d);return e.qrToImageData(f.data,i,c),n(u,l,d),u.putImageData(f,0,0),l},t.renderToDataURL=function(i,s,a){let c=a;typeof c=="undefined"&&(!s||!s.getContext)&&(c=s,s=void 0),c||(c={});const l=t.render(i,s,c),d=c.type||"image/png",u=c.rendererOpts||{};return l.toDataURL(d,u.quality)}})(wt)),wt}var St={},Sn;function wo(){if(Sn)return St;Sn=1;const t=Xn();function e(o,i){const s=o.a/255,a=i+'="'+o.hex+'"';return s<1?a+" "+i+'-opacity="'+s.toFixed(2).slice(1)+'"':a}function n(o,i,s){let a=o+i;return typeof s!="undefined"&&(a+=" "+s),a}function r(o,i,s){let a="",c=0,l=!1,d=0;for(let u=0;u<o.length;u++){const f=Math.floor(u%i),h=Math.floor(u/i);!f&&!l&&(l=!0),o[u]?(d++,u>0&&f>0&&o[u-1]||(a+=l?n("M",f+s,.5+h+s):n("m",c,0),c=0,l=!1),f+1<i&&o[u+1]||(a+=n("h",d),d=0)):c++}return a}return St.render=function(i,s,a){const c=t.getOptions(s),l=i.modules.size,d=i.modules.data,u=l+c.margin*2,f=c.color.light.a?"<path "+e(c.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",h="<path "+e(c.color.dark,"stroke")+' d="'+r(d,l,c.margin)+'"/>',m='viewBox="0 0 '+u+" "+u+'"',x='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+m+' shape-rendering="crispEdges">'+f+h+`</svg>
`;return typeof a=="function"&&a(null,x),x},St}var En;function po(){if(En)return pe;En=1;const t=Yr(),e=yo(),n=mo(),r=wo();function o(i,s,a,c,l){const d=[].slice.call(arguments,1),u=d.length,f=typeof d[u-1]=="function";if(!f&&!t())throw new Error("Callback required as last argument");if(f){if(u<2)throw new Error("Too few arguments provided");u===2?(l=a,a=s,s=c=void 0):u===3&&(s.getContext&&typeof l=="undefined"?(l=c,c=void 0):(l=c,c=a,a=s,s=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(a=s,s=c=void 0):u===2&&!s.getContext&&(c=a,a=s,s=void 0),new Promise(function(h,m){try{const y=e.create(a,c);h(i(y,s,c))}catch(y){m(y)}})}try{const h=e.create(a,c);l(null,i(h,s,c))}catch(h){l(h)}}return pe.create=e.create,pe.toCanvas=o.bind(null,n.render),pe.toDataURL=o.bind(null,n.renderToDataURL),pe.toString=o.bind(null,function(i,s,a){return r.render(i,a)}),pe}var Zn=po();const So=jr(Zn),bn=br({__proto__:null,default:So},[Zn]);function Eo(t){return M(this,null,function*(){const n=new ReadableStream({start(o){o.enqueue(t),o.close()}}).pipeThrough(new CompressionStream("deflate-raw")),r=yield new Response(n).arrayBuffer();return new Uint8Array(r)})}function Cn(t){return M(this,null,function*(){const n=new ReadableStream({start(o){o.enqueue(t),o.close()}}).pipeThrough(new DecompressionStream("deflate-raw")),r=yield new Response(n).arrayBuffer();return new Uint8Array(r)})}class k extends Error{constructor(n,r){super(n);D(this,"code");this.code=r,this.name="SHCError"}}class $e extends k{constructor(e){super(e,"JWS_ERROR"),this.name="JWSError"}}class O extends k{constructor(e){super(e,"QR_CODE_ERROR"),this.name="QRCodeError"}}class bo extends k{constructor(e){super(e,"INVALID_BUNDLE_REFERENCE_ERROR"),this.name="InvalidBundleReferenceError"}}class Et extends k{constructor(e){super(e,"FILE_FORMAT_ERROR"),this.name="FileFormatError"}}class de extends k{constructor(e){super(e,"VERIFICATION_ERROR"),this.name="VerificationError"}}class Co extends k{constructor(e){super(e,"BAD_SIGNATURE"),this.name="SignatureVerificationError"}}class Ao extends k{constructor(e){super(e,"EXPIRED"),this.name="ExpirationError"}}class ae extends k{constructor(e){super(e,"FAILED_VALIDATION"),this.name="PayloadValidationError"}}class X extends k{constructor(e){super(e,"FAILED_VALIDATION"),this.name="BundleValidationError"}}class F extends k{constructor(e){super(e,"FAILED_VALIDATION"),this.name="CredentialValidationError"}}class Nt{process(e){if(!e||e.resourceType!=="Bundle")throw new X("Invalid bundle: must be a FHIR Bundle resource");const n=JSON.parse(JSON.stringify(e));return n.type||(n.type="collection"),n}processForQR(e,n={}){var o;const r=this.process(e);return this.optimizeForQR(r,(o=n.strictReferences)!=null?o:!0)}optimizeForQR(e,n){const r=JSON.parse(JSON.stringify(e));delete r.id;const o=new Map;return r.entry&&(r.entry.forEach((i,s)=>{i.fullUrl&&(o.set(i.fullUrl.split("/").slice(-2).join("/"),`resource:${s}`),i.fullUrl=`resource:${s}`)}),r.entry.forEach(i=>{i.resource&&(i.resource=this.optimizeResource(i.resource,o,n))})),r}optimizeResource(e,n,r){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(i=>this.optimizeResource(i,n,r)).filter(i=>i!=null);const o={};for(const[i,s]of Object.entries(e))if(!(s==null||Array.isArray(s)&&s.length===0)&&i!=="id"){if(i==="meta"){if(typeof s=="object"&&s!==null){const a=s;a.security&&Array.isArray(a.security)&&(o[i]={security:a.security})}continue}if(!(i==="text"&&this.isCodeableConcept(e)||i==="text"&&this.isDomainResource(e))&&!(i==="display"&&typeof s=="string"&&this.isWithinCoding(e))){if(i==="reference"&&typeof s=="string"){const a=n.get(s);if(a)o[i]=a;else{if(r)throw new bo(`Reference "${s}" not found in bundle resources`);o[i]=s}continue}o[i]=this.optimizeResource(s,n,r)}}return o}isDomainResource(e){return e!=null&&e.text!=null&&typeof e.text=="object"&&"div"in e.text}isCodeableConcept(e){return e!=null&&typeof e=="object"&&"coding"in e&&Array.isArray(e.coding)}isWithinCoding(e){return e!==null&&typeof e=="object"&&"system"in e&&"code"in e&&typeof e.system=="string"&&typeof e.code=="string"}validate(e){try{if(!e)throw new X("Bundle cannot be null or undefined");if(e.resourceType!=="Bundle")throw new X("Resource must be of type Bundle");if(e.type&&!new Set(["document","message","transaction","transaction-response","batch","batch-response","history","searchset","collection"]).has(e.type))throw new X(`Invalid bundle.type: ${e.type}`);if(e.entry){if(!Array.isArray(e.entry))throw new X("Bundle.entry must be an array");for(const[n,r]of e.entry.entries()){if(!r.resource)throw new X(`Bundle.entry[${n}] must contain a resource`);if(!r.resource.resourceType)throw new X(`Bundle.entry[${n}].resource must have a resourceType`)}}return!0}catch(n){if(n instanceof X)throw n;const r=n instanceof Error?n.message:String(n);throw new X(`Bundle validation failed: ${r}`)}}}class er{sign(i,s,a){return M(this,arguments,function*(e,n,r,o={}){var c;try{this.validateJWTPayload(e);const d={alg:"ES256",kid:yield this.deriveKidFromPublicKey(r)},u=JSON.stringify(e);let h=new TextEncoder().encode(u);((c=o.enableCompression)!=null?c:!0)&&(h=yield Eo(h),d.zip="DEF");let y;return typeof n=="string"?y=yield Ur(n,"ES256"):n&&typeof n=="object"&&"kty"in n?y=yield Ee(n,"ES256"):y=n,yield new Vr(h).setProtectedHeader(d).sign(y)}catch(l){if(l instanceof k)throw l;const d=l instanceof Error?l.message:String(l);throw new $e(`JWS signing failed: ${d}`)}})}deriveKidFromPublicKey(e){return M(this,null,function*(){let n;typeof e=="string"?n=yield _t(e,"ES256"):e&&typeof e=="object"&&"kty"in e?n=yield Ee(e,"ES256"):n=e;const r=yield Fn(n);return yield qr(r)})}verify(e,n,r){return M(this,null,function*(){var o;try{if(!e||typeof e!="string")throw new ae("Invalid JWS: must be a non-empty string");let i;typeof n=="string"?i=yield _t(n,"ES256"):n&&typeof n=="object"&&"kty"in n?i=yield Ee(n,"ES256"):i=n;let s,a;try{const f=yield _r(e,i);s=f.payload,a=f.protectedHeader}catch(f){const h=f instanceof Error?f.message:String(f);throw new Co(`Invalid JWS signature: ${h}`)}let c=s;a.zip==="DEF"&&(c=yield Cn(s));const l=new TextDecoder().decode(c),d=JSON.parse(l);if(this.validateJWTPayload(d),(o=r==null?void 0:r.verifyExpiration)!=null?o:!0){const f=Math.floor(Date.now()/1e3);if(typeof d.exp=="number"&&d.exp<f)throw new Ao("SMART Health Card has expired")}return d}catch(i){if(i instanceof k)throw i;const s=i instanceof Error?i.message:String(i);throw new $e(`JWS verification failed: ${s}`)}})}validateJWTPayload(e){if(!e||typeof e!="object")throw new ae("Invalid JWT payload: must be an object");if(!e.iss||typeof e.iss!="string")throw new ae("Invalid JWT payload: 'iss' (issuer) is required and must be a string");if(!e.nbf||typeof e.nbf!="number")throw new ae("Invalid JWT payload: 'nbf' (not before) is required and must be a number");if(e.exp!==void 0&&typeof e.exp!="number")throw new ae("Invalid JWT payload: 'exp' (expiration) must be a number if provided");if(e.exp&&e.exp<=e.nbf)throw new ae("Invalid JWT payload: 'exp' must be greater than 'nbf'");if(!e.vc||typeof e.vc!="object")throw new ae("Invalid JWT payload: 'vc' (verifiable credential) is required and must be an object")}parseUnverified(e){return M(this,null,function*(){try{if(!e||typeof e!="string")throw new ae("Invalid JWS: must be a non-empty string");const n=e.split(".");if(n.length!==3)throw new $e("Invalid Compact JWS");const r=Gr(e),o=n[1],i=fe(o),s=r.zip==="DEF"?yield Cn(i):i,a=new TextDecoder().decode(s),c=JSON.parse(a);return{header:r,payload:c}}catch(n){if(n instanceof k)throw n;const r=n instanceof Error?n.message:String(n);throw new $e(`Failed to parse JWS: ${r}`)}})}}const vo={L:1195,M:927,Q:670,H:519};class Ct{constructor(e={}){D(this,"config");var o,i;const n=this.buildEncodeOptions(e.encodeOptions),r=(o=e.maxSingleQRSize)!=null?o:this.deriveMaxSingleQRSize(n.errorCorrectionLevel);this.config={maxSingleQRSize:r,enableChunking:(i=e.enableChunking)!=null?i:!1,encodeOptions:n}}deriveMaxSingleQRSize(e){return vo[e]}buildEncodeOptions(e={}){var r,o,i,s;const n={errorCorrectionLevel:"L",scale:4,margin:1,color:{dark:"#000000ff",light:"#ffffffff"}};return $({errorCorrectionLevel:(r=e.errorCorrectionLevel)!=null?r:n.errorCorrectionLevel,scale:(o=e.scale)!=null?o:n.scale,margin:(i=e.margin)!=null?i:n.margin,color:(s=e.color)!=null?s:n.color},e)}generateQR(e){return M(this,null,function*(){const n=e.length>this.config.maxSingleQRSize;if(!this.config.enableChunking&&n)throw new O(`Chunking is not enabled, but JWS length exceeds maxSingleQRSize:
        ${e.length} > ${this.config.maxSingleQRSize}. Use enableChunking: true to enable chunking.`);if(n)return yield this.generateChunkedQR(e);{const r=this.encodeJWSToNumeric(e);return yield this.generateSingleQR(r)}})}decodeQR(e){return M(this,null,function*(){if(!e||e.length===0)throw new O("No QR code data provided");if(e.length===1){const n=e[0];if(!n)throw new O("QR code data is undefined");return this.decodeSingleQR(n)}return this.decodeChunkedQR(e)})}encodeJWSToNumeric(e){return e.split("").map(r=>{const i=r.charCodeAt(0)-45;if(i<0||i>77)throw new O(`Invalid character '${r}' in JWS. Expected base64url characters only.`);return i.toString().padStart(2,"0")}).join("")}generateSingleQR(e){return M(this,null,function*(){const n=yield zt(()=>Promise.resolve().then(()=>bn),void 0,import.meta.url),r=[{data:new TextEncoder().encode("shc:/"),mode:"byte"},{data:e,mode:"numeric"}];return[yield n.toDataURL(r,this.config.encodeOptions)]})}chunkJWS(e){if(!e||typeof e!="string")throw new O("Invalid JWS: must be a non-empty string");const n=this.config.maxSingleQRSize;if(e.length<=n)return[`shc:/${this.encodeJWSToNumeric(e)}`];const r=Math.ceil(e.length/n),o=Math.ceil(e.length/r),i=[];for(let s=0,a=1;s<e.length;s+=o,a++){const c=e.substring(s,s+o),l=this.encodeJWSToNumeric(c);i.push(`shc:/${a}/${r}/${l}`)}return i}generateChunkedQR(e){return M(this,null,function*(){const n=yield zt(()=>Promise.resolve().then(()=>bn),void 0,import.meta.url),r=this.chunkJWS(e),o=r.length,i=[];for(let s=0;s<r.length;s++){const a=s+1,l=r[s].split("/").pop(),d=`shc:/${a}/${o}/`,u=[{data:new TextEncoder().encode(d),mode:"byte"},{data:l,mode:"numeric"}],f=yield n.toDataURL(u,this.config.encodeOptions);i.push(f)}return i})}decodeSingleQR(e){const n="shc:/";if(!e.startsWith(n))throw new O(`Invalid QR code format. Expected '${n}' prefix.`);const r=e.substring(n.length);return this.decodeNumericToJWS(r)}decodeChunkedQR(e){const n=[];let r=0;for(const i of e){const s="shc:/";if(!i.startsWith(s))throw new O(`Invalid chunked QR code format. Expected '${s}' prefix.`);const c=i.substring(s.length).split("/");if(c.length!==3)throw new O("Invalid chunked QR code format. Expected format: shc:/INDEX/TOTAL/DATA");const l=c[0],d=c[1],u=c[2];if(!l||!d||!u)throw new O("Invalid chunked QR code format: missing parts");const f=parseInt(l),h=parseInt(d);if(Number.isNaN(f)||Number.isNaN(h)||f<1||f>h)throw new O("Invalid chunk index or total in QR code");if(r===0)r=h;else if(r!==h)throw new O("Inconsistent total chunk count across QR codes");n.push({index:f,data:u})}if(n.length!==r)throw new O(`Missing chunks. Expected ${r}, got ${n.length}`);n.sort((i,s)=>i.index-s.index);const o=n.map(i=>i.data).join("");return this.decodeNumericToJWS(o)}decodeNumericToJWS(e){if(e.length%2!==0)throw new O("Invalid numeric data: must have even length");const n=45,r=e.match(/(\d\d)/g);if(!r)throw new O("Invalid numeric data: cannot parse digit pairs");for(const o of r){const i=parseInt(o);if(i>77)throw new O(`Invalid digit pair '${o}': value ${i} exceeds maximum 77`)}return r.map(o=>{const s=parseInt(o)+n;return String.fromCharCode(s)}).join("")}}class tr{constructor(e,n){D(this,"jws");D(this,"originalBundle");this.jws=e,this.originalBundle=n}asJWS(){return this.jws}getOriginalBundle(){return this.originalBundle}asQR(){return M(this,arguments,function*(e={}){return yield new Ct(e).generateQR(this.jws)})}asQRNumeric(e={}){return new Ct(e).chunkJWS(this.jws)}asBundle(){return M(this,arguments,function*(e={}){const{optimizeForQR:n=!1,strictReferences:r=!0}=e;return n?new Nt().processForQR(this.originalBundle,{strictReferences:r}):this.originalBundle})}asFileContent(){return M(this,null,function*(){const e={verifiableCredential:[this.jws]};return JSON.stringify(e)})}asFileBlob(){return M(this,null,function*(){const e=yield this.asFileContent();return new Blob([e],{type:"application/smart-health-card"})})}}class nr{create(e,n={}){if(!e||e.resourceType!=="Bundle")throw new F("Invalid FHIR Bundle provided");const r=n.fhirVersion||"4.0.1";return{vc:{type:this.createStandardTypes(n.includeAdditionalTypes),credentialSubject:{fhirVersion:r,fhirBundle:e}}}}validate(e){try{if(!e||!e.vc)throw new F("Invalid VC: missing vc property");return this.validateTypes(e.vc.type),this.validateCredentialSubject(e.vc.credentialSubject),!0}catch(n){if(n instanceof F)throw n;const r=n instanceof Error?n.message:String(n);throw new F(`VC validation failed: ${r}`)}}createStandardTypes(e){const n=["https://smarthealth.cards#health-card"];return e&&e.length>0?[...n,...e]:n}validateTypes(e){if(!Array.isArray(e))throw new F("VC type must be an array");if(e.length<1)throw new F("VC type must contain at least 1 element");if(!e.includes("https://smarthealth.cards#health-card"))throw new F("VC type must include https://smarthealth.cards#health-card")}validateCredentialSubject(e){if(!e)throw new F("VC credentialSubject is required");if(!e.fhirVersion)throw new F("VC credentialSubject must include fhirVersion");if(!/^\d+\.\d+\.\d+$/.test(e.fhirVersion))throw new F("VC fhirVersion must be in semantic version format (e.g., 4.0.1)");if(!e.fhirBundle)throw new F("VC credentialSubject must include fhirBundle");if(e.fhirBundle.resourceType!=="Bundle")throw new X("VC fhirBundle must be a valid FHIR Bundle")}}class xo{constructor(e){D(this,"config");D(this,"bundleProcessor");D(this,"vcProcessor");D(this,"jwsProcessor");var n,r,o;this.config=ue($({},e),{expirationTime:(n=e.expirationTime)!=null?n:null,enableQROptimization:(r=e.enableQROptimization)!=null?r:!0,strictReferences:(o=e.strictReferences)!=null?o:!0}),this.bundleProcessor=new Nt,this.vcProcessor=new nr,this.jwsProcessor=new er}issue(r){return M(this,arguments,function*(e,n={}){const o=yield this.createJWS(e,n);return new tr(o,e)})}createJWS(r){return M(this,arguments,function*(e,n={}){const o=this.config.enableQROptimization?this.bundleProcessor.processForQR(e,{strictReferences:this.config.strictReferences}):this.bundleProcessor.process(e);this.bundleProcessor.validate(o);const i=this.vcProcessor.create(o,n);this.vcProcessor.validate(i);const s=Math.floor(Date.now()/1e3),a={iss:this.config.issuer,nbf:s,vc:i.vc};return this.config.expirationTime&&(a.exp=s+this.config.expirationTime),yield this.jwsProcessor.sign(a,this.config.privateKey,this.config.publicKey,{enableCompression:!0})})}}class Ro{constructor(e){D(this,"config");D(this,"bundleProcessor");D(this,"vcProcessor");D(this,"jwsProcessor");var n,r,o;this.config=ue($({},e),{enableQROptimization:(n=e.enableQROptimization)!=null?n:!0,strictReferences:(r=e.strictReferences)!=null?r:!0,verifyExpiration:(o=e.verifyExpiration)!=null?o:!0}),this.bundleProcessor=new Nt,this.vcProcessor=new nr,this.jwsProcessor=new er}fromFileContent(e){return M(this,null,function*(){let n;e instanceof Blob?n=yield e.text():n=e;const r=n;let o;try{const i=JSON.parse(r);if(i.verifiableCredential&&Array.isArray(i.verifiableCredential)){if(i.verifiableCredential.length===0)throw new Et("File contains empty verifiableCredential array");o=i.verifiableCredential[0]}else throw new Et("File does not contain expected verifiableCredential array")}catch(i){if(i instanceof k)throw i;const s=i instanceof Error?i.message:String(i);throw new Et(`Invalid file format - expected JSON with verifiableCredential array: ${s}`)}return yield this.fromJWS(o)})}fromJWS(e){return M(this,null,function*(){try{let n=this.config.publicKey;n||(n=yield this.resolvePublicKeyFromJWKS(e));const r=yield this.jwsProcessor.verify(e,n,{verifyExpiration:this.config.verifyExpiration}),o=r.vc.credentialSubject.fhirBundle;this.bundleProcessor.validate(o);const i={vc:r.vc};return this.vcProcessor.validate(i),new tr(e,o)}catch(n){if(n instanceof k)throw n;const r=n instanceof Error?n.message:String(n);throw new de(`Failed to verify SMART Health Card: ${r}`)}})}resolvePublicKeyFromJWKS(e){return M(this,null,function*(){try{const{header:n,payload:r}=yield this.jwsProcessor.parseUnverified(e);if(!r.iss||typeof r.iss!="string")throw new de("Cannot resolve JWKS: missing 'iss' in payload");if(!n.kid||typeof n.kid!="string")throw new de("Cannot resolve JWKS: missing 'kid' in JWS header");const o=`${r.iss.replace(/\/$/,"")}/.well-known/jwks.json`,i=yield fetch(o);if(!i.ok)throw new de(`Failed to fetch JWKS from issuer (${o}): ${i.status} ${i.statusText}`);const s=yield i.json();if(!s||!Array.isArray(s.keys))throw new de("Invalid JWKS format: missing keys array");const a=s.keys.find(l=>l.kid===n.kid);if(!a)throw new de(`No matching key found in JWKS for kid '${n.kid}'`);return yield Ee(a,"ES256")}catch(n){if(n instanceof k)throw n;const r=n instanceof Error?n.message:String(n);throw new de(`Unable to resolve public key via JWKS endpoint: ${r}`)}})}fromQRNumeric(e){return M(this,null,function*(){try{const n=new Ct,r=Array.isArray(e)?e:[e],o=yield n.decodeQR(r);return yield this.fromJWS(o)}catch(n){if(n instanceof k)throw n;const r=n instanceof Error?n.message:String(n);throw new O(`Failed to read SMART Health Card from QR numeric data: ${r}`)}})}}/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/const Ie={newline:10,reset:27};function Bo(t){if(!Number.isSafeInteger(t))throw new Error(`integer expected: ${t}`)}function Po(t){if(!Number.isSafeInteger(t)||t<1||t>40)throw new Error(`Invalid version=${t}. Expected number [1..40]`)}function Io(t,e){return t.toString(2).padStart(e,"0")}function An(t,e){const n=t%e;return n>=0?n:e+n}function H(t,e){return new Array(t).fill(e)}function vn(...t){let e=0;for(const r of t)e=Math.max(e,r.length);const n=[];for(let r=0;r<e;r++)for(const o of t)r>=o.length||n.push(o[r]);return new Uint8Array(n)}function To(){let t,e=1/0;return{add(n,r){n>=e||(t=r,e=n)},get:()=>t,score:()=>e}}function xn(t){return{has:e=>t.includes(e),decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})},encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Bo(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})}}}class W{constructor(e,n){D(this,"data");D(this,"height");D(this,"width");const{height:r,width:o}=W.size(e);this.data=n||Array.from({length:r},()=>H(o,void 0)),this.height=r,this.width=o}static size(e,n){if(typeof e=="number"&&(e={height:e,width:e}),!Number.isSafeInteger(e.height)&&e.height!==1/0)throw new Error(`Bitmap: invalid height=${e.height} (${typeof e.height})`);if(!Number.isSafeInteger(e.width)&&e.width!==1/0)throw new Error(`Bitmap: invalid width=${e.width} (${typeof e.width})`);return n!==void 0&&(e={width:Math.min(e.width,n.width),height:Math.min(e.height,n.height)}),e}static fromString(e){e=e.replace(/^\n+/g,"").replace(/\n+$/g,"");const n=e.split(String.fromCharCode(Ie.newline)),r=n.length,o=new Array(r);let i;for(const s of n){const a=s.split("").map(c=>{if(c==="X")return!0;if(c===" ")return!1;if(c!=="?")throw new Error(`Bitmap.fromString: unknown symbol=${c}`)});if(i&&a.length!==i)throw new Error(`Bitmap.fromString different row sizes: width=${i} cur=${a.length}`);i=a.length,o.push(a)}return i||(i=0),new W({height:r,width:i},o)}point(e){return this.data[e.y][e.x]}isInside(e){return 0<=e.x&&e.x<this.width&&0<=e.y&&e.y<this.height}size(e){if(!e)return{height:this.height,width:this.width};const{x:n,y:r}=this.xy(e);return{height:this.height-r,width:this.width-n}}xy(e){if(typeof e=="number"&&(e={x:e,y:e}),!Number.isSafeInteger(e.x))throw new Error(`Bitmap: invalid x=${e.x}`);if(!Number.isSafeInteger(e.y))throw new Error(`Bitmap: invalid y=${e.y}`);return e.x=An(e.x,this.width),e.y=An(e.y,this.height),e}rect(e,n,r){const{x:o,y:i}=this.xy(e),{height:s,width:a}=W.size(n,this.size({x:o,y:i}));for(let c=0;c<s;c++)for(let l=0;l<a;l++)this.data[i+c][o+l]=typeof r=="function"?r({x:l,y:c},this.data[i+c][o+l]):r;return this}rectRead(e,n,r){return this.rect(e,n,(o,i)=>(r(o,i),i))}hLine(e,n,r){return this.rect(e,{width:n,height:1},r)}vLine(e,n,r){return this.rect(e,{width:1,height:n},r)}border(e=2,n){const r=this.height+2*e,o=this.width+2*e,i=H(e,n),s=Array.from({length:e},()=>H(o,n));return new W({height:r,width:o},[...s,...this.data.map(a=>[...i,...a,...i]),...s])}embed(e,n){return this.rect(e,n.size(),({x:r,y:o})=>n.data[o][r])}rectSlice(e,n=this.size()){const r=new W(W.size(n,this.size(this.xy(e))));return this.rect(e,n,({x:o,y:i},s)=>r.data[i][o]=s),r}inverse(){const{height:e,width:n}=this;return new W({height:n,width:e}).rect({x:0,y:0},1/0,({x:o,y:i})=>this.data[o][i])}scale(e){if(!Number.isSafeInteger(e)||e>1024)throw new Error(`invalid scale factor: ${e}`);const{height:n,width:r}=this;return new W({height:e*n,width:e*r}).rect({x:0,y:0},1/0,({x:i,y:s})=>this.data[Math.floor(s/e)][Math.floor(i/e)])}clone(){return new W(this.size()).rect({x:0,y:0},this.size(),({x:n,y:r})=>this.data[r][n])}assertDrawn(){this.rectRead(0,1/0,(e,n)=>{if(typeof n!="boolean")throw new Error(`Invalid color type=${typeof n}`)})}toString(){return this.data.map(e=>e.map(n=>n===void 0?"?":n?"X":" ").join("")).join(String.fromCharCode(Ie.newline))}toASCII(){const{height:e,width:n,data:r}=this;let o="";for(let i=0;i<e;i+=2){for(let s=0;s<n;s++){const a=r[i][s],c=i+1>=e?!0:r[i+1][s];!a&&!c?o+="█":!a&&c?o+="▀":a&&!c?o+="▄":a&&c&&(o+=" ")}o+=String.fromCharCode(Ie.newline)}return o}toTerm(){const e=String.fromCharCode(Ie.reset),n=e+"[0m",r=e+"[1;47m  "+n,o=e+"[40m  "+n;return this.data.map(i=>i.map(s=>s?o:r).join("")).join(String.fromCharCode(Ie.newline))}toSVG(e=!0){let n=`<svg viewBox="0 0 ${this.width} ${this.height}" xmlns="http://www.w3.org/2000/svg">`,r="",o;return this.rectRead(0,1/0,(i,s)=>{if(!s)return;const{x:a,y:c}=i;if(!e){n+=`<rect x="${a}" y="${c}" width="1" height="1" />`;return}let l=`M${a} ${c}`;if(o){const u=`m${a-o.x} ${c-o.y}`;u.length<=l.length&&(l=u)}const d=a<10?`H${a}`:"h-1";r+=`${l}h1v1${d}Z`,o=i}),e&&(n+=`<path d="${r}"/>`),n+="</svg>",n}toGIF(){const e=a=>[a&255,a>>>8&255],n=[...e(this.width),...e(this.height)],r=[];this.rectRead(0,1/0,(a,c)=>r.push(+(c===!0)));const o=126,i=[71,73,70,56,55,97,...n,246,0,0,255,255,255,...H(381,0),44,0,0,0,0,...n,0,7],s=Math.floor(r.length/o);for(let a=0;a<s;a++)i.push(o+1,128,...r.slice(o*a,o*(a+1)).map(c=>+c));return i.push(r.length%o+1,128,...r.slice(s*o).map(a=>+a)),i.push(1,129,0,59),new Uint8Array(i)}toImage(e=!1){const{height:n,width:r}=this.size(),o=new Uint8Array(n*r*(e?3:4));let i=0;for(let s=0;s<n;s++)for(let a=0;a<r;a++){const c=this.data[s][a]?0:255;o[i++]=c,o[i++]=c,o[i++]=c,e||(o[i++]=255)}return{height:n,width:r,data:o}}}const Mo=[26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],No={low:[7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],medium:[10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],quartile:[13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],high:[17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]},Do={low:[1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],medium:[1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],quartile:[1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],high:[1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]},te={size:{encode:t=>21+4*(t-1),decode:t=>(t-17)/4},sizeType:t=>Math.floor((t+7)/17),alignmentPatterns(t){if(t===1)return[];const e=6,n=te.size.encode(t)-e-1,r=n-e,o=Math.ceil(r/28);let i=Math.floor(r/o);i%2?i+=1:r%o*2>=o&&(i+=2);const s=[e];for(let a=1;a<o;a++)s.push(n-(o-a)*i);return s.push(n),s},ECCode:{low:1,medium:0,quartile:3,high:2},formatMask:21522,formatBits(t,e){const n=te.ECCode[t]<<3|e;let r=n;for(let o=0;o<10;o++)r=r<<1^(r>>9)*1335;return(n<<10|r)^te.formatMask},versionBits(t){let e=t;for(let n=0;n<12;n++)e=e<<1^(e>>11)*7973;return t<<12|e},alphabet:{numeric:xn("0123456789"),alphanumerc:xn("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:")},lengthBits(t,e){return{numeric:[10,12,14],alphanumeric:[9,11,13],byte:[8,16,16],kanji:[8,10,12],eci:[0,0,0]}[e][te.sizeType(t)]},modeBits:{numeric:"0001",alphanumeric:"0010",byte:"0100",kanji:"1000",eci:"0111"},capacity(t,e){const n=Mo[t-1],r=No[e][t-1],o=Do[e][t-1],i=Math.floor(n/o)-r,s=o-n%o;return{words:r,numBlocks:o,shortBlocks:s,blockLen:i,capacity:(n-r*o)*8,total:(r+i)*o+o-s}}},Uo=[(t,e)=>(t+e)%2==0,(t,e)=>e%2==0,(t,e)=>t%3==0,(t,e)=>(t+e)%3==0,(t,e)=>(Math.floor(e/2)+Math.floor(t/3))%2==0,(t,e)=>t*e%2+t*e%3==0,(t,e)=>(t*e%2+t*e%3)%2==0,(t,e)=>((t+e)%2+t*e%3)%2==0],v={tables:(t=>{const e=H(256,0),n=H(256,0);for(let r=0,o=1;r<256;r++)e[r]=o,n[o]=r,o<<=1,o&256&&(o^=t);return{exp:e,log:n}})(285),exp:t=>v.tables.exp[t],log(t){if(t===0)throw new Error(`GF.log: invalid arg=${t}`);return v.tables.log[t]%255},mul(t,e){return t===0||e===0?0:v.tables.exp[(v.tables.log[t]+v.tables.log[e])%255]},add:(t,e)=>t^e,pow:(t,e)=>v.tables.exp[v.tables.log[t]*e%255],inv(t){if(t===0)throw new Error(`GF.inverse: invalid arg=${t}`);return v.tables.exp[255-v.tables.log[t]]},polynomial(t){if(t.length==0)throw new Error("GF.polymomial: invalid length");if(t[0]!==0)return t;let e=0;for(;e<t.length-1&&t[e]==0;e++);return t.slice(e)},monomial(t,e){if(t<0)throw new Error(`GF.monomial: invalid degree=${t}`);if(e==0)return[0];let n=H(t+1,0);return n[0]=e,v.polynomial(n)},degree:t=>t.length-1,coefficient:(t,e)=>t[v.degree(t)-e],mulPoly(t,e){if(t[0]===0||e[0]===0)return[0];const n=H(t.length+e.length-1,0);for(let r=0;r<t.length;r++)for(let o=0;o<e.length;o++)n[r+o]=v.add(n[r+o],v.mul(t[r],e[o]));return v.polynomial(n)},mulPolyScalar(t,e){if(e==0)return[0];if(e==1)return t;const n=H(t.length,0);for(let r=0;r<t.length;r++)n[r]=v.mul(t[r],e);return v.polynomial(n)},mulPolyMonomial(t,e,n){if(e<0)throw new Error("GF.mulPolyMonomial: invalid degree");if(n==0)return[0];const r=H(t.length+e,0);for(let o=0;o<t.length;o++)r[o]=v.mul(t[o],n);return v.polynomial(r)},addPoly(t,e){if(t[0]===0)return e;if(e[0]===0)return t;let n=t,r=e;n.length>r.length&&([n,r]=[r,n]);let o=H(r.length,0),i=r.length-n.length,s=r.slice(0,i);for(let a=0;a<s.length;a++)o[a]=s[a];for(let a=i;a<r.length;a++)o[a]=v.add(n[a-i],r[a]);return v.polynomial(o)},remainderPoly(t,e){const n=Array.from(t);for(let r=0;r<t.length-e.length+1;r++){const o=n[r];if(o!==0)for(let i=1;i<e.length;i++)e[i]!==0&&(n[r+i]=v.add(n[r+i],v.mul(e[i],o)))}return n.slice(t.length-e.length+1,n.length)},divisorPoly(t){let e=[1];for(let n=0;n<t;n++)e=v.mulPoly(e,[1,v.pow(2,n)]);return e},evalPoly(t,e){if(e==0)return v.coefficient(t,0);let n=t[0];for(let r=1;r<t.length;r++)n=v.add(v.mul(e,n),t[r]);return n},euclidian(t,e,n){v.degree(t)<v.degree(e)&&([t,e]=[e,t]);let r=t,o=e,i=[0],s=[1];for(;2*v.degree(o)>=n;){let l=r,d=i;if(r=o,i=s,r[0]===0)throw new Error("rLast[0] === 0");o=l;let u=[0];const f=v.inv(r[0]);for(;v.degree(o)>=v.degree(r)&&o[0]!==0;){const h=v.degree(o)-v.degree(r),m=v.mul(o[0],f);u=v.addPoly(u,v.monomial(h,m)),o=v.addPoly(o,v.mulPolyMonomial(r,h,m))}if(u=v.mulPoly(u,i),s=v.addPoly(u,d),v.degree(o)>=v.degree(r))throw new Error(`Division failed r: ${o}, rLast: ${r}`)}const a=v.coefficient(s,0);if(a==0)throw new Error("sigmaTilde(0) was zero");const c=v.inv(a);return[v.mulPolyScalar(s,c),v.mulPolyScalar(o,c)]}};function Lo(t){return{encode(e){const n=v.divisorPoly(t),r=Array.from(e);return r.push(...n.slice(0,-1).fill(0)),Uint8Array.from(v.remainderPoly(r,n))},decode(e){const n=e.slice(),r=v.polynomial(Array.from(e));let o=H(t,0),i=!1;for(let u=0;u<t;u++){const f=v.evalPoly(r,v.exp(u));o[o.length-1-u]=f,f!==0&&(i=!0)}if(!i)return n;o=v.polynomial(o);const s=v.monomial(t,1),[a,c]=v.euclidian(s,o,t),l=H(v.degree(a),0);let d=0;for(let u=1;u<256&&d<l.length;u++)v.evalPoly(a,u)===0&&(l[d++]=v.inv(u));if(d!==l.length)throw new Error("RS.decode: invalid errors number");for(let u=0;u<l.length;u++){const f=n.length-1-v.log(l[u]);if(f<0)throw new Error("RS.decode: invalid error location");const h=v.inv(l[u]);let m=1;for(let y=0;y<l.length;y++)u!==y&&(m=v.mul(m,v.add(1,v.mul(l[y],h))));n[f]=v.add(n[f],v.mul(v.evalPoly(c,h),v.inv(m)))}return n}}}function Ko(t,e){const{words:n,shortBlocks:r,numBlocks:o,blockLen:i,total:s}=te.capacity(t,e),a=Lo(n);return{encode(c){const l=[],d=[];for(let m=0;m<o;m++){const y=m<r,x=i+(y?0:1);l.push(c.subarray(0,x)),d.push(a.encode(c.subarray(0,x))),c=c.subarray(x)}const u=vn(...l),f=vn(...d),h=new Uint8Array(u.length+f.length);return h.set(u),h.set(f,u.length),h},decode(c){if(c.length!==s)throw new Error(`interleave.decode: len(data)=${c.length}, total=${s}`);const l=[];for(let f=0;f<o;f++){const h=f<r;l.push(new Uint8Array(n+i+(h?0:1)))}let d=0;for(let f=0;f<i;f++)for(let h=0;h<o;h++)l[h][f]=c[d++];for(let f=r;f<o;f++)l[f][i]=c[d++];for(let f=i;f<i+n;f++)for(let h=0;h<o;h++){const m=h<r;l[h][f+(m?0:1)]=c[d++]}const u=[];for(const f of l)u.push(...Array.from(a.decode(f)).slice(0,-n));return Uint8Array.from(u)}}}function ko(t,e,n,r=!1){const o=te.size.encode(t);let i=new W(o+2);const s=new W(3).rect(0,3,!0).border(1,!1).border(1,!0).border(1,!1);i=i.embed(0,s).embed({x:-s.width,y:0},s).embed({x:0,y:-s.height},s),i=i.rectSlice(1,o);const a=new W(1).rect(0,1,!0).border(1,!1).border(1,!0),c=te.alignmentPatterns(t);for(const l of c)for(const d of c)i.data[l][d]===void 0&&i.embed({x:d-2,y:l-2},a);i=i.hLine({x:0,y:6},1/0,({x:l},d)=>d===void 0?l%2==0:d).vLine({x:6,y:0},1/0,({y:l},d)=>d===void 0?l%2==0:d);{const l=te.formatBits(e,n),d=u=>!r&&(l>>u&1)==1;for(let u=0;u<6;u++)i.data[u][8]=d(u);for(let u=6;u<8;u++)i.data[u+1][8]=d(u);for(let u=8;u<15;u++)i.data[o-15+u][8]=d(u);for(let u=0;u<8;u++)i.data[8][o-u-1]=d(u);for(let u=8;u<9;u++)i.data[8][15-u-1+1]=d(u);for(let u=9;u<15;u++)i.data[8][15-u-1]=d(u);i.data[o-8][8]=!r}if(t>=7){const l=te.versionBits(t);for(let d=0;d<18;d+=1){const u=!r&&(l>>d&1)==1,f=Math.floor(d/3),h=d%3+o-8-3;i.data[f][h]=u,i.data[h][f]=u}}return i}function $o(t,e,n){const r=t.height,o=Uo[e];let i=-1,s=r-1;for(let a=r-1;a>0;a-=2){for(a==6&&(a=5);;s+=i){for(let c=0;c<2;c+=1){const l=a-c;t.data[s][l]===void 0&&n(l,s,o(l,s))}if(s+i<0||s+i>=r)break}i=-i}}const Oo={best:To,bin:Io,drawTemplate:ko,fillArr:H,info:te,interleave:Ko,validateVersion:Po,zigzag:$o};/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/const{best:At,bin:Jo,drawTemplate:Wo,fillArr:vt,info:q,interleave:Ho,validateVersion:rr,zigzag:zo}=Oo,Rn=3,_o=8,Qo=24,Fo=2,Vo=1.333,or=2,qo=3,U=t=>t>>>0,We=(t,e)=>{const n=t.x-e.x,r=t.y-e.y;return n*n+r*r},he=(t,e)=>Math.sqrt(We(t,e)),Ce=t=>t.reduce((e,n)=>e+n),Bn=(t,e)=>{t.x+=e.x,t.y+=e.y},Go=t=>({x:-t.x,y:-t.y}),Oe=t=>({x:t.y,y:t.x}),Pn=t=>({x:t.x,y:t.y}),Je=t=>({x:U(t.x),y:U(t.y)}),jo=(t,e)=>({x:t.x+e.x,y:t.y+e.y});function Q(t,e,n){return Math.max(Math.min(t,n||t),e||t)}const ir=t=>{const e=t.data.length/(t.width*t.height);if(e===3||e===4)return e;throw new Error(`Unknown image format, bytes per pixel=${e}`)};function Yo(t){const e=ir(t),n=new Uint8Array(t.height*t.width);for(let d=0,u=0,f=t.data;d<f.length;d+=e){const h=f[d],m=f[d+1],y=f[d+2];n[u++]=U((h+2*m+y)/4)&255}const r=_o;if(t.width<r*5||t.height<r*5)throw new Error("image too small");const o=Math.ceil(t.width/r),i=Math.ceil(t.height/r),s=t.height-r,a=t.width-r,c=new Uint8Array(o*i);for(let d=0;d<i;d++){const u=Q(d*r,0,s);for(let f=0;f<o;f++){const h=Q(f*r,0,a);let m=0,y=255,x=0;for(let C=0,w=u*t.width+h;C<r;C=C+1,w=w+t.width)for(let g=0;g<r;g++){const P=n[w+g];m+=P,y=Math.min(y,P),x=Math.max(x,P)}let S=Math.floor(m/Jt(r,2));if(x-y<=Qo&&(S=y/2,d>0&&f>0)){const C=(g,P)=>P*o+g,w=(c[C(f,d-1)]+2*c[C(f-1,d)]+c[C(f-1,d-1)])/4;y<w&&(S=w)}c[o*d+f]=U(S)}}const l=new W({width:t.width,height:t.height});for(let d=0;d<i;d++){const u=Q(d*r,0,s),f=Q(d,2,i-3);for(let h=0;h<o;h++){const m=Q(h*r,0,a),y=Q(h,2,o-3);let x=0;for(let C=-2;C<=2;C++){const w=o*(f+C)+y;for(let g=-2;g<=2;g++)x+=c[w+g]}const S=x/25;for(let C=0,w=u*t.width+m;C<r;C+=1,w+=t.width)for(let g=0;g<r;g++)n[w+g]<=S&&(l.data[u+C][m+g]=!0)}}return l}function Xo(t,e){if(Math.abs(e.y-t.y)<=e.moduleSize&&Math.abs(e.x-t.x)<=e.moduleSize){const n=Math.abs(e.moduleSize-t.moduleSize);return n<=1||n<=t.moduleSize}return!1}function Zo(t,e){const n=t.count+e.count;return{x:(t.count*t.x+e.count*e.x)/n,y:(t.count*t.y+e.count*e.y)/n,moduleSize:(t.count*t.moduleSize+e.count*e.moduleSize)/n,count:n}}const ei=t=>t.filter(e=>e.count>=or);function sr(t,e){const n=e||vt(t.length,1);if(t.length!==n.length)throw new Error("invalid pattern");if(!(t.length&1))throw new Error("invalid pattern, length should be odd");const r={center:Math.ceil(t.length/2)-1,length:t.length,pattern:t,size:n,runs:()=>vt(t.length,0),totalSize:Ce(n),total:o=>o.reduce((i,s)=>i+s),shift:(o,i)=>{for(let s=0;s<o.length-i;s++)o[s]=o[s+2];for(let s=o.length-i;s<o.length;s++)o[s]=0},checkSize(o,i,s=Fo){const a=i/s;for(let c=0;c<o.length;c++)if(Math.abs(n[c]*i-o[c])>=n[c]*a)return!1;return!0},add(o,i,s,a){const c=a/J.totalSize,l={x:i,y:s,moduleSize:c,count:1};for(let d=0;d<o.length;d++){const u=o[d];if(Xo(u,l))return o[d]=Zo(u,l)}o.push(l)},toCenter(o,i){for(let s=t.length-1;s>r.center;s--)i-=o[s];return i-=o[r.center]/2,i},check(o,i,s,a,c){let l=0,d=Pn(s);const u=Go(a),f=(h,m)=>{for(;o.isInside(d)&&!!o.point(d)===r.pattern[h];Bn(d,m))i[h]++,l++;if(i[h]===0)return!0;const y=h===r.center;return!!(c&&!y&&i[h]>r.size[h]*c)};for(let h=r.center;h>=0;h--)if(f(h,u))return!1;d=Pn(s),Bn(d,a),l=1;for(let h=r.center;h<r.length;h++)if(f(h,a))return!1;return l},scanLine(o,i,s,a,c){const l=r.runs();let d=0,u=s;if(s)for(;u<a&&!!o.data[i][u]===r.pattern[0];)u++;for(;u<a;u++){if(!!o.data[i][u]===r.pattern[d]){if(l[d]++,u!==o.width-1)continue;u++}if(d!==r.length-1){l[++d]++;continue}const f=c(l,u);if(f)d=0,l.fill(0);else{if(f===!1)break;r.shift(l,2),d=r.length-2,l[d]++}}}};return r}const J=sr([!0,!1,!0,!1,!0],[1,1,3,1,1]),ce=sr([!1,!0,!1]);function ti(t){let e=[];function n(g,P=2){const p=Ce(g);if(p<J.totalSize)return!1;const A=p/J.totalSize;return J.checkSize(g,A,P)}function r(g,P,p,A){const b=J.runs();let E=J.check(t,b,g,A,P);if(E===!1)return!1;const B=Ce(b);return 5*Math.abs(B-p)>=2*p?!1:n(b)?J.toCenter(b,E):!1}function o(g,P,p){if(!n(g))return!1;const A=Ce(g);let b=J.toCenter(g,p),E=r({x:U(b),y:P},g[2],A,{y:1,x:0});if(E===!1)return!1;E+=P;let B=r({x:U(b),y:U(E)},g[2],A,{y:0,x:1});if(B===!1)return!1;b=B+U(b);const R=J.runs();return!J.check(t,R,{x:U(b),y:U(E)},{x:1,y:1})||!n(R,Vo)?!1:(J.add(e,b,E,A),!0)}let i=!1,s=Q(U(3*t.height/388),qo),a=!1;for(let g=s-1;g<t.height&&!a;g+=s)J.scanLine(t,g,0,t.width,(P,p)=>{if(o(P,g,p)){if(s=2,i){let A=0,b=0;for(const R of e)R.count<or||(A++,b+=R.moduleSize);if(A<3)return;const E=b/e.length;let B=0;for(const R of e)B+=Math.abs(R.moduleSize-E);if(B<=.05*b)return a=!0,!1}else if(e.length>1){const A=ei(e);if(A.length<2)return!0;i=!0;const b=U((Math.abs(A[0].x-A[1].x)-Math.abs(A[0].y-A[1].y))/2);return b<=P[2]+s?!0:(g+=b-P[2]-s,!1)}}});const c=e.length;if(c<3)throw new Error(`Finder: len(found) = ${c}`);e.sort((g,P)=>g.moduleSize-P.moduleSize);const l=At();for(let g=0;g<c-2;g++){const P=e[g];for(let p=g+1;p<c-1;p++){const A=e[p],b=We(P,A);for(let E=p+1;E<c;E++){const B=e[E];if(B.moduleSize>P.moduleSize*1.4)continue;const R=[b,We(A,B),We(P,B)].sort((j,le)=>j-le),T=R[0],I=R[1],N=R[2];l.add(Math.abs(N-2*I)+Math.abs(N-2*T),[P,A,B])}}}const d=l.get();if(!d)throw new Error("cannot find finder");const u=d[0],f=d[1],h=d[2],m=he(u,f),y=he(f,h),x=he(u,h);let S=h,C=u,w=f;if(y>=m&&y>=x?(S=u,C=f,w=h):x>=y&&x>=m&&(S=f,C=u,w=h),(w.x-S.x)*(C.y-S.y)-(w.y-S.y)*(C.x-S.x)<0){let g=C;C=w,w=g}return{bl:C,tl:S,tr:w}}function ni(t,e,n){const{moduleSize:r}=e,o=U(n*r),i=Q(e.x-o,0),s=Q(e.x+o,void 0,t.width-1),a=s-i,c=Q(e.y-o,0),l=Q(e.y+o,void 0,t.height-1),d=l-c;if(a<r*3||d<r*3)throw new Error(`x = ${a}, y=${d} moduleSize = ${r}`);const u=i,f=c,h=s-i,m=l-c,y=[],x=u+h,S=U(f+m/2);for(let C=0;C<m;C++){const w=U((C+1)/2),g=S+(C&1?-w:w);let P;if(ce.scanLine(t,g,u,x,(p,A)=>{if(!ce.checkSize(p,r))return;const b=Ce(p),E=ce.toCenter(p,A),B=ce.runs();let R=ce.check(t,B,{x:U(E),y:g},{y:1,x:0},2*p[1]);if(R===!1)return;R+=g;const T=Ce(B);if(5*Math.abs(T-b)>=2*b||!ce.checkSize(B,r))return;const I=ce.toCenter(B,R);if(P=ce.add(y,E,I,b),P)return!1}),P)return P}if(y.length>0)return y[0];throw new Error("Alignment pattern not found")}function In(t,e,n){let r=!1,o={x:Math.abs(n.x-e.x),y:Math.abs(n.y-e.y)};o.y>o.x&&(r=!0,e=Oe(e),n=Oe(n),o=Oe(o));let i=-o.x/2,s={x:e.x>=n.x?-1:1,y:e.y>=n.y?-1:1},a=0,c=n.x+s.x;for(let l=e.x,d=e.y;l!==c;l+=s.x){let u={x:l,y:d};if(r&&(u=Oe(u)),a===1==!!t.point(u)){if(a===2)return he({x:l,y:d},e);a++}if(i+=o.y,!(i<=0)){if(d===n.y)break;d+=s.y,i-=o.x}}return a===2?he({x:n.x+s.x,y:n.y},e):NaN}function Tn(t,e,n){let r=In(t,e,n),o=1;const{x:i,y:s}=e;let a=i-(n.x-i);const c=t.width;a<0?(o=i/(i-a),a=0):a>=c&&(o=(c-1-i)/(a-i),a=c-1);let l=U(s-(n.y-s)*o),d=1;const u=t.height;return l<0?(d=s/(s-l),l=0):l>=u&&(d=(u-1-s)/(l-s),l=u-1),a=U(i+(a-i)*d),r+=In(t,e,{x:a,y:l}),r-1}function Mn(t,e,n){const r=Tn(t,Je(e),Je(n)),o=Tn(t,Je(n),Je(e));return Number.isNaN(r)?o/J.totalSize:Number.isNaN(o)?r/J.totalSize:(r+o)/(2*J.totalSize)}function ri(t){const{bl:e,tl:n,tr:r}=ti(t),o=(Mn(t,n,r)+Mn(t,n,e))/2;if(o<1)throw new Error(`invalid moduleSize = ${o}`);const i=U(he(n,r)/o+.5),s=U(he(n,e)/o+.5);let a=U((i+s)/2+7);const c=a%4;c===0?a++:c===2?a--:c===3&&(a-=2);const l=q.size.decode(a);rr(l);let d;if(q.alignmentPatterns(l).length>0){const C={x:r.x-n.x+e.x,y:r.y-n.y+e.y},w=1-3/(q.size.encode(l)-7),g={x:U(n.x+w*(C.x-n.x)),y:U(n.y+w*(C.y-n.y)),moduleSize:o,count:1};for(let P=4;P<=16;P<<=1)try{d=ni(t,g,P);break}catch(p){}}const u={x:3.5,y:3.5},f={x:a-3.5,y:3.5},h={x:3.5,y:a-3.5};let m,y;d?(m=d,y={x:a-6.5,y:a-6.5}):(m={x:r.x-n.x+e.x,y:r.y-n.y+e.y},y={x:a-3.5,y:a-3.5});const x=[n,r,m,e];return{bits:oi(t,a,x,[u,f,y,h]),points:x}}function Nn(t){const e={x:t[0].x-t[1].x+t[2].x-t[3].x,y:t[0].y-t[1].y+t[2].y-t[3].y};if(e.x===0&&e.y===0)return[[t[1].x-t[0].x,t[2].x-t[1].x,t[0].x],[t[1].y-t[0].y,t[2].y-t[1].y,t[0].y],[0,0,1]];{const n={x:t[1].x-t[2].x,y:t[1].y-t[2].y},r={x:t[3].x-t[2].x,y:t[3].y-t[2].y},o=n.x*r.y-r.x*n.y,i=(e.x*r.y-r.x*e.y)/o,s=(n.x*e.y-e.x*n.y)/o;return[[t[1].x-t[0].x+i*t[1].x,t[3].x-t[0].x+s*t[3].x,t[0].x],[t[1].y-t[0].y+i*t[1].y,t[3].y-t[0].y+s*t[3].y,t[0].y],[i,s,1]]}}function oi(t,e,n,r){const o=Nn(r),i=[[o[1][1]*o[2][2]-o[2][1]*o[1][2],o[2][1]*o[0][2]-o[0][1]*o[2][2],o[0][1]*o[1][2]-o[1][1]*o[0][2]],[o[2][0]*o[1][2]-o[1][0]*o[2][2],o[0][0]*o[2][2]-o[2][0]*o[0][2],o[1][0]*o[0][2]-o[0][0]*o[1][2]],[o[1][0]*o[2][1]-o[2][0]*o[1][1],o[2][0]*o[0][1]-o[0][0]*o[2][1],o[0][0]*o[1][1]-o[1][0]*o[0][1]]],a=Nn(n).map(u=>u.map((f,h)=>u.reduce((m,y,x)=>m+y*i[x][h],0))),c=new W(e),l=vt(2*e,0),d=l.length;for(let u=0;u<e;u++){const f=a;for(let h=0;h<d-1;h+=2){const m=h/2+.5,y=u+.5,x=f[2][0]*m+f[2][1]*y+f[2][2];l[h]=U((f[0][0]*m+f[0][1]*y+f[0][2])/x),l[h+1]=U((f[1][0]*m+f[1][1]*y+f[1][2])/x)}for(let h=0;h<d;h+=2){const m=Q(l[h],0,t.width-1),y=Q(l[h+1],0,t.height-1);t.data[y][m]&&(c.data[u][h/2]=!0)}}return c}function ii(t){const e=(a,c,l)=>l<<1|(t.data[c][a]?1:0),n=t.height;let r=0;for(let a=5;a>=0;a--)for(let c=n-9;c>=n-11;c--)r=e(c,a,r);let o=0;for(let a=5;a>=0;a--)for(let c=n-9;c>=n-11;c--)o=e(a,c,o);let i=0;for(let a=0;a<6;a++)i=e(a,8,i);i=e(7,8,i),i=e(8,8,i),i=e(8,7,i);for(let a=5;a>=0;a--)i=e(8,a,i);let s=0;for(let a=n-1;a>=n-7;a--)s=e(8,a,s);for(let a=n-8;a<n;a++)s=e(a,8,s);return{version1:r,version2:o,format1:i,format2:s}}function si(t){const e=d=>{let u=0;for(;d;)d&1&&u++,d>>=1;return u},n=t.height,{version1:r,version2:o,format1:i,format2:s}=ii(t);let a;const c=At();for(const d of["medium","low","high","quartile"])for(let u=0;u<8;u++){const f=q.formatBits(d,u),h={ecc:d,mask:u};if(f===i||f===s){a=h;break}c.add(e(i^f),h),i!==s&&c.add(e(s^f),h)}if(a===void 0&&c.score()<=Rn&&(a=c.get()),a===void 0)throw new Error("invalid format pattern");let l=q.size.decode(n);if(l<7)rr(l);else{l=void 0;const d=At();for(let u=7;u<=40;u++){const f=q.versionBits(u);if(f===r||f===o){l=u;break}d.add(e(r^f),u),r!==o&&d.add(e(o^f),u)}if(l===void 0&&d.score()<=Rn&&(l=d.get()),l===void 0)throw new Error("invalid version pattern");if(q.size.encode(l)!==n)throw new Error("invalid version size")}return $({version:l},a)}function ai(t){const e=t.height;if(e<21||(e&3)!==1||e!==t.width)throw new Error(`decode: invalid size=${e}`);const{version:n,mask:r,ecc:o}=si(t),i=Wo(n,o,r),{total:s}=q.capacity(n,o),a=new Uint8Array(s);let c=0,l=0,d=0;if(zo(i,r,(x,S,C)=>{d++,l<<=1,l|=+(!!t.data[S][x]!==C),d===8&&(a[c++]=l,d=0,l=0)}),c!==s)throw new Error(`decode: pos=${c}, total=${s}`);let u=Array.from(Ho(n,o).decode(a)).map(x=>Jo(x,8)).join("");const f=x=>{if(x>u.length)throw new Error("Not enough bits");const S=u.slice(0,x);return u=u.slice(x),S},h=x=>+`0b${x}`,m={"0000":"terminator","0001":"numeric","0010":"alphanumeric","0100":"byte","0111":"eci",1e3:"kanji"};let y="";for(;!(u.length<4);){const x=f(4),S=m[x];if(S===void 0)throw new Error(`Unknown modeBits=${x} res="${y}"`);if(S==="terminator")break;const C=q.lengthBits(n,S);let w=h(f(C));if(S==="numeric"){for(;w>=3;){const g=h(f(10));if(g>=1e3)throw new Error(`numberic(3) = ${g}`);y+=g.toString().padStart(3,"0"),w-=3}if(w===2){const g=h(f(7));if(g>=100)throw new Error(`numeric(2) = ${g}`);y+=g.toString().padStart(2,"0")}else if(w===1){const g=h(f(4));if(g>=10)throw new Error(`Numeric(1) = ${g}`);y+=g.toString()}}else if(S==="alphanumeric"){for(;w>=2;){const g=h(f(11));y+=q.alphabet.alphanumerc.encode([Math.floor(g/45),g%45]).join(""),w-=2}w===1&&(y+=q.alphabet.alphanumerc.encode([h(f(6))]).join(""))}else if(S==="byte"){let g=[];for(let P=0;P<w;P++)g.push(+`0b${f(8)}`);y+=new TextDecoder().decode(new Uint8Array(g))}else throw new Error(`Unknown mode=${S}`)}return y}function ci(t){const e=Array.isArray(t.data)?new Uint8Array(t.data):t.data,{height:n,width:r}=t,o=Math.min(n,r),i={x:Math.floor((r-o)/2),y:Math.floor((n-o)/2)},s=ir(t),a=new Uint8Array(o*o*s);for(let c=0;c<o;c++){const l=((c+i.y)*r+i.x)*s,d=c*o*s,u=o*s;a.set(e.subarray(l,l+u),d)}return{offset:i,img:{height:o,width:o,data:a}}}function li(t,e={}){for(const a of["height","width"])if(!Number.isSafeInteger(t[a])||t[a]<=0)throw new Error(`invalid img.${a}=${t[a]} (${typeof t[a]})`);if(!Array.isArray(t.data)&&!(t.data instanceof Uint8Array)&&!(t.data instanceof Uint8ClampedArray))throw new Error(`invalid image.data=${t.data} (${typeof t.data})`);if(e.cropToSquare!==void 0&&typeof e.cropToSquare!="boolean")throw new Error(`invalid opts.cropToSquare=${e.cropToSquare}`);for(const a of["pointsOnDetect","imageOnBitmap","imageOnDetect","imageOnResult"])if(e[a]!==void 0&&typeof e[a]!="function")throw new Error(`invalid opts.${a}=${e[a]} (${typeof e[a]})`);let n={x:0,y:0};e.cropToSquare&&({img:t,offset:n}=ci(t));const r=Yo(t);e.imageOnBitmap&&e.imageOnBitmap(r.toImage());const{bits:o,points:i}=ri(r);if(e.pointsOnDetect){const a=i.map(c=>$($({},c),jo(c,n)));e.pointsOnDetect(a)}e.imageOnDetect&&e.imageOnDetect(o.toImage());const s=ai(o);return e.imageOnResult&&e.imageOnResult(o.toImage()),s}const ui=[{kty:"EC",kid:"3Kfdg-XwP-7gXyywtUfUADwBumDOPKMQx-iELL11W9s",use:"sig",alg:"ES256",crv:"P-256",x:"11XvRWy1I2S0EyJlyf_bWfw_TQ5CJJNLw78bHXNxcgw",y:"eZXwxvO1hvCY0KucrPfKo7yAyMT6Ajc3N7OkAB6VYy8",d:"FvOOk6hMixJ2o9zt4PCfan_UW7i4aOEnzj76ZaCI9Og"},{kty:"EC",kid:"7rIUtD5K5Izrptr3ywgESTxhgJtJSeb06V42hg7WUDs",use:"enc",alg:"ECDH-ES",crv:"P-256",x:"Lhaq5B4HhCDJSSQU_rJLShIIr6S5PxfXKTGKfKSP_CY",y:"EaxJ3zkqswLnw5GOf95A3atOTToVYmZPrp_t7WBcHcM",d:"K9zmeCMxMTdq_9nOa0s1Kfg-GXrNkrSLw209g3A5k70"},{kty:"EC",kid:"EBKOr72QQDcTBUuVzAzkfBTGew0ZA16GuWty64nS-sw",use:"sig",alg:"ES256",x5c:["MIICDDCCAZGgAwIBAgIUVJEUcO5ckx9MA7ZPjlsXYGv+98wwCgYIKoZIzj0EAwMwJzElMCMGA1UEAwwcU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBDQTAeFw0yMTA2MDExNTUwMDlaFw0yMjA2MDExNTUwMDlaMCsxKTAnBgNVBAMMIFNNQVJUIEhlYWx0aCBDYXJkIEV4YW1wbGUgSXNzdWVyMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEPQHApUWm94mflvswQgAnfHlETMwJFqjUVSs7WU6LQy7uaPwg77xXlVmMNtFWwkg0L9GrlqLkIOEVfXxx5GwtZKOBljCBkzAJBgNVHRMEAjAAMAsGA1UdDwQEAwIHgDA5BgNVHREEMjAwhi5odHRwczovL3NwZWMuc21hcnRoZWFsdGguY2FyZHMvZXhhbXBsZXMvaXNzdWVyMB0GA1UdDgQWBBTGqQP/SGBzOjWWcDdk/U7bQFhu+DAfBgNVHSMEGDAWgBQ4uufUcLGAmR55HWQWi+6PN9HJcTAKBggqhkjOPQQDAwNpADBmAjEAlZ9TR2TJnhumSUmtmgsWPpcp3xDYUtcXtxHs2xuHU6HqoaBfWDdUJKO8tWljGSVWAjEApesQltBP8ddWIn1BgBpldJ1pq9zukqfwRjwoCH1SRQXyuhGNfovvQMl/lw8MLIyO","MIICBzCCAWigAwIBAgIUK9wvDGYJ5S9DKzs/MY+IiTa0CP0wCgYIKoZIzj0EAwQwLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMB4XDTIxMDYwMTE1NTAwOVoXDTI2MDUzMTE1NTAwOVowJzElMCMGA1UEAwwcU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBDQTB2MBAGByqGSM49AgEGBSuBBAAiA2IABF2eAAAAGv0/isod1xpgaLX0DASxCDs0+JbCt12CTdQhB7os9m9H8c0nLyaNb8lM9IXkBRZLoLly/ZRaRjU8vq3bt6l5m9Cc6OY+xwmADKvNdNm94dsCC5CiB+JQu6WgWKNQME4wDAYDVR0TBAUwAwEB/zAdBgNVHQ4EFgQUOLrn1HCxgJkeeR1kFovujzfRyXEwHwYDVR0jBBgwFoAUJo6aEvlKNnmPfQaKVkOXIDY87/8wCgYIKoZIzj0EAwQDgYwAMIGIAkIBq9tT76Qzv1wH6nB0/sKPN4xPUScJeDv4+u2Zncv4ySWn5BR3DxYxEdJsVk4Aczw8uBipnYS90XNiogXMmN7JbRQCQgEYLzjOB1BdWIzjBlLF0onqnsAQijr6VX+2tfd94FNgMxHtaU864vgD/b3b0jr/Qf4dUkvF7K9WM1+vbcd0WDP4gQ==","MIICMjCCAZOgAwIBAgIUadiyU9sUFV6H40ZB5pCyc+gOikgwCgYIKoZIzj0EAwQwLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMB4XDTIxMDYwMTE1NTAwOFoXDTMxMDUzMDE1NTAwOFowLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQB/XU90B0DMB6GKbfNKz6MeEIZ2o6qCX76GGiwhPYZyDLgB4+njRHUA7l7KSrv8THtzXSn8FwDmubAZdbU3lwNRGcAQJVY/9Bq9TY5Utp8ttbVnXcHQ5pumzMgIkkrIzERg+iCZLtjgPYjUMgeLWpqQMG3VBNN6LXN4wM6DiJiZeeBId6jUDBOMAwGA1UdEwQFMAMBAf8wHQYDVR0OBBYEFCaOmhL5SjZ5j30GilZDlyA2PO//MB8GA1UdIwQYMBaAFCaOmhL5SjZ5j30GilZDlyA2PO//MAoGCCqGSM49BAMEA4GMADCBiAJCAe/u808fhGLVpgXyg3h/miSnqxGBx7Gav5Xf3iscdZkF9G5SH1G6UPvIS0tvP/2x9xHh2Vsx82OCZH64uPmKPqmkAkIBcUed8q/dQMgUmsB+jT7A7hKz0rh3CvmhW8b4djD3NesKW3M9qXqpRihd+7KqmTjUxhqUckiPBVLVm5wenaj08Ys="],crv:"P-256",x:"PQHApUWm94mflvswQgAnfHlETMwJFqjUVSs7WU6LQy4",y:"7mj8IO-8V5VZjDbRVsJINC_Rq5ai5CDhFX18ceRsLWQ",d:"vRyvhpwvbBuGVF3xmzpdvQjNH_IthPq3ehMWqPtlRXQ"}],di={keys:ui};let ar=null,xt=null;function fi(){return M(this,null,function*(){try{const e=di.keys.find(o=>o.use==="sig"&&o.alg==="ES256"&&o.kty==="EC");if(!e)throw new Error("No suitable signing key found in JWKS");ar=yield Ee(e,"ES256");const t=e,{d:n}=t,r=Ge(t,["d"]);xt=yield Ee(r,"ES256"),console.log("Test keys loaded successfully"),console.log("Using key ID:",e.kid)}catch(e){throw console.error("❌ Failed to load test keys:",e),e}})}function cr(){return M(this,null,function*(){try{console.log("Enumerating camera devices...");let t=null;try{t=yield navigator.mediaDevices.getUserMedia({video:!0})}catch(n){console.warn("⚠️ Camera permission denied, device labels may not be available")}return z=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput"),t&&t.getTracks().forEach(n=>n.stop()),console.log(`Found ${z.length} camera(s):`,z.map(n=>n.label||`Camera ${n.deviceId.substring(0,8)}...`)),z}catch(t){return console.error("❌ Failed to enumerate camera devices:",t),z=[],[]}})}function lr(){const t=document.getElementById("cameraSelect");if(t.innerHTML="",z.length===0){t.innerHTML='<option value="">No cameras found</option>',t.disabled=!0;return}if(z.length>1&&(t.innerHTML='<option value="">Auto (Prefer back camera)</option>'),z.forEach((e,n)=>{const r=document.createElement("option");r.value=e.deviceId;let o=e.label;(!o||o.trim()==="")&&(o=`Camera ${n+1}`),o.toLowerCase().includes("back")||o.toLowerCase().includes("rear")?o=`📱 ${o}`:o.toLowerCase().includes("front")||o.toLowerCase().includes("user")||o.toLowerCase().includes("face")?o=`🤳 ${o}`:o=`📷 ${o}`,r.textContent=o,t.appendChild(r)}),t.disabled=!1,z.length>1){const e=z.find(n=>n.label&&(n.label.toLowerCase().includes("back")||n.label.toLowerCase().includes("rear")||n.label.toLowerCase().includes("environment")));e&&(t.value=e.deviceId)}}function hi(){return M(this,null,function*(){try{G("info","🔍 Detecting available cameras..."),yield cr(),lr(),z.length===0?G("error","❌ No cameras found. QR scanning will not be available."):(G("success",`✅ Found ${z.length} camera(s). Select your preferred camera above.`),setTimeout(()=>{const t=document.getElementById("scanStatus");t&&(t.style.display="none")},3e3))}catch(t){console.error("❌ Camera initialization failed:",t),G("error",`❌ Camera initialization failed: ${t.message}`)}})}const ur={resourceType:"Bundle",type:"collection",entry:[{fullUrl:"https://example.org/fhir/Patient/123",resource:{resourceType:"Patient",id:"123",name:[{family:"Demo",given:["Test"]}],birthDate:"1990-01-01",gender:"unknown"}},{fullUrl:"https://example.org/fhir/Immunization/456",resource:{resourceType:"Immunization",id:"456",status:"completed",vaccineCode:{coding:[{system:"http://hl7.org/fhir/sid/cvx",code:"207",display:"COVID-19 vaccine (Demo Data Only)"}]},patient:{reference:"Patient/123"},occurrenceDateTime:"2023-01-15",performer:[{actor:{display:"Demo Healthcare Provider (Test Only)"}}]}}]};let dr=null,fr=null,Me=null,Dt=!1,z=[],He=null;function gi(){return M(this,null,function*(){try{yield fi(),dr=new xo({issuer:"https://spec.smarthealth.cards/examples/issuer",privateKey:ar,publicKey:xt}),fr=new Ro({publicKey:xt}),yi(),yield hi(),mi(),console.log("SMART Health Cards demo initialized successfully"),console.log("Using SMART Health Cards example test keys")}catch(t){console.error("❌ Failed to initialize demo:",t),G("error",`Initialization failed: ${t.message}`)}})}function yi(){document.getElementById("generateBtn").addEventListener("click",wi),document.getElementById("clearBtn").addEventListener("click",Si),document.getElementById("copyNumericBtn").addEventListener("click",Ei),document.getElementById("scanBtn").addEventListener("click",bi),document.getElementById("stopScanBtn").addEventListener("click",hr),navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",()=>M(null,null,function*(){console.log("Camera devices changed, refreshing camera list..."),yield cr(),lr()}))}function mi(){const t=document.getElementById("bundleDisplay");t.textContent=JSON.stringify(ur,null,2)}function wi(){return M(this,null,function*(){const t=document.getElementById("generateBtn");try{t.disabled=!0,t.innerHTML='<span class="loading"></span>Generating...',Ae("info","Generating SMART Health Card QR code...");const e=yield dr.issue(ur,{includeAdditionalTypes:["https://smarthealth.cards#immunization","https://smarthealth.cards#covid19"]}),n=yield e.asQR({encodeOptions:{errorCorrectionLevel:"L",scale:4,margin:1}});He=e.asQRNumeric()[0],pi(n[0]),Ae("success","✅ QR code generated successfully! This contains the demo health card data."),console.log("Generated QR code:",n[0].substring(0,50)+"..."),console.log("JWS:",e.asJWS().substring(0,100)+"...")}catch(e){console.error("❌ QR generation failed:",e),Ae("error",`QR generation failed: ${e.message}`)}finally{t.disabled=!1,t.textContent="Generate Sample QR Code"}})}function pi(t){const e=document.getElementById("qrCodeContainer"),n=document.getElementById("copyButtonContainer");e.innerHTML=`
    <div>
      <img src="${t}" alt="SMART Health Card QR Code" style="max-width: 300px;" />
      <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
          📷 You can scan this QR code using the camera scanner below
      </p>
    </div>
  `,n.style.display="block"}function Si(){const t=document.getElementById("qrCodeContainer"),e=document.getElementById("generationStatus"),n=document.getElementById("copyButtonContainer");t.innerHTML='<p class="placeholder">Click "Generate Sample QR Code" to create a QR code</p>',e.style.display="none",n.style.display="none",He=null}function Ei(){return M(this,null,function*(){if(!He){Ae("error","No numeric data available to copy");return}try{yield navigator.clipboard.writeText(He),Ae("success","✅ Numeric data copied to clipboard!");const t=document.getElementById("copyNumericBtn"),e=t.textContent;t.textContent="Copied",t.disabled=!0,setTimeout(()=>{t.textContent=e,t.disabled=!1},2e3)}catch(t){console.error("❌ Failed to copy to clipboard:",t),Ae("error",`Failed to copy to clipboard: ${t.message}`)}})}function bi(){return M(this,null,function*(){const t=document.getElementById("scanBtn"),e=document.getElementById("stopScanBtn"),n=document.getElementById("cameraSelect"),r=document.getElementById("video"),o=document.getElementById("canvas"),i=document.getElementById("scannerPlaceholder");try{if(t.disabled=!0,e.disabled=!1,G("info","Requesting camera access..."),z.length===0)throw new Error("No cameras available. Please ensure you have a camera connected and grant camera permissions.");const s={width:{ideal:640},height:{ideal:480}},a=n.value;a?(s.deviceId={exact:a},console.log(`Using selected camera: ${a}`)):(s.facingMode="environment",console.log("Using auto camera selection (prefer back camera)")),Me=yield navigator.mediaDevices.getUserMedia({video:s}),r.srcObject=Me,r.play(),r.style.display="block",i.style.display="none";const c=document.getElementById("scannerContainer");if(!c.querySelector(".scanner-overlay")){const l=document.createElement("div");l.className="scanner-overlay",c.appendChild(l)}Dt=!0,G("info","📷 Camera active - position QR code within the frame"),gr(r,o)}catch(s){console.error("❌ Camera access failed:",s);let a=`Camera access failed: ${s.message}`;const c=n.value;if(c){const l=z.find(u=>u.deviceId===c),d=(l==null?void 0:l.label)||`Camera ${c.substring(0,8)}...`;a+=` (Selected camera: ${d}). Try selecting a different camera or use auto-selection.`}else a+=" Please ensure you've granted camera permissions and try selecting a specific camera.";G("error",a),t.disabled=!1,e.disabled=!0}})}function hr(){const t=document.getElementById("scanBtn"),e=document.getElementById("stopScanBtn"),n=document.getElementById("scanStatus"),r=document.getElementById("video"),o=document.getElementById("scannerPlaceholder");Dt=!1,Me&&(Me.getTracks().forEach(a=>a.stop()),Me=null),r.style.display="none",o.style.display="block",o.textContent='Click "Start Camera Scan" to begin scanning';const s=document.getElementById("scannerContainer").querySelector(".scanner-overlay");s&&s.remove(),t.disabled=!1,e.disabled=!0,n.style.display="none"}function gr(t,e){if(!Dt)return;const n=e.getContext("2d");if(t.readyState===t.HAVE_ENOUGH_DATA){e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height);let o=null;try{o=li({width:r.width,height:r.height,data:r.data},{})}catch(i){}if(typeof o=="string"&&o.startsWith("shc:/")){Ci(o);return}}requestAnimationFrame(()=>gr(t,e))}function Ci(t){return M(this,null,function*(){console.log("QR code detected:",t.substring(0,50)+"...");try{hr(),G("info","🔍 QR code detected! Verifying health card...");const n=yield(yield fr.fromQRNumeric(t)).asBundle();Dn(n,t),G("success","✅ SMART Health Card verified and decoded successfully!")}catch(e){console.error("❌ QR verification failed:",e),G("error",`QR verification failed: ${e.message}`),Dn(null,t,e.message)}})}function Dn(t,e,n=null){var o,i,s,a,c;const r=document.getElementById("scanResult");if(t){const l=(i=(o=t.entry)==null?void 0:o.find(f=>{var h;return((h=f.resource)==null?void 0:h.resourceType)==="Patient"}))==null?void 0:i.resource,d=(s=t.entry)==null?void 0:s.filter(f=>{var h;return((h=f.resource)==null?void 0:h.resourceType)==="Immunization"});let u=`🎉 SMART Health Card Verified!

`;if(l){const f=(a=l.name)==null?void 0:a[0];u+=`👤 Patient: ${((c=f==null?void 0:f.given)==null?void 0:c[0])||"Unknown"} ${(f==null?void 0:f.family)||"Unknown"}
`,u+=`📅 Birth Date: ${l.birthDate||"Unknown"}

`}d&&d.length>0&&(u+=`💉 Immunizations:
`,d.forEach((f,h)=>{var x,S;const m=f.resource,y=(S=(x=m.vaccineCode)==null?void 0:x.coding)==null?void 0:S[0];u+=`  ${h+1}. ${(y==null?void 0:y.display)||(y==null?void 0:y.code)||"Unknown vaccine"}
`,u+=`     Date: ${m.occurrenceDateTime||"Unknown date"}
`,u+=`     Status: ${m.status||"Unknown"}
`})),u+=`
📋 Full FHIR Bundle:
`,u+=JSON.stringify(t,null,2),r.textContent=u}else{let l=`❌ QR Code Processing Failed

`;n&&(l+=`Error: ${n}

`),l+=`Raw QR Data: ${e}
`,l+=`Length: ${e.length} characters`,r.textContent=l}}function Ae(t,e){const n=document.getElementById("generationStatus");n&&(n.className=`status-message ${t}`,n.textContent=e,n.style.display="block")}function G(t,e){const n=document.getElementById("scanStatus");n&&(n.className=`status-message ${t}`,n.textContent=e,n.style.display="block")}document.addEventListener("DOMContentLoaded",gi);
