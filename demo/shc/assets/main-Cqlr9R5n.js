var Vn=Object.defineProperty,Gn=Object.defineProperties;var jn=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var Rt=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var It=t=>{throw TypeError(t)},Tt=Math.pow,qe=(t,e,n)=>e in t?Vn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,L=(t,e)=>{for(var n in e||(e={}))Rt.call(e,n)&&qe(t,n,e[n]);if(Le)for(var n of Le(e))Pt.call(e,n)&&qe(t,n,e[n]);return t},ae=(t,e)=>Gn(t,jn(e));var Ye=(t,e)=>{var n={};for(var r in t)Rt.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Le)for(var r of Le(t))e.indexOf(r)<0&&Pt.call(t,r)&&(n[r]=t[r]);return n};var I=(t,e,n)=>qe(t,typeof e!="symbol"?e+"":e,n),Mt=(t,e,n)=>e.has(t)||It("Cannot "+n);var D=(t,e,n)=>(Mt(t,e,"read from private field"),n?n.call(t):e.get(t)),Ae=(t,e,n)=>e.has(t)?It("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),ve=(t,e,n,r)=>(Mt(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);var A=(t,e,n)=>new Promise((r,o)=>{var i=c=>{try{a(n.next(c))}catch(l){o(l)}},s=c=>{try{a(n.throw(c))}catch(l){o(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(i,s);a((n=n.apply(t,e)).next())});function qn(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in t)){const i=Object.getOwnPropertyDescriptor(r,o);i&&Object.defineProperty(t,o,i.get?i:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const Yn="modulepreload",Xn=function(t,e){return new URL(t,e).href},Nt={},Dt=function(e,n,r){let o=Promise.resolve();if(n&&n.length>0){const s=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(n.map(l=>{if(l=Xn(l,r),l in Nt)return;Nt[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(!!r)for(let m=s.length-1;m>=0;m--){const y=s[m];if(y.href===l&&(!d||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Yn,d||(h.as="script"),h.crossOrigin="",h.href=l,c&&h.setAttribute("nonce",c),document.head.appendChild(h),d)return new Promise((m,y)=>{h.addEventListener("load",m),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Y=new TextEncoder,ue=new TextDecoder;function Xt(...t){const e=t.reduce((o,{length:i})=>o+i,0),n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return n}function Zn(t){if(Uint8Array.prototype.toBase64)return t.toBase64();const e=32768,n=[];for(let r=0;r<t.length;r+=e)n.push(String.fromCharCode.apply(null,t.subarray(r,r+e)));return btoa(n.join(""))}function gt(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(t);const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}function le(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof t=="string"?t:ue.decode(t),{alphabet:"base64url"});let e=t;e instanceof Uint8Array&&(e=ue.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return gt(e)}catch(n){throw new TypeError("The input to be decoded is not correctly encoded.")}}function Re(t){let e=t;return typeof e=="string"&&(e=Y.encode(e)),Uint8Array.prototype.toBase64?e.toBase64({alphabet:"base64url",omitPadding:!0}):Zn(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class De extends Error{constructor(n,r){var o;super(n,r);I(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}}I(De,"code","ERR_JOSE_GENERIC");class F extends De{constructor(){super(...arguments);I(this,"code","ERR_JOSE_NOT_SUPPORTED")}}I(F,"code","ERR_JOSE_NOT_SUPPORTED");class M extends De{constructor(){super(...arguments);I(this,"code","ERR_JWS_INVALID")}}I(M,"code","ERR_JWS_INVALID");class Zt extends De{constructor(){super(...arguments);I(this,"code","ERR_JWK_INVALID")}}I(Zt,"code","ERR_JWK_INVALID");class en extends De{constructor(n="signature verification failed",r){super(n,r);I(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}I(en,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function ee(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function xe(t,e){return t.name===e}function Xe(t){return parseInt(t.name.slice(4),10)}function er(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function tr(t,e){if(e&&!t.usages.includes(e))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${e}.`)}function nr(t,e,n){switch(e){case"HS256":case"HS384":case"HS512":{if(!xe(t.algorithm,"HMAC"))throw ee("HMAC");const r=parseInt(e.slice(2),10);if(Xe(t.algorithm.hash)!==r)throw ee(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!xe(t.algorithm,"RSASSA-PKCS1-v1_5"))throw ee("RSASSA-PKCS1-v1_5");const r=parseInt(e.slice(2),10);if(Xe(t.algorithm.hash)!==r)throw ee(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!xe(t.algorithm,"RSA-PSS"))throw ee("RSA-PSS");const r=parseInt(e.slice(2),10);if(Xe(t.algorithm.hash)!==r)throw ee(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!xe(t.algorithm,"Ed25519"))throw ee("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!xe(t.algorithm,"ECDSA"))throw ee("ECDSA");const r=er(e);if(t.algorithm.namedCurve!==r)throw ee(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}tr(t,n)}function tn(t,e,...n){var r;if(n=n.filter(Boolean),n.length>2){const o=n.pop();t+=`one of type ${n.join(", ")}, or ${o}.`}else n.length===2?t+=`one of type ${n[0]} or ${n[1]}.`:t+=`of type ${n[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(r=e.constructor)!=null&&r.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const yt=(t,...e)=>tn("Key must be ",t,...e);function nn(t,e,...n){return tn(`Key for the ${t} algorithm must be `,e,...n)}function mt(t){return(t==null?void 0:t[Symbol.toStringTag])==="CryptoKey"}function wt(t){return(t==null?void 0:t[Symbol.toStringTag])==="KeyObject"}const pt=t=>mt(t)||wt(t),rn=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let n;for(const r of e){const o=Object.keys(r);if(!n||n.size===0){n=new Set(o);continue}for(const i of o){if(n.has(i))return!1;n.add(i)}}return!0};function rr(t){return typeof t=="object"&&t!==null}const Te=t=>{if(!rr(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},or=(t,e)=>A(void 0,null,function*(){const n=`SHA-${t.slice(-3)}`;return new Uint8Array(yield crypto.subtle.digest(n,e))}),on=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:n}=e.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}},ir=t=>{const e=Object.entries({"P-256":[6,8,42,134,72,206,61,3,1,7],"P-384":[6,5,43,129,4,0,34],"P-521":[6,5,43,129,4,0,35]}),n=Math.max(...e.map(([,r])=>r.length));for(let r=0;r<=t.byteLength-n;r++)for(const[o,i]of e)if(r<=t.byteLength-i.length&&t.subarray(r,r+i.length).every((s,a)=>s===i[a]))return o},sn=(t,e,n,r)=>A(void 0,null,function*(){let o,i;const s=t==="spki",a=()=>s?["verify"]:["sign"],c=()=>s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];switch(n){case"PS256":case"PS384":case"PS512":o={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`},i=a();break;case"RS256":case"RS384":case"RS512":o={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`},i=a();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`},i=c();break;case"ES256":case"ES384":case"ES512":{o={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[n]},i=a();break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{const l=ir(e);o=l?{name:"ECDH",namedCurve:l}:{name:"X25519"},i=s?[]:["deriveBits"];break}case"Ed25519":case"EdDSA":o={name:"Ed25519"},i=a();break;default:throw new F('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(t,e,o,!!s,i)}),sr=(t,e,n)=>{const r=gt(t.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""));return sn("pkcs8",r,e)},ar=(t,e,n)=>{const r=gt(t.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,""));return sn("spki",r,e)};function cr(t){let e,n;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},n=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new F('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},n=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},n=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new F('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"Ed25519":case"EdDSA":e={name:"Ed25519"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new F('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new F('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:n}}const an=t=>A(void 0,null,function*(){var o,i;if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:n}=cr(t),r=L({},t);return delete r.alg,delete r.use,crypto.subtle.importKey("jwk",r,e,(o=t.ext)!=null?o:!t.d,(i=t.key_ops)!=null?i:n)});function Ut(t,e,n){return A(this,null,function*(){if(typeof t!="string"||t.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return ar(t,e)})}function lr(t,e,n){return A(this,null,function*(){if(typeof t!="string"||t.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return sr(t,e)})}function he(t,e,n){return A(this,null,function*(){if(!Te(t))throw new TypeError("JWK must be an object");let r;switch(e!=null||(e=t.alg),r!=null||(r=t.ext),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return le(t.k);case"RSA":if("oth"in t&&t.oth!==void 0)throw new F('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return an(ae(L({},t),{alg:e,ext:r}));default:throw new F('Unsupported "kty" (Key Type) Parameter value')}})}const cn=(t,e,n,r,o)=>{if(o.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(s=>typeof s!="string"||s.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;n!==void 0?i=new Map([...Object.entries(n),...e.entries()]):i=e;for(const s of r.crit){if(!i.has(s))throw new F(`Extension Header Parameter "${s}" is not recognized`);if(o[s]===void 0)throw new t(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&r[s]===void 0)throw new t(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(r.crit)};function Qe(t){return Te(t)&&typeof t.kty=="string"}function dr(t){return t.kty!=="oct"&&typeof t.d=="string"}function ur(t){return t.kty!=="oct"&&typeof t.d=="undefined"}function fr(t){return t.kty==="oct"&&typeof t.k=="string"}let ge;const Lt=(t,e,n,r=!1)=>A(void 0,null,function*(){ge||(ge=new WeakMap);let o=ge.get(t);if(o!=null&&o[n])return o[n];const i=yield an(ae(L({},e),{alg:n}));return r&&Object.freeze(t),o?o[n]=i:ge.set(t,{[n]:i}),i}),hr=(t,e)=>{var s;ge||(ge=new WeakMap);let n=ge.get(t);if(n!=null&&n[e])return n[e];const r=t.type==="public",o=!!r;let i;if(t.asymmetricKeyType==="x25519"){switch(e){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=t.toCryptoKey(t.asymmetricKeyType,o,r?[]:["deriveBits"])}if(t.asymmetricKeyType==="ed25519"){if(e!=="EdDSA"&&e!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=t.toCryptoKey(t.asymmetricKeyType,o,[r?"verify":"sign"])}if(t.asymmetricKeyType==="rsa"){let a;switch(e){case"RSA-OAEP":a="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":a="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":a="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":a="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(e.startsWith("RSA-OAEP"))return t.toCryptoKey({name:"RSA-OAEP",hash:a},o,r?["encrypt"]:["decrypt"]);i=t.toCryptoKey({name:e.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:a},o,[r?"verify":"sign"])}if(t.asymmetricKeyType==="ec"){const c=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((s=t.asymmetricKeyDetails)==null?void 0:s.namedCurve);if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");e==="ES256"&&c==="P-256"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[r?"verify":"sign"])),e==="ES384"&&c==="P-384"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[r?"verify":"sign"])),e==="ES512"&&c==="P-521"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[r?"verify":"sign"])),e.startsWith("ECDH-ES")&&(i=t.toCryptoKey({name:"ECDH",namedCurve:c},o,r?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[e]=i:ge.set(t,{[e]:i}),i},ln=(t,e)=>A(void 0,null,function*(){if(t instanceof Uint8Array||mt(t))return t;if(wt(t)){if(t.type==="secret")return t.export();if("toCryptoKey"in t&&typeof t.toCryptoKey=="function")try{return hr(t,e)}catch(r){if(r instanceof TypeError)throw r}let n=t.export({format:"jwk"});return Lt(t,n,e)}if(Qe(t))return t.k?le(t.k):Lt(t,t,e,!0);throw new Error("unreachable")}),fe=t=>t==null?void 0:t[Symbol.toStringTag],it=(t,e,n)=>{var r,o;if(e.use!==void 0){let i;switch(n){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc";break}if(e.use!==i)throw new TypeError(`Invalid key for this operation, its "use" must be "${i}" when present`)}if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, its "alg" must be "${t}" when present`);if(Array.isArray(e.key_ops)){let i;switch(!0){case(n==="sign"||n==="verify"):case t==="dir":case t.includes("CBC-HS"):i=n;break;case t.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(t):!t.includes("GCM")&&t.endsWith("KW")?i=n==="encrypt"?"wrapKey":"unwrapKey":i=n;break;case(n==="encrypt"&&t.startsWith("RSA")):i="wrapKey";break;case n==="decrypt":i=t.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(i&&((o=(r=e.key_ops)==null?void 0:r.includes)==null?void 0:o.call(r,i))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${i}" when present`)}return!0},gr=(t,e,n)=>{if(!(e instanceof Uint8Array)){if(Qe(e)){if(fr(e)&&it(t,e,n))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!pt(e))throw new TypeError(nn(t,e,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(e.type!=="secret")throw new TypeError(`${fe(e)} instances for symmetric algorithms must be of type "secret"`)}},yr=(t,e,n)=>{if(Qe(e))switch(n){case"decrypt":case"sign":if(dr(e)&&it(t,e,n))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(ur(e)&&it(t,e,n))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!pt(e))throw new TypeError(nn(t,e,"CryptoKey","KeyObject","JSON Web Key"));if(e.type==="secret")throw new TypeError(`${fe(e)} instances for asymmetric algorithms must not be of type "secret"`);if(e.type==="public")switch(n){case"sign":throw new TypeError(`${fe(e)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${fe(e)} instances for asymmetric algorithm decryption must be of type "private"`)}if(e.type==="private")switch(n){case"verify":throw new TypeError(`${fe(e)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${fe(e)} instances for asymmetric algorithm encryption must be of type "public"`)}},dn=(t,e,n)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(t)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(t)?gr(t,e,n):yr(t,e,n)};function mr(t){return A(this,null,function*(){if(wt(t))if(t.type==="secret")t=t.export();else return t.export({format:"jwk"});if(t instanceof Uint8Array)return{kty:"oct",k:Re(t)};if(!mt(t))throw new TypeError(yt(t,"CryptoKey","KeyObject","Uint8Array"));if(!t.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const s=yield crypto.subtle.exportKey("jwk",t),{ext:e,key_ops:n,alg:r,use:o}=s;return Ye(s,["ext","key_ops","alg","use"])})}function un(t){return A(this,null,function*(){return mr(t)})}const fn=(t,e)=>{const n=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:parseInt(t.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new F(`alg ${t} is not supported either by JOSE or your javascript runtime`)}},hn=(t,e,n)=>A(void 0,null,function*(){if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(yt(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[n])}return nr(e,t,n),e}),wr=(t,e,n,r)=>A(void 0,null,function*(){const o=yield hn(t,e,"verify");on(t,o);const i=fn(t,o.algorithm);try{return yield crypto.subtle.verify(i,o,n,r)}catch(s){return!1}});function pr(t,e,n){return A(this,null,function*(){var y;if(!Te(t))throw new M("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new M('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new M("JWS Protected Header incorrect type");if(t.payload===void 0)throw new M("JWS Payload missing");if(typeof t.signature!="string")throw new M("JWS Signature missing or incorrect type");if(t.header!==void 0&&!Te(t.header))throw new M("JWS Unprotected Header incorrect type");let r={};if(t.protected)try{const b=le(t.protected);r=JSON.parse(ue.decode(b))}catch(b){throw new M("JWS Protected Header is invalid")}if(!rn(r,t.header))throw new M("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o=L(L({},r),t.header),i=cn(M,new Map([["b64",!0]]),n==null?void 0:n.crit,r,o);let s=!0;if(i.has("b64")&&(s=r.b64,typeof s!="boolean"))throw new M('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=o;if(typeof a!="string"||!a)throw new M('JWS "alg" (Algorithm) Header Parameter missing or invalid');if(s){if(typeof t.payload!="string")throw new M("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new M("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=yield e(r,t),c=!0),dn(a,e,"verify");const l=Xt(Y.encode((y=t.protected)!=null?y:""),Y.encode("."),typeof t.payload=="string"?Y.encode(t.payload):t.payload);let d;try{d=le(t.signature)}catch(b){throw new M("Failed to base64url decode the signature")}const u=yield ln(e,a);if(!(yield wr(a,u,d,l)))throw new en;let h;if(s)try{h=le(t.payload)}catch(b){throw new M("Failed to base64url decode the payload")}else typeof t.payload=="string"?h=Y.encode(t.payload):h=t.payload;const m={payload:h};return t.protected!==void 0&&(m.protectedHeader=r),t.header!==void 0&&(m.unprotectedHeader=t.header),c?ae(L({},m),{key:u}):m})}function Sr(t,e,n){return A(this,null,function*(){if(t instanceof Uint8Array&&(t=ue.decode(t)),typeof t!="string")throw new M("Compact JWS must be a string or Uint8Array");const{0:r,1:o,2:i,length:s}=t.split(".");if(s!==3)throw new M("Invalid Compact JWS");const a=yield pr({payload:o,protected:r,signature:i},e,n),c={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?ae(L({},c),{key:a.key}):c})}const Er=(t,e,n)=>A(void 0,null,function*(){const r=yield hn(t,e,"sign");on(t,r);const o=yield crypto.subtle.sign(fn(t,r.algorithm),r,n);return new Uint8Array(o)});var Ne,H,q;class br{constructor(e){Ae(this,Ne);Ae(this,H);Ae(this,q);if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");ve(this,Ne,e)}setProtectedHeader(e){if(D(this,H))throw new TypeError("setProtectedHeader can only be called once");return ve(this,H,e),this}setUnprotectedHeader(e){if(D(this,q))throw new TypeError("setUnprotectedHeader can only be called once");return ve(this,q,e),this}sign(e,n){return A(this,null,function*(){if(!D(this,H)&&!D(this,q))throw new M("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!rn(D(this,H),D(this,q)))throw new M("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r=L(L({},D(this,H)),D(this,q)),o=cn(M,new Map([["b64",!0]]),n==null?void 0:n.crit,D(this,H),r);let i=!0;if(o.has("b64")&&(i=D(this,H).b64,typeof i!="boolean"))throw new M('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=r;if(typeof s!="string"||!s)throw new M('JWS "alg" (Algorithm) Header Parameter missing or invalid');dn(s,e,"sign");let a=D(this,Ne);i&&(a=Y.encode(Re(a)));let c;D(this,H)?c=Y.encode(Re(JSON.stringify(D(this,H)))):c=Y.encode("");const l=Xt(c,Y.encode("."),a),d=yield ln(e,s),u=yield Er(s,d,l),f={signature:Re(u),payload:""};return i&&(f.payload=ue.decode(a)),D(this,q)&&(f.header=D(this,q)),D(this,H)&&(f.protected=ue.decode(c)),f})}}Ne=new WeakMap,H=new WeakMap,q=new WeakMap;var we;class Cr{constructor(e){Ae(this,we);ve(this,we,new br(e))}setProtectedHeader(e){return D(this,we).setProtectedHeader(e),this}sign(e,n){return A(this,null,function*(){const r=yield D(this,we).sign(e,n);if(r.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`})}}we=new WeakMap;const te=(t,e)=>{if(typeof t!="string"||!t)throw new Zt(`${e} missing or invalid`)};function Ar(t,e){return A(this,null,function*(){let n;if(Qe(t))n=t;else if(pt(t))n=yield un(t);else throw new TypeError(yt(t,"CryptoKey","KeyObject","JSON Web Key"));if(e!=null||(e="sha256"),e!=="sha256"&&e!=="sha384"&&e!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(n.kty){case"EC":te(n.crv,'"crv" (Curve) Parameter'),te(n.x,'"x" (X Coordinate) Parameter'),te(n.y,'"y" (Y Coordinate) Parameter'),r={crv:n.crv,kty:n.kty,x:n.x,y:n.y};break;case"OKP":te(n.crv,'"crv" (Subtype of Key Pair) Parameter'),te(n.x,'"x" (Public Key) Parameter'),r={crv:n.crv,kty:n.kty,x:n.x};break;case"RSA":te(n.e,'"e" (Exponent) Parameter'),te(n.n,'"n" (Modulus) Parameter'),r={e:n.e,kty:n.kty,n:n.n};break;case"oct":te(n.k,'"k" (Key Value) Parameter'),r={k:n.k,kty:n.kty};break;default:throw new F('"kty" (Key Type) Parameter missing or unsupported')}const o=Y.encode(JSON.stringify(r));return Re(yield or(e,o))})}function vr(t){let e;if(typeof t=="string"){const n=t.split(".");(n.length===3||n.length===5)&&([e]=n)}else if(typeof t=="object"&&t)if("protected"in t)e=t.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof e!="string"||!e)throw new Error;const n=JSON.parse(ue.decode(le(e)));if(!Te(n))throw new Error;return n}catch(n){throw new TypeError("Invalid Token or Protected Header formatting")}}var pe={},xr=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},gn={},_={};let St;const Br=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];_.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};_.getSymbolTotalCodewords=function(e){return Br[e]};_.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};_.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');St=e};_.isKanjiModeEnabled=function(){return typeof St!="undefined"};_.toSJIS=function(e){return St(e)};var Fe={};(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit!="undefined"&&r.bit>=0&&r.bit<4},t.from=function(r,o){if(t.isValid(r))return r;try{return e(r)}catch(i){return o}}})(Fe);function yn(){this.buffer=[],this.length=0}yn.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let n=0;n<e;n++)this.putBit((t>>>e-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var Rr=yn;function Ue(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}Ue.prototype.set=function(t,e,n,r){const o=t*this.size+e;this.data[o]=n,r&&(this.reservedBit[o]=!0)};Ue.prototype.get=function(t,e){return this.data[t*this.size+e]};Ue.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n};Ue.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var Pr=Ue,mn={};(function(t){const e=_.getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const o=Math.floor(r/7)+2,i=e(r),s=i===145?26:Math.ceil((i-13)/(2*o-2))*2,a=[i-7];for(let c=1;c<o-1;c++)a[c]=a[c-1]-s;return a.push(6),a.reverse()},t.getPositions=function(r){const o=[],i=t.getRowColCoords(r),s=i.length;for(let a=0;a<s;a++)for(let c=0;c<s;c++)a===0&&c===0||a===0&&c===s-1||a===s-1&&c===0||o.push([i[a],i[c]]);return o}})(mn);var wn={};const Ir=_.getSymbolSize,Kt=7;wn.getPositions=function(e){const n=Ir(e);return[[0,0],[n-Kt,0],[0,n-Kt]]};var pn={};(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},t.from=function(o){return t.isValid(o)?parseInt(o,10):void 0},t.getPenaltyN1=function(o){const i=o.size;let s=0,a=0,c=0,l=null,d=null;for(let u=0;u<i;u++){a=c=0,l=d=null;for(let f=0;f<i;f++){let h=o.get(u,f);h===l?a++:(a>=5&&(s+=e.N1+(a-5)),l=h,a=1),h=o.get(f,u),h===d?c++:(c>=5&&(s+=e.N1+(c-5)),d=h,c=1)}a>=5&&(s+=e.N1+(a-5)),c>=5&&(s+=e.N1+(c-5))}return s},t.getPenaltyN2=function(o){const i=o.size;let s=0;for(let a=0;a<i-1;a++)for(let c=0;c<i-1;c++){const l=o.get(a,c)+o.get(a,c+1)+o.get(a+1,c)+o.get(a+1,c+1);(l===4||l===0)&&s++}return s*e.N2},t.getPenaltyN3=function(o){const i=o.size;let s=0,a=0,c=0;for(let l=0;l<i;l++){a=c=0;for(let d=0;d<i;d++)a=a<<1&2047|o.get(l,d),d>=10&&(a===1488||a===93)&&s++,c=c<<1&2047|o.get(d,l),d>=10&&(c===1488||c===93)&&s++}return s*e.N3},t.getPenaltyN4=function(o){let i=0;const s=o.data.length;for(let c=0;c<s;c++)i+=o.data[c];return Math.abs(Math.ceil(i*100/s/5)-10)*e.N4};function n(r,o,i){switch(r){case t.Patterns.PATTERN000:return(o+i)%2===0;case t.Patterns.PATTERN001:return o%2===0;case t.Patterns.PATTERN010:return i%3===0;case t.Patterns.PATTERN011:return(o+i)%3===0;case t.Patterns.PATTERN100:return(Math.floor(o/2)+Math.floor(i/3))%2===0;case t.Patterns.PATTERN101:return o*i%2+o*i%3===0;case t.Patterns.PATTERN110:return(o*i%2+o*i%3)%2===0;case t.Patterns.PATTERN111:return(o*i%3+(o+i)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(o,i){const s=i.size;for(let a=0;a<s;a++)for(let c=0;c<s;c++)i.isReserved(c,a)||i.xor(c,a,n(o,c,a))},t.getBestMask=function(o,i){const s=Object.keys(t.Patterns).length;let a=0,c=1/0;for(let l=0;l<s;l++){i(l),t.applyMask(l,o);const d=t.getPenaltyN1(o)+t.getPenaltyN2(o)+t.getPenaltyN3(o)+t.getPenaltyN4(o);t.applyMask(l,o),d<c&&(c=d,a=l)}return a}})(pn);var Ve={};const oe=Fe,Ke=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],$e=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Ve.getBlocksCount=function(e,n){switch(n){case oe.L:return Ke[(e-1)*4+0];case oe.M:return Ke[(e-1)*4+1];case oe.Q:return Ke[(e-1)*4+2];case oe.H:return Ke[(e-1)*4+3];default:return}};Ve.getTotalCodewordsCount=function(e,n){switch(n){case oe.L:return $e[(e-1)*4+0];case oe.M:return $e[(e-1)*4+1];case oe.Q:return $e[(e-1)*4+2];case oe.H:return $e[(e-1)*4+3];default:return}};var Sn={},Ge={};const Pe=new Uint8Array(512),He=new Uint8Array(256);(function(){let e=1;for(let n=0;n<255;n++)Pe[n]=e,He[e]=n,e<<=1,e&256&&(e^=285);for(let n=255;n<512;n++)Pe[n]=Pe[n-255]})();Ge.log=function(e){if(e<1)throw new Error("log("+e+")");return He[e]};Ge.exp=function(e){return Pe[e]};Ge.mul=function(e,n){return e===0||n===0?0:Pe[He[e]+He[n]]};(function(t){const e=Ge;t.mul=function(r,o){const i=new Uint8Array(r.length+o.length-1);for(let s=0;s<r.length;s++)for(let a=0;a<o.length;a++)i[s+a]^=e.mul(r[s],o[a]);return i},t.mod=function(r,o){let i=new Uint8Array(r);for(;i.length-o.length>=0;){const s=i[0];for(let c=0;c<o.length;c++)i[c]^=e.mul(o[c],s);let a=0;for(;a<i.length&&i[a]===0;)a++;i=i.slice(a)}return i},t.generateECPolynomial=function(r){let o=new Uint8Array([1]);for(let i=0;i<r;i++)o=t.mul(o,new Uint8Array([1,e.exp(i)]));return o}})(Sn);const En=Sn;function Et(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}Et.prototype.initialize=function(e){this.degree=e,this.genPoly=En.generateECPolynomial(this.degree)};Et.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(e.length+this.degree);n.set(e);const r=En.mod(n,this.genPoly),o=this.degree-r.length;if(o>0){const i=new Uint8Array(this.degree);return i.set(r,o),i}return r};var Tr=Et,bn={},ie={},bt={};bt.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var Z={};const Cn="[0-9]+",Mr="[A-Z $%*+\\-./:]+";let Me="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Me=Me.replace(/u/g,"\\u");const Nr="(?:(?![A-Z0-9 $%*+\\-./:]|"+Me+`)(?:.|[\r
]))+`;Z.KANJI=new RegExp(Me,"g");Z.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Z.BYTE=new RegExp(Nr,"g");Z.NUMERIC=new RegExp(Cn,"g");Z.ALPHANUMERIC=new RegExp(Mr,"g");const Dr=new RegExp("^"+Me+"$"),Ur=new RegExp("^"+Cn+"$"),Lr=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Z.testKanji=function(e){return Dr.test(e)};Z.testNumeric=function(e){return Ur.test(e)};Z.testAlphanumeric=function(e){return Lr.test(e)};(function(t){const e=bt,n=Z;t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(i,s){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!e.isValid(s))throw new Error("Invalid version: "+s);return s>=1&&s<10?i.ccBits[0]:s<27?i.ccBits[1]:i.ccBits[2]},t.getBestModeForData=function(i){return n.testNumeric(i)?t.NUMERIC:n.testAlphanumeric(i)?t.ALPHANUMERIC:n.testKanji(i)?t.KANJI:t.BYTE},t.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},t.isValid=function(i){return i&&i.bit&&i.ccBits};function r(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+o)}}t.from=function(i,s){if(t.isValid(i))return i;try{return r(i)}catch(a){return s}}})(ie);(function(t){const e=_,n=Ve,r=Fe,o=ie,i=bt,s=7973,a=e.getBCHDigit(s);function c(f,h,m){for(let y=1;y<=40;y++)if(h<=t.getCapacity(y,m,f))return y}function l(f,h){return o.getCharCountIndicator(f,h)+4}function d(f,h){let m=0;return f.forEach(function(y){const b=l(y.mode,h);m+=b+y.getBitsLength()}),m}function u(f,h){for(let m=1;m<=40;m++)if(d(f,m)<=t.getCapacity(m,h,o.MIXED))return m}t.from=function(h,m){return i.isValid(h)?parseInt(h,10):m},t.getCapacity=function(h,m,y){if(!i.isValid(h))throw new Error("Invalid QR Code version");typeof y=="undefined"&&(y=o.BYTE);const b=e.getSymbolTotalCodewords(h),p=n.getTotalCodewordsCount(h,m),S=(b-p)*8;if(y===o.MIXED)return S;const w=S-l(y,h);switch(y){case o.NUMERIC:return Math.floor(w/10*3);case o.ALPHANUMERIC:return Math.floor(w/11*2);case o.KANJI:return Math.floor(w/13);case o.BYTE:default:return Math.floor(w/8)}},t.getBestVersionForData=function(h,m){let y;const b=r.from(m,r.M);if(Array.isArray(h)){if(h.length>1)return u(h,b);if(h.length===0)return 1;y=h[0]}else y=h;return c(y.mode,y.getLength(),b)},t.getEncodedBits=function(h){if(!i.isValid(h)||h<7)throw new Error("Invalid QR Code version");let m=h<<12;for(;e.getBCHDigit(m)-a>=0;)m^=s<<e.getBCHDigit(m)-a;return h<<12|m}})(bn);var An={};const st=_,vn=1335,Kr=21522,$t=st.getBCHDigit(vn);An.getEncodedBits=function(e,n){const r=e.bit<<3|n;let o=r<<10;for(;st.getBCHDigit(o)-$t>=0;)o^=vn<<st.getBCHDigit(o)-$t;return(r<<10|o)^Kr};var xn={};const $r=ie;function Se(t){this.mode=$r.NUMERIC,this.data=t.toString()}Se.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};Se.prototype.getLength=function(){return this.data.length};Se.prototype.getBitsLength=function(){return Se.getBitsLength(this.data.length)};Se.prototype.write=function(e){let n,r,o;for(n=0;n+3<=this.data.length;n+=3)r=this.data.substr(n,3),o=parseInt(r,10),e.put(o,10);const i=this.data.length-n;i>0&&(r=this.data.substr(n),o=parseInt(r,10),e.put(o,i*3+1))};var kr=Se;const Or=ie,Ze=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Ee(t){this.mode=Or.ALPHANUMERIC,this.data=t}Ee.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Ee.prototype.getLength=function(){return this.data.length};Ee.prototype.getBitsLength=function(){return Ee.getBitsLength(this.data.length)};Ee.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let r=Ze.indexOf(this.data[n])*45;r+=Ze.indexOf(this.data[n+1]),e.put(r,11)}this.data.length%2&&e.put(Ze.indexOf(this.data[n]),6)};var Jr=Ee;const Wr=ie;function be(t){this.mode=Wr.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}be.getBitsLength=function(e){return e*8};be.prototype.getLength=function(){return this.data.length};be.prototype.getBitsLength=function(){return be.getBitsLength(this.data.length)};be.prototype.write=function(t){for(let e=0,n=this.data.length;e<n;e++)t.put(this.data[e],8)};var Hr=be;const zr=ie,_r=_;function Ce(t){this.mode=zr.KANJI,this.data=t}Ce.getBitsLength=function(e){return e*13};Ce.prototype.getLength=function(){return this.data.length};Ce.prototype.getBitsLength=function(){return Ce.getBitsLength(this.data.length)};Ce.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let n=_r.toSJIS(this.data[e]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),t.put(n,13)}};var Qr=Ce,Bn={exports:{}};(function(t){var e={single_source_shortest_paths:function(n,r,o){var i={},s={};s[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var c,l,d,u,f,h,m,y,b;!a.empty();){c=a.pop(),l=c.value,u=c.cost,f=n[l]||{};for(d in f)f.hasOwnProperty(d)&&(h=f[d],m=u+h,y=s[d],b=typeof s[d]=="undefined",(b||y>m)&&(s[d]=m,a.push(d,m),i[d]=l))}if(typeof o!="undefined"&&typeof s[o]=="undefined"){var p=["Could not find a path from ",r," to ",o,"."].join("");throw new Error(p)}return i},extract_shortest_path_from_predecessor_list:function(n,r){for(var o=[],i=r;i;)o.push(i),n[i],i=n[i];return o.reverse(),o},find_path:function(n,r,o){var i=e.single_source_shortest_paths(n,r,o);return e.extract_shortest_path_from_predecessor_list(i,o)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,o={},i;n=n||{};for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);return o.queue=[],o.sorter=n.sorter||r.default_sorter,o},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var o={value:n,cost:r};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(Bn);var Fr=Bn.exports;(function(t){const e=ie,n=kr,r=Jr,o=Hr,i=Qr,s=Z,a=_,c=Fr;function l(p){return unescape(encodeURIComponent(p)).length}function d(p,S,w){const g=[];let C;for(;(C=p.exec(w))!==null;)g.push({data:C[0],index:C.index,mode:S,length:C[0].length});return g}function u(p){const S=d(s.NUMERIC,e.NUMERIC,p),w=d(s.ALPHANUMERIC,e.ALPHANUMERIC,p);let g,C;return a.isKanjiModeEnabled()?(g=d(s.BYTE,e.BYTE,p),C=d(s.KANJI,e.KANJI,p)):(g=d(s.BYTE_KANJI,e.BYTE,p),C=[]),S.concat(w,g,C).sort(function(x,B){return x.index-B.index}).map(function(x){return{data:x.data,mode:x.mode,length:x.length}})}function f(p,S){switch(S){case e.NUMERIC:return n.getBitsLength(p);case e.ALPHANUMERIC:return r.getBitsLength(p);case e.KANJI:return i.getBitsLength(p);case e.BYTE:return o.getBitsLength(p)}}function h(p){return p.reduce(function(S,w){const g=S.length-1>=0?S[S.length-1]:null;return g&&g.mode===w.mode?(S[S.length-1].data+=w.data,S):(S.push(w),S)},[])}function m(p){const S=[];for(let w=0;w<p.length;w++){const g=p[w];switch(g.mode){case e.NUMERIC:S.push([g,{data:g.data,mode:e.ALPHANUMERIC,length:g.length},{data:g.data,mode:e.BYTE,length:g.length}]);break;case e.ALPHANUMERIC:S.push([g,{data:g.data,mode:e.BYTE,length:g.length}]);break;case e.KANJI:S.push([g,{data:g.data,mode:e.BYTE,length:l(g.data)}]);break;case e.BYTE:S.push([{data:g.data,mode:e.BYTE,length:l(g.data)}])}}return S}function y(p,S){const w={},g={start:{}};let C=["start"];for(let v=0;v<p.length;v++){const x=p[v],B=[];for(let P=0;P<x.length;P++){const R=x[P],N=""+v+P;B.push(N),w[N]={node:R,lastCount:0},g[N]={};for(let se=0;se<C.length;se++){const W=C[se];w[W]&&w[W].node.mode===R.mode?(g[W][N]=f(w[W].lastCount+R.length,R.mode)-f(w[W].lastCount,R.mode),w[W].lastCount+=R.length):(w[W]&&(w[W].lastCount=R.length),g[W][N]=f(R.length,R.mode)+4+e.getCharCountIndicator(R.mode,S))}}C=B}for(let v=0;v<C.length;v++)g[C[v]].end=0;return{map:g,table:w}}function b(p,S){let w;const g=e.getBestModeForData(p);if(w=e.from(S,g),w!==e.BYTE&&w.bit<g.bit)throw new Error('"'+p+'" cannot be encoded with mode '+e.toString(w)+`.
 Suggested mode is: `+e.toString(g));switch(w===e.KANJI&&!a.isKanjiModeEnabled()&&(w=e.BYTE),w){case e.NUMERIC:return new n(p);case e.ALPHANUMERIC:return new r(p);case e.KANJI:return new i(p);case e.BYTE:return new o(p)}}t.fromArray=function(S){return S.reduce(function(w,g){return typeof g=="string"?w.push(b(g,null)):g.data&&w.push(b(g.data,g.mode)),w},[])},t.fromString=function(S,w){const g=u(S,a.isKanjiModeEnabled()),C=m(g),v=y(C,w),x=c.find_path(v.map,"start","end"),B=[];for(let P=1;P<x.length-1;P++)B.push(v.table[x[P]].node);return t.fromArray(h(B))},t.rawSplit=function(S){return t.fromArray(u(S,a.isKanjiModeEnabled()))}})(xn);const je=_,et=Fe,Vr=Rr,Gr=Pr,jr=mn,qr=wn,at=pn,ct=Ve,Yr=Tr,ze=bn,Xr=An,Zr=ie,tt=xn;function eo(t,e){const n=t.size,r=qr.getPositions(e);for(let o=0;o<r.length;o++){const i=r[o][0],s=r[o][1];for(let a=-1;a<=7;a++)if(!(i+a<=-1||n<=i+a))for(let c=-1;c<=7;c++)s+c<=-1||n<=s+c||(a>=0&&a<=6&&(c===0||c===6)||c>=0&&c<=6&&(a===0||a===6)||a>=2&&a<=4&&c>=2&&c<=4?t.set(i+a,s+c,!0,!0):t.set(i+a,s+c,!1,!0))}}function to(t){const e=t.size;for(let n=8;n<e-8;n++){const r=n%2===0;t.set(n,6,r,!0),t.set(6,n,r,!0)}}function no(t,e){const n=jr.getPositions(e);for(let r=0;r<n.length;r++){const o=n[r][0],i=n[r][1];for(let s=-2;s<=2;s++)for(let a=-2;a<=2;a++)s===-2||s===2||a===-2||a===2||s===0&&a===0?t.set(o+s,i+a,!0,!0):t.set(o+s,i+a,!1,!0)}}function ro(t,e){const n=t.size,r=ze.getEncodedBits(e);let o,i,s;for(let a=0;a<18;a++)o=Math.floor(a/3),i=a%3+n-8-3,s=(r>>a&1)===1,t.set(o,i,s,!0),t.set(i,o,s,!0)}function nt(t,e,n){const r=t.size,o=Xr.getEncodedBits(e,n);let i,s;for(i=0;i<15;i++)s=(o>>i&1)===1,i<6?t.set(i,8,s,!0):i<8?t.set(i+1,8,s,!0):t.set(r-15+i,8,s,!0),i<8?t.set(8,r-i-1,s,!0):i<9?t.set(8,15-i-1+1,s,!0):t.set(8,15-i-1,s,!0);t.set(r-8,8,1,!0)}function oo(t,e){const n=t.size;let r=-1,o=n-1,i=7,s=0;for(let a=n-1;a>0;a-=2)for(a===6&&a--;;){for(let c=0;c<2;c++)if(!t.isReserved(o,a-c)){let l=!1;s<e.length&&(l=(e[s]>>>i&1)===1),t.set(o,a-c,l),i--,i===-1&&(s++,i=7)}if(o+=r,o<0||n<=o){o-=r,r=-r;break}}}function io(t,e,n){const r=new Vr;n.forEach(function(c){r.put(c.mode.bit,4),r.put(c.getLength(),Zr.getCharCountIndicator(c.mode,t)),c.write(r)});const o=je.getSymbolTotalCodewords(t),i=ct.getTotalCodewordsCount(t,e),s=(o-i)*8;for(r.getLengthInBits()+4<=s&&r.put(0,4);r.getLengthInBits()%8!==0;)r.putBit(0);const a=(s-r.getLengthInBits())/8;for(let c=0;c<a;c++)r.put(c%2?17:236,8);return so(r,t,e)}function so(t,e,n){const r=je.getSymbolTotalCodewords(e),o=ct.getTotalCodewordsCount(e,n),i=r-o,s=ct.getBlocksCount(e,n),a=r%s,c=s-a,l=Math.floor(r/s),d=Math.floor(i/s),u=d+1,f=l-d,h=new Yr(f);let m=0;const y=new Array(s),b=new Array(s);let p=0;const S=new Uint8Array(t.buffer);for(let x=0;x<s;x++){const B=x<c?d:u;y[x]=S.slice(m,m+B),b[x]=h.encode(y[x]),m+=B,p=Math.max(p,B)}const w=new Uint8Array(r);let g=0,C,v;for(C=0;C<p;C++)for(v=0;v<s;v++)C<y[v].length&&(w[g++]=y[v][C]);for(C=0;C<f;C++)for(v=0;v<s;v++)w[g++]=b[v][C];return w}function ao(t,e,n,r){let o;if(Array.isArray(t))o=tt.fromArray(t);else if(typeof t=="string"){let l=e;if(!l){const d=tt.rawSplit(t);l=ze.getBestVersionForData(d,n)}o=tt.fromString(t,l||40)}else throw new Error("Invalid data");const i=ze.getBestVersionForData(o,n);if(!i)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=i;else if(e<i)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+i+`.
`);const s=io(e,n,o),a=je.getSymbolSize(e),c=new Gr(a);return eo(c,e),to(c),no(c,e),nt(c,n,0),e>=7&&ro(c,e),oo(c,s),isNaN(r)&&(r=at.getBestMask(c,nt.bind(null,c,n))),at.applyMask(r,c),nt(c,n,r),{modules:c,version:e,errorCorrectionLevel:n,maskPattern:r,segments:o}}gn.create=function(e,n){if(typeof e=="undefined"||e==="")throw new Error("No input text");let r=et.M,o,i;return typeof n!="undefined"&&(r=et.from(n.errorCorrectionLevel,et.M),o=ze.from(n.version),i=at.from(n.maskPattern),n.toSJISFunc&&je.setToSJISFunction(n.toSJISFunc)),ao(e,o,r,i)};var Rn={},Ct={};(function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(i){return[i,i]}))),r.length===6&&r.push("F","F");const o=parseInt(r.join(""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:o&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const o=typeof r.margin=="undefined"||r.margin===null||r.margin<0?4:r.margin,i=r.width&&r.width>=21?r.width:void 0,s=r.scale||4;return{width:i,scale:i?4:s,margin:o,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,o){return o.width&&o.width>=r+o.margin*2?o.width/(r+o.margin*2):o.scale},t.getImageWidth=function(r,o){const i=t.getScale(r,o);return Math.floor((r+o.margin*2)*i)},t.qrToImageData=function(r,o,i){const s=o.modules.size,a=o.modules.data,c=t.getScale(s,i),l=Math.floor((s+i.margin*2)*c),d=i.margin*c,u=[i.color.light,i.color.dark];for(let f=0;f<l;f++)for(let h=0;h<l;h++){let m=(f*l+h)*4,y=i.color.light;if(f>=d&&h>=d&&f<l-d&&h<l-d){const b=Math.floor((f-d)/c),p=Math.floor((h-d)/c);y=u[a[b*s+p]?1:0]}r[m++]=y.r,r[m++]=y.g,r[m++]=y.b,r[m]=y.a}}})(Ct);(function(t){const e=Ct;function n(o,i,s){o.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=s,i.width=s,i.style.height=s+"px",i.style.width=s+"px"}function r(){try{return document.createElement("canvas")}catch(o){throw new Error("You need to specify a canvas element")}}t.render=function(i,s,a){let c=a,l=s;typeof c=="undefined"&&(!s||!s.getContext)&&(c=s,s=void 0),s||(l=r()),c=e.getOptions(c);const d=e.getImageWidth(i.modules.size,c),u=l.getContext("2d"),f=u.createImageData(d,d);return e.qrToImageData(f.data,i,c),n(u,l,d),u.putImageData(f,0,0),l},t.renderToDataURL=function(i,s,a){let c=a;typeof c=="undefined"&&(!s||!s.getContext)&&(c=s,s=void 0),c||(c={});const l=t.render(i,s,c),d=c.type||"image/png",u=c.rendererOpts||{};return l.toDataURL(d,u.quality)}})(Rn);var Pn={};const co=Ct;function kt(t,e){const n=t.a/255,r=e+'="'+t.hex+'"';return n<1?r+" "+e+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function rt(t,e,n){let r=t+e;return typeof n!="undefined"&&(r+=" "+n),r}function lo(t,e,n){let r="",o=0,i=!1,s=0;for(let a=0;a<t.length;a++){const c=Math.floor(a%e),l=Math.floor(a/e);!c&&!i&&(i=!0),t[a]?(s++,a>0&&c>0&&t[a-1]||(r+=i?rt("M",c+n,.5+l+n):rt("m",o,0),o=0,i=!1),c+1<e&&t[a+1]||(r+=rt("h",s),s=0)):o++}return r}Pn.render=function(e,n,r){const o=co.getOptions(n),i=e.modules.size,s=e.modules.data,a=i+o.margin*2,c=o.color.light.a?"<path "+kt(o.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",l="<path "+kt(o.color.dark,"stroke")+' d="'+lo(s,i,o.margin)+'"/>',d='viewBox="0 0 '+a+" "+a+'"',f='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+d+' shape-rendering="crispEdges">'+c+l+`</svg>
`;return typeof r=="function"&&r(null,f),f};const uo=xr,lt=gn,In=Rn,fo=Pn;function At(t,e,n,r,o){const i=[].slice.call(arguments,1),s=i.length,a=typeof i[s-1]=="function";if(!a&&!uo())throw new Error("Callback required as last argument");if(a){if(s<2)throw new Error("Too few arguments provided");s===2?(o=n,n=e,e=r=void 0):s===3&&(e.getContext&&typeof o=="undefined"?(o=r,r=void 0):(o=r,r=n,n=e,e=void 0))}else{if(s<1)throw new Error("Too few arguments provided");return s===1?(n=e,e=r=void 0):s===2&&!e.getContext&&(r=n,n=e,e=void 0),new Promise(function(c,l){try{const d=lt.create(n,r);c(t(d,e,r))}catch(d){l(d)}})}try{const c=lt.create(n,r);o(null,t(c,e,r))}catch(c){o(c)}}var ho=pe.create=lt.create,go=pe.toCanvas=At.bind(null,In.render),yo=pe.toDataURL=At.bind(null,In.renderToDataURL),mo=pe.toString=At.bind(null,function(t,e,n){return fo.render(t,n)});const Ot=qn({__proto__:null,create:ho,default:pe,toCanvas:go,toDataURL:yo,toString:mo},[pe]);function wo(t){return A(this,null,function*(){const n=new ReadableStream({start(o){o.enqueue(t),o.close()}}).pipeThrough(new CompressionStream("deflate-raw")),r=yield new Response(n).arrayBuffer();return new Uint8Array(r)})}function Jt(t){return A(this,null,function*(){const n=new ReadableStream({start(o){o.enqueue(t),o.close()}}).pipeThrough(new DecompressionStream("deflate-raw")),r=yield new Response(n).arrayBuffer();return new Uint8Array(r)})}class U extends Error{constructor(n,r){super(n);I(this,"code");this.code=r,this.name="SmartHealthCardError"}}class ke extends U{constructor(e){super(e,"JWS_ERROR"),this.name="JWSError"}}class K extends U{constructor(e){super(e,"QR_CODE_ERROR"),this.name="QRCodeError"}}class po extends U{constructor(e){super(e,"INVALID_BUNDLE_REFERENCE_ERROR"),this.name="InvalidBundleReferenceError"}}class ot extends U{constructor(e){super(e,"FILE_FORMAT_ERROR"),this.name="FileFormatError"}}class ce extends U{constructor(e){super(e,"VERIFICATION_ERROR"),this.name="VerificationError"}}class So extends U{constructor(e){super(e,"BAD_SIGNATURE"),this.name="SignatureVerificationError"}}class Eo extends U{constructor(e){super(e,"EXPIRED"),this.name="ExpirationError"}}class ne extends U{constructor(e){super(e,"FAILED_VALIDATION"),this.name="PayloadValidationError"}}class j extends U{constructor(e){super(e,"FAILED_VALIDATION"),this.name="BundleValidationError"}}class Q extends U{constructor(e){super(e,"FAILED_VALIDATION"),this.name="CredentialValidationError"}}class vt{process(e){if(!e||e.resourceType!=="Bundle")throw new j("Invalid bundle: must be a FHIR Bundle resource");const n=JSON.parse(JSON.stringify(e));return n.type||(n.type="collection"),n}processForQR(e,n={}){var o;const r=this.process(e);return this.optimizeForQR(r,(o=n.strictReferences)!=null?o:!0)}optimizeForQR(e,n){const r=JSON.parse(JSON.stringify(e));delete r.id;const o=new Map;return r.entry&&(r.entry.forEach((i,s)=>{i.fullUrl&&(o.set(i.fullUrl.split("/").slice(-2).join("/"),`resource:${s}`),i.fullUrl=`resource:${s}`)}),r.entry.forEach(i=>{i.resource&&(i.resource=this.optimizeResource(i.resource,o,n))})),r}optimizeResource(e,n,r){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(i=>this.optimizeResource(i,n,r)).filter(i=>i!=null);const o={};for(const[i,s]of Object.entries(e))if(!(s==null||Array.isArray(s)&&s.length===0)&&i!=="id"){if(i==="meta"){if(typeof s=="object"&&s!==null){const a=s;a.security&&Array.isArray(a.security)&&(o[i]={security:a.security})}continue}if(!(i==="text"&&this.isCodeableConcept(e)||i==="text"&&this.isDomainResource(e))&&!(i==="display"&&typeof s=="string"&&this.isWithinCoding(e))){if(i==="reference"&&typeof s=="string"){const a=n.get(s);if(a)o[i]=a;else{if(r)throw new po(`Reference "${s}" not found in bundle resources`);o[i]=s}continue}o[i]=this.optimizeResource(s,n,r)}}return o}isDomainResource(e){return e!=null&&e.text!=null&&typeof e.text=="object"&&"div"in e.text}isCodeableConcept(e){return e!=null&&typeof e=="object"&&"coding"in e&&Array.isArray(e.coding)}isWithinCoding(e){return e!==null&&typeof e=="object"&&"system"in e&&"code"in e&&typeof e.system=="string"&&typeof e.code=="string"}validate(e){try{if(!e)throw new j("Bundle cannot be null or undefined");if(e.resourceType!=="Bundle")throw new j("Resource must be of type Bundle");if(e.type&&!new Set(["document","message","transaction","transaction-response","batch","batch-response","history","searchset","collection"]).has(e.type))throw new j(`Invalid bundle.type: ${e.type}`);if(e.entry){if(!Array.isArray(e.entry))throw new j("Bundle.entry must be an array");for(const[n,r]of e.entry.entries()){if(!r.resource)throw new j(`Bundle.entry[${n}] must contain a resource`);if(!r.resource.resourceType)throw new j(`Bundle.entry[${n}].resource must have a resourceType`)}}return!0}catch(n){if(n instanceof j)throw n;const r=n instanceof Error?n.message:String(n);throw new j(`Bundle validation failed: ${r}`)}}}class Tn{sign(i,s,a){return A(this,arguments,function*(e,n,r,o={}){var c;try{this.validateJWTPayload(e);const d={alg:"ES256",kid:yield this.deriveKidFromPublicKey(r)},u=JSON.stringify(e);let h=new TextEncoder().encode(u);((c=o.enableCompression)!=null?c:!0)&&(h=yield wo(h),d.zip="DEF");let y;return typeof n=="string"?y=yield lr(n,"ES256"):n&&typeof n=="object"&&"kty"in n?y=yield he(n,"ES256"):y=n,yield new Cr(h).setProtectedHeader(d).sign(y)}catch(l){if(l instanceof U)throw l;const d=l instanceof Error?l.message:String(l);throw new ke(`JWS signing failed: ${d}`)}})}deriveKidFromPublicKey(e){return A(this,null,function*(){let n;typeof e=="string"?n=yield Ut(e,"ES256"):e&&typeof e=="object"&&"kty"in e?n=yield he(e,"ES256"):n=e;const r=yield un(n);return yield Ar(r)})}verify(e,n,r){return A(this,null,function*(){var o;try{if(!e||typeof e!="string")throw new ne("Invalid JWS: must be a non-empty string");let i;typeof n=="string"?i=yield Ut(n,"ES256"):n&&typeof n=="object"&&"kty"in n?i=yield he(n,"ES256"):i=n;let s,a;try{const f=yield Sr(e,i);s=f.payload,a=f.protectedHeader}catch(f){const h=f instanceof Error?f.message:String(f);throw new So(`Invalid JWS signature: ${h}`)}let c=s;a.zip==="DEF"&&(c=yield Jt(s));const l=new TextDecoder().decode(c),d=JSON.parse(l);if(this.validateJWTPayload(d),(o=r==null?void 0:r.verifyExpiration)!=null?o:!0){const f=Math.floor(Date.now()/1e3);if(typeof d.exp=="number"&&d.exp<f)throw new Eo("SMART Health Card has expired")}return d}catch(i){if(i instanceof U)throw i;const s=i instanceof Error?i.message:String(i);throw new ke(`JWS verification failed: ${s}`)}})}validateJWTPayload(e){if(!e||typeof e!="object")throw new ne("Invalid JWT payload: must be an object");if(!e.iss||typeof e.iss!="string")throw new ne("Invalid JWT payload: 'iss' (issuer) is required and must be a string");if(!e.nbf||typeof e.nbf!="number")throw new ne("Invalid JWT payload: 'nbf' (not before) is required and must be a number");if(e.exp!==void 0&&typeof e.exp!="number")throw new ne("Invalid JWT payload: 'exp' (expiration) must be a number if provided");if(e.exp&&e.exp<=e.nbf)throw new ne("Invalid JWT payload: 'exp' must be greater than 'nbf'");if(!e.vc||typeof e.vc!="object")throw new ne("Invalid JWT payload: 'vc' (verifiable credential) is required and must be an object")}parseUnverified(e){return A(this,null,function*(){try{if(!e||typeof e!="string")throw new ne("Invalid JWS: must be a non-empty string");const n=e.split(".");if(n.length!==3)throw new ke("Invalid Compact JWS");const r=vr(e),o=n[1],i=le(o),s=r.zip==="DEF"?yield Jt(i):i,a=new TextDecoder().decode(s),c=JSON.parse(a);return{header:r,payload:c}}catch(n){if(n instanceof U)throw n;const r=n instanceof Error?n.message:String(n);throw new ke(`Failed to parse JWS: ${r}`)}})}}const bo={L:1195,M:927,Q:670,H:519};class dt{constructor(e={}){I(this,"config");var o,i;const n=this.buildEncodeOptions(e.encodeOptions),r=(o=e.maxSingleQRSize)!=null?o:this.deriveMaxSingleQRSize(n.errorCorrectionLevel);this.config={maxSingleQRSize:r,enableChunking:(i=e.enableChunking)!=null?i:!1,encodeOptions:n}}deriveMaxSingleQRSize(e){return bo[e]}buildEncodeOptions(e={}){var r,o,i,s;const n={errorCorrectionLevel:"L",scale:4,margin:1,color:{dark:"#000000ff",light:"#ffffffff"}};return L({errorCorrectionLevel:(r=e.errorCorrectionLevel)!=null?r:n.errorCorrectionLevel,scale:(o=e.scale)!=null?o:n.scale,margin:(i=e.margin)!=null?i:n.margin,color:(s=e.color)!=null?s:n.color},e)}generateQR(e){return A(this,null,function*(){const n=e.length>this.config.maxSingleQRSize;if(!this.config.enableChunking&&n)throw new K(`Chunking is not enabled, but JWS length exceeds maxSingleQRSize:
        ${e.length} > ${this.config.maxSingleQRSize}. Use enableChunking: true to enable chunking.`);if(n)return yield this.generateChunkedQR(e);{const r=this.encodeJWSToNumeric(e);return yield this.generateSingleQR(r)}})}decodeQR(e){return A(this,null,function*(){if(!e||e.length===0)throw new K("No QR code data provided");if(e.length===1){const n=e[0];if(!n)throw new K("QR code data is undefined");return this.decodeSingleQR(n)}return this.decodeChunkedQR(e)})}encodeJWSToNumeric(e){return e.split("").map(r=>{const i=r.charCodeAt(0)-45;if(i<0||i>77)throw new K(`Invalid character '${r}' in JWS. Expected base64url characters only.`);return i.toString().padStart(2,"0")}).join("")}generateSingleQR(e){return A(this,null,function*(){const n=yield Dt(()=>Promise.resolve().then(()=>Ot),void 0,import.meta.url),r=[{data:new TextEncoder().encode("shc:/"),mode:"byte"},{data:e,mode:"numeric"}];return[yield n.toDataURL(r,this.config.encodeOptions)]})}chunkJWS(e){if(!e||typeof e!="string")throw new K("Invalid JWS: must be a non-empty string");const n=this.config.maxSingleQRSize;if(e.length<=n)return[`shc:/${this.encodeJWSToNumeric(e)}`];const r=Math.ceil(e.length/n),o=Math.ceil(e.length/r),i=[];for(let s=0,a=1;s<e.length;s+=o,a++){const c=e.substring(s,s+o),l=this.encodeJWSToNumeric(c);i.push(`shc:/${a}/${r}/${l}`)}return i}generateChunkedQR(e){return A(this,null,function*(){const n=yield Dt(()=>Promise.resolve().then(()=>Ot),void 0,import.meta.url),r=this.chunkJWS(e),o=r.length,i=[];for(let s=0;s<r.length;s++){const a=s+1,l=r[s].split("/").pop(),d=`shc:/${a}/${o}/`,u=[{data:new TextEncoder().encode(d),mode:"byte"},{data:l,mode:"numeric"}],f=yield n.toDataURL(u,this.config.encodeOptions);i.push(f)}return i})}decodeSingleQR(e){const n="shc:/";if(!e.startsWith(n))throw new K(`Invalid QR code format. Expected '${n}' prefix.`);const r=e.substring(n.length);return this.decodeNumericToJWS(r)}decodeChunkedQR(e){const n=[];let r=0;for(const i of e){const s="shc:/";if(!i.startsWith(s))throw new K(`Invalid chunked QR code format. Expected '${s}' prefix.`);const c=i.substring(s.length).split("/");if(c.length!==3)throw new K("Invalid chunked QR code format. Expected format: shc:/INDEX/TOTAL/DATA");const l=c[0],d=c[1],u=c[2];if(!l||!d||!u)throw new K("Invalid chunked QR code format: missing parts");const f=parseInt(l),h=parseInt(d);if(Number.isNaN(f)||Number.isNaN(h)||f<1||f>h)throw new K("Invalid chunk index or total in QR code");if(r===0)r=h;else if(r!==h)throw new K("Inconsistent total chunk count across QR codes");n.push({index:f,data:u})}if(n.length!==r)throw new K(`Missing chunks. Expected ${r}, got ${n.length}`);n.sort((i,s)=>i.index-s.index);const o=n.map(i=>i.data).join("");return this.decodeNumericToJWS(o)}decodeNumericToJWS(e){if(e.length%2!==0)throw new K("Invalid numeric data: must have even length");const n=45,r=e.match(/(\d\d)/g);if(!r)throw new K("Invalid numeric data: cannot parse digit pairs");for(const o of r){const i=parseInt(o);if(i>77)throw new K(`Invalid digit pair '${o}': value ${i} exceeds maximum 77`)}return r.map(o=>{const s=parseInt(o)+n;return String.fromCharCode(s)}).join("")}}class Mn{constructor(e,n){I(this,"jws");I(this,"originalBundle");this.jws=e,this.originalBundle=n}asJWS(){return this.jws}getOriginalBundle(){return this.originalBundle}asQR(){return A(this,arguments,function*(e={}){return yield new dt(e).generateQR(this.jws)})}asQRNumeric(e={}){return new dt(e).chunkJWS(this.jws)}asBundle(){return A(this,arguments,function*(e={}){const{optimizeForQR:n=!1,strictReferences:r=!0}=e;return n?new vt().processForQR(this.originalBundle,{strictReferences:r}):this.originalBundle})}asFileContent(){return A(this,null,function*(){const e={verifiableCredential:[this.jws]};return JSON.stringify(e)})}asFileBlob(){return A(this,null,function*(){const e=yield this.asFileContent();return new Blob([e],{type:"application/smart-health-card"})})}}class Nn{create(e,n={}){if(!e||e.resourceType!=="Bundle")throw new Q("Invalid FHIR Bundle provided");const r=n.fhirVersion||"4.0.1";return{vc:{type:this.createStandardTypes(n.includeAdditionalTypes),credentialSubject:{fhirVersion:r,fhirBundle:e}}}}validate(e){try{if(!e||!e.vc)throw new Q("Invalid VC: missing vc property");return this.validateTypes(e.vc.type),this.validateCredentialSubject(e.vc.credentialSubject),!0}catch(n){if(n instanceof Q)throw n;const r=n instanceof Error?n.message:String(n);throw new Q(`VC validation failed: ${r}`)}}createStandardTypes(e){const n=["https://smarthealth.cards#health-card"];return e&&e.length>0?[...n,...e]:n}validateTypes(e){if(!Array.isArray(e))throw new Q("VC type must be an array");if(e.length<1)throw new Q("VC type must contain at least 1 element");if(!e.includes("https://smarthealth.cards#health-card"))throw new Q("VC type must include https://smarthealth.cards#health-card")}validateCredentialSubject(e){if(!e)throw new Q("VC credentialSubject is required");if(!e.fhirVersion)throw new Q("VC credentialSubject must include fhirVersion");if(!/^\d+\.\d+\.\d+$/.test(e.fhirVersion))throw new Q("VC fhirVersion must be in semantic version format (e.g., 4.0.1)");if(!e.fhirBundle)throw new Q("VC credentialSubject must include fhirBundle");if(e.fhirBundle.resourceType!=="Bundle")throw new j("VC fhirBundle must be a valid FHIR Bundle")}}class Co{constructor(e){I(this,"config");I(this,"bundleProcessor");I(this,"vcProcessor");I(this,"jwsProcessor");var n,r,o;this.config=ae(L({},e),{expirationTime:(n=e.expirationTime)!=null?n:null,enableQROptimization:(r=e.enableQROptimization)!=null?r:!0,strictReferences:(o=e.strictReferences)!=null?o:!0}),this.bundleProcessor=new vt,this.vcProcessor=new Nn,this.jwsProcessor=new Tn}issue(r){return A(this,arguments,function*(e,n={}){const o=yield this.createJWS(e,n);return new Mn(o,e)})}createJWS(r){return A(this,arguments,function*(e,n={}){const o=this.config.enableQROptimization?this.bundleProcessor.processForQR(e,{strictReferences:this.config.strictReferences}):this.bundleProcessor.process(e);this.bundleProcessor.validate(o);const i=this.vcProcessor.create(o,n);this.vcProcessor.validate(i);const s=Math.floor(Date.now()/1e3),a={iss:this.config.issuer,nbf:s,vc:i.vc};return this.config.expirationTime&&(a.exp=s+this.config.expirationTime),yield this.jwsProcessor.sign(a,this.config.privateKey,this.config.publicKey,{enableCompression:!0})})}}class Ao{constructor(e){I(this,"config");I(this,"bundleProcessor");I(this,"vcProcessor");I(this,"jwsProcessor");var n,r,o;this.config=ae(L({},e),{enableQROptimization:(n=e.enableQROptimization)!=null?n:!0,strictReferences:(r=e.strictReferences)!=null?r:!0,verifyExpiration:(o=e.verifyExpiration)!=null?o:!0}),this.bundleProcessor=new vt,this.vcProcessor=new Nn,this.jwsProcessor=new Tn}fromFileContent(e){return A(this,null,function*(){let n;e instanceof Blob?n=yield e.text():n=e;const r=n;let o;try{const i=JSON.parse(r);if(i.verifiableCredential&&Array.isArray(i.verifiableCredential)){if(i.verifiableCredential.length===0)throw new ot("File contains empty verifiableCredential array");o=i.verifiableCredential[0]}else throw new ot("File does not contain expected verifiableCredential array")}catch(i){if(i instanceof U)throw i;const s=i instanceof Error?i.message:String(i);throw new ot(`Invalid file format - expected JSON with verifiableCredential array: ${s}`)}return yield this.fromJWS(o)})}fromJWS(e){return A(this,null,function*(){try{let n=this.config.publicKey;n||(n=yield this.resolvePublicKeyFromJWKS(e));const r=yield this.jwsProcessor.verify(e,n,{verifyExpiration:this.config.verifyExpiration}),o=r.vc.credentialSubject.fhirBundle;this.bundleProcessor.validate(o);const i={vc:r.vc};return this.vcProcessor.validate(i),new Mn(e,o)}catch(n){if(n instanceof U)throw n;const r=n instanceof Error?n.message:String(n);throw new ce(`Failed to verify SMART Health Card: ${r}`)}})}resolvePublicKeyFromJWKS(e){return A(this,null,function*(){try{const{header:n,payload:r}=yield this.jwsProcessor.parseUnverified(e);if(!r.iss||typeof r.iss!="string")throw new ce("Cannot resolve JWKS: missing 'iss' in payload");if(!n.kid||typeof n.kid!="string")throw new ce("Cannot resolve JWKS: missing 'kid' in JWS header");const i=`${new URL(r.iss).origin}/.well-known/jwks.json`,s=yield fetch(i);if(!s.ok)throw new ce(`Failed to fetch JWKS from issuer (${i}): ${s.status} ${s.statusText}`);const a=yield s.json();if(!a||!Array.isArray(a.keys))throw new ce("Invalid JWKS format: missing keys array");const c=a.keys.find(d=>d.kid===n.kid);if(!c)throw new ce(`No matching key found in JWKS for kid '${n.kid}'`);return yield he(c,"ES256")}catch(n){if(n instanceof U)throw n;const r=n instanceof Error?n.message:String(n);throw new ce(`Unable to resolve public key via JWKS endpoint: ${r}`)}})}fromQRNumeric(e){return A(this,null,function*(){try{const n=new dt,r=Array.isArray(e)?e:[e],o=yield n.decodeQR(r);return yield this.fromJWS(o)}catch(n){if(n instanceof U)throw n;const r=n instanceof Error?n.message:String(n);throw new K(`Failed to read SMART Health Card from QR numeric data: ${r}`)}})}}/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/const Be={newline:10,reset:27};function vo(t){if(!Number.isSafeInteger(t))throw new Error(`integer expected: ${t}`)}function xo(t){if(!Number.isSafeInteger(t)||t<1||t>40)throw new Error(`Invalid version=${t}. Expected number [1..40]`)}function Bo(t,e){return t.toString(2).padStart(e,"0")}function Wt(t,e){const n=t%e;return n>=0?n:e+n}function O(t,e){return new Array(t).fill(e)}function Ht(...t){let e=0;for(const r of t)e=Math.max(e,r.length);const n=[];for(let r=0;r<e;r++)for(const o of t)r>=o.length||n.push(o[r]);return new Uint8Array(n)}function Ro(){let t,e=1/0;return{add(n,r){n>=e||(t=r,e=n)},get:()=>t,score:()=>e}}function zt(t){return{has:e=>t.includes(e),decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})},encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(vo(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})}}}class k{constructor(e,n){I(this,"data");I(this,"height");I(this,"width");const{height:r,width:o}=k.size(e);this.data=n||Array.from({length:r},()=>O(o,void 0)),this.height=r,this.width=o}static size(e,n){if(typeof e=="number"&&(e={height:e,width:e}),!Number.isSafeInteger(e.height)&&e.height!==1/0)throw new Error(`Bitmap: invalid height=${e.height} (${typeof e.height})`);if(!Number.isSafeInteger(e.width)&&e.width!==1/0)throw new Error(`Bitmap: invalid width=${e.width} (${typeof e.width})`);return n!==void 0&&(e={width:Math.min(e.width,n.width),height:Math.min(e.height,n.height)}),e}static fromString(e){e=e.replace(/^\n+/g,"").replace(/\n+$/g,"");const n=e.split(String.fromCharCode(Be.newline)),r=n.length,o=new Array(r);let i;for(const s of n){const a=s.split("").map(c=>{if(c==="X")return!0;if(c===" ")return!1;if(c!=="?")throw new Error(`Bitmap.fromString: unknown symbol=${c}`)});if(i&&a.length!==i)throw new Error(`Bitmap.fromString different row sizes: width=${i} cur=${a.length}`);i=a.length,o.push(a)}return i||(i=0),new k({height:r,width:i},o)}point(e){return this.data[e.y][e.x]}isInside(e){return 0<=e.x&&e.x<this.width&&0<=e.y&&e.y<this.height}size(e){if(!e)return{height:this.height,width:this.width};const{x:n,y:r}=this.xy(e);return{height:this.height-r,width:this.width-n}}xy(e){if(typeof e=="number"&&(e={x:e,y:e}),!Number.isSafeInteger(e.x))throw new Error(`Bitmap: invalid x=${e.x}`);if(!Number.isSafeInteger(e.y))throw new Error(`Bitmap: invalid y=${e.y}`);return e.x=Wt(e.x,this.width),e.y=Wt(e.y,this.height),e}rect(e,n,r){const{x:o,y:i}=this.xy(e),{height:s,width:a}=k.size(n,this.size({x:o,y:i}));for(let c=0;c<s;c++)for(let l=0;l<a;l++)this.data[i+c][o+l]=typeof r=="function"?r({x:l,y:c},this.data[i+c][o+l]):r;return this}rectRead(e,n,r){return this.rect(e,n,(o,i)=>(r(o,i),i))}hLine(e,n,r){return this.rect(e,{width:n,height:1},r)}vLine(e,n,r){return this.rect(e,{width:1,height:n},r)}border(e=2,n){const r=this.height+2*e,o=this.width+2*e,i=O(e,n),s=Array.from({length:e},()=>O(o,n));return new k({height:r,width:o},[...s,...this.data.map(a=>[...i,...a,...i]),...s])}embed(e,n){return this.rect(e,n.size(),({x:r,y:o})=>n.data[o][r])}rectSlice(e,n=this.size()){const r=new k(k.size(n,this.size(this.xy(e))));return this.rect(e,n,({x:o,y:i},s)=>r.data[i][o]=s),r}inverse(){const{height:e,width:n}=this;return new k({height:n,width:e}).rect({x:0,y:0},1/0,({x:o,y:i})=>this.data[o][i])}scale(e){if(!Number.isSafeInteger(e)||e>1024)throw new Error(`invalid scale factor: ${e}`);const{height:n,width:r}=this;return new k({height:e*n,width:e*r}).rect({x:0,y:0},1/0,({x:i,y:s})=>this.data[Math.floor(s/e)][Math.floor(i/e)])}clone(){return new k(this.size()).rect({x:0,y:0},this.size(),({x:n,y:r})=>this.data[r][n])}assertDrawn(){this.rectRead(0,1/0,(e,n)=>{if(typeof n!="boolean")throw new Error(`Invalid color type=${typeof n}`)})}toString(){return this.data.map(e=>e.map(n=>n===void 0?"?":n?"X":" ").join("")).join(String.fromCharCode(Be.newline))}toASCII(){const{height:e,width:n,data:r}=this;let o="";for(let i=0;i<e;i+=2){for(let s=0;s<n;s++){const a=r[i][s],c=i+1>=e?!0:r[i+1][s];!a&&!c?o+="":!a&&c?o+="":a&&!c?o+="":a&&c&&(o+=" ")}o+=String.fromCharCode(Be.newline)}return o}toTerm(){const e=String.fromCharCode(Be.reset),n=e+"[0m",r=e+"[1;47m  "+n,o=e+"[40m  "+n;return this.data.map(i=>i.map(s=>s?o:r).join("")).join(String.fromCharCode(Be.newline))}toSVG(e=!0){let n=`<svg viewBox="0 0 ${this.width} ${this.height}" xmlns="http://www.w3.org/2000/svg">`,r="",o;return this.rectRead(0,1/0,(i,s)=>{if(!s)return;const{x:a,y:c}=i;if(!e){n+=`<rect x="${a}" y="${c}" width="1" height="1" />`;return}let l=`M${a} ${c}`;if(o){const u=`m${a-o.x} ${c-o.y}`;u.length<=l.length&&(l=u)}const d=a<10?`H${a}`:"h-1";r+=`${l}h1v1${d}Z`,o=i}),e&&(n+=`<path d="${r}"/>`),n+="</svg>",n}toGIF(){const e=a=>[a&255,a>>>8&255],n=[...e(this.width),...e(this.height)],r=[];this.rectRead(0,1/0,(a,c)=>r.push(+(c===!0)));const o=126,i=[71,73,70,56,55,97,...n,246,0,0,255,255,255,...O(3*127,0),44,0,0,0,0,...n,0,7],s=Math.floor(r.length/o);for(let a=0;a<s;a++)i.push(o+1,128,...r.slice(o*a,o*(a+1)).map(c=>+c));return i.push(r.length%o+1,128,...r.slice(s*o).map(a=>+a)),i.push(1,129,0,59),new Uint8Array(i)}toImage(e=!1){const{height:n,width:r}=this.size(),o=new Uint8Array(n*r*(e?3:4));let i=0;for(let s=0;s<n;s++)for(let a=0;a<r;a++){const c=this.data[s][a]?0:255;o[i++]=c,o[i++]=c,o[i++]=c,e||(o[i++]=255)}return{height:n,width:r,data:o}}}const Po=[26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],Io={low:[7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],medium:[10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],quartile:[13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],high:[17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]},To={low:[1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],medium:[1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],quartile:[1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],high:[1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]},X={size:{encode:t=>21+4*(t-1),decode:t=>(t-17)/4},sizeType:t=>Math.floor((t+7)/17),alignmentPatterns(t){if(t===1)return[];const e=6,n=X.size.encode(t)-e-1,r=n-e,o=Math.ceil(r/28);let i=Math.floor(r/o);i%2?i+=1:r%o*2>=o&&(i+=2);const s=[e];for(let a=1;a<o;a++)s.push(n-(o-a)*i);return s.push(n),s},ECCode:{low:1,medium:0,quartile:3,high:2},formatMask:21522,formatBits(t,e){const n=X.ECCode[t]<<3|e;let r=n;for(let o=0;o<10;o++)r=r<<1^(r>>9)*1335;return(n<<10|r)^X.formatMask},versionBits(t){let e=t;for(let n=0;n<12;n++)e=e<<1^(e>>11)*7973;return t<<12|e},alphabet:{numeric:zt("0123456789"),alphanumerc:zt("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:")},lengthBits(t,e){return{numeric:[10,12,14],alphanumeric:[9,11,13],byte:[8,16,16],kanji:[8,10,12],eci:[0,0,0]}[e][X.sizeType(t)]},modeBits:{numeric:"0001",alphanumeric:"0010",byte:"0100",kanji:"1000",eci:"0111"},capacity(t,e){const n=Po[t-1],r=Io[e][t-1],o=To[e][t-1],i=Math.floor(n/o)-r,s=o-n%o;return{words:r,numBlocks:o,shortBlocks:s,blockLen:i,capacity:(n-r*o)*8,total:(r+i)*o+o-s}}},Mo=[(t,e)=>(t+e)%2==0,(t,e)=>e%2==0,(t,e)=>t%3==0,(t,e)=>(t+e)%3==0,(t,e)=>(Math.floor(e/2)+Math.floor(t/3))%2==0,(t,e)=>t*e%2+t*e%3==0,(t,e)=>(t*e%2+t*e%3)%2==0,(t,e)=>((t+e)%2+t*e%3)%2==0],E={tables:(t=>{const e=O(256,0),n=O(256,0);for(let r=0,o=1;r<256;r++)e[r]=o,n[o]=r,o<<=1,o&256&&(o^=t);return{exp:e,log:n}})(285),exp:t=>E.tables.exp[t],log(t){if(t===0)throw new Error(`GF.log: invalid arg=${t}`);return E.tables.log[t]%255},mul(t,e){return t===0||e===0?0:E.tables.exp[(E.tables.log[t]+E.tables.log[e])%255]},add:(t,e)=>t^e,pow:(t,e)=>E.tables.exp[E.tables.log[t]*e%255],inv(t){if(t===0)throw new Error(`GF.inverse: invalid arg=${t}`);return E.tables.exp[255-E.tables.log[t]]},polynomial(t){if(t.length==0)throw new Error("GF.polymomial: invalid length");if(t[0]!==0)return t;let e=0;for(;e<t.length-1&&t[e]==0;e++);return t.slice(e)},monomial(t,e){if(t<0)throw new Error(`GF.monomial: invalid degree=${t}`);if(e==0)return[0];let n=O(t+1,0);return n[0]=e,E.polynomial(n)},degree:t=>t.length-1,coefficient:(t,e)=>t[E.degree(t)-e],mulPoly(t,e){if(t[0]===0||e[0]===0)return[0];const n=O(t.length+e.length-1,0);for(let r=0;r<t.length;r++)for(let o=0;o<e.length;o++)n[r+o]=E.add(n[r+o],E.mul(t[r],e[o]));return E.polynomial(n)},mulPolyScalar(t,e){if(e==0)return[0];if(e==1)return t;const n=O(t.length,0);for(let r=0;r<t.length;r++)n[r]=E.mul(t[r],e);return E.polynomial(n)},mulPolyMonomial(t,e,n){if(e<0)throw new Error("GF.mulPolyMonomial: invalid degree");if(n==0)return[0];const r=O(t.length+e,0);for(let o=0;o<t.length;o++)r[o]=E.mul(t[o],n);return E.polynomial(r)},addPoly(t,e){if(t[0]===0)return e;if(e[0]===0)return t;let n=t,r=e;n.length>r.length&&([n,r]=[r,n]);let o=O(r.length,0),i=r.length-n.length,s=r.slice(0,i);for(let a=0;a<s.length;a++)o[a]=s[a];for(let a=i;a<r.length;a++)o[a]=E.add(n[a-i],r[a]);return E.polynomial(o)},remainderPoly(t,e){const n=Array.from(t);for(let r=0;r<t.length-e.length+1;r++){const o=n[r];if(o!==0)for(let i=1;i<e.length;i++)e[i]!==0&&(n[r+i]=E.add(n[r+i],E.mul(e[i],o)))}return n.slice(t.length-e.length+1,n.length)},divisorPoly(t){let e=[1];for(let n=0;n<t;n++)e=E.mulPoly(e,[1,E.pow(2,n)]);return e},evalPoly(t,e){if(e==0)return E.coefficient(t,0);let n=t[0];for(let r=1;r<t.length;r++)n=E.add(E.mul(e,n),t[r]);return n},euclidian(t,e,n){E.degree(t)<E.degree(e)&&([t,e]=[e,t]);let r=t,o=e,i=[0],s=[1];for(;2*E.degree(o)>=n;){let l=r,d=i;if(r=o,i=s,r[0]===0)throw new Error("rLast[0] === 0");o=l;let u=[0];const f=E.inv(r[0]);for(;E.degree(o)>=E.degree(r)&&o[0]!==0;){const h=E.degree(o)-E.degree(r),m=E.mul(o[0],f);u=E.addPoly(u,E.monomial(h,m)),o=E.addPoly(o,E.mulPolyMonomial(r,h,m))}if(u=E.mulPoly(u,i),s=E.addPoly(u,d),E.degree(o)>=E.degree(r))throw new Error(`Division failed r: ${o}, rLast: ${r}`)}const a=E.coefficient(s,0);if(a==0)throw new Error("sigmaTilde(0) was zero");const c=E.inv(a);return[E.mulPolyScalar(s,c),E.mulPolyScalar(o,c)]}};function No(t){return{encode(e){const n=E.divisorPoly(t),r=Array.from(e);return r.push(...n.slice(0,-1).fill(0)),Uint8Array.from(E.remainderPoly(r,n))},decode(e){const n=e.slice(),r=E.polynomial(Array.from(e));let o=O(t,0),i=!1;for(let u=0;u<t;u++){const f=E.evalPoly(r,E.exp(u));o[o.length-1-u]=f,f!==0&&(i=!0)}if(!i)return n;o=E.polynomial(o);const s=E.monomial(t,1),[a,c]=E.euclidian(s,o,t),l=O(E.degree(a),0);let d=0;for(let u=1;u<256&&d<l.length;u++)E.evalPoly(a,u)===0&&(l[d++]=E.inv(u));if(d!==l.length)throw new Error("RS.decode: invalid errors number");for(let u=0;u<l.length;u++){const f=n.length-1-E.log(l[u]);if(f<0)throw new Error("RS.decode: invalid error location");const h=E.inv(l[u]);let m=1;for(let y=0;y<l.length;y++)u!==y&&(m=E.mul(m,E.add(1,E.mul(l[y],h))));n[f]=E.add(n[f],E.mul(E.evalPoly(c,h),E.inv(m)))}return n}}}function Do(t,e){const{words:n,shortBlocks:r,numBlocks:o,blockLen:i,total:s}=X.capacity(t,e),a=No(n);return{encode(c){const l=[],d=[];for(let m=0;m<o;m++){const y=m<r,b=i+(y?0:1);l.push(c.subarray(0,b)),d.push(a.encode(c.subarray(0,b))),c=c.subarray(b)}const u=Ht(...l),f=Ht(...d),h=new Uint8Array(u.length+f.length);return h.set(u),h.set(f,u.length),h},decode(c){if(c.length!==s)throw new Error(`interleave.decode: len(data)=${c.length}, total=${s}`);const l=[];for(let f=0;f<o;f++){const h=f<r;l.push(new Uint8Array(n+i+(h?0:1)))}let d=0;for(let f=0;f<i;f++)for(let h=0;h<o;h++)l[h][f]=c[d++];for(let f=r;f<o;f++)l[f][i]=c[d++];for(let f=i;f<i+n;f++)for(let h=0;h<o;h++){const m=h<r;l[h][f+(m?0:1)]=c[d++]}const u=[];for(const f of l)u.push(...Array.from(a.decode(f)).slice(0,-n));return Uint8Array.from(u)}}}function Uo(t,e,n,r=!1){const o=X.size.encode(t);let i=new k(o+2);const s=new k(3).rect(0,3,!0).border(1,!1).border(1,!0).border(1,!1);i=i.embed(0,s).embed({x:-s.width,y:0},s).embed({x:0,y:-s.height},s),i=i.rectSlice(1,o);const a=new k(1).rect(0,1,!0).border(1,!1).border(1,!0),c=X.alignmentPatterns(t);for(const l of c)for(const d of c)i.data[l][d]===void 0&&i.embed({x:d-2,y:l-2},a);i=i.hLine({x:0,y:6},1/0,({x:l},d)=>d===void 0?l%2==0:d).vLine({x:6,y:0},1/0,({y:l},d)=>d===void 0?l%2==0:d);{const l=X.formatBits(e,n),d=u=>!r&&(l>>u&1)==1;for(let u=0;u<6;u++)i.data[u][8]=d(u);for(let u=6;u<8;u++)i.data[u+1][8]=d(u);for(let u=8;u<15;u++)i.data[o-15+u][8]=d(u);for(let u=0;u<8;u++)i.data[8][o-u-1]=d(u);for(let u=8;u<9;u++)i.data[8][15-u-1+1]=d(u);for(let u=9;u<15;u++)i.data[8][15-u-1]=d(u);i.data[o-8][8]=!r}if(t>=7){const l=X.versionBits(t);for(let d=0;d<18;d+=1){const u=!r&&(l>>d&1)==1,f=Math.floor(d/3),h=d%3+o-8-3;i.data[f][h]=u,i.data[h][f]=u}}return i}function Lo(t,e,n){const r=t.height,o=Mo[e];let i=-1,s=r-1;for(let a=r-1;a>0;a-=2){for(a==6&&(a=5);;s+=i){for(let c=0;c<2;c+=1){const l=a-c;t.data[s][l]===void 0&&n(l,s,o(l,s))}if(s+i<0||s+i>=r)break}i=-i}}const Ko={best:Ro,bin:Bo,drawTemplate:Uo,fillArr:O,info:X,interleave:Do,validateVersion:xo,zigzag:Lo};/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/const{best:ut,bin:$o,drawTemplate:ko,fillArr:ft,info:V,interleave:Oo,validateVersion:Dn,zigzag:Jo}=Ko,_t=3,Wo=8,Ho=24,zo=2,_o=1.333,Un=2,Qo=3,T=t=>t>>>0,We=(t,e)=>{const n=t.x-e.x,r=t.y-e.y;return n*n+r*r},de=(t,e)=>Math.sqrt(We(t,e)),ye=t=>t.reduce((e,n)=>e+n),Qt=(t,e)=>{t.x+=e.x,t.y+=e.y},Fo=t=>({x:-t.x,y:-t.y}),Oe=t=>({x:t.y,y:t.x}),Ft=t=>({x:t.x,y:t.y}),Je=t=>({x:T(t.x),y:T(t.y)}),Vo=(t,e)=>({x:t.x+e.x,y:t.y+e.y});function z(t,e,n){return Math.max(Math.min(t,n||t),e||t)}const Ln=t=>{const e=t.data.length/(t.width*t.height);if(e===3||e===4)return e;throw new Error(`Unknown image format, bytes per pixel=${e}`)};function Go(t){const e=Ln(t),n=new Uint8Array(t.height*t.width);for(let d=0,u=0,f=t.data;d<f.length;d+=e){const h=f[d],m=f[d+1],y=f[d+2];n[u++]=T((h+2*m+y)/4)&255}const r=Wo;if(t.width<r*5||t.height<r*5)throw new Error("image too small");const o=Math.ceil(t.width/r),i=Math.ceil(t.height/r),s=t.height-r,a=t.width-r,c=new Uint8Array(o*i);for(let d=0;d<i;d++){const u=z(d*r,0,s);for(let f=0;f<o;f++){const h=z(f*r,0,a);let m=0,y=255,b=0;for(let S=0,w=u*t.width+h;S<r;S=S+1,w=w+t.width)for(let g=0;g<r;g++){const C=n[w+g];m+=C,y=Math.min(y,C),b=Math.max(b,C)}let p=Math.floor(m/Tt(r,2));if(b-y<=Ho&&(p=y/2,d>0&&f>0)){const S=(g,C)=>C*o+g,w=(c[S(f,d-1)]+2*c[S(f-1,d)]+c[S(f-1,d-1)])/4;y<w&&(p=w)}c[o*d+f]=T(p)}}const l=new k({width:t.width,height:t.height});for(let d=0;d<i;d++){const u=z(d*r,0,s),f=z(d,2,i-3);for(let h=0;h<o;h++){const m=z(h*r,0,a),y=z(h,2,o-3);let b=0;for(let S=-2;S<=2;S++){const w=o*(f+S)+y;for(let g=-2;g<=2;g++)b+=c[w+g]}const p=b/25;for(let S=0,w=u*t.width+m;S<r;S+=1,w+=t.width)for(let g=0;g<r;g++)n[w+g]<=p&&(l.data[u+S][m+g]=!0)}}return l}function jo(t,e){if(Math.abs(e.y-t.y)<=e.moduleSize&&Math.abs(e.x-t.x)<=e.moduleSize){const n=Math.abs(e.moduleSize-t.moduleSize);return n<=1||n<=t.moduleSize}return!1}function qo(t,e){const n=t.count+e.count;return{x:(t.count*t.x+e.count*e.x)/n,y:(t.count*t.y+e.count*e.y)/n,moduleSize:(t.count*t.moduleSize+e.count*e.moduleSize)/n,count:n}}const Yo=t=>t.filter(e=>e.count>=Un);function Kn(t,e){const n=e||ft(t.length,1);if(t.length!==n.length)throw new Error("invalid pattern");if(!(t.length&1))throw new Error("invalid pattern, length should be odd");const r={center:Math.ceil(t.length/2)-1,length:t.length,pattern:t,size:n,runs:()=>ft(t.length,0),totalSize:ye(n),total:o=>o.reduce((i,s)=>i+s),shift:(o,i)=>{for(let s=0;s<o.length-i;s++)o[s]=o[s+2];for(let s=o.length-i;s<o.length;s++)o[s]=0},checkSize(o,i,s=zo){const a=i/s;for(let c=0;c<o.length;c++)if(Math.abs(n[c]*i-o[c])>=n[c]*a)return!1;return!0},add(o,i,s,a){const c=a/$.totalSize,l={x:i,y:s,moduleSize:c,count:1};for(let d=0;d<o.length;d++){const u=o[d];if(jo(u,l))return o[d]=qo(u,l)}o.push(l)},toCenter(o,i){for(let s=t.length-1;s>r.center;s--)i-=o[s];return i-=o[r.center]/2,i},check(o,i,s,a,c){let l=0,d=Ft(s);const u=Fo(a),f=(h,m)=>{for(;o.isInside(d)&&!!o.point(d)===r.pattern[h];Qt(d,m))i[h]++,l++;if(i[h]===0)return!0;const y=h===r.center;return!!(c&&!y&&i[h]>r.size[h]*c)};for(let h=r.center;h>=0;h--)if(f(h,u))return!1;d=Ft(s),Qt(d,a),l=1;for(let h=r.center;h<r.length;h++)if(f(h,a))return!1;return l},scanLine(o,i,s,a,c){const l=r.runs();let d=0,u=s;if(s)for(;u<a&&!!o.data[i][u]===r.pattern[0];)u++;for(;u<a;u++){if(!!o.data[i][u]===r.pattern[d]){if(l[d]++,u!==o.width-1)continue;u++}if(d!==r.length-1){l[++d]++;continue}const f=c(l,u);if(f)d=0,l.fill(0);else{if(f===!1)break;r.shift(l,2),d=r.length-2,l[d]++}}}};return r}const $=Kn([!0,!1,!0,!1,!0],[1,1,3,1,1]),re=Kn([!1,!0,!1]);function Xo(t){let e=[];function n(g,C=2){const v=ye(g);if(v<$.totalSize)return!1;const x=v/$.totalSize;return $.checkSize(g,x,C)}function r(g,C,v,x){const B=$.runs();let P=$.check(t,B,g,x,C);if(P===!1)return!1;const R=ye(B);return 5*Math.abs(R-v)>=2*v?!1:n(B)?$.toCenter(B,P):!1}function o(g,C,v){if(!n(g))return!1;const x=ye(g);let B=$.toCenter(g,v),P=r({x:T(B),y:C},g[2],x,{y:1,x:0});if(P===!1)return!1;P+=C;let R=r({x:T(B),y:T(P)},g[2],x,{y:0,x:1});if(R===!1)return!1;B=R+T(B);const N=$.runs();return!$.check(t,N,{x:T(B),y:T(P)},{x:1,y:1})||!n(N,_o)?!1:($.add(e,B,P,x),!0)}let i=!1,s=z(T(3*t.height/(4*97)),Qo),a=!1;for(let g=s-1;g<t.height&&!a;g+=s)$.scanLine(t,g,0,t.width,(C,v)=>{if(o(C,g,v)){if(s=2,i){let x=0,B=0;for(const N of e)N.count<Un||(x++,B+=N.moduleSize);if(x<3)return;const P=B/e.length;let R=0;for(const N of e)R+=Math.abs(N.moduleSize-P);if(R<=.05*B)return a=!0,!1}else if(e.length>1){const x=Yo(e);if(x.length<2)return!0;i=!0;const B=T((Math.abs(x[0].x-x[1].x)-Math.abs(x[0].y-x[1].y))/2);return B<=C[2]+s?!0:(g+=B-C[2]-s,!1)}}});const c=e.length;if(c<3)throw new Error(`Finder: len(found) = ${c}`);e.sort((g,C)=>g.moduleSize-C.moduleSize);const l=ut();for(let g=0;g<c-2;g++){const C=e[g];for(let v=g+1;v<c-1;v++){const x=e[v],B=We(C,x);for(let P=v+1;P<c;P++){const R=e[P];if(R.moduleSize>C.moduleSize*1.4)continue;const N=[B,We(x,R),We(C,R)].sort((Qn,Fn)=>Qn-Fn),se=N[0],W=N[1],Bt=N[2];l.add(Math.abs(Bt-2*W)+Math.abs(Bt-2*se),[C,x,R])}}}const d=l.get();if(!d)throw new Error("cannot find finder");const u=d[0],f=d[1],h=d[2],m=de(u,f),y=de(f,h),b=de(u,h);let p=h,S=u,w=f;if(y>=m&&y>=b?(p=u,S=f,w=h):b>=y&&b>=m&&(p=f,S=u,w=h),(w.x-p.x)*(S.y-p.y)-(w.y-p.y)*(S.x-p.x)<0){let g=S;S=w,w=g}return{bl:S,tl:p,tr:w}}function Zo(t,e,n){const{moduleSize:r}=e,o=T(n*r),i=z(e.x-o,0),s=z(e.x+o,void 0,t.width-1),a=s-i,c=z(e.y-o,0),l=z(e.y+o,void 0,t.height-1),d=l-c;if(a<r*3||d<r*3)throw new Error(`x = ${a}, y=${d} moduleSize = ${r}`);const u=i,f=c,h=s-i,m=l-c,y=[],b=u+h,p=T(f+m/2);for(let S=0;S<m;S++){const w=T((S+1)/2),g=p+(S&1?-w:w);let C;if(re.scanLine(t,g,u,b,(v,x)=>{if(!re.checkSize(v,r))return;const B=ye(v),P=re.toCenter(v,x),R=re.runs();let N=re.check(t,R,{x:T(P),y:g},{y:1,x:0},2*v[1]);if(N===!1)return;N+=g;const se=ye(R);if(5*Math.abs(se-B)>=2*B||!re.checkSize(R,r))return;const W=re.toCenter(R,N);if(C=re.add(y,P,W,B),C)return!1}),C)return C}if(y.length>0)return y[0];throw new Error("Alignment pattern not found")}function Vt(t,e,n){let r=!1,o={x:Math.abs(n.x-e.x),y:Math.abs(n.y-e.y)};o.y>o.x&&(r=!0,e=Oe(e),n=Oe(n),o=Oe(o));let i=-o.x/2,s={x:e.x>=n.x?-1:1,y:e.y>=n.y?-1:1},a=0,c=n.x+s.x;for(let l=e.x,d=e.y;l!==c;l+=s.x){let u={x:l,y:d};if(r&&(u=Oe(u)),a===1==!!t.point(u)){if(a===2)return de({x:l,y:d},e);a++}if(i+=o.y,!(i<=0)){if(d===n.y)break;d+=s.y,i-=o.x}}return a===2?de({x:n.x+s.x,y:n.y},e):NaN}function Gt(t,e,n){let r=Vt(t,e,n),o=1;const{x:i,y:s}=e;let a=i-(n.x-i);const c=t.width;a<0?(o=i/(i-a),a=0):a>=c&&(o=(c-1-i)/(a-i),a=c-1);let l=T(s-(n.y-s)*o),d=1;const u=t.height;return l<0?(d=s/(s-l),l=0):l>=u&&(d=(u-1-s)/(l-s),l=u-1),a=T(i+(a-i)*d),r+=Vt(t,e,{x:a,y:l}),r-1}function jt(t,e,n){const r=Gt(t,Je(e),Je(n)),o=Gt(t,Je(n),Je(e));return Number.isNaN(r)?o/$.totalSize:Number.isNaN(o)?r/$.totalSize:(r+o)/(2*$.totalSize)}function ei(t){const{bl:e,tl:n,tr:r}=Xo(t),o=(jt(t,n,r)+jt(t,n,e))/2;if(o<1)throw new Error(`invalid moduleSize = ${o}`);const i=T(de(n,r)/o+.5),s=T(de(n,e)/o+.5);let a=T((i+s)/2+7);const c=a%4;c===0?a++:c===2?a--:c===3&&(a-=2);const l=V.size.decode(a);Dn(l);let d;if(V.alignmentPatterns(l).length>0){const S={x:r.x-n.x+e.x,y:r.y-n.y+e.y},w=1-3/(V.size.encode(l)-7),g={x:T(n.x+w*(S.x-n.x)),y:T(n.y+w*(S.y-n.y)),moduleSize:o,count:1};for(let C=4;C<=16;C<<=1)try{d=Zo(t,g,C);break}catch(v){}}const u={x:3.5,y:3.5},f={x:a-3.5,y:3.5},h={x:3.5,y:a-3.5};let m,y;d?(m=d,y={x:a-6.5,y:a-6.5}):(m={x:r.x-n.x+e.x,y:r.y-n.y+e.y},y={x:a-3.5,y:a-3.5});const b=[n,r,m,e];return{bits:ti(t,a,b,[u,f,y,h]),points:b}}function qt(t){const e={x:t[0].x-t[1].x+t[2].x-t[3].x,y:t[0].y-t[1].y+t[2].y-t[3].y};if(e.x===0&&e.y===0)return[[t[1].x-t[0].x,t[2].x-t[1].x,t[0].x],[t[1].y-t[0].y,t[2].y-t[1].y,t[0].y],[0,0,1]];{const n={x:t[1].x-t[2].x,y:t[1].y-t[2].y},r={x:t[3].x-t[2].x,y:t[3].y-t[2].y},o=n.x*r.y-r.x*n.y,i=(e.x*r.y-r.x*e.y)/o,s=(n.x*e.y-e.x*n.y)/o;return[[t[1].x-t[0].x+i*t[1].x,t[3].x-t[0].x+s*t[3].x,t[0].x],[t[1].y-t[0].y+i*t[1].y,t[3].y-t[0].y+s*t[3].y,t[0].y],[i,s,1]]}}function ti(t,e,n,r){const o=qt(r),i=[[o[1][1]*o[2][2]-o[2][1]*o[1][2],o[2][1]*o[0][2]-o[0][1]*o[2][2],o[0][1]*o[1][2]-o[1][1]*o[0][2]],[o[2][0]*o[1][2]-o[1][0]*o[2][2],o[0][0]*o[2][2]-o[2][0]*o[0][2],o[1][0]*o[0][2]-o[0][0]*o[1][2]],[o[1][0]*o[2][1]-o[2][0]*o[1][1],o[2][0]*o[0][1]-o[0][0]*o[2][1],o[0][0]*o[1][1]-o[1][0]*o[0][1]]],a=qt(n).map(u=>u.map((f,h)=>u.reduce((m,y,b)=>m+y*i[b][h],0))),c=new k(e),l=ft(2*e,0),d=l.length;for(let u=0;u<e;u++){const f=a;for(let h=0;h<d-1;h+=2){const m=h/2+.5,y=u+.5,b=f[2][0]*m+f[2][1]*y+f[2][2];l[h]=T((f[0][0]*m+f[0][1]*y+f[0][2])/b),l[h+1]=T((f[1][0]*m+f[1][1]*y+f[1][2])/b)}for(let h=0;h<d;h+=2){const m=z(l[h],0,t.width-1),y=z(l[h+1],0,t.height-1);t.data[y][m]&&(c.data[u][h/2]=!0)}}return c}function ni(t){const e=(a,c,l)=>l<<1|(t.data[c][a]?1:0),n=t.height;let r=0;for(let a=5;a>=0;a--)for(let c=n-9;c>=n-11;c--)r=e(c,a,r);let o=0;for(let a=5;a>=0;a--)for(let c=n-9;c>=n-11;c--)o=e(a,c,o);let i=0;for(let a=0;a<6;a++)i=e(a,8,i);i=e(7,8,i),i=e(8,8,i),i=e(8,7,i);for(let a=5;a>=0;a--)i=e(8,a,i);let s=0;for(let a=n-1;a>=n-7;a--)s=e(8,a,s);for(let a=n-8;a<n;a++)s=e(a,8,s);return{version1:r,version2:o,format1:i,format2:s}}function ri(t){const e=d=>{let u=0;for(;d;)d&1&&u++,d>>=1;return u},n=t.height,{version1:r,version2:o,format1:i,format2:s}=ni(t);let a;const c=ut();for(const d of["medium","low","high","quartile"])for(let u=0;u<8;u++){const f=V.formatBits(d,u),h={ecc:d,mask:u};if(f===i||f===s){a=h;break}c.add(e(i^f),h),i!==s&&c.add(e(s^f),h)}if(a===void 0&&c.score()<=_t&&(a=c.get()),a===void 0)throw new Error("invalid format pattern");let l=V.size.decode(n);if(l<7)Dn(l);else{l=void 0;const d=ut();for(let u=7;u<=40;u++){const f=V.versionBits(u);if(f===r||f===o){l=u;break}d.add(e(r^f),u),r!==o&&d.add(e(o^f),u)}if(l===void 0&&d.score()<=_t&&(l=d.get()),l===void 0)throw new Error("invalid version pattern");if(V.size.encode(l)!==n)throw new Error("invalid version size")}return L({version:l},a)}function oi(t){const e=t.height;if(e<21||(e&3)!==1||e!==t.width)throw new Error(`decode: invalid size=${e}`);const{version:n,mask:r,ecc:o}=ri(t),i=ko(n,o,r),{total:s}=V.capacity(n,o),a=new Uint8Array(s);let c=0,l=0,d=0;if(Jo(i,r,(b,p,S)=>{d++,l<<=1,l|=+(!!t.data[p][b]!==S),d===8&&(a[c++]=l,d=0,l=0)}),c!==s)throw new Error(`decode: pos=${c}, total=${s}`);let u=Array.from(Oo(n,o).decode(a)).map(b=>$o(b,8)).join("");const f=b=>{if(b>u.length)throw new Error("Not enough bits");const p=u.slice(0,b);return u=u.slice(b),p},h=b=>+`0b${b}`,m={"0000":"terminator","0001":"numeric","0010":"alphanumeric","0100":"byte","0111":"eci",1e3:"kanji"};let y="";for(;!(u.length<4);){const b=f(4),p=m[b];if(p===void 0)throw new Error(`Unknown modeBits=${b} res="${y}"`);if(p==="terminator")break;const S=V.lengthBits(n,p);let w=h(f(S));if(p==="numeric"){for(;w>=3;){const g=h(f(10));if(g>=1e3)throw new Error(`numberic(3) = ${g}`);y+=g.toString().padStart(3,"0"),w-=3}if(w===2){const g=h(f(7));if(g>=100)throw new Error(`numeric(2) = ${g}`);y+=g.toString().padStart(2,"0")}else if(w===1){const g=h(f(4));if(g>=10)throw new Error(`Numeric(1) = ${g}`);y+=g.toString()}}else if(p==="alphanumeric"){for(;w>=2;){const g=h(f(11));y+=V.alphabet.alphanumerc.encode([Math.floor(g/45),g%45]).join(""),w-=2}w===1&&(y+=V.alphabet.alphanumerc.encode([h(f(6))]).join(""))}else if(p==="byte"){let g=[];for(let C=0;C<w;C++)g.push(+`0b${f(8)}`);y+=new TextDecoder().decode(new Uint8Array(g))}else throw new Error(`Unknown mode=${p}`)}return y}function ii(t){const e=Array.isArray(t.data)?new Uint8Array(t.data):t.data,{height:n,width:r}=t,o=Math.min(n,r),i={x:Math.floor((r-o)/2),y:Math.floor((n-o)/2)},s=Ln(t),a=new Uint8Array(o*o*s);for(let c=0;c<o;c++){const l=((c+i.y)*r+i.x)*s,d=c*o*s,u=o*s;a.set(e.subarray(l,l+u),d)}return{offset:i,img:{height:o,width:o,data:a}}}function si(t,e={}){for(const a of["height","width"])if(!Number.isSafeInteger(t[a])||t[a]<=0)throw new Error(`invalid img.${a}=${t[a]} (${typeof t[a]})`);if(!Array.isArray(t.data)&&!(t.data instanceof Uint8Array)&&!(t.data instanceof Uint8ClampedArray))throw new Error(`invalid image.data=${t.data} (${typeof t.data})`);if(e.cropToSquare!==void 0&&typeof e.cropToSquare!="boolean")throw new Error(`invalid opts.cropToSquare=${e.cropToSquare}`);for(const a of["pointsOnDetect","imageOnBitmap","imageOnDetect","imageOnResult"])if(e[a]!==void 0&&typeof e[a]!="function")throw new Error(`invalid opts.${a}=${e[a]} (${typeof e[a]})`);let n={x:0,y:0};e.cropToSquare&&({img:t,offset:n}=ii(t));const r=Go(t);e.imageOnBitmap&&e.imageOnBitmap(r.toImage());const{bits:o,points:i}=ei(r);if(e.pointsOnDetect){const a=i.map(c=>L(L({},c),Vo(c,n)));e.pointsOnDetect(a)}e.imageOnDetect&&e.imageOnDetect(o.toImage());const s=oi(o);return e.imageOnResult&&e.imageOnResult(o.toImage()),s}const ai=[{kty:"EC",kid:"3Kfdg-XwP-7gXyywtUfUADwBumDOPKMQx-iELL11W9s",use:"sig",alg:"ES256",crv:"P-256",x:"11XvRWy1I2S0EyJlyf_bWfw_TQ5CJJNLw78bHXNxcgw",y:"eZXwxvO1hvCY0KucrPfKo7yAyMT6Ajc3N7OkAB6VYy8",d:"FvOOk6hMixJ2o9zt4PCfan_UW7i4aOEnzj76ZaCI9Og"},{kty:"EC",kid:"7rIUtD5K5Izrptr3ywgESTxhgJtJSeb06V42hg7WUDs",use:"enc",alg:"ECDH-ES",crv:"P-256",x:"Lhaq5B4HhCDJSSQU_rJLShIIr6S5PxfXKTGKfKSP_CY",y:"EaxJ3zkqswLnw5GOf95A3atOTToVYmZPrp_t7WBcHcM",d:"K9zmeCMxMTdq_9nOa0s1Kfg-GXrNkrSLw209g3A5k70"},{kty:"EC",kid:"EBKOr72QQDcTBUuVzAzkfBTGew0ZA16GuWty64nS-sw",use:"sig",alg:"ES256",x5c:["MIICDDCCAZGgAwIBAgIUVJEUcO5ckx9MA7ZPjlsXYGv+98wwCgYIKoZIzj0EAwMwJzElMCMGA1UEAwwcU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBDQTAeFw0yMTA2MDExNTUwMDlaFw0yMjA2MDExNTUwMDlaMCsxKTAnBgNVBAMMIFNNQVJUIEhlYWx0aCBDYXJkIEV4YW1wbGUgSXNzdWVyMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEPQHApUWm94mflvswQgAnfHlETMwJFqjUVSs7WU6LQy7uaPwg77xXlVmMNtFWwkg0L9GrlqLkIOEVfXxx5GwtZKOBljCBkzAJBgNVHRMEAjAAMAsGA1UdDwQEAwIHgDA5BgNVHREEMjAwhi5odHRwczovL3NwZWMuc21hcnRoZWFsdGguY2FyZHMvZXhhbXBsZXMvaXNzdWVyMB0GA1UdDgQWBBTGqQP/SGBzOjWWcDdk/U7bQFhu+DAfBgNVHSMEGDAWgBQ4uufUcLGAmR55HWQWi+6PN9HJcTAKBggqhkjOPQQDAwNpADBmAjEAlZ9TR2TJnhumSUmtmgsWPpcp3xDYUtcXtxHs2xuHU6HqoaBfWDdUJKO8tWljGSVWAjEApesQltBP8ddWIn1BgBpldJ1pq9zukqfwRjwoCH1SRQXyuhGNfovvQMl/lw8MLIyO","MIICBzCCAWigAwIBAgIUK9wvDGYJ5S9DKzs/MY+IiTa0CP0wCgYIKoZIzj0EAwQwLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMB4XDTIxMDYwMTE1NTAwOVoXDTI2MDUzMTE1NTAwOVowJzElMCMGA1UEAwwcU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBDQTB2MBAGByqGSM49AgEGBSuBBAAiA2IABF2eAAAAGv0/isod1xpgaLX0DASxCDs0+JbCt12CTdQhB7os9m9H8c0nLyaNb8lM9IXkBRZLoLly/ZRaRjU8vq3bt6l5m9Cc6OY+xwmADKvNdNm94dsCC5CiB+JQu6WgWKNQME4wDAYDVR0TBAUwAwEB/zAdBgNVHQ4EFgQUOLrn1HCxgJkeeR1kFovujzfRyXEwHwYDVR0jBBgwFoAUJo6aEvlKNnmPfQaKVkOXIDY87/8wCgYIKoZIzj0EAwQDgYwAMIGIAkIBq9tT76Qzv1wH6nB0/sKPN4xPUScJeDv4+u2Zncv4ySWn5BR3DxYxEdJsVk4Aczw8uBipnYS90XNiogXMmN7JbRQCQgEYLzjOB1BdWIzjBlLF0onqnsAQijr6VX+2tfd94FNgMxHtaU864vgD/b3b0jr/Qf4dUkvF7K9WM1+vbcd0WDP4gQ==","MIICMjCCAZOgAwIBAgIUadiyU9sUFV6H40ZB5pCyc+gOikgwCgYIKoZIzj0EAwQwLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMB4XDTIxMDYwMTE1NTAwOFoXDTMxMDUzMDE1NTAwOFowLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQB/XU90B0DMB6GKbfNKz6MeEIZ2o6qCX76GGiwhPYZyDLgB4+njRHUA7l7KSrv8THtzXSn8FwDmubAZdbU3lwNRGcAQJVY/9Bq9TY5Utp8ttbVnXcHQ5pumzMgIkkrIzERg+iCZLtjgPYjUMgeLWpqQMG3VBNN6LXN4wM6DiJiZeeBId6jUDBOMAwGA1UdEwQFMAMBAf8wHQYDVR0OBBYEFCaOmhL5SjZ5j30GilZDlyA2PO//MB8GA1UdIwQYMBaAFCaOmhL5SjZ5j30GilZDlyA2PO//MAoGCCqGSM49BAMEA4GMADCBiAJCAe/u808fhGLVpgXyg3h/miSnqxGBx7Gav5Xf3iscdZkF9G5SH1G6UPvIS0tvP/2x9xHh2Vsx82OCZH64uPmKPqmkAkIBcUed8q/dQMgUmsB+jT7A7hKz0rh3CvmhW8b4djD3NesKW3M9qXqpRihd+7KqmTjUxhqUckiPBVLVm5wenaj08Ys="],crv:"P-256",x:"PQHApUWm94mflvswQgAnfHlETMwJFqjUVSs7WU6LQy4",y:"7mj8IO-8V5VZjDbRVsJINC_Rq5ai5CDhFX18ceRsLWQ",d:"vRyvhpwvbBuGVF3xmzpdvQjNH_IthPq3ehMWqPtlRXQ"}],ci={keys:ai};let $n=null,ht=null;function li(){return A(this,null,function*(){try{const e=ci.keys.find(o=>o.use==="sig"&&o.alg==="ES256"&&o.kty==="EC");if(!e)throw new Error("No suitable signing key found in JWKS");$n=yield he(e,"ES256");const t=e,{d:n}=t,r=Ye(t,["d"]);ht=yield he(r,"ES256"),console.log("Test keys loaded successfully"),console.log("Using key ID:",e.kid)}catch(e){throw console.error(" Failed to load test keys:",e),e}})}function kn(){return A(this,null,function*(){try{console.log("Enumerating camera devices...");let t=null;try{t=yield navigator.mediaDevices.getUserMedia({video:!0})}catch(n){console.warn(" Camera permission denied, device labels may not be available")}return J=(yield navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput"),t&&t.getTracks().forEach(n=>n.stop()),console.log(`Found ${J.length} camera(s):`,J.map(n=>n.label||`Camera ${n.deviceId.substring(0,8)}...`)),J}catch(t){return console.error(" Failed to enumerate camera devices:",t),J=[],[]}})}function On(){const t=document.getElementById("cameraSelect");if(t.innerHTML="",J.length===0){t.innerHTML='<option value="">No cameras found</option>',t.disabled=!0;return}if(J.length>1&&(t.innerHTML='<option value="">Auto (Prefer back camera)</option>'),J.forEach((e,n)=>{const r=document.createElement("option");r.value=e.deviceId;let o=e.label;(!o||o.trim()==="")&&(o=`Camera ${n+1}`),o.toLowerCase().includes("back")||o.toLowerCase().includes("rear")?o=` ${o}`:o.toLowerCase().includes("front")||o.toLowerCase().includes("user")||o.toLowerCase().includes("face")?o=` ${o}`:o=` ${o}`,r.textContent=o,t.appendChild(r)}),t.disabled=!1,J.length>1){const e=J.find(n=>n.label&&(n.label.toLowerCase().includes("back")||n.label.toLowerCase().includes("rear")||n.label.toLowerCase().includes("environment")));e&&(t.value=e.deviceId)}}function di(){return A(this,null,function*(){try{G("info"," Detecting available cameras..."),yield kn(),On(),J.length===0?G("error"," No cameras found. QR scanning will not be available."):(G("success",` Found ${J.length} camera(s). Select your preferred camera above.`),setTimeout(()=>{const t=document.getElementById("scanStatus");t&&(t.style.display="none")},3e3))}catch(t){console.error(" Camera initialization failed:",t),G("error",` Camera initialization failed: ${t.message}`)}})}const Jn={resourceType:"Bundle",type:"collection",entry:[{fullUrl:"https://example.org/fhir/Patient/123",resource:{resourceType:"Patient",id:"123",name:[{family:"Demo",given:["Test"]}],birthDate:"1990-01-01",gender:"unknown"}},{fullUrl:"https://example.org/fhir/Immunization/456",resource:{resourceType:"Immunization",id:"456",status:"completed",vaccineCode:{coding:[{system:"http://hl7.org/fhir/sid/cvx",code:"207",display:"COVID-19 vaccine (Demo Data Only)"}]},patient:{reference:"Patient/123"},occurrenceDateTime:"2023-01-15",performer:[{actor:{display:"Demo Healthcare Provider (Test Only)"}}]}}]};let Wn=null,Hn=null,Ie=null,xt=!1,J=[],_e=null;function ui(){return A(this,null,function*(){try{yield li(),Wn=new Co({issuer:"https://spec.smarthealth.cards/examples/issuer",privateKey:$n,publicKey:ht}),Hn=new Ao({publicKey:ht}),fi(),yield di(),hi(),console.log("SMART Health Cards demo initialized successfully"),console.log("Using SMART Health Cards example test keys")}catch(t){console.error(" Failed to initialize demo:",t),G("error",`Initialization failed: ${t.message}`)}})}function fi(){document.getElementById("generateBtn").addEventListener("click",gi),document.getElementById("clearBtn").addEventListener("click",mi),document.getElementById("copyNumericBtn").addEventListener("click",wi),document.getElementById("scanBtn").addEventListener("click",pi),document.getElementById("stopScanBtn").addEventListener("click",zn),navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",()=>A(this,null,function*(){console.log("Camera devices changed, refreshing camera list..."),yield kn(),On()}))}function hi(){const t=document.getElementById("bundleDisplay");t.textContent=JSON.stringify(Jn,null,2)}function gi(){return A(this,null,function*(){const t=document.getElementById("generateBtn");try{t.disabled=!0,t.innerHTML='<span class="loading"></span>Generating...',me("info","Generating SMART Health Card QR code...");const e=yield Wn.issue(Jn,{includeAdditionalTypes:["https://smarthealth.cards#immunization","https://smarthealth.cards#covid19"]}),n=yield e.asQR({encodeOptions:{errorCorrectionLevel:"L",scale:4,margin:1}});_e=e.asQRNumeric()[0],yi(n[0]),me("success"," QR code generated successfully! This contains the demo health card data."),console.log("Generated QR code:",n[0].substring(0,50)+"..."),console.log("JWS:",e.asJWS().substring(0,100)+"...")}catch(e){console.error(" QR generation failed:",e),me("error",`QR generation failed: ${e.message}`)}finally{t.disabled=!1,t.textContent="Generate Sample QR Code"}})}function yi(t){const e=document.getElementById("qrCodeContainer"),n=document.getElementById("copyButtonContainer");e.innerHTML=`
    <div>
      <img src="${t}" alt="SMART Health Card QR Code" style="max-width: 300px;" />
      <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
           You can scan this QR code using the camera scanner below
      </p>
    </div>
  `,n.style.display="block"}function mi(){const t=document.getElementById("qrCodeContainer"),e=document.getElementById("generationStatus"),n=document.getElementById("copyButtonContainer");t.innerHTML='<p class="placeholder">Click "Generate Sample QR Code" to create a QR code</p>',e.style.display="none",n.style.display="none",_e=null}function wi(){return A(this,null,function*(){if(!_e){me("error","No numeric data available to copy");return}try{yield navigator.clipboard.writeText(_e),me("success"," Numeric data copied to clipboard!");const t=document.getElementById("copyNumericBtn"),e=t.textContent;t.textContent="Copied",t.disabled=!0,setTimeout(()=>{t.textContent=e,t.disabled=!1},2e3)}catch(t){console.error(" Failed to copy to clipboard:",t),me("error",`Failed to copy to clipboard: ${t.message}`)}})}function pi(){return A(this,null,function*(){const t=document.getElementById("scanBtn"),e=document.getElementById("stopScanBtn"),n=document.getElementById("cameraSelect"),r=document.getElementById("video"),o=document.getElementById("canvas"),i=document.getElementById("scannerPlaceholder");try{if(t.disabled=!0,e.disabled=!1,G("info","Requesting camera access..."),J.length===0)throw new Error("No cameras available. Please ensure you have a camera connected and grant camera permissions.");const s={width:{ideal:640},height:{ideal:480}},a=n.value;a?(s.deviceId={exact:a},console.log(`Using selected camera: ${a}`)):(s.facingMode="environment",console.log("Using auto camera selection (prefer back camera)")),Ie=yield navigator.mediaDevices.getUserMedia({video:s}),r.srcObject=Ie,r.play(),r.style.display="block",i.style.display="none";const c=document.getElementById("scannerContainer");if(!c.querySelector(".scanner-overlay")){const l=document.createElement("div");l.className="scanner-overlay",c.appendChild(l)}xt=!0,G("info"," Camera active - position QR code within the frame"),_n(r,o)}catch(s){console.error(" Camera access failed:",s);let a=`Camera access failed: ${s.message}`;const c=n.value;if(c){const l=J.find(u=>u.deviceId===c),d=(l==null?void 0:l.label)||`Camera ${c.substring(0,8)}...`;a+=` (Selected camera: ${d}). Try selecting a different camera or use auto-selection.`}else a+=" Please ensure you've granted camera permissions and try selecting a specific camera.";G("error",a),t.disabled=!1,e.disabled=!0}})}function zn(){const t=document.getElementById("scanBtn"),e=document.getElementById("stopScanBtn"),n=document.getElementById("scanStatus"),r=document.getElementById("video"),o=document.getElementById("scannerPlaceholder");xt=!1,Ie&&(Ie.getTracks().forEach(a=>a.stop()),Ie=null),r.style.display="none",o.style.display="block",o.textContent='Click "Start Camera Scan" to begin scanning';const s=document.getElementById("scannerContainer").querySelector(".scanner-overlay");s&&s.remove(),t.disabled=!1,e.disabled=!0,n.style.display="none"}function _n(t,e){if(!xt)return;const n=e.getContext("2d");if(t.readyState===t.HAVE_ENOUGH_DATA){e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height);let o=null;try{o=si({width:r.width,height:r.height,data:r.data},{})}catch(i){}if(typeof o=="string"&&o.startsWith("shc:/")){Si(o);return}}requestAnimationFrame(()=>_n(t,e))}function Si(t){return A(this,null,function*(){console.log("QR code detected:",t.substring(0,50)+"...");try{zn(),G("info"," QR code detected! Verifying health card...");const n=yield(yield Hn.fromQRNumeric(t)).asBundle();Yt(n,t),G("success"," SMART Health Card verified and decoded successfully!")}catch(e){console.error(" QR verification failed:",e),G("error",`QR verification failed: ${e.message}`),Yt(null,t,e.message)}})}function Yt(t,e,n=null){var o,i,s,a,c;const r=document.getElementById("scanResult");if(t){const l=(i=(o=t.entry)==null?void 0:o.find(f=>{var h;return((h=f.resource)==null?void 0:h.resourceType)==="Patient"}))==null?void 0:i.resource,d=(s=t.entry)==null?void 0:s.filter(f=>{var h;return((h=f.resource)==null?void 0:h.resourceType)==="Immunization"});let u=` SMART Health Card Verified!

`;if(l){const f=(a=l.name)==null?void 0:a[0];u+=` Patient: ${((c=f==null?void 0:f.given)==null?void 0:c[0])||"Unknown"} ${(f==null?void 0:f.family)||"Unknown"}
`,u+=` Birth Date: ${l.birthDate||"Unknown"}

`}d&&d.length>0&&(u+=` Immunizations:
`,d.forEach((f,h)=>{var b,p;const m=f.resource,y=(p=(b=m.vaccineCode)==null?void 0:b.coding)==null?void 0:p[0];u+=`  ${h+1}. ${(y==null?void 0:y.display)||(y==null?void 0:y.code)||"Unknown vaccine"}
`,u+=`     Date: ${m.occurrenceDateTime||"Unknown date"}
`,u+=`     Status: ${m.status||"Unknown"}
`})),u+=`
 Full FHIR Bundle:
`,u+=JSON.stringify(t,null,2),r.textContent=u}else{let l=` QR Code Processing Failed

`;n&&(l+=`Error: ${n}

`),l+=`Raw QR Data: ${e}
`,l+=`Length: ${e.length} characters`,r.textContent=l}}function me(t,e){const n=document.getElementById("generationStatus");n&&(n.className=`status-message ${t}`,n.textContent=e,n.style.display="block")}function G(t,e){const n=document.getElementById("scanStatus");n&&(n.className=`status-message ${t}`,n.textContent=e,n.style.display="block")}document.addEventListener("DOMContentLoaded",ui);
