var Gt=Object.defineProperty,Ft=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Ge=t=>{throw TypeError(t)},Fe=Math.pow,Re=(t,e,r)=>e in t?Gt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,D=(t,e)=>{for(var r in e||(e={}))_e.call(e,r)&&Re(t,r,e[r]);if(we)for(var r of we(e))Ve.call(e,r)&&Re(t,r,e[r]);return t},j=(t,e)=>Ft(t,qt(e));var Pe=(t,e)=>{var r={};for(var n in t)_e.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&we)for(var n of we(t))e.indexOf(n)<0&&Ve.call(t,n)&&(r[n]=t[n]);return r};var A=(t,e,r)=>Re(t,typeof e!="symbol"?e+"":e,r),qe=(t,e,r)=>e.has(t)||Ge("Cannot "+r);var K=(t,e,r)=>(qe(t,e,"read from private field"),r?r.call(t):e.get(t)),de=(t,e,r)=>e.has(t)?Ge("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),fe=(t,e,r,n)=>(qe(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var w=(t,e,r)=>new Promise((n,o)=>{var i=c=>{try{a(r.next(c))}catch(l){o(l)}},s=c=>{try{a(r.throw(c))}catch(l){o(l)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(i,s);a((r=r.apply(t,e)).next())});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const Xt="modulepreload",Yt=function(t,e){return new URL(t,e).href},Xe={},Ye=function(e,r,n){let o=Promise.resolve();if(r&&r.length>0){const s=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(r.map(l=>{if(l=Yt(l,n),l in Xe)return;Xe[l]=!0;const f=l.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(!!n)for(let g=s.length-1;g>=0;g--){const m=s[g];if(m.href===l&&(!f||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":Xt,f||(u.as="script"),u.crossOrigin="",u.href=l,c&&u.setAttribute("nonce",c),document.head.appendChild(u),f)return new Promise((g,m)=>{u.addEventListener("load",g),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},G=new TextEncoder,ie=new TextDecoder;function ut(...t){const e=t.reduce((o,{length:i})=>o+i,0),r=new Uint8Array(e);let n=0;for(const o of t)r.set(o,n),n+=o.length;return r}function jt(t){if(Uint8Array.prototype.toBase64)return t.toBase64();const e=32768,r=[];for(let n=0;n<t.length;n+=e)r.push(String.fromCharCode.apply(null,t.subarray(n,n+e)));return btoa(r.join(""))}function Je(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(t);const e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function ne(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof t=="string"?t:ie.decode(t),{alphabet:"base64url"});let e=t;e instanceof Uint8Array&&(e=ie.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Je(e)}catch(r){throw new TypeError("The input to be decoded is not correctly encoded.")}}function ye(t){let e=t;return typeof e=="string"&&(e=G.encode(e)),Uint8Array.prototype.toBase64?e.toBase64({alphabet:"base64url",omitPadding:!0}):jt(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}var Ke;let ve=(Ke=class extends Error{constructor(r,n){var o;super(r,n);A(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}},A(Ke,"code","ERR_JOSE_GENERIC"),Ke);var De;let F=(De=class extends ve{constructor(){super(...arguments);A(this,"code","ERR_JOSE_NOT_SUPPORTED")}},A(De,"code","ERR_JOSE_NOT_SUPPORTED"),De);class P extends ve{constructor(){super(...arguments);A(this,"code","ERR_JWS_INVALID")}}A(P,"code","ERR_JWS_INVALID");class yt extends ve{constructor(){super(...arguments);A(this,"code","ERR_JWK_INVALID")}}A(yt,"code","ERR_JWK_INVALID");class mt extends ve{constructor(r="signature verification failed",n){super(r,n);A(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}A(mt,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function Y(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function he(t,e){return t.name===e}function Ie(t){return parseInt(t.name.slice(4),10)}function Zt(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function er(t,e){if(e&&!t.usages.includes(e))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${e}.`)}function tr(t,e,r){switch(e){case"HS256":case"HS384":case"HS512":{if(!he(t.algorithm,"HMAC"))throw Y("HMAC");const n=parseInt(e.slice(2),10);if(Ie(t.algorithm.hash)!==n)throw Y(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!he(t.algorithm,"RSASSA-PKCS1-v1_5"))throw Y("RSASSA-PKCS1-v1_5");const n=parseInt(e.slice(2),10);if(Ie(t.algorithm.hash)!==n)throw Y(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!he(t.algorithm,"RSA-PSS"))throw Y("RSA-PSS");const n=parseInt(e.slice(2),10);if(Ie(t.algorithm.hash)!==n)throw Y(`SHA-${n}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!he(t.algorithm,"Ed25519"))throw Y("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!he(t.algorithm,"ECDSA"))throw Y("ECDSA");const n=Zt(e);if(t.algorithm.namedCurve!==n)throw Y(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}er(t,r)}function pt(t,e,...r){var n;if(r=r.filter(Boolean),r.length>2){const o=r.pop();t+=`one of type ${r.join(", ")}, or ${o}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(n=e.constructor)!=null&&n.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const Ne=(t,...e)=>pt("Key must be ",t,...e);function gt(t,e,...r){return pt(`Key for the ${t} algorithm must be `,e,...r)}function He(t){return(t==null?void 0:t[Symbol.toStringTag])==="CryptoKey"}function ke(t){return(t==null?void 0:t[Symbol.toStringTag])==="KeyObject"}const Le=t=>He(t)||ke(t),wt=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(const n of e){const o=Object.keys(n);if(!r||r.size===0){r=new Set(o);continue}for(const i of o){if(r.has(i))return!1;r.add(i)}}return!0};function rr(t){return typeof t=="object"&&t!==null}const pe=t=>{if(!rr(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},nr=(t,e)=>w(void 0,null,function*(){const r=`SHA-${t.slice(-3)}`;return new Uint8Array(yield crypto.subtle.digest(r,e))}),St=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}},or=t=>{const e=Object.entries({"P-256":[6,8,42,134,72,206,61,3,1,7],"P-384":[6,5,43,129,4,0,34],"P-521":[6,5,43,129,4,0,35]}),r=Math.max(...e.map(([,n])=>n.length));for(let n=0;n<=t.byteLength-r;n++)for(const[o,i]of e)if(n<=t.byteLength-i.length&&t.subarray(n,n+i.length).every((s,a)=>s===i[a]))return o},Et=(t,e,r,n)=>w(void 0,null,function*(){let o,i;const s=t==="spki",a=()=>s?["verify"]:["sign"],c=()=>s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];switch(r){case"PS256":case"PS384":case"PS512":o={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=a();break;case"RS256":case"RS384":case"RS512":o={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=a();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=c();break;case"ES256":case"ES384":case"ES512":{o={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[r]},i=a();break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{const l=or(e);o=l?{name:"ECDH",namedCurve:l}:{name:"X25519"},i=s?[]:["deriveBits"];break}case"Ed25519":case"EdDSA":o={name:"Ed25519"},i=a();break;default:throw new F('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(t,e,o,!!s,i)}),ir=(t,e,r)=>{const n=Je(t.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""));return Et("pkcs8",n,e)},sr=(t,e,r)=>{const n=Je(t.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,""));return Et("spki",n,e)};function ar(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new F('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new F('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"Ed25519":case"EdDSA":e={name:"Ed25519"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new F('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new F('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}const bt=t=>w(void 0,null,function*(){var o,i;if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:r}=ar(t),n=D({},t);return delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,e,(o=t.ext)!=null?o:!t.d,(i=t.key_ops)!=null?i:r)});function je(t,e,r){return w(this,null,function*(){if(typeof t!="string"||t.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return sr(t,e)})}function cr(t,e,r){return w(this,null,function*(){if(typeof t!="string"||t.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return ir(t,e)})}function lr(t,e,r){return w(this,null,function*(){if(!pe(t))throw new TypeError("JWK must be an object");let n;switch(e!=null||(e=t.alg),n!=null||(n=t.ext),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return ne(t.k);case"RSA":if("oth"in t&&t.oth!==void 0)throw new F('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return bt(j(D({},t),{alg:e,ext:n}));default:throw new F('Unsupported "kty" (Key Type) Parameter value')}})}const vt=(t,e,r,n,o)=>{if(o.crit!==void 0&&(n==null?void 0:n.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(s=>typeof s!="string"||s.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...e.entries()]):i=e;for(const s of n.crit){if(!i.has(s))throw new F(`Extension Header Parameter "${s}" is not recognized`);if(o[s]===void 0)throw new t(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&n[s]===void 0)throw new t(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(n.crit)};function xe(t){return pe(t)&&typeof t.kty=="string"}function dr(t){return t.kty!=="oct"&&typeof t.d=="string"}function fr(t){return t.kty!=="oct"&&typeof t.d=="undefined"}function hr(t){return t.kty==="oct"&&typeof t.k=="string"}let ae;const Ze=(t,e,r,n=!1)=>w(void 0,null,function*(){ae||(ae=new WeakMap);let o=ae.get(t);if(o!=null&&o[r])return o[r];const i=yield bt(j(D({},e),{alg:r}));return n&&Object.freeze(t),o?o[r]=i:ae.set(t,{[r]:i}),i}),ur=(t,e)=>{var s;ae||(ae=new WeakMap);let r=ae.get(t);if(r!=null&&r[e])return r[e];const n=t.type==="public",o=!!n;let i;if(t.asymmetricKeyType==="x25519"){switch(e){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=t.toCryptoKey(t.asymmetricKeyType,o,n?[]:["deriveBits"])}if(t.asymmetricKeyType==="ed25519"){if(e!=="EdDSA"&&e!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=t.toCryptoKey(t.asymmetricKeyType,o,[n?"verify":"sign"])}if(t.asymmetricKeyType==="rsa"){let a;switch(e){case"RSA-OAEP":a="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":a="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":a="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":a="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(e.startsWith("RSA-OAEP"))return t.toCryptoKey({name:"RSA-OAEP",hash:a},o,n?["encrypt"]:["decrypt"]);i=t.toCryptoKey({name:e.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:a},o,[n?"verify":"sign"])}if(t.asymmetricKeyType==="ec"){const c=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((s=t.asymmetricKeyDetails)==null?void 0:s.namedCurve);if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");e==="ES256"&&c==="P-256"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[n?"verify":"sign"])),e==="ES384"&&c==="P-384"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[n?"verify":"sign"])),e==="ES512"&&c==="P-521"&&(i=t.toCryptoKey({name:"ECDSA",namedCurve:c},o,[n?"verify":"sign"])),e.startsWith("ECDH-ES")&&(i=t.toCryptoKey({name:"ECDH",namedCurve:c},o,n?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[e]=i:ae.set(t,{[e]:i}),i},xt=(t,e)=>w(void 0,null,function*(){if(t instanceof Uint8Array||He(t))return t;if(ke(t)){if(t.type==="secret")return t.export();if("toCryptoKey"in t&&typeof t.toCryptoKey=="function")try{return ur(t,e)}catch(n){if(n instanceof TypeError)throw n}let r=t.export({format:"jwk"});return Ze(t,r,e)}if(xe(t))return t.k?ne(t.k):Ze(t,t,e,!0);throw new Error("unreachable")}),se=t=>t==null?void 0:t[Symbol.toStringTag],Oe=(t,e,r)=>{var n,o;if(e.use!==void 0){let i;switch(r){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc";break}if(e.use!==i)throw new TypeError(`Invalid key for this operation, its "use" must be "${i}" when present`)}if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, its "alg" must be "${t}" when present`);if(Array.isArray(e.key_ops)){let i;switch(!0){case(r==="sign"||r==="verify"):case t==="dir":case t.includes("CBC-HS"):i=r;break;case t.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(t):!t.includes("GCM")&&t.endsWith("KW")?i=r==="encrypt"?"wrapKey":"unwrapKey":i=r;break;case(r==="encrypt"&&t.startsWith("RSA")):i="wrapKey";break;case r==="decrypt":i=t.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(i&&((o=(n=e.key_ops)==null?void 0:n.includes)==null?void 0:o.call(n,i))===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${i}" when present`)}return!0},yr=(t,e,r)=>{if(!(e instanceof Uint8Array)){if(xe(e)){if(hr(e)&&Oe(t,e,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Le(e))throw new TypeError(gt(t,e,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(e.type!=="secret")throw new TypeError(`${se(e)} instances for symmetric algorithms must be of type "secret"`)}},mr=(t,e,r)=>{if(xe(e))switch(r){case"decrypt":case"sign":if(dr(e)&&Oe(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(fr(e)&&Oe(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Le(e))throw new TypeError(gt(t,e,"CryptoKey","KeyObject","JSON Web Key"));if(e.type==="secret")throw new TypeError(`${se(e)} instances for asymmetric algorithms must not be of type "secret"`);if(e.type==="public")switch(r){case"sign":throw new TypeError(`${se(e)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${se(e)} instances for asymmetric algorithm decryption must be of type "private"`)}if(e.type==="private")switch(r){case"verify":throw new TypeError(`${se(e)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${se(e)} instances for asymmetric algorithm encryption must be of type "public"`)}},At=(t,e,r)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(t)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(t)?yr(t,e,r):mr(t,e,r)};function pr(t){return w(this,null,function*(){if(ke(t))if(t.type==="secret")t=t.export();else return t.export({format:"jwk"});if(t instanceof Uint8Array)return{kty:"oct",k:ye(t)};if(!He(t))throw new TypeError(Ne(t,"CryptoKey","KeyObject","Uint8Array"));if(!t.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const s=yield crypto.subtle.exportKey("jwk",t),{ext:e,key_ops:r,alg:n,use:o}=s;return Pe(s,["ext","key_ops","alg","use"])})}function Ct(t){return w(this,null,function*(){return pr(t)})}const Rt=(t,e)=>{const r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(t.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};default:throw new F(`alg ${t} is not supported either by JOSE or your javascript runtime`)}},Pt=(t,e,r)=>w(void 0,null,function*(){if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Ne(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}return tr(e,t,r),e}),gr=(t,e,r,n)=>w(void 0,null,function*(){const o=yield Pt(t,e,"verify");St(t,o);const i=Rt(t,o.algorithm);try{return yield crypto.subtle.verify(i,o,r,n)}catch(s){return!1}});function wr(t,e,r){return w(this,null,function*(){var m;if(!pe(t))throw new P("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new P('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new P("JWS Protected Header incorrect type");if(t.payload===void 0)throw new P("JWS Payload missing");if(typeof t.signature!="string")throw new P("JWS Signature missing or incorrect type");if(t.header!==void 0&&!pe(t.header))throw new P("JWS Unprotected Header incorrect type");let n={};if(t.protected)try{const S=ne(t.protected);n=JSON.parse(ie.decode(S))}catch(S){throw new P("JWS Protected Header is invalid")}if(!wt(n,t.header))throw new P("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o=D(D({},n),t.header),i=vt(P,new Map([["b64",!0]]),r==null?void 0:r.crit,n,o);let s=!0;if(i.has("b64")&&(s=n.b64,typeof s!="boolean"))throw new P('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=o;if(typeof a!="string"||!a)throw new P('JWS "alg" (Algorithm) Header Parameter missing or invalid');if(s){if(typeof t.payload!="string")throw new P("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new P("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=yield e(n,t),c=!0),At(a,e,"verify");const l=ut(G.encode((m=t.protected)!=null?m:""),G.encode("."),typeof t.payload=="string"?G.encode(t.payload):t.payload);let f;try{f=ne(t.signature)}catch(S){throw new P("Failed to base64url decode the signature")}const d=yield xt(e,a);if(!(yield gr(a,d,f,l)))throw new mt;let u;if(s)try{u=ne(t.payload)}catch(S){throw new P("Failed to base64url decode the payload")}else typeof t.payload=="string"?u=G.encode(t.payload):u=t.payload;const g={payload:u};return t.protected!==void 0&&(g.protectedHeader=n),t.header!==void 0&&(g.unprotectedHeader=t.header),c?j(D({},g),{key:d}):g})}function Sr(t,e,r){return w(this,null,function*(){if(t instanceof Uint8Array&&(t=ie.decode(t)),typeof t!="string")throw new P("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:i,length:s}=t.split(".");if(s!==3)throw new P("Invalid Compact JWS");const a=yield wr({payload:o,protected:n,signature:i},e,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?j(D({},c),{key:a.key}):c})}const Er=(t,e,r)=>w(void 0,null,function*(){const n=yield Pt(t,e,"sign");St(t,n);const o=yield crypto.subtle.sign(Rt(t,n.algorithm),n,r);return new Uint8Array(o)});var ge,L,V;class br{constructor(e){de(this,ge);de(this,L);de(this,V);if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");fe(this,ge,e)}setProtectedHeader(e){if(K(this,L))throw new TypeError("setProtectedHeader can only be called once");return fe(this,L,e),this}setUnprotectedHeader(e){if(K(this,V))throw new TypeError("setUnprotectedHeader can only be called once");return fe(this,V,e),this}sign(e,r){return w(this,null,function*(){if(!K(this,L)&&!K(this,V))throw new P("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!wt(K(this,L),K(this,V)))throw new P("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n=D(D({},K(this,L)),K(this,V)),o=vt(P,new Map([["b64",!0]]),r==null?void 0:r.crit,K(this,L),n);let i=!0;if(o.has("b64")&&(i=K(this,L).b64,typeof i!="boolean"))throw new P('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=n;if(typeof s!="string"||!s)throw new P('JWS "alg" (Algorithm) Header Parameter missing or invalid');At(s,e,"sign");let a=K(this,ge);i&&(a=G.encode(ye(a)));let c;K(this,L)?c=G.encode(ye(JSON.stringify(K(this,L)))):c=G.encode("");const l=ut(c,G.encode("."),a),f=yield xt(e,s),d=yield Er(s,f,l),h={signature:ye(d),payload:""};return i&&(h.payload=ie.decode(a)),K(this,V)&&(h.header=K(this,V)),K(this,L)&&(h.protected=ie.decode(c)),h})}}ge=new WeakMap,L=new WeakMap,V=new WeakMap;var le;class vr{constructor(e){de(this,le);fe(this,le,new br(e))}setProtectedHeader(e){return K(this,le).setProtectedHeader(e),this}sign(e,r){return w(this,null,function*(){const n=yield K(this,le).sign(e,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`})}}le=new WeakMap;const Z=(t,e)=>{if(typeof t!="string"||!t)throw new yt(`${e} missing or invalid`)};function xr(t,e){return w(this,null,function*(){let r;if(xe(t))r=t;else if(Le(t))r=yield Ct(t);else throw new TypeError(Ne(t,"CryptoKey","KeyObject","JSON Web Key"));if(e!=null||(e="sha256"),e!=="sha256"&&e!=="sha384"&&e!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let n;switch(r.kty){case"EC":Z(r.crv,'"crv" (Curve) Parameter'),Z(r.x,'"x" (X Coordinate) Parameter'),Z(r.y,'"y" (Y Coordinate) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":Z(r.crv,'"crv" (Subtype of Key Pair) Parameter'),Z(r.x,'"x" (Public Key) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":Z(r.e,'"e" (Exponent) Parameter'),Z(r.n,'"n" (Modulus) Parameter'),n={e:r.e,kty:r.kty,n:r.n};break;case"oct":Z(r.k,'"k" (Key Value) Parameter'),n={k:r.k,kty:r.kty};break;default:throw new F('"kty" (Key Type) Parameter missing or unsupported')}const o=G.encode(JSON.stringify(n));return ye(yield nr(e,o))})}function Ar(t){let e;if(typeof t=="string"){const r=t.split(".");(r.length===3||r.length===5)&&([e]=r)}else if(typeof t=="object"&&t)if("protected"in t)e=t.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof e!="string"||!e)throw new Error;const r=JSON.parse(ie.decode(ne(e)));if(!pe(r))throw new Error;return r}catch(r){throw new TypeError("Invalid Token or Protected Header formatting")}}const Cr={L:1195,M:927,Q:670,H:519};class q extends Error{constructor(r,n){super(r);A(this,"code");this.code=n,this.name="SmartHealthCardError"}}class B extends q{constructor(e){super(e,"FHIR_VALIDATION_ERROR"),this.name="FhirValidationError"}}class M extends q{constructor(e){super(e,"JWS_ERROR"),this.name="JWSError"}}class W extends q{constructor(e){super(e,"QR_CODE_ERROR"),this.name="QRCodeError"}}class Rr extends q{constructor(e){super(e,"INVALID_BUNDLE_REFERENCE_ERROR"),this.name="InvalidBundleReferenceError"}}class Be extends q{constructor(e){super(e,"FILE_FORMAT_ERROR"),this.name="FileFormatError"}}class te extends q{constructor(e){super(e,"VERIFICATION_ERROR"),this.name="VerificationError"}}class It{constructor(e,r){A(this,"jws");A(this,"originalBundle");this.jws=e,this.originalBundle=r}asJWS(){return this.jws}getOriginalBundle(){return this.originalBundle}asQR(){return w(this,arguments,function*(e={}){return yield new $e(e).generateQR(this.jws)})}asQRNumeric(e={}){return new $e(e).chunkJWS(this.jws)}asBundle(){return w(this,arguments,function*(e={}){const{optimizeForQR:r=!1,strictReferences:n=!0}=e;return r?new Bt().processForQR(this.originalBundle,{strictReferences:n}):this.originalBundle})}asFileContent(){return w(this,null,function*(){const e={verifiableCredential:[this.jws]};return JSON.stringify(e)})}asFileBlob(){return w(this,null,function*(){const e=yield this.asFileContent();return new Blob([e],{type:"application/smart-health-card"})})}}class Pr{constructor(e){A(this,"config");A(this,"fhirProcessor");A(this,"vcProcessor");A(this,"jwsProcessor");var r,n,o;this.config=j(D({},e),{expirationTime:(r=e.expirationTime)!=null?r:null,enableQROptimization:(n=e.enableQROptimization)!=null?n:!0,strictReferences:(o=e.strictReferences)!=null?o:!0}),this.fhirProcessor=new Bt,this.vcProcessor=new Tt,this.jwsProcessor=new Kt}issue(n){return w(this,arguments,function*(e,r={}){const o=yield this.createJWS(e,r);return new It(o,e)})}createJWS(n){return w(this,arguments,function*(e,r={}){const o=this.config.enableQROptimization?this.fhirProcessor.processForQR(e,{strictReferences:this.config.strictReferences}):this.fhirProcessor.process(e);this.fhirProcessor.validate(o);const i=this.vcProcessor.create(o,r);this.vcProcessor.validate(i);const s=Math.floor(Date.now()/1e3),a={iss:this.config.issuer,nbf:s,vc:i.vc};return this.config.expirationTime&&(a.exp=s+this.config.expirationTime),yield this.jwsProcessor.sign(a,this.config.privateKey,this.config.publicKey,{enableCompression:!0})})}}class Ir{constructor(e){A(this,"config");A(this,"vcProcessor");A(this,"jwsProcessor");var r,n,o;this.config=j(D({},e),{enableQROptimization:(r=e.enableQROptimization)!=null?r:!0,strictReferences:(n=e.strictReferences)!=null?n:!0,verifyExpiration:(o=e.verifyExpiration)!=null?o:!0}),this.vcProcessor=new Tt,this.jwsProcessor=new Kt}fromFileContent(e){return w(this,null,function*(){let r;e instanceof Blob?r=yield e.text():r=e;const n=r;let o;try{const i=JSON.parse(n);if(i.verifiableCredential&&Array.isArray(i.verifiableCredential)){if(i.verifiableCredential.length===0)throw new Be("File contains empty verifiableCredential array");o=i.verifiableCredential[0]}else throw new Be("File does not contain expected verifiableCredential array")}catch(i){if(i instanceof q)throw i;const s=i instanceof Error?i.message:String(i);throw new Be(`Invalid file format - expected JSON with verifiableCredential array: ${s}`)}return yield this.fromJWS(o)})}fromJWS(e){return w(this,null,function*(){try{let r=this.config.publicKey;r||(r=yield this.resolvePublicKeyFromJWKS(e));const o={vc:(yield this.jwsProcessor.verify(e,r,{verifyExpiration:this.config.verifyExpiration})).vc};this.vcProcessor.validate(o);const i=o.vc.credentialSubject.fhirBundle;return new It(e,i)}catch(r){if(r instanceof q)throw r;const n=r instanceof Error?r.message:String(r);throw new te(`Failed to verify SMART Health Card: ${n}`)}})}resolvePublicKeyFromJWKS(e){return w(this,null,function*(){try{const{header:r,payload:n}=yield this.jwsProcessor.parseUnverified(e);if(!n.iss||typeof n.iss!="string")throw new te("Cannot resolve JWKS: missing 'iss' in payload");if(!r.kid||typeof r.kid!="string")throw new te("Cannot resolve JWKS: missing 'kid' in JWS header");const i=`${new URL(n.iss).origin}/.well-known/jwks.json`,s=yield fetch(i);if(!s.ok)throw new te(`Failed to fetch JWKS from issuer (${i}): ${s.status} ${s.statusText}`);const a=yield s.json();if(!a||!Array.isArray(a.keys))throw new te("Invalid JWKS format: missing keys array");const c=a.keys.find(f=>f.kid===r.kid);if(!c)throw new te(`No matching key found in JWKS for kid '${r.kid}'`);return yield lr(c,"ES256")}catch(r){if(r instanceof q)throw r;const n=r instanceof Error?r.message:String(r);throw new te(`Unable to resolve public key via JWKS: ${n}`)}})}fromQRNumeric(e){return w(this,null,function*(){try{const r=new $e,n=Array.isArray(e)?e:[e],o=yield r.decodeQR(n);return yield this.fromJWS(o)}catch(r){if(r instanceof q)throw r;const n=r instanceof Error?r.message:String(r);throw new W(`Failed to read SMART Health Card from QR numeric data: ${n}`)}})}}class Bt{process(e){if(!e||e.resourceType!=="Bundle")throw new B("Invalid bundle: must be a FHIR Bundle resource");const r=JSON.parse(JSON.stringify(e));return r.type||(r.type="collection"),r}processForQR(e,r={}){var o;const n=this.process(e);return this.optimizeForQR(n,(o=r.strictReferences)!=null?o:!0)}optimizeForQR(e,r){const n=JSON.parse(JSON.stringify(e));delete n.id;const o=new Map;return n.entry&&(n.entry.forEach((i,s)=>{i.fullUrl&&(o.set(i.fullUrl.split("/").slice(-2).join("/"),`resource:${s}`),i.fullUrl=`resource:${s}`)}),n.entry.forEach(i=>{i.resource&&(i.resource=this.optimizeResource(i.resource,o,r))})),n}optimizeResource(e,r,n){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(i=>this.optimizeResource(i,r,n)).filter(i=>i!=null);const o={};for(const[i,s]of Object.entries(e))if(!(s==null||Array.isArray(s)&&s.length===0)&&i!=="id"){if(i==="meta"){if(typeof s=="object"&&s!==null){const a=s;a.security&&Array.isArray(a.security)&&(o[i]={security:a.security})}continue}if(!(i==="text"&&this.isCodeableConcept(e)||i==="text"&&this.isDomainResource(e))&&!(i==="display"&&typeof s=="string"&&this.isWithinCoding(e))){if(i==="reference"&&typeof s=="string"){const a=r.get(s);if(a)o[i]=a;else{if(n)throw new Rr(`Reference "${s}" not found in bundle resources`);o[i]=s}continue}o[i]=this.optimizeResource(s,r,n)}}return o}isDomainResource(e){return e!=null&&e.text!=null&&typeof e.text=="object"&&"div"in e.text}isCodeableConcept(e){return e!=null&&typeof e=="object"&&"coding"in e&&Array.isArray(e.coding)}isWithinCoding(e){return e!==null&&typeof e=="object"&&"system"in e&&"code"in e&&typeof e.system=="string"&&typeof e.code=="string"}validate(e){try{if(!e)throw new B("Bundle cannot be null or undefined");if(e.resourceType!=="Bundle")throw new B("Resource must be of type Bundle");if(e.type&&!new Set(["document","message","transaction","transaction-response","batch","batch-response","history","searchset","collection"]).has(e.type))throw new B(`Invalid bundle.type: ${e.type}`);if(e.entry){if(!Array.isArray(e.entry))throw new B("Bundle.entry must be an array");for(const[r,n]of e.entry.entries()){if(!n.resource)throw new B(`Bundle.entry[${r}] must contain a resource`);if(!n.resource.resourceType)throw new B(`Bundle.entry[${r}].resource must have a resourceType`)}}return!0}catch(r){if(r instanceof B)throw r;const n=r instanceof Error?r.message:String(r);throw new B(`Bundle validation failed: ${n}`)}}}class Tt{create(e,r={}){if(!e||e.resourceType!=="Bundle")throw new B("Invalid FHIR Bundle provided");const n=r.fhirVersion||"4.0.1";return{vc:{type:this.createStandardTypes(r.includeAdditionalTypes),credentialSubject:{fhirVersion:n,fhirBundle:e}}}}validate(e){try{if(!e||!e.vc)throw new B("Invalid VC: missing vc property");return this.validateTypes(e.vc.type),this.validateCredentialSubject(e.vc.credentialSubject),!0}catch(r){if(r instanceof B)throw r;const n=r instanceof Error?r.message:String(r);throw new B(`VC validation failed: ${n}`)}}createStandardTypes(e){const r=["https://smarthealth.cards#health-card"];return e&&e.length>0?[...r,...e]:r}validateTypes(e){if(!Array.isArray(e))throw new B("VC type must be an array");if(e.length<1)throw new B("VC type must contain at least 1 element");if(!e.includes("https://smarthealth.cards#health-card"))throw new B("VC type must include https://smarthealth.cards#health-card")}validateCredentialSubject(e){if(!e)throw new B("VC credentialSubject is required");if(!e.fhirVersion)throw new B("VC credentialSubject must include fhirVersion");if(!/^\d+\.\d+\.\d+$/.test(e.fhirVersion))throw new B("VC fhirVersion must be in semantic version format (e.g., 4.0.1)");if(!e.fhirBundle)throw new B("VC credentialSubject must include fhirBundle");if(e.fhirBundle.resourceType!=="Bundle")throw new B("VC fhirBundle must be a valid FHIR Bundle")}}class Kt{deflateRaw(e){return w(this,null,function*(){const n=new ReadableStream({start(i){i.enqueue(e),i.close()}}).pipeThrough(new CompressionStream("deflate-raw")),o=yield new Response(n).arrayBuffer();return new Uint8Array(o)})}inflateRaw(e){return w(this,null,function*(){const n=new ReadableStream({start(i){i.enqueue(e),i.close()}}).pipeThrough(new DecompressionStream("deflate-raw")),o=yield new Response(n).arrayBuffer();return new Uint8Array(o)})}sign(i,s,a){return w(this,arguments,function*(e,r,n,o={}){var c;try{this.validateJWTPayload(e);const f={alg:"ES256",kid:yield this.deriveKidFromPublicKey(n)},d=JSON.stringify(e);let u=new TextEncoder().encode(d);((c=o.enableCompression)!=null?c:!0)&&(u=yield this.deflateRaw(u),f.zip="DEF");let m;return typeof r=="string"?m=yield cr(r,"ES256"):m=r,yield new vr(u).setProtectedHeader(f).sign(m)}catch(l){if(l instanceof M)throw l;const f=l instanceof Error?l.message:String(l);throw new M(`JWS signing failed: ${f}`)}})}deriveKidFromPublicKey(e){return w(this,null,function*(){let r;typeof e=="string"?r=yield je(e,"ES256"):r=e;const n=yield Ct(r);return yield xr(n)})}verify(e,r,n){return w(this,null,function*(){var o;try{if(!e||typeof e!="string")throw new M("Invalid JWS: must be a non-empty string");let i;typeof r=="string"?i=yield je(r,"ES256"):i=r;const{payload:s,protectedHeader:a}=yield Sr(e,i);let c=s;a.zip==="DEF"&&(c=yield this.inflateRaw(s));const l=new TextDecoder().decode(c),f=JSON.parse(l);if(this.validateJWTPayload(f),(o=n==null?void 0:n.verifyExpiration)!=null?o:!0){const h=Math.floor(Date.now()/1e3);if(typeof f.exp=="number"&&f.exp<h)throw new M("SMART Health Card has expired")}return f}catch(i){if(i instanceof M)throw i;const s=i instanceof Error?i.message:String(i);throw new M(`JWS verification failed: ${s}`)}})}validateJWTPayload(e){if(!e||typeof e!="object")throw new M("Invalid JWT payload: must be an object");if(!e.iss||typeof e.iss!="string")throw new M("Invalid JWT payload: 'iss' (issuer) is required and must be a string");if(!e.nbf||typeof e.nbf!="number")throw new M("Invalid JWT payload: 'nbf' (not before) is required and must be a number");if(e.exp!==void 0&&typeof e.exp!="number")throw new M("Invalid JWT payload: 'exp' (expiration) must be a number if provided");if(e.exp&&e.exp<=e.nbf)throw new M("Invalid JWT payload: 'exp' must be greater than 'nbf'");if(!e.vc||typeof e.vc!="object")throw new M("Invalid JWT payload: 'vc' (verifiable credential) is required and must be an object")}parseUnverified(e){return w(this,null,function*(){try{if(!e||typeof e!="string")throw new M("Invalid JWS: must be a non-empty string");const r=e.split(".");if(r.length!==3)throw new M("Invalid Compact JWS");const n=Ar(e),o=r[1],i=ne(o),s=n.zip==="DEF"?yield this.inflateRaw(i):i,a=new TextDecoder().decode(s),c=JSON.parse(a);return{header:n,payload:c}}catch(r){if(r instanceof M)throw r;const n=r instanceof Error?r.message:String(r);throw new M(`Failed to parse JWS: ${n}`)}})}}class $e{constructor(e={}){A(this,"config");var o,i;const r=this.buildEncodeOptions(e.encodeOptions),n=(o=e.maxSingleQRSize)!=null?o:this.deriveMaxSingleQRSize(r.errorCorrectionLevel);this.config={maxSingleQRSize:n,enableChunking:(i=e.enableChunking)!=null?i:!1,encodeOptions:r}}deriveMaxSingleQRSize(e){return Cr[e]}buildEncodeOptions(e={}){var n,o,i,s;const r={errorCorrectionLevel:"L",scale:4,margin:1,color:{dark:"#000000ff",light:"#ffffffff"}};return D({errorCorrectionLevel:(n=e.errorCorrectionLevel)!=null?n:r.errorCorrectionLevel,scale:(o=e.scale)!=null?o:r.scale,margin:(i=e.margin)!=null?i:r.margin,color:(s=e.color)!=null?s:r.color},e)}generateQR(e){return w(this,null,function*(){const r=e.length>this.config.maxSingleQRSize;if(!this.config.enableChunking&&r)throw new W(`Chunking is not enabled, but JWS length exceeds maxSingleQRSize:
        ${e.length} > ${this.config.maxSingleQRSize}. Use enableChunking: true to enable chunking.`);if(r)return yield this.generateChunkedQR(e);{const n=this.encodeJWSToNumeric(e);return yield this.generateSingleQR(n)}})}decodeQR(e){return w(this,null,function*(){if(!e||e.length===0)throw new W("No QR code data provided");if(e.length===1){const r=e[0];if(!r)throw new W("QR code data is undefined");return this.decodeSingleQR(r)}return this.decodeChunkedQR(e)})}encodeJWSToNumeric(e){return e.split("").map(n=>{const i=n.charCodeAt(0)-45;if(i<0||i>77)throw new W(`Invalid character '${n}' in JWS. Expected base64url characters only.`);return i.toString().padStart(2,"0")}).join("")}generateSingleQR(e){return w(this,null,function*(){const r=yield Ye(()=>import("./browser-CKYXhPt6.js").then(i=>i.b),[],import.meta.url),n=[{data:new TextEncoder().encode("shc:/"),mode:"byte"},{data:e,mode:"numeric"}];return[yield r.toDataURL(n,this.config.encodeOptions)]})}chunkJWS(e){if(!e||typeof e!="string")throw new W("Invalid JWS: must be a non-empty string");const r=this.config.maxSingleQRSize;if(e.length<=r)return[`shc:/${this.encodeJWSToNumeric(e)}`];const n=Math.ceil(e.length/r),o=Math.ceil(e.length/n),i=[];for(let s=0,a=1;s<e.length;s+=o,a++){const c=e.substring(s,s+o),l=this.encodeJWSToNumeric(c);i.push(`shc:/${a}/${n}/${l}`)}return i}generateChunkedQR(e){return w(this,null,function*(){const r=yield Ye(()=>import("./browser-CKYXhPt6.js").then(s=>s.b),[],import.meta.url),n=this.chunkJWS(e),o=n.length,i=[];for(let s=0;s<n.length;s++){const a=s+1,l=n[s].split("/").pop(),f=`shc:/${a}/${o}/`,d=[{data:new TextEncoder().encode(f),mode:"byte"},{data:l,mode:"numeric"}],h=yield r.toDataURL(d,this.config.encodeOptions);i.push(h)}return i})}decodeSingleQR(e){const r="shc:/";if(!e.startsWith(r))throw new W(`Invalid QR code format. Expected '${r}' prefix.`);const n=e.substring(r.length);return this.decodeNumericToJWS(n)}decodeChunkedQR(e){const r=[];let n=0;for(const i of e){const s="shc:/";if(!i.startsWith(s))throw new W(`Invalid chunked QR code format. Expected '${s}' prefix.`);const c=i.substring(s.length).split("/");if(c.length!==3)throw new W("Invalid chunked QR code format. Expected format: shc:/INDEX/TOTAL/DATA");const l=c[0],f=c[1],d=c[2];if(!l||!f||!d)throw new W("Invalid chunked QR code format: missing parts");const h=parseInt(l),u=parseInt(f);if(Number.isNaN(h)||Number.isNaN(u)||h<1||h>u)throw new W("Invalid chunk index or total in QR code");if(n===0)n=u;else if(n!==u)throw new W("Inconsistent total chunk count across QR codes");r.push({index:h,data:d})}if(r.length!==n)throw new W(`Missing chunks. Expected ${n}, got ${r.length}`);r.sort((i,s)=>i.index-s.index);const o=r.map(i=>i.data).join("");return this.decodeNumericToJWS(o)}decodeNumericToJWS(e){if(e.length%2!==0)throw new W("Invalid numeric data: must have even length");const r=45,n=e.match(/(\d\d)/g);if(!n)throw new W("Invalid numeric data: cannot parse digit pairs");for(const o of n){const i=parseInt(o);if(i>77)throw new W(`Invalid digit pair '${o}': value ${i} exceeds maximum 77`)}return n.map(o=>{const s=parseInt(o)+r;return String.fromCharCode(s)}).join("")}}/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/const ue={newline:10,reset:27};function Br(t){if(!Number.isSafeInteger(t))throw new Error(`integer expected: ${t}`)}function Tr(t){if(!Number.isSafeInteger(t)||t<1||t>40)throw new Error(`Invalid version=${t}. Expected number [1..40]`)}function Kr(t,e){return t.toString(2).padStart(e,"0")}function et(t,e){const r=t%e;return r>=0?r:e+r}function H(t,e){return new Array(t).fill(e)}function tt(...t){let e=0;for(const n of t)e=Math.max(e,n.length);const r=[];for(let n=0;n<e;n++)for(const o of t)n>=o.length||r.push(o[n]);return new Uint8Array(r)}function Dr(){let t,e=1/0;return{add(r,n){r>=e||(t=n,e=r)},get:()=>t,score:()=>e}}function rt(t){return{has:e=>t.includes(e),decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const n=t.indexOf(r);if(n===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${t}`);return n})},encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(r=>{if(Br(r),r<0||r>=t.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${t.length})`);return t[r]})}}}class N{constructor(e,r){A(this,"data");A(this,"height");A(this,"width");const{height:n,width:o}=N.size(e);this.data=r||Array.from({length:n},()=>H(o,void 0)),this.height=n,this.width=o}static size(e,r){if(typeof e=="number"&&(e={height:e,width:e}),!Number.isSafeInteger(e.height)&&e.height!==1/0)throw new Error(`Bitmap: invalid height=${e.height} (${typeof e.height})`);if(!Number.isSafeInteger(e.width)&&e.width!==1/0)throw new Error(`Bitmap: invalid width=${e.width} (${typeof e.width})`);return r!==void 0&&(e={width:Math.min(e.width,r.width),height:Math.min(e.height,r.height)}),e}static fromString(e){e=e.replace(/^\n+/g,"").replace(/\n+$/g,"");const r=e.split(String.fromCharCode(ue.newline)),n=r.length,o=new Array(n);let i;for(const s of r){const a=s.split("").map(c=>{if(c==="X")return!0;if(c===" ")return!1;if(c!=="?")throw new Error(`Bitmap.fromString: unknown symbol=${c}`)});if(i&&a.length!==i)throw new Error(`Bitmap.fromString different row sizes: width=${i} cur=${a.length}`);i=a.length,o.push(a)}return i||(i=0),new N({height:n,width:i},o)}point(e){return this.data[e.y][e.x]}isInside(e){return 0<=e.x&&e.x<this.width&&0<=e.y&&e.y<this.height}size(e){if(!e)return{height:this.height,width:this.width};const{x:r,y:n}=this.xy(e);return{height:this.height-n,width:this.width-r}}xy(e){if(typeof e=="number"&&(e={x:e,y:e}),!Number.isSafeInteger(e.x))throw new Error(`Bitmap: invalid x=${e.x}`);if(!Number.isSafeInteger(e.y))throw new Error(`Bitmap: invalid y=${e.y}`);return e.x=et(e.x,this.width),e.y=et(e.y,this.height),e}rect(e,r,n){const{x:o,y:i}=this.xy(e),{height:s,width:a}=N.size(r,this.size({x:o,y:i}));for(let c=0;c<s;c++)for(let l=0;l<a;l++)this.data[i+c][o+l]=typeof n=="function"?n({x:l,y:c},this.data[i+c][o+l]):n;return this}rectRead(e,r,n){return this.rect(e,r,(o,i)=>(n(o,i),i))}hLine(e,r,n){return this.rect(e,{width:r,height:1},n)}vLine(e,r,n){return this.rect(e,{width:1,height:r},n)}border(e=2,r){const n=this.height+2*e,o=this.width+2*e,i=H(e,r),s=Array.from({length:e},()=>H(o,r));return new N({height:n,width:o},[...s,...this.data.map(a=>[...i,...a,...i]),...s])}embed(e,r){return this.rect(e,r.size(),({x:n,y:o})=>r.data[o][n])}rectSlice(e,r=this.size()){const n=new N(N.size(r,this.size(this.xy(e))));return this.rect(e,r,({x:o,y:i},s)=>n.data[i][o]=s),n}inverse(){const{height:e,width:r}=this;return new N({height:r,width:e}).rect({x:0,y:0},1/0,({x:o,y:i})=>this.data[o][i])}scale(e){if(!Number.isSafeInteger(e)||e>1024)throw new Error(`invalid scale factor: ${e}`);const{height:r,width:n}=this;return new N({height:e*r,width:e*n}).rect({x:0,y:0},1/0,({x:i,y:s})=>this.data[Math.floor(s/e)][Math.floor(i/e)])}clone(){return new N(this.size()).rect({x:0,y:0},this.size(),({x:r,y:n})=>this.data[n][r])}assertDrawn(){this.rectRead(0,1/0,(e,r)=>{if(typeof r!="boolean")throw new Error(`Invalid color type=${typeof r}`)})}toString(){return this.data.map(e=>e.map(r=>r===void 0?"?":r?"X":" ").join("")).join(String.fromCharCode(ue.newline))}toASCII(){const{height:e,width:r,data:n}=this;let o="";for(let i=0;i<e;i+=2){for(let s=0;s<r;s++){const a=n[i][s],c=i+1>=e?!0:n[i+1][s];!a&&!c?o+="█":!a&&c?o+="▀":a&&!c?o+="▄":a&&c&&(o+=" ")}o+=String.fromCharCode(ue.newline)}return o}toTerm(){const e=String.fromCharCode(ue.reset),r=e+"[0m",n=e+"[1;47m  "+r,o=e+"[40m  "+r;return this.data.map(i=>i.map(s=>s?o:n).join("")).join(String.fromCharCode(ue.newline))}toSVG(e=!0){let r=`<svg viewBox="0 0 ${this.width} ${this.height}" xmlns="http://www.w3.org/2000/svg">`,n="",o;return this.rectRead(0,1/0,(i,s)=>{if(!s)return;const{x:a,y:c}=i;if(!e){r+=`<rect x="${a}" y="${c}" width="1" height="1" />`;return}let l=`M${a} ${c}`;if(o){const d=`m${a-o.x} ${c-o.y}`;d.length<=l.length&&(l=d)}const f=a<10?`H${a}`:"h-1";n+=`${l}h1v1${f}Z`,o=i}),e&&(r+=`<path d="${n}"/>`),r+="</svg>",r}toGIF(){const e=a=>[a&255,a>>>8&255],r=[...e(this.width),...e(this.height)],n=[];this.rectRead(0,1/0,(a,c)=>n.push(+(c===!0)));const o=126,i=[71,73,70,56,55,97,...r,246,0,0,255,255,255,...H(3*127,0),44,0,0,0,0,...r,0,7],s=Math.floor(n.length/o);for(let a=0;a<s;a++)i.push(o+1,128,...n.slice(o*a,o*(a+1)).map(c=>+c));return i.push(n.length%o+1,128,...n.slice(s*o).map(a=>+a)),i.push(1,129,0,59),new Uint8Array(i)}toImage(e=!1){const{height:r,width:n}=this.size(),o=new Uint8Array(r*n*(e?3:4));let i=0;for(let s=0;s<r;s++)for(let a=0;a<n;a++){const c=this.data[s][a]?0:255;o[i++]=c,o[i++]=c,o[i++]=c,e||(o[i++]=255)}return{height:r,width:n,data:o}}}const Or=[26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],$r={low:[7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],medium:[10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],quartile:[13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],high:[17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]},Mr={low:[1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],medium:[1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],quartile:[1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],high:[1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]},X={size:{encode:t=>21+4*(t-1),decode:t=>(t-17)/4},sizeType:t=>Math.floor((t+7)/17),alignmentPatterns(t){if(t===1)return[];const e=6,r=X.size.encode(t)-e-1,n=r-e,o=Math.ceil(n/28);let i=Math.floor(n/o);i%2?i+=1:n%o*2>=o&&(i+=2);const s=[e];for(let a=1;a<o;a++)s.push(r-(o-a)*i);return s.push(r),s},ECCode:{low:1,medium:0,quartile:3,high:2},formatMask:21522,formatBits(t,e){const r=X.ECCode[t]<<3|e;let n=r;for(let o=0;o<10;o++)n=n<<1^(n>>9)*1335;return(r<<10|n)^X.formatMask},versionBits(t){let e=t;for(let r=0;r<12;r++)e=e<<1^(e>>11)*7973;return t<<12|e},alphabet:{numeric:rt("0123456789"),alphanumerc:rt("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:")},lengthBits(t,e){return{numeric:[10,12,14],alphanumeric:[9,11,13],byte:[8,16,16],kanji:[8,10,12],eci:[0,0,0]}[e][X.sizeType(t)]},modeBits:{numeric:"0001",alphanumeric:"0010",byte:"0100",kanji:"1000",eci:"0111"},capacity(t,e){const r=Or[t-1],n=$r[e][t-1],o=Mr[e][t-1],i=Math.floor(r/o)-n,s=o-r%o;return{words:n,numBlocks:o,shortBlocks:s,blockLen:i,capacity:(r-n*o)*8,total:(n+i)*o+o-s}}},Wr=[(t,e)=>(t+e)%2==0,(t,e)=>e%2==0,(t,e)=>t%3==0,(t,e)=>(t+e)%3==0,(t,e)=>(Math.floor(e/2)+Math.floor(t/3))%2==0,(t,e)=>t*e%2+t*e%3==0,(t,e)=>(t*e%2+t*e%3)%2==0,(t,e)=>((t+e)%2+t*e%3)%2==0],y={tables:(t=>{const e=H(256,0),r=H(256,0);for(let n=0,o=1;n<256;n++)e[n]=o,r[o]=n,o<<=1,o&256&&(o^=t);return{exp:e,log:r}})(285),exp:t=>y.tables.exp[t],log(t){if(t===0)throw new Error(`GF.log: invalid arg=${t}`);return y.tables.log[t]%255},mul(t,e){return t===0||e===0?0:y.tables.exp[(y.tables.log[t]+y.tables.log[e])%255]},add:(t,e)=>t^e,pow:(t,e)=>y.tables.exp[y.tables.log[t]*e%255],inv(t){if(t===0)throw new Error(`GF.inverse: invalid arg=${t}`);return y.tables.exp[255-y.tables.log[t]]},polynomial(t){if(t.length==0)throw new Error("GF.polymomial: invalid length");if(t[0]!==0)return t;let e=0;for(;e<t.length-1&&t[e]==0;e++);return t.slice(e)},monomial(t,e){if(t<0)throw new Error(`GF.monomial: invalid degree=${t}`);if(e==0)return[0];let r=H(t+1,0);return r[0]=e,y.polynomial(r)},degree:t=>t.length-1,coefficient:(t,e)=>t[y.degree(t)-e],mulPoly(t,e){if(t[0]===0||e[0]===0)return[0];const r=H(t.length+e.length-1,0);for(let n=0;n<t.length;n++)for(let o=0;o<e.length;o++)r[n+o]=y.add(r[n+o],y.mul(t[n],e[o]));return y.polynomial(r)},mulPolyScalar(t,e){if(e==0)return[0];if(e==1)return t;const r=H(t.length,0);for(let n=0;n<t.length;n++)r[n]=y.mul(t[n],e);return y.polynomial(r)},mulPolyMonomial(t,e,r){if(e<0)throw new Error("GF.mulPolyMonomial: invalid degree");if(r==0)return[0];const n=H(t.length+e,0);for(let o=0;o<t.length;o++)n[o]=y.mul(t[o],r);return y.polynomial(n)},addPoly(t,e){if(t[0]===0)return e;if(e[0]===0)return t;let r=t,n=e;r.length>n.length&&([r,n]=[n,r]);let o=H(n.length,0),i=n.length-r.length,s=n.slice(0,i);for(let a=0;a<s.length;a++)o[a]=s[a];for(let a=i;a<n.length;a++)o[a]=y.add(r[a-i],n[a]);return y.polynomial(o)},remainderPoly(t,e){const r=Array.from(t);for(let n=0;n<t.length-e.length+1;n++){const o=r[n];if(o!==0)for(let i=1;i<e.length;i++)e[i]!==0&&(r[n+i]=y.add(r[n+i],y.mul(e[i],o)))}return r.slice(t.length-e.length+1,r.length)},divisorPoly(t){let e=[1];for(let r=0;r<t;r++)e=y.mulPoly(e,[1,y.pow(2,r)]);return e},evalPoly(t,e){if(e==0)return y.coefficient(t,0);let r=t[0];for(let n=1;n<t.length;n++)r=y.add(y.mul(e,r),t[n]);return r},euclidian(t,e,r){y.degree(t)<y.degree(e)&&([t,e]=[e,t]);let n=t,o=e,i=[0],s=[1];for(;2*y.degree(o)>=r;){let l=n,f=i;if(n=o,i=s,n[0]===0)throw new Error("rLast[0] === 0");o=l;let d=[0];const h=y.inv(n[0]);for(;y.degree(o)>=y.degree(n)&&o[0]!==0;){const u=y.degree(o)-y.degree(n),g=y.mul(o[0],h);d=y.addPoly(d,y.monomial(u,g)),o=y.addPoly(o,y.mulPolyMonomial(n,u,g))}if(d=y.mulPoly(d,i),s=y.addPoly(d,f),y.degree(o)>=y.degree(n))throw new Error(`Division failed r: ${o}, rLast: ${n}`)}const a=y.coefficient(s,0);if(a==0)throw new Error("sigmaTilde(0) was zero");const c=y.inv(a);return[y.mulPolyScalar(s,c),y.mulPolyScalar(o,c)]}};function Ur(t){return{encode(e){const r=y.divisorPoly(t),n=Array.from(e);return n.push(...r.slice(0,-1).fill(0)),Uint8Array.from(y.remainderPoly(n,r))},decode(e){const r=e.slice(),n=y.polynomial(Array.from(e));let o=H(t,0),i=!1;for(let d=0;d<t;d++){const h=y.evalPoly(n,y.exp(d));o[o.length-1-d]=h,h!==0&&(i=!0)}if(!i)return r;o=y.polynomial(o);const s=y.monomial(t,1),[a,c]=y.euclidian(s,o,t),l=H(y.degree(a),0);let f=0;for(let d=1;d<256&&f<l.length;d++)y.evalPoly(a,d)===0&&(l[f++]=y.inv(d));if(f!==l.length)throw new Error("RS.decode: invalid errors number");for(let d=0;d<l.length;d++){const h=r.length-1-y.log(l[d]);if(h<0)throw new Error("RS.decode: invalid error location");const u=y.inv(l[d]);let g=1;for(let m=0;m<l.length;m++)d!==m&&(g=y.mul(g,y.add(1,y.mul(l[m],u))));r[h]=y.add(r[h],y.mul(y.evalPoly(c,u),y.inv(g)))}return r}}}function Jr(t,e){const{words:r,shortBlocks:n,numBlocks:o,blockLen:i,total:s}=X.capacity(t,e),a=Ur(r);return{encode(c){const l=[],f=[];for(let g=0;g<o;g++){const m=g<n,S=i+(m?0:1);l.push(c.subarray(0,S)),f.push(a.encode(c.subarray(0,S))),c=c.subarray(S)}const d=tt(...l),h=tt(...f),u=new Uint8Array(d.length+h.length);return u.set(d),u.set(h,d.length),u},decode(c){if(c.length!==s)throw new Error(`interleave.decode: len(data)=${c.length}, total=${s}`);const l=[];for(let h=0;h<o;h++){const u=h<n;l.push(new Uint8Array(r+i+(u?0:1)))}let f=0;for(let h=0;h<i;h++)for(let u=0;u<o;u++)l[u][h]=c[f++];for(let h=n;h<o;h++)l[h][i]=c[f++];for(let h=i;h<i+r;h++)for(let u=0;u<o;u++){const g=u<n;l[u][h+(g?0:1)]=c[f++]}const d=[];for(const h of l)d.push(...Array.from(a.decode(h)).slice(0,-r));return Uint8Array.from(d)}}}function Nr(t,e,r,n=!1){const o=X.size.encode(t);let i=new N(o+2);const s=new N(3).rect(0,3,!0).border(1,!1).border(1,!0).border(1,!1);i=i.embed(0,s).embed({x:-s.width,y:0},s).embed({x:0,y:-s.height},s),i=i.rectSlice(1,o);const a=new N(1).rect(0,1,!0).border(1,!1).border(1,!0),c=X.alignmentPatterns(t);for(const l of c)for(const f of c)i.data[l][f]===void 0&&i.embed({x:f-2,y:l-2},a);i=i.hLine({x:0,y:6},1/0,({x:l},f)=>f===void 0?l%2==0:f).vLine({x:6,y:0},1/0,({y:l},f)=>f===void 0?l%2==0:f);{const l=X.formatBits(e,r),f=d=>!n&&(l>>d&1)==1;for(let d=0;d<6;d++)i.data[d][8]=f(d);for(let d=6;d<8;d++)i.data[d+1][8]=f(d);for(let d=8;d<15;d++)i.data[o-15+d][8]=f(d);for(let d=0;d<8;d++)i.data[8][o-d-1]=f(d);for(let d=8;d<9;d++)i.data[8][15-d-1+1]=f(d);for(let d=9;d<15;d++)i.data[8][15-d-1]=f(d);i.data[o-8][8]=!n}if(t>=7){const l=X.versionBits(t);for(let f=0;f<18;f+=1){const d=!n&&(l>>f&1)==1,h=Math.floor(f/3),u=f%3+o-8-3;i.data[h][u]=d,i.data[u][h]=d}}return i}function Hr(t,e,r){const n=t.height,o=Wr[e];let i=-1,s=n-1;for(let a=n-1;a>0;a-=2){for(a==6&&(a=5);;s+=i){for(let c=0;c<2;c+=1){const l=a-c;t.data[s][l]===void 0&&r(l,s,o(l,s))}if(s+i<0||s+i>=n)break}i=-i}}const kr={best:Dr,bin:Kr,drawTemplate:Nr,fillArr:H,info:X,interleave:Jr,validateVersion:Tr,zigzag:Hr};/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/const{best:Me,bin:Lr,drawTemplate:Qr,fillArr:We,info:z,interleave:zr,validateVersion:Dt,zigzag:_r}=kr,nt=3,Vr=8,Gr=24,Fr=2,qr=1.333,Ot=2,Xr=3,C=t=>t>>>0,be=(t,e)=>{const r=t.x-e.x,n=t.y-e.y;return r*r+n*n},oe=(t,e)=>Math.sqrt(be(t,e)),ce=t=>t.reduce((e,r)=>e+r),ot=(t,e)=>{t.x+=e.x,t.y+=e.y},Yr=t=>({x:-t.x,y:-t.y}),Se=t=>({x:t.y,y:t.x}),it=t=>({x:t.x,y:t.y}),Ee=t=>({x:C(t.x),y:C(t.y)}),jr=(t,e)=>({x:t.x+e.x,y:t.y+e.y});function Q(t,e,r){return Math.max(Math.min(t,r||t),e||t)}const $t=t=>{const e=t.data.length/(t.width*t.height);if(e===3||e===4)return e;throw new Error(`Unknown image format, bytes per pixel=${e}`)};function Zr(t){const e=$t(t),r=new Uint8Array(t.height*t.width);for(let f=0,d=0,h=t.data;f<h.length;f+=e){const u=h[f],g=h[f+1],m=h[f+2];r[d++]=C((u+2*g+m)/4)&255}const n=Vr;if(t.width<n*5||t.height<n*5)throw new Error("image too small");const o=Math.ceil(t.width/n),i=Math.ceil(t.height/n),s=t.height-n,a=t.width-n,c=new Uint8Array(o*i);for(let f=0;f<i;f++){const d=Q(f*n,0,s);for(let h=0;h<o;h++){const u=Q(h*n,0,a);let g=0,m=255,S=0;for(let E=0,v=d*t.width+u;E<n;E=E+1,v=v+t.width)for(let p=0;p<n;p++){const b=r[v+p];g+=b,m=Math.min(m,b),S=Math.max(S,b)}let x=Math.floor(g/Fe(n,2));if(S-m<=Gr&&(x=m/2,f>0&&h>0)){const E=(p,b)=>b*o+p,v=(c[E(h,f-1)]+2*c[E(h-1,f)]+c[E(h-1,f-1)])/4;m<v&&(x=v)}c[o*f+h]=C(x)}}const l=new N({width:t.width,height:t.height});for(let f=0;f<i;f++){const d=Q(f*n,0,s),h=Q(f,2,i-3);for(let u=0;u<o;u++){const g=Q(u*n,0,a),m=Q(u,2,o-3);let S=0;for(let E=-2;E<=2;E++){const v=o*(h+E)+m;for(let p=-2;p<=2;p++)S+=c[v+p]}const x=S/25;for(let E=0,v=d*t.width+g;E<n;E+=1,v+=t.width)for(let p=0;p<n;p++)r[v+p]<=x&&(l.data[d+E][g+p]=!0)}}return l}function en(t,e){if(Math.abs(e.y-t.y)<=e.moduleSize&&Math.abs(e.x-t.x)<=e.moduleSize){const r=Math.abs(e.moduleSize-t.moduleSize);return r<=1||r<=t.moduleSize}return!1}function tn(t,e){const r=t.count+e.count;return{x:(t.count*t.x+e.count*e.x)/r,y:(t.count*t.y+e.count*e.y)/r,moduleSize:(t.count*t.moduleSize+e.count*e.moduleSize)/r,count:r}}const rn=t=>t.filter(e=>e.count>=Ot);function Mt(t,e){const r=e||We(t.length,1);if(t.length!==r.length)throw new Error("invalid pattern");if(!(t.length&1))throw new Error("invalid pattern, length should be odd");const n={center:Math.ceil(t.length/2)-1,length:t.length,pattern:t,size:r,runs:()=>We(t.length,0),totalSize:ce(r),total:o=>o.reduce((i,s)=>i+s),shift:(o,i)=>{for(let s=0;s<o.length-i;s++)o[s]=o[s+2];for(let s=o.length-i;s<o.length;s++)o[s]=0},checkSize(o,i,s=Fr){const a=i/s;for(let c=0;c<o.length;c++)if(Math.abs(r[c]*i-o[c])>=r[c]*a)return!1;return!0},add(o,i,s,a){const c=a/J.totalSize,l={x:i,y:s,moduleSize:c,count:1};for(let f=0;f<o.length;f++){const d=o[f];if(en(d,l))return o[f]=tn(d,l)}o.push(l)},toCenter(o,i){for(let s=t.length-1;s>n.center;s--)i-=o[s];return i-=o[n.center]/2,i},check(o,i,s,a,c){let l=0,f=it(s);const d=Yr(a),h=(u,g)=>{for(;o.isInside(f)&&!!o.point(f)===n.pattern[u];ot(f,g))i[u]++,l++;if(i[u]===0)return!0;const m=u===n.center;return!!(c&&!m&&i[u]>n.size[u]*c)};for(let u=n.center;u>=0;u--)if(h(u,d))return!1;f=it(s),ot(f,a),l=1;for(let u=n.center;u<n.length;u++)if(h(u,a))return!1;return l},scanLine(o,i,s,a,c){const l=n.runs();let f=0,d=s;if(s)for(;d<a&&!!o.data[i][d]===n.pattern[0];)d++;for(;d<a;d++){if(!!o.data[i][d]===n.pattern[f]){if(l[f]++,d!==o.width-1)continue;d++}if(f!==n.length-1){l[++f]++;continue}const h=c(l,d);if(h)f=0,l.fill(0);else{if(h===!1)break;n.shift(l,2),f=n.length-2,l[f]++}}}};return n}const J=Mt([!0,!1,!0,!1,!0],[1,1,3,1,1]),ee=Mt([!1,!0,!1]);function nn(t){let e=[];function r(p,b=2){const T=ce(p);if(T<J.totalSize)return!1;const I=T/J.totalSize;return J.checkSize(p,I,b)}function n(p,b,T,I){const R=J.runs();let O=J.check(t,R,p,I,b);if(O===!1)return!1;const $=ce(R);return 5*Math.abs($-T)>=2*T?!1:r(R)?J.toCenter(R,O):!1}function o(p,b,T){if(!r(p))return!1;const I=ce(p);let R=J.toCenter(p,T),O=n({x:C(R),y:b},p[2],I,{y:1,x:0});if(O===!1)return!1;O+=b;let $=n({x:C(R),y:C(O)},p[2],I,{y:0,x:1});if($===!1)return!1;R=$+C(R);const U=J.runs();return!J.check(t,U,{x:C(R),y:C(O)},{x:1,y:1})||!r(U,qr)?!1:(J.add(e,R,O,I),!0)}let i=!1,s=Q(C(3*t.height/(4*97)),Xr),a=!1;for(let p=s-1;p<t.height&&!a;p+=s)J.scanLine(t,p,0,t.width,(b,T)=>{if(o(b,p,T)){if(s=2,i){let I=0,R=0;for(const U of e)U.count<Ot||(I++,R+=U.moduleSize);if(I<3)return;const O=R/e.length;let $=0;for(const U of e)$+=Math.abs(U.moduleSize-O);if($<=.05*R)return a=!0,!1}else if(e.length>1){const I=rn(e);if(I.length<2)return!0;i=!0;const R=C((Math.abs(I[0].x-I[1].x)-Math.abs(I[0].y-I[1].y))/2);return R<=b[2]+s?!0:(p+=R-b[2]-s,!1)}}});const c=e.length;if(c<3)throw new Error(`Finder: len(found) = ${c}`);e.sort((p,b)=>p.moduleSize-b.moduleSize);const l=Me();for(let p=0;p<c-2;p++){const b=e[p];for(let T=p+1;T<c-1;T++){const I=e[T],R=be(b,I);for(let O=T+1;O<c;O++){const $=e[O];if($.moduleSize>b.moduleSize*1.4)continue;const U=[R,be(I,$),be(b,$)].sort((_t,Vt)=>_t-Vt),Ae=U[0],Ce=U[1],ze=U[2];l.add(Math.abs(ze-2*Ce)+Math.abs(ze-2*Ae),[b,I,$])}}}const f=l.get();if(!f)throw new Error("cannot find finder");const d=f[0],h=f[1],u=f[2],g=oe(d,h),m=oe(h,u),S=oe(d,u);let x=u,E=d,v=h;if(m>=g&&m>=S?(x=d,E=h,v=u):S>=m&&S>=g&&(x=h,E=d,v=u),(v.x-x.x)*(E.y-x.y)-(v.y-x.y)*(E.x-x.x)<0){let p=E;E=v,v=p}return{bl:E,tl:x,tr:v}}function on(t,e,r){const{moduleSize:n}=e,o=C(r*n),i=Q(e.x-o,0),s=Q(e.x+o,void 0,t.width-1),a=s-i,c=Q(e.y-o,0),l=Q(e.y+o,void 0,t.height-1),f=l-c;if(a<n*3||f<n*3)throw new Error(`x = ${a}, y=${f} moduleSize = ${n}`);const d=i,h=c,u=s-i,g=l-c,m=[],S=d+u,x=C(h+g/2);for(let E=0;E<g;E++){const v=C((E+1)/2),p=x+(E&1?-v:v);let b;if(ee.scanLine(t,p,d,S,(T,I)=>{if(!ee.checkSize(T,n))return;const R=ce(T),O=ee.toCenter(T,I),$=ee.runs();let U=ee.check(t,$,{x:C(O),y:p},{y:1,x:0},2*T[1]);if(U===!1)return;U+=p;const Ae=ce($);if(5*Math.abs(Ae-R)>=2*R||!ee.checkSize($,n))return;const Ce=ee.toCenter($,U);if(b=ee.add(m,O,Ce,R),b)return!1}),b)return b}if(m.length>0)return m[0];throw new Error("Alignment pattern not found")}function st(t,e,r){let n=!1,o={x:Math.abs(r.x-e.x),y:Math.abs(r.y-e.y)};o.y>o.x&&(n=!0,e=Se(e),r=Se(r),o=Se(o));let i=-o.x/2,s={x:e.x>=r.x?-1:1,y:e.y>=r.y?-1:1},a=0,c=r.x+s.x;for(let l=e.x,f=e.y;l!==c;l+=s.x){let d={x:l,y:f};if(n&&(d=Se(d)),a===1==!!t.point(d)){if(a===2)return oe({x:l,y:f},e);a++}if(i+=o.y,!(i<=0)){if(f===r.y)break;f+=s.y,i-=o.x}}return a===2?oe({x:r.x+s.x,y:r.y},e):NaN}function at(t,e,r){let n=st(t,e,r),o=1;const{x:i,y:s}=e;let a=i-(r.x-i);const c=t.width;a<0?(o=i/(i-a),a=0):a>=c&&(o=(c-1-i)/(a-i),a=c-1);let l=C(s-(r.y-s)*o),f=1;const d=t.height;return l<0?(f=s/(s-l),l=0):l>=d&&(f=(d-1-s)/(l-s),l=d-1),a=C(i+(a-i)*f),n+=st(t,e,{x:a,y:l}),n-1}function ct(t,e,r){const n=at(t,Ee(e),Ee(r)),o=at(t,Ee(r),Ee(e));return Number.isNaN(n)?o/J.totalSize:Number.isNaN(o)?n/J.totalSize:(n+o)/(2*J.totalSize)}function sn(t){const{bl:e,tl:r,tr:n}=nn(t),o=(ct(t,r,n)+ct(t,r,e))/2;if(o<1)throw new Error(`invalid moduleSize = ${o}`);const i=C(oe(r,n)/o+.5),s=C(oe(r,e)/o+.5);let a=C((i+s)/2+7);const c=a%4;c===0?a++:c===2?a--:c===3&&(a-=2);const l=z.size.decode(a);Dt(l);let f;if(z.alignmentPatterns(l).length>0){const E={x:n.x-r.x+e.x,y:n.y-r.y+e.y},v=1-3/(z.size.encode(l)-7),p={x:C(r.x+v*(E.x-r.x)),y:C(r.y+v*(E.y-r.y)),moduleSize:o,count:1};for(let b=4;b<=16;b<<=1)try{f=on(t,p,b);break}catch(T){}}const d={x:3.5,y:3.5},h={x:a-3.5,y:3.5},u={x:3.5,y:a-3.5};let g,m;f?(g=f,m={x:a-6.5,y:a-6.5}):(g={x:n.x-r.x+e.x,y:n.y-r.y+e.y},m={x:a-3.5,y:a-3.5});const S=[r,n,g,e];return{bits:an(t,a,S,[d,h,m,u]),points:S}}function lt(t){const e={x:t[0].x-t[1].x+t[2].x-t[3].x,y:t[0].y-t[1].y+t[2].y-t[3].y};if(e.x===0&&e.y===0)return[[t[1].x-t[0].x,t[2].x-t[1].x,t[0].x],[t[1].y-t[0].y,t[2].y-t[1].y,t[0].y],[0,0,1]];{const r={x:t[1].x-t[2].x,y:t[1].y-t[2].y},n={x:t[3].x-t[2].x,y:t[3].y-t[2].y},o=r.x*n.y-n.x*r.y,i=(e.x*n.y-n.x*e.y)/o,s=(r.x*e.y-e.x*r.y)/o;return[[t[1].x-t[0].x+i*t[1].x,t[3].x-t[0].x+s*t[3].x,t[0].x],[t[1].y-t[0].y+i*t[1].y,t[3].y-t[0].y+s*t[3].y,t[0].y],[i,s,1]]}}function an(t,e,r,n){const o=lt(n),i=[[o[1][1]*o[2][2]-o[2][1]*o[1][2],o[2][1]*o[0][2]-o[0][1]*o[2][2],o[0][1]*o[1][2]-o[1][1]*o[0][2]],[o[2][0]*o[1][2]-o[1][0]*o[2][2],o[0][0]*o[2][2]-o[2][0]*o[0][2],o[1][0]*o[0][2]-o[0][0]*o[1][2]],[o[1][0]*o[2][1]-o[2][0]*o[1][1],o[2][0]*o[0][1]-o[0][0]*o[2][1],o[0][0]*o[1][1]-o[1][0]*o[0][1]]],a=lt(r).map(d=>d.map((h,u)=>d.reduce((g,m,S)=>g+m*i[S][u],0))),c=new N(e),l=We(2*e,0),f=l.length;for(let d=0;d<e;d++){const h=a;for(let u=0;u<f-1;u+=2){const g=u/2+.5,m=d+.5,S=h[2][0]*g+h[2][1]*m+h[2][2];l[u]=C((h[0][0]*g+h[0][1]*m+h[0][2])/S),l[u+1]=C((h[1][0]*g+h[1][1]*m+h[1][2])/S)}for(let u=0;u<f;u+=2){const g=Q(l[u],0,t.width-1),m=Q(l[u+1],0,t.height-1);t.data[m][g]&&(c.data[d][u/2]=!0)}}return c}function cn(t){const e=(a,c,l)=>l<<1|(t.data[c][a]?1:0),r=t.height;let n=0;for(let a=5;a>=0;a--)for(let c=r-9;c>=r-11;c--)n=e(c,a,n);let o=0;for(let a=5;a>=0;a--)for(let c=r-9;c>=r-11;c--)o=e(a,c,o);let i=0;for(let a=0;a<6;a++)i=e(a,8,i);i=e(7,8,i),i=e(8,8,i),i=e(8,7,i);for(let a=5;a>=0;a--)i=e(8,a,i);let s=0;for(let a=r-1;a>=r-7;a--)s=e(8,a,s);for(let a=r-8;a<r;a++)s=e(a,8,s);return{version1:n,version2:o,format1:i,format2:s}}function ln(t){const e=f=>{let d=0;for(;f;)f&1&&d++,f>>=1;return d},r=t.height,{version1:n,version2:o,format1:i,format2:s}=cn(t);let a;const c=Me();for(const f of["medium","low","high","quartile"])for(let d=0;d<8;d++){const h=z.formatBits(f,d),u={ecc:f,mask:d};if(h===i||h===s){a=u;break}c.add(e(i^h),u),i!==s&&c.add(e(s^h),u)}if(a===void 0&&c.score()<=nt&&(a=c.get()),a===void 0)throw new Error("invalid format pattern");let l=z.size.decode(r);if(l<7)Dt(l);else{l=void 0;const f=Me();for(let d=7;d<=40;d++){const h=z.versionBits(d);if(h===n||h===o){l=d;break}f.add(e(n^h),d),n!==o&&f.add(e(o^h),d)}if(l===void 0&&f.score()<=nt&&(l=f.get()),l===void 0)throw new Error("invalid version pattern");if(z.size.encode(l)!==r)throw new Error("invalid version size")}return D({version:l},a)}function dn(t){const e=t.height;if(e<21||(e&3)!==1||e!==t.width)throw new Error(`decode: invalid size=${e}`);const{version:r,mask:n,ecc:o}=ln(t),i=Qr(r,o,n),{total:s}=z.capacity(r,o),a=new Uint8Array(s);let c=0,l=0,f=0;if(_r(i,n,(S,x,E)=>{f++,l<<=1,l|=+(!!t.data[x][S]!==E),f===8&&(a[c++]=l,f=0,l=0)}),c!==s)throw new Error(`decode: pos=${c}, total=${s}`);let d=Array.from(zr(r,o).decode(a)).map(S=>Lr(S,8)).join("");const h=S=>{if(S>d.length)throw new Error("Not enough bits");const x=d.slice(0,S);return d=d.slice(S),x},u=S=>+`0b${S}`,g={"0000":"terminator","0001":"numeric","0010":"alphanumeric","0100":"byte","0111":"eci",1e3:"kanji"};let m="";for(;!(d.length<4);){const S=h(4),x=g[S];if(x===void 0)throw new Error(`Unknown modeBits=${S} res="${m}"`);if(x==="terminator")break;const E=z.lengthBits(r,x);let v=u(h(E));if(x==="numeric"){for(;v>=3;){const p=u(h(10));if(p>=1e3)throw new Error(`numberic(3) = ${p}`);m+=p.toString().padStart(3,"0"),v-=3}if(v===2){const p=u(h(7));if(p>=100)throw new Error(`numeric(2) = ${p}`);m+=p.toString().padStart(2,"0")}else if(v===1){const p=u(h(4));if(p>=10)throw new Error(`Numeric(1) = ${p}`);m+=p.toString()}}else if(x==="alphanumeric"){for(;v>=2;){const p=u(h(11));m+=z.alphabet.alphanumerc.encode([Math.floor(p/45),p%45]).join(""),v-=2}v===1&&(m+=z.alphabet.alphanumerc.encode([u(h(6))]).join(""))}else if(x==="byte"){let p=[];for(let b=0;b<v;b++)p.push(+`0b${h(8)}`);m+=new TextDecoder().decode(new Uint8Array(p))}else throw new Error(`Unknown mode=${x}`)}return m}function fn(t){const e=Array.isArray(t.data)?new Uint8Array(t.data):t.data,{height:r,width:n}=t,o=Math.min(r,n),i={x:Math.floor((n-o)/2),y:Math.floor((r-o)/2)},s=$t(t),a=new Uint8Array(o*o*s);for(let c=0;c<o;c++){const l=((c+i.y)*n+i.x)*s,f=c*o*s,d=o*s;a.set(e.subarray(l,l+d),f)}return{offset:i,img:{height:o,width:o,data:a}}}function hn(t,e={}){for(const a of["height","width"])if(!Number.isSafeInteger(t[a])||t[a]<=0)throw new Error(`invalid img.${a}=${t[a]} (${typeof t[a]})`);if(!Array.isArray(t.data)&&!(t.data instanceof Uint8Array)&&!(t.data instanceof Uint8ClampedArray))throw new Error(`invalid image.data=${t.data} (${typeof t.data})`);if(e.cropToSquare!==void 0&&typeof e.cropToSquare!="boolean")throw new Error(`invalid opts.cropToSquare=${e.cropToSquare}`);for(const a of["pointsOnDetect","imageOnBitmap","imageOnDetect","imageOnResult"])if(e[a]!==void 0&&typeof e[a]!="function")throw new Error(`invalid opts.${a}=${e[a]} (${typeof e[a]})`);let r={x:0,y:0};e.cropToSquare&&({img:t,offset:r}=fn(t));const n=Zr(t);e.imageOnBitmap&&e.imageOnBitmap(n.toImage());const{bits:o,points:i}=sn(n);if(e.pointsOnDetect){const a=i.map(c=>D(D({},c),jr(c,r)));e.pointsOnDetect(a)}e.imageOnDetect&&e.imageOnDetect(o.toImage());const s=dn(o);return e.imageOnResult&&e.imageOnResult(o.toImage()),s}new TextEncoder;const dt=new TextDecoder;function un(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(t);const e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function yn(t){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof t=="string"?t:dt.decode(t),{alphabet:"base64url"});let e=t;e instanceof Uint8Array&&(e=dt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return un(e)}catch(r){throw new TypeError("The input to be decoded is not correctly encoded.")}}class Wt extends Error{constructor(r,n){var o;super(r,n);A(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}}A(Wt,"code","ERR_JOSE_GENERIC");class re extends Wt{constructor(){super(...arguments);A(this,"code","ERR_JOSE_NOT_SUPPORTED")}}A(re,"code","ERR_JOSE_NOT_SUPPORTED");function mn(t){return typeof t=="object"&&t!==null}const pn=t=>{if(!mn(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};function gn(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new re('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new re('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"Ed25519":case"EdDSA":e={name:"Ed25519"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new re('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new re('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}const wn=t=>w(void 0,null,function*(){var o,i;if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:r}=gn(t),n=D({},t);return delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,e,(o=t.ext)!=null?o:!t.d,(i=t.key_ops)!=null?i:r)});function ft(t,e,r){return w(this,null,function*(){if(!pn(t))throw new TypeError("JWK must be an object");let n;switch(e!=null||(e=t.alg),n!=null||(n=t.ext),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return yn(t.k);case"RSA":if("oth"in t&&t.oth!==void 0)throw new re('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return wn(j(D({},t),{alg:e,ext:n}));default:throw new re('Unsupported "kty" (Key Type) Parameter value')}})}const Sn=[{kty:"EC",kid:"3Kfdg-XwP-7gXyywtUfUADwBumDOPKMQx-iELL11W9s",use:"sig",alg:"ES256",crv:"P-256",x:"11XvRWy1I2S0EyJlyf_bWfw_TQ5CJJNLw78bHXNxcgw",y:"eZXwxvO1hvCY0KucrPfKo7yAyMT6Ajc3N7OkAB6VYy8",d:"FvOOk6hMixJ2o9zt4PCfan_UW7i4aOEnzj76ZaCI9Og"},{kty:"EC",kid:"7rIUtD5K5Izrptr3ywgESTxhgJtJSeb06V42hg7WUDs",use:"enc",alg:"ECDH-ES",crv:"P-256",x:"Lhaq5B4HhCDJSSQU_rJLShIIr6S5PxfXKTGKfKSP_CY",y:"EaxJ3zkqswLnw5GOf95A3atOTToVYmZPrp_t7WBcHcM",d:"K9zmeCMxMTdq_9nOa0s1Kfg-GXrNkrSLw209g3A5k70"},{kty:"EC",kid:"EBKOr72QQDcTBUuVzAzkfBTGew0ZA16GuWty64nS-sw",use:"sig",alg:"ES256",x5c:["MIICDDCCAZGgAwIBAgIUVJEUcO5ckx9MA7ZPjlsXYGv+98wwCgYIKoZIzj0EAwMwJzElMCMGA1UEAwwcU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBDQTAeFw0yMTA2MDExNTUwMDlaFw0yMjA2MDExNTUwMDlaMCsxKTAnBgNVBAMMIFNNQVJUIEhlYWx0aCBDYXJkIEV4YW1wbGUgSXNzdWVyMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEPQHApUWm94mflvswQgAnfHlETMwJFqjUVSs7WU6LQy7uaPwg77xXlVmMNtFWwkg0L9GrlqLkIOEVfXxx5GwtZKOBljCBkzAJBgNVHRMEAjAAMAsGA1UdDwQEAwIHgDA5BgNVHREEMjAwhi5odHRwczovL3NwZWMuc21hcnRoZWFsdGguY2FyZHMvZXhhbXBsZXMvaXNzdWVyMB0GA1UdDgQWBBTGqQP/SGBzOjWWcDdk/U7bQFhu+DAfBgNVHSMEGDAWgBQ4uufUcLGAmR55HWQWi+6PN9HJcTAKBggqhkjOPQQDAwNpADBmAjEAlZ9TR2TJnhumSUmtmgsWPpcp3xDYUtcXtxHs2xuHU6HqoaBfWDdUJKO8tWljGSVWAjEApesQltBP8ddWIn1BgBpldJ1pq9zukqfwRjwoCH1SRQXyuhGNfovvQMl/lw8MLIyO","MIICBzCCAWigAwIBAgIUK9wvDGYJ5S9DKzs/MY+IiTa0CP0wCgYIKoZIzj0EAwQwLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMB4XDTIxMDYwMTE1NTAwOVoXDTI2MDUzMTE1NTAwOVowJzElMCMGA1UEAwwcU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBDQTB2MBAGByqGSM49AgEGBSuBBAAiA2IABF2eAAAAGv0/isod1xpgaLX0DASxCDs0+JbCt12CTdQhB7os9m9H8c0nLyaNb8lM9IXkBRZLoLly/ZRaRjU8vq3bt6l5m9Cc6OY+xwmADKvNdNm94dsCC5CiB+JQu6WgWKNQME4wDAYDVR0TBAUwAwEB/zAdBgNVHQ4EFgQUOLrn1HCxgJkeeR1kFovujzfRyXEwHwYDVR0jBBgwFoAUJo6aEvlKNnmPfQaKVkOXIDY87/8wCgYIKoZIzj0EAwQDgYwAMIGIAkIBq9tT76Qzv1wH6nB0/sKPN4xPUScJeDv4+u2Zncv4ySWn5BR3DxYxEdJsVk4Aczw8uBipnYS90XNiogXMmN7JbRQCQgEYLzjOB1BdWIzjBlLF0onqnsAQijr6VX+2tfd94FNgMxHtaU864vgD/b3b0jr/Qf4dUkvF7K9WM1+vbcd0WDP4gQ==","MIICMjCCAZOgAwIBAgIUadiyU9sUFV6H40ZB5pCyc+gOikgwCgYIKoZIzj0EAwQwLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMB4XDTIxMDYwMTE1NTAwOFoXDTMxMDUzMDE1NTAwOFowLDEqMCgGA1UEAwwhU01BUlQgSGVhbHRoIENhcmQgRXhhbXBsZSBSb290IENBMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQB/XU90B0DMB6GKbfNKz6MeEIZ2o6qCX76GGiwhPYZyDLgB4+njRHUA7l7KSrv8THtzXSn8FwDmubAZdbU3lwNRGcAQJVY/9Bq9TY5Utp8ttbVnXcHQ5pumzMgIkkrIzERg+iCZLtjgPYjUMgeLWpqQMG3VBNN6LXN4wM6DiJiZeeBId6jUDBOMAwGA1UdEwQFMAMBAf8wHQYDVR0OBBYEFCaOmhL5SjZ5j30GilZDlyA2PO//MB8GA1UdIwQYMBaAFCaOmhL5SjZ5j30GilZDlyA2PO//MAoGCCqGSM49BAMEA4GMADCBiAJCAe/u808fhGLVpgXyg3h/miSnqxGBx7Gav5Xf3iscdZkF9G5SH1G6UPvIS0tvP/2x9xHh2Vsx82OCZH64uPmKPqmkAkIBcUed8q/dQMgUmsB+jT7A7hKz0rh3CvmhW8b4djD3NesKW3M9qXqpRihd+7KqmTjUxhqUckiPBVLVm5wenaj08Ys="],crv:"P-256",x:"PQHApUWm94mflvswQgAnfHlETMwJFqjUVSs7WU6LQy4",y:"7mj8IO-8V5VZjDbRVsJINC_Rq5ai5CDhFX18ceRsLWQ",d:"vRyvhpwvbBuGVF3xmzpdvQjNH_IthPq3ehMWqPtlRXQ"}],En={keys:Sn};let Ut=null,Ue=null;function bn(){return w(this,null,function*(){try{const e=En.keys.find(o=>o.use==="sig"&&o.alg==="ES256"&&o.kty==="EC");if(!e)throw new Error("No suitable signing key found in JWKS");Ut=yield ft(e,"ES256");const t=e,{d:r}=t,n=Pe(t,["d"]);Ue=yield ft(n,"ES256"),console.log("Test keys loaded successfully"),console.log("Using key ID:",e.kid)}catch(e){throw console.error("❌ Failed to load test keys:",e),e}})}function Jt(){return w(this,null,function*(){try{console.log("Enumerating camera devices...");let t=null;try{t=yield navigator.mediaDevices.getUserMedia({video:!0})}catch(r){console.warn("⚠️ Camera permission denied, device labels may not be available")}return k=(yield navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput"),t&&t.getTracks().forEach(r=>r.stop()),console.log(`Found ${k.length} camera(s):`,k.map(r=>r.label||`Camera ${r.deviceId.substring(0,8)}...`)),k}catch(t){return console.error("❌ Failed to enumerate camera devices:",t),k=[],[]}})}function Nt(){const t=document.getElementById("cameraSelect");if(t.innerHTML="",k.length===0){t.innerHTML='<option value="">No cameras found</option>',t.disabled=!0;return}if(k.length>1&&(t.innerHTML='<option value="">Auto (Prefer back camera)</option>'),k.forEach((e,r)=>{const n=document.createElement("option");n.value=e.deviceId;let o=e.label;(!o||o.trim()==="")&&(o=`Camera ${r+1}`),o.toLowerCase().includes("back")||o.toLowerCase().includes("rear")?o=`📱 ${o}`:o.toLowerCase().includes("front")||o.toLowerCase().includes("user")||o.toLowerCase().includes("face")?o=`🤳 ${o}`:o=`📷 ${o}`,n.textContent=o,t.appendChild(n)}),t.disabled=!1,k.length>1){const e=k.find(r=>r.label&&(r.label.toLowerCase().includes("back")||r.label.toLowerCase().includes("rear")||r.label.toLowerCase().includes("environment")));e&&(t.value=e.deviceId)}}function vn(){return w(this,null,function*(){try{_("info","🔍 Detecting available cameras..."),yield Jt(),Nt(),k.length===0?_("error","❌ No cameras found. QR scanning will not be available."):(_("success",`✅ Found ${k.length} camera(s). Select your preferred camera above.`),setTimeout(()=>{const t=document.getElementById("scanStatus");t&&(t.style.display="none")},3e3))}catch(t){console.error("❌ Camera initialization failed:",t),_("error",`❌ Camera initialization failed: ${t.message}`)}})}const Ht={resourceType:"Bundle",type:"collection",entry:[{fullUrl:"https://example.org/fhir/Patient/123",resource:{resourceType:"Patient",id:"123",name:[{family:"Demo",given:["Test"]}],birthDate:"1990-01-01",gender:"unknown"}},{fullUrl:"https://example.org/fhir/Immunization/456",resource:{resourceType:"Immunization",id:"456",status:"completed",vaccineCode:{coding:[{system:"http://hl7.org/fhir/sid/cvx",code:"207",display:"COVID-19 vaccine (Demo Data Only)"}]},patient:{reference:"Patient/123"},occurrenceDateTime:"2023-01-15",performer:[{actor:{display:"Demo Healthcare Provider (Test Only)"}}]}}]};let kt=null,Lt=null,me=null,Qe=!1,k=[];function xn(){return w(this,null,function*(){try{yield bn(),kt=new Pr({issuer:"https://spec.smarthealth.cards/examples/issuer",privateKey:Ut,publicKey:Ue}),Lt=new Ir({publicKey:Ue}),An(),yield vn(),Cn(),console.log("SMART Health Cards demo initialized successfully"),console.log("Using SMART Health Cards example test keys")}catch(t){console.error("❌ Failed to initialize demo:",t),_("error",`Initialization failed: ${t.message}`)}})}function An(){document.getElementById("generateBtn").addEventListener("click",Rn),document.getElementById("clearBtn").addEventListener("click",In),document.getElementById("scanBtn").addEventListener("click",Bn),document.getElementById("stopScanBtn").addEventListener("click",Qt),navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",()=>w(this,null,function*(){console.log("Camera devices changed, refreshing camera list..."),yield Jt(),Nt()}))}function Cn(){const t=document.getElementById("bundleDisplay");t.textContent=JSON.stringify(Ht,null,2)}function Rn(){return w(this,null,function*(){const t=document.getElementById("generateBtn");try{t.disabled=!0,t.innerHTML='<span class="loading"></span>Generating...',Te("info","Generating SMART Health Card QR code...");const e=yield kt.issue(Ht,{includeAdditionalTypes:["https://smarthealth.cards#immunization"]}),r=yield e.asQR({encodeOptions:{errorCorrectionLevel:"L",scale:4,margin:1}});Pn(r[0]),Te("success","✅ QR code generated successfully! This contains the demo health card data."),console.log("Generated QR code:",r[0].substring(0,50)+"..."),console.log("JWS:",e.asJWS().substring(0,100)+"...")}catch(e){console.error("❌ QR generation failed:",e),Te("error",`QR generation failed: ${e.message}`)}finally{t.disabled=!1,t.textContent="Generate Sample QR Code"}})}function Pn(t){const e=document.getElementById("qrCodeContainer");e.innerHTML=`
    <div>
      <img src="${t}" alt="SMART Health Card QR Code" style="max-width: 300px;" />
      <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
          📷 You can scan this QR code using the camera scanner below
      </p>
    </div>
  `}function In(){const t=document.getElementById("qrCodeContainer"),e=document.getElementById("generationStatus");t.innerHTML='<p class="placeholder">Click "Generate Sample QR Code" to create a QR code</p>',e.style.display="none"}function Bn(){return w(this,null,function*(){const t=document.getElementById("scanBtn"),e=document.getElementById("stopScanBtn"),r=document.getElementById("cameraSelect"),n=document.getElementById("video"),o=document.getElementById("canvas"),i=document.getElementById("scannerPlaceholder");try{if(t.disabled=!0,e.disabled=!1,_("info","Requesting camera access..."),k.length===0)throw new Error("No cameras available. Please ensure you have a camera connected and grant camera permissions.");const s={width:{ideal:640},height:{ideal:480}},a=r.value;a?(s.deviceId={exact:a},console.log(`Using selected camera: ${a}`)):(s.facingMode="environment",console.log("Using auto camera selection (prefer back camera)")),me=yield navigator.mediaDevices.getUserMedia({video:s}),n.srcObject=me,n.play(),n.style.display="block",i.style.display="none";const c=document.getElementById("scannerContainer");if(!c.querySelector(".scanner-overlay")){const l=document.createElement("div");l.className="scanner-overlay",c.appendChild(l)}Qe=!0,_("info","📷 Camera active - position QR code within the frame"),zt(n,o)}catch(s){console.error("❌ Camera access failed:",s);let a=`Camera access failed: ${s.message}`;const c=r.value;if(c){const l=k.find(d=>d.deviceId===c),f=(l==null?void 0:l.label)||`Camera ${c.substring(0,8)}...`;a+=` (Selected camera: ${f}). Try selecting a different camera or use auto-selection.`}else a+=" Please ensure you've granted camera permissions and try selecting a specific camera.";_("error",a),t.disabled=!1,e.disabled=!0}})}function Qt(){const t=document.getElementById("scanBtn"),e=document.getElementById("stopScanBtn"),r=document.getElementById("scanStatus"),n=document.getElementById("video"),o=document.getElementById("scannerPlaceholder");Qe=!1,me&&(me.getTracks().forEach(a=>a.stop()),me=null),n.style.display="none",o.style.display="block",o.textContent='Click "Start Camera Scan" to begin scanning';const s=document.getElementById("scannerContainer").querySelector(".scanner-overlay");s&&s.remove(),t.disabled=!1,e.disabled=!0,r.style.display="none"}function zt(t,e){if(!Qe)return;const r=e.getContext("2d");if(t.readyState===t.HAVE_ENOUGH_DATA){e.width=t.videoWidth,e.height=t.videoHeight,r.drawImage(t,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height);let o=null;try{o=hn({width:n.width,height:n.height,data:n.data},{})}catch(i){}if(typeof o=="string"&&o.startsWith("shc:/")){Tn(o);return}}requestAnimationFrame(()=>zt(t,e))}function Tn(t){return w(this,null,function*(){console.log("QR code detected:",t.substring(0,50)+"...");try{Qt(),_("info","🔍 QR code detected! Verifying health card...");const r=yield(yield Lt.fromQRNumeric(t)).asBundle();ht(r,t),_("success","✅ SMART Health Card verified and decoded successfully!")}catch(e){console.error("❌ QR verification failed:",e),_("error",`QR verification failed: ${e.message}`),ht(null,t,e.message)}})}function ht(t,e,r=null){var o,i,s,a,c;const n=document.getElementById("scanResult");if(t){const l=(i=(o=t.entry)==null?void 0:o.find(h=>{var u;return((u=h.resource)==null?void 0:u.resourceType)==="Patient"}))==null?void 0:i.resource,f=(s=t.entry)==null?void 0:s.filter(h=>{var u;return((u=h.resource)==null?void 0:u.resourceType)==="Immunization"});let d=`🎉 SMART Health Card Verified!

`;if(l){const h=(a=l.name)==null?void 0:a[0];d+=`👤 Patient: ${((c=h==null?void 0:h.given)==null?void 0:c[0])||"Unknown"} ${(h==null?void 0:h.family)||"Unknown"}
`,d+=`📅 Birth Date: ${l.birthDate||"Unknown"}

`}f&&f.length>0&&(d+=`💉 Immunizations:
`,f.forEach((h,u)=>{var S,x;const g=h.resource,m=(x=(S=g.vaccineCode)==null?void 0:S.coding)==null?void 0:x[0];d+=`  ${u+1}. ${(m==null?void 0:m.display)||(m==null?void 0:m.code)||"Unknown vaccine"}
`,d+=`     Date: ${g.occurrenceDateTime||"Unknown date"}
`,d+=`     Status: ${g.status||"Unknown"}
`})),d+=`
📋 Full FHIR Bundle:
`,d+=JSON.stringify(t,null,2),n.textContent=d}else{let l=`❌ QR Code Processing Failed

`;r&&(l+=`Error: ${r}

`),l+=`Raw QR Data: ${e}
`,l+=`Length: ${e.length} characters`,n.textContent=l}}function Te(t,e){const r=document.getElementById("generationStatus");r&&(r.className=`status-message ${t}`,r.textContent=e,r.style.display="block")}function _(t,e){const r=document.getElementById("scanStatus");r&&(r.className=`status-message ${t}`,r.textContent=e,r.style.display="block")}document.addEventListener("DOMContentLoaded",xn);
