<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>SHLManifestBuilder | Kill the Clipboard - SMART Health Cards Library - v0.0.1</title><meta name="description" content="Documentation for Kill the Clipboard - SMART Health Cards Library"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script><style>
@media (prefers-color-scheme: dark) {
  :root {
    --md-sys-color-primary: #b7c4ff;
    --md-sys-color-on-primary: #002682;
    --md-sys-color-primary-container: #0038b6;
    --md-sys-color-on-primary-container: #dde1ff;
    --md-sys-color-secondary: #c2c5dd;
    --md-sys-color-on-secondary: #2c3042;
    --md-sys-color-secondary-container: #424659;
    --md-sys-color-on-secondary-container: #dee1f9;
    --md-sys-color-tertiary: #e4bada;
    --md-sys-color-on-tertiary: #43273f;
    --md-sys-color-tertiary-container: #5c3d56;
    --md-sys-color-on-tertiary-container: #ffd7f4;
    --md-sys-color-error: #ffb4ab;
    --md-sys-color-on-error: #690005;
    --md-sys-color-error-container: #93000a;
    --md-sys-color-on-error-container: #ffb4ab;
    --md-sys-color-background: #1b1b1f;
    --md-sys-color-on-background: #e4e1e6;
    --md-sys-color-surface: #1b1b1f;
    --md-sys-color-on-surface: #e4e1e6;
    --md-sys-color-surface-variant: #45464f;
    --md-sys-color-on-surface-variant: #c6c5d0;
    --md-sys-color-outline: #90909a;
    --md-sys-color-outline-variant: #45464f;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #e4e1e6;
    --md-sys-color-inverse-on-surface: #303034;
    --md-sys-color-inverse-primary: #004ced;
    --md-sys-color-surface-dim: #131316;
    --md-sys-color-surface-bright: #39393c;
    --md-sys-color-surface-container-lowest: #0e0e11;
    --md-sys-color-surface-container-low: #1b1b1f;
    --md-sys-color-surface-container: #1f1f23;
    --md-sys-color-surface-container-high: #2a2a2d;
    --md-sys-color-surface-container-highest: #343438
  }
}
:root[data-theme="dark"] {
  --md-sys-color-primary: #b7c4ff;
  --md-sys-color-on-primary: #002682;
  --md-sys-color-primary-container: #0038b6;
  --md-sys-color-on-primary-container: #dde1ff;
  --md-sys-color-secondary: #c2c5dd;
  --md-sys-color-on-secondary: #2c3042;
  --md-sys-color-secondary-container: #424659;
  --md-sys-color-on-secondary-container: #dee1f9;
  --md-sys-color-tertiary: #e4bada;
  --md-sys-color-on-tertiary: #43273f;
  --md-sys-color-tertiary-container: #5c3d56;
  --md-sys-color-on-tertiary-container: #ffd7f4;
  --md-sys-color-error: #ffb4ab;
  --md-sys-color-on-error: #690005;
  --md-sys-color-error-container: #93000a;
  --md-sys-color-on-error-container: #ffb4ab;
  --md-sys-color-background: #1b1b1f;
  --md-sys-color-on-background: #e4e1e6;
  --md-sys-color-surface: #1b1b1f;
  --md-sys-color-on-surface: #e4e1e6;
  --md-sys-color-surface-variant: #45464f;
  --md-sys-color-on-surface-variant: #c6c5d0;
  --md-sys-color-outline: #90909a;
  --md-sys-color-outline-variant: #45464f;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #e4e1e6;
  --md-sys-color-inverse-on-surface: #303034;
  --md-sys-color-inverse-primary: #004ced;
  --md-sys-color-surface-dim: #131316;
  --md-sys-color-surface-bright: #39393c;
  --md-sys-color-surface-container-lowest: #0e0e11;
  --md-sys-color-surface-container-low: #1b1b1f;
  --md-sys-color-surface-container: #1f1f23;
  --md-sys-color-surface-container-high: #2a2a2d;
  --md-sys-color-surface-container-highest: #343438
}

@media (prefers-color-scheme: light) {
  :root {
    --md-sys-color-primary: #004ced;
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #dde1ff;
    --md-sys-color-on-primary-container: #001452;
    --md-sys-color-secondary: #5a5d72;
    --md-sys-color-on-secondary: #ffffff;
    --md-sys-color-secondary-container: #dee1f9;
    --md-sys-color-on-secondary-container: #171b2c;
    --md-sys-color-tertiary: #75546f;
    --md-sys-color-on-tertiary: #ffffff;
    --md-sys-color-tertiary-container: #ffd7f4;
    --md-sys-color-on-tertiary-container: #2c1229;
    --md-sys-color-error: #ba1a1a;
    --md-sys-color-on-error: #ffffff;
    --md-sys-color-error-container: #ffdad6;
    --md-sys-color-on-error-container: #410002;
    --md-sys-color-background: #fefbff;
    --md-sys-color-on-background: #1b1b1f;
    --md-sys-color-surface: #fefbff;
    --md-sys-color-on-surface: #1b1b1f;
    --md-sys-color-surface-variant: #e2e1ec;
    --md-sys-color-on-surface-variant: #45464f;
    --md-sys-color-outline: #767680;
    --md-sys-color-outline-variant: #c6c5d0;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #303034;
    --md-sys-color-inverse-on-surface: #f2f0f4;
    --md-sys-color-inverse-primary: #b7c4ff;
    --md-sys-color-surface-dim: #dbd9de;
    --md-sys-color-surface-bright: #fbf8fd;
    --md-sys-color-surface-container-lowest: #ffffff;
    --md-sys-color-surface-container-low: #f5f3f7;
    --md-sys-color-surface-container: #efedf1;
    --md-sys-color-surface-container-high: #eae7ec;
    --md-sys-color-surface-container-highest: #e4e1e6
  }
}
:root[data-theme="light"] {
  --md-sys-color-primary: #004ced;
  --md-sys-color-on-primary: #ffffff;
  --md-sys-color-primary-container: #dde1ff;
  --md-sys-color-on-primary-container: #001452;
  --md-sys-color-secondary: #5a5d72;
  --md-sys-color-on-secondary: #ffffff;
  --md-sys-color-secondary-container: #dee1f9;
  --md-sys-color-on-secondary-container: #171b2c;
  --md-sys-color-tertiary: #75546f;
  --md-sys-color-on-tertiary: #ffffff;
  --md-sys-color-tertiary-container: #ffd7f4;
  --md-sys-color-on-tertiary-container: #2c1229;
  --md-sys-color-error: #ba1a1a;
  --md-sys-color-on-error: #ffffff;
  --md-sys-color-error-container: #ffdad6;
  --md-sys-color-on-error-container: #410002;
  --md-sys-color-background: #fefbff;
  --md-sys-color-on-background: #1b1b1f;
  --md-sys-color-surface: #fefbff;
  --md-sys-color-on-surface: #1b1b1f;
  --md-sys-color-surface-variant: #e2e1ec;
  --md-sys-color-on-surface-variant: #45464f;
  --md-sys-color-outline: #767680;
  --md-sys-color-outline-variant: #c6c5d0;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #303034;
  --md-sys-color-inverse-on-surface: #f2f0f4;
  --md-sys-color-inverse-primary: #b7c4ff;
  --md-sys-color-surface-dim: #dbd9de;
  --md-sys-color-surface-bright: #fbf8fd;
  --md-sys-color-surface-container-lowest: #ffffff;
  --md-sys-color-surface-container-low: #f5f3f7;
  --md-sys-color-surface-container: #efedf1;
  --md-sys-color-surface-container-high: #eae7ec;
  --md-sys-color-surface-container-highest: #e4e1e6
}
</style><link rel="stylesheet" href="../assets/material-style.css"/><link rel="stylesheet" href="../assets/version-select.css"/><script src="../assets/version-select.js"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">Kill the Clipboard - SMART Health Cards Library - v0.0.1</a><select id="version-select" class="title loading"></select><div id="tsd-toolbar-links"><a href="https://github.com/vintasoftware/kill-the-clipboard">GitHub</a><a href="https://www.vinta.com.br">Maintained by Vinta Software</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">SHLManifestBuilder</a></li></ul><h1>Class SHLManifestBuilder</h1></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><p>Class that builds the manifest and files for a Smart Health Link.</p>
<p>This class handles file encryption, upload, and manifest building for SHL content.
It encrypts files using JWE with A256GCM, manages file storage through provided
upload/retrieval functions, and generates manifests with embedded or location-based
file descriptors based on size thresholds.</p>
<p>Per the SHL specification, servers SHALL persist the builder state (not the manifest)
and generate fresh manifests with short-lived URLs on each request. This ensures
URLs remain secure and can be rotated frequently.</p>
<p>The builder supports:</p>
<ul>
<li>Smart Health Card files (JWS format)</li>
<li>FHIR JSON resources</li>
<li>Optional compression with raw DEFLATE</li>
<li>Embedded vs location-based file serving</li>
<li>Serialization/deserialization for persistence</li>
</ul>
</div><div class="tsd-comment tsd-typography"><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example">Example<a href="#example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// Create SHL and builder</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">shl</span><span class="hl-1"> = </span><span class="hl-7">SHL</span><span class="hl-1">.</span><span class="hl-0">generate</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">baseManifestURL:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://shl.example.org/manifests/&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">manifestPath:</span><span class="hl-1"> </span><span class="hl-2">&#39;/manifest.json&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">flag:</span><span class="hl-1"> </span><span class="hl-2">&#39;P&#39;</span><br/><span class="hl-1">});</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builder</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHLManifestBuilder</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">shl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">uploadFile</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">content</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// Upload encrypted content to storage, return path</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">myStorage</span><span class="hl-1">.</span><span class="hl-0">upload</span><span class="hl-1">(</span><span class="hl-5">content</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">getFileURL</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">path</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// Generate short-lived signed URL for path</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-5">myStorage</span><span class="hl-1">.</span><span class="hl-0">getSignedURL</span><span class="hl-1">(</span><span class="hl-5">path</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Add files</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addHealthCard</span><span class="hl-1">({ </span><span class="hl-5">shc:</span><span class="hl-1"> </span><span class="hl-5">mySmartHealthCard</span><span class="hl-1"> });</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addFHIRResource</span><span class="hl-1">({ </span><span class="hl-5">content:</span><span class="hl-1"> </span><span class="hl-5">myFhirBundle</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Generate manifest</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">manifest</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">buildManifest</span><span class="hl-1">({ </span><span class="hl-5">embeddedLengthMax:</span><span class="hl-1"> </span><span class="hl-8">16384</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

</div></div></section><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L66">src/shl/manifest-builder.ts:66</a></li></ul></aside><section class="tsd-panel-group tsd-index-group"><section class="tsd-panel tsd-index-panel"><details class="tsd-index-content tsd-accordion" open><summary class="tsd-accordion-summary tsd-index-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h5 class="tsd-index-heading uppercase">Index</h5></summary><div class="tsd-accordion-details"><section class="tsd-index-section"><h3 class="tsd-index-heading">Accessors</h3><div class="tsd-index-list"><a href="#files" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Accessor"><use href="../assets/icons.svg#icon-262144"></use></svg><span>files</span></a>
<a href="#manifestid" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Accessor"><use href="../assets/icons.svg#icon-262144"></use></svg><span>manifest<wbr/>Id</span></a>
<a href="#shl" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Accessor"><use href="../assets/icons.svg#icon-262144"></use></svg><span>shl</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Constructors</h3><div class="tsd-index-list"><a href="#constructor" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Constructor"><use href="../assets/icons.svg#icon-512"></use></svg><span>constructor</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods</h3><div class="tsd-index-list"><a href="#addfhirresource" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>add<wbr/>FHIR<wbr/>Resource</span></a>
<a href="#addhealthcard" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>add<wbr/>Health<wbr/>Card</span></a>
<a href="#buildmanifest" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>build<wbr/>Manifest</span></a>
<a href="#deserialize" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>deserialize</span></a>
<a href="#serialize" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>serialize</span></a>
</div></section></div></details></section></section><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Accessors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Accessors</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="files"><span>files</span><a href="#files" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li><div class="tsd-signature" id="filesfiles"><span class="tsd-signature-keyword">get</span> <span class="tsd-kind-get-signature">files</span><span class="tsd-signature-symbol">()</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SerializedSHLManifestBuilderFile.html" class="tsd-signature-type tsd-kind-interface">SerializedSHLManifestBuilderFile</a><span class="tsd-signature-symbol">[]</span></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Get the current list of files in the manifest.</p>
<p>Returns metadata about all files that have been added to the builder.
Does not include the actual file content, only the storage paths,
content types, and ciphertext lengths.</p>
</div><h4 class="tsd-returns-title">Returns <a href="../interfaces/SerializedSHLManifestBuilderFile.html" class="tsd-signature-type tsd-kind-interface">SerializedSHLManifestBuilderFile</a><span class="tsd-signature-symbol">[]</span></h4><p>Array of file metadata objects (copies, safe to modify)</p>
<div class="tsd-comment tsd-typography"></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L381">src/shl/manifest-builder.ts:381</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="manifestid"><span>manifest<wbr/>Id</span><a href="#manifestid" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li><div class="tsd-signature" id="manifestidmanifestid"><span class="tsd-signature-keyword">get</span> <span class="tsd-kind-get-signature">manifestId</span><span class="tsd-signature-symbol">()</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Get the manifest ID for the SHL instance used by this builder.</p>
<p>Useful for storing the SHL and its manifest in a database with a unique identifier.</p>
<p>The manifest ID is the 43-character base64url-encoded entropy segment
that uniquely identifies this SHL's manifest URL. This ID is extracted
from the manifest URL path and can be used as a database key or identifier.</p>
<p>For example, if the manifest URL is:
'<a href="https://shl.example.org/manifests/abc123def456.../manifest.json">https://shl.example.org/manifests/abc123def456.../manifest.json</a>'
The manifest ID would be: 'abc123def456...'</p>
</div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">string</span></h4><p>The 43-character manifest ID string</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws">Throws<a href="#throws" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If the manifest URL cannot be parsed to extract the ID</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-1">Example<a href="#example-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">manifestId</span><span class="hl-1"> = </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-5">manifestId</span><span class="hl-1">;</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Database key:&#39;</span><span class="hl-1">, </span><span class="hl-5">manifestId</span><span class="hl-1">); </span><span class="hl-3">// &#39;abc123def456...&#39;</span>
</code><button type="button">Copy</button></pre>

</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L334">src/shl/manifest-builder.ts:334</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="shl"><span>shl</span><a href="#shl" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li><div class="tsd-signature" id="shlshl"><span class="tsd-signature-keyword">get</span> <span class="tsd-kind-get-signature">shl</span><span class="tsd-signature-symbol">()</span><span class="tsd-signature-symbol">:</span> <a href="SHL.html" class="tsd-signature-type tsd-kind-class">SHL</a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Get the SHL instance used by this builder.</p>
<p>Returns the immutable SHL that contains the encryption key and manifest URL
for this builder's files.</p>
</div><h4 class="tsd-returns-title">Returns <a href="SHL.html" class="tsd-signature-type tsd-kind-class">SHL</a></h4><p>The SHL instance provided in the constructor</p>
<div class="tsd-comment tsd-typography"></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L308">src/shl/manifest-builder.ts:308</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Constructors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Constructors</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="constructor"><span>constructor</span><a href="#constructor" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="constructorshlmanifestbuilder"><span class="tsd-signature-keyword">new</span> <span class="tsd-kind-constructor-signature">SHLManifestBuilder</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">params</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">fetch</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">options</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">RequestInit</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Response</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">getFileURL</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">loadFile</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">shl</span><span class="tsd-signature-symbol">:</span> <a href="SHL.html" class="tsd-signature-type tsd-kind-class">SHL</a><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">uploadFile</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><br/>            <span class="tsd-kind-parameter">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>            <span class="tsd-kind-parameter">contentType</span><span class="tsd-signature-symbol">?:</span> <a href="../types/SHLFileContentType.html" class="tsd-signature-type tsd-kind-type-alias">SHLFileContentType</a><span class="tsd-signature-symbol">,</span><br/>        <span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a href="" class="tsd-signature-type tsd-kind-class">SHLManifestBuilder</a><a href="#constructorshlmanifestbuilder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Create a manifest builder for the given SHL.</p>
<p>The builder requires functions for file storage operations. These functions
abstract the storage backend (S3, filesystem, database, etc.) and allow
the builder to work with any storage system.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">params</span>: <span class="tsd-signature-symbol">{</span><br/>    <span class="tsd-kind-property">fetch</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">options</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">RequestInit</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Response</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">getFileURL</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">loadFile</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">shl</span><span class="tsd-signature-symbol">:</span> <a href="SHL.html" class="tsd-signature-type tsd-kind-class">SHL</a><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">uploadFile</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><br/>        <span class="tsd-kind-parameter">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>        <span class="tsd-kind-parameter">contentType</span><span class="tsd-signature-symbol">?:</span> <a href="../types/SHLFileContentType.html" class="tsd-signature-type tsd-kind-type-alias">SHLFileContentType</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/><span class="tsd-signature-symbol">}</span></span><ul class="tsd-parameters"><li class="tsd-parameter"><h5><code class="tsd-tag">Optional</code><span class="tsd-kind-property">fetch</span><span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">options</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">RequestInit</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Response</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Optional fetch implementation for the default loadFile.
Only used if <code>loadFile</code> is not provided. Defaults to global fetch.</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><span class="tsd-kind-property">getFileURL</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Function to generate URLs for stored files.
Receives a storage path from <code>uploadFile</code> and returns an HTTPS URL.
Per SHL spec, URLs SHALL be short-lived and intended for single use.
Called each time a manifest is built for location-based files.</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><code class="tsd-tag">Optional</code><span class="tsd-kind-property">loadFile</span><span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Optional function to load file content from storage.
Receives a storage path and returns the JWE content as a string.
If not provided, defaults to fetching via <code>getFileURL()</code> with the provided fetch implementation.
Called when building manifests for embedded files.</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><span class="tsd-kind-property">shl</span><span class="tsd-signature-symbol">: </span><a href="SHL.html" class="tsd-signature-type tsd-kind-class">SHL</a></h5><div class="tsd-comment tsd-typography"><p>The immutable SHL instance this builder manages.
Contains the encryption key and manifest URL for this SHL.</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><span class="tsd-kind-property">uploadFile</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">contentType</span><span class="tsd-signature-symbol">?:</span> <a href="../types/SHLFileContentType.html" class="tsd-signature-type tsd-kind-type-alias">SHLFileContentType</a><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Function to upload encrypted files to storage.
Receives the JWE content as a string and optional content type.
Must return a storage path/key that can be used with <code>getFileURL</code> and <code>loadFile</code>.
Called once per file when added to the builder.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></li></ul></div><h4 class="tsd-returns-title">Returns <a href="" class="tsd-signature-type tsd-kind-class">SHLManifestBuilder</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-2">Example<a href="#example-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// With S3-like storage</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builder</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHLManifestBuilder</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">shl:</span><span class="hl-1"> </span><span class="hl-5">myShl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">uploadFile</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">content</span><span class="hl-1">, </span><span class="hl-5">contentType</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">key</span><span class="hl-1"> = </span><span class="hl-2">`shl-files/</span><span class="hl-6">${</span><span class="hl-5">crypto</span><span class="hl-10">.</span><span class="hl-0">randomUUID</span><span class="hl-10">()</span><span class="hl-6">}</span><span class="hl-2">.jwe`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">s3</span><span class="hl-1">.</span><span class="hl-0">putObject</span><span class="hl-1">({ </span><span class="hl-5">Key:</span><span class="hl-1"> </span><span class="hl-5">key</span><span class="hl-1">, </span><span class="hl-5">Body:</span><span class="hl-1"> </span><span class="hl-5">content</span><span class="hl-1">, </span><span class="hl-5">ContentType:</span><span class="hl-1"> </span><span class="hl-2">&#39;application/jose&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-5">key</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">getFileURL</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">path</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-5">s3</span><span class="hl-1">.</span><span class="hl-0">getSignedUrl</span><span class="hl-1">(</span><span class="hl-2">&#39;getObject&#39;</span><span class="hl-1">, { </span><span class="hl-5">Key:</span><span class="hl-1"> </span><span class="hl-5">path</span><span class="hl-1">, </span><span class="hl-5">Expires:</span><span class="hl-1"> </span><span class="hl-8">3600</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">loadFile</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">path</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">s3</span><span class="hl-1">.</span><span class="hl-0">getObject</span><span class="hl-1">({ </span><span class="hl-5">Key:</span><span class="hl-1"> </span><span class="hl-5">path</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">Body</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L120">src/shl/manifest-builder.ts:120</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="addfhirresource"><span>add<wbr/>FHIR<wbr/>Resource</span><a href="#addfhirresource" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="addfhirresource-1"><span class="tsd-kind-call-signature">addFHIRResource</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">params</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Resource</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">enableCompression</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">boolean</span> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><br/>    <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">ciphertextLength</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">encryptedFile</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SHLFileJWE.html" class="tsd-signature-type tsd-kind-interface">SHLFileJWE</a><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">storagePath</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><a href="#addfhirresource-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Add a FHIR JSON resource file to the manifest.</p>
<p>Encrypts the FHIR resource as a JWE file and uploads it to storage.
The resource is serialized as JSON and can be any valid FHIR R4 resource.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">params</span>: <span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Resource</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">enableCompression</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">boolean</span> <span class="tsd-signature-symbol">}</span></span><div class="tsd-comment tsd-typography"><p>Configuration for adding the FHIR resource. The object should contain:</p>
<ul>
<li><code>content</code>: FHIR R4 resource object to add (must have valid <code>resourceType</code> field)</li>
<li><code>enableCompression</code>: Optional. Whether to compress the file content before encryption (defaults to true)</li>
</ul>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><br/>    <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">ciphertextLength</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">encryptedFile</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SHLFileJWE.html" class="tsd-signature-type tsd-kind-interface">SHLFileJWE</a><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">storagePath</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span></h4><p>Promise resolving to object with encrypted file metadata and storage path</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-1">Throws<a href="#throws-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><a href="SHLError.html" class="tsd-kind-class">SHLError</a> When encryption fails</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-3">Example<a href="#example-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// Add a FHIR Bundle</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addFHIRResource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">content:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">resourceType:</span><span class="hl-1"> </span><span class="hl-2">&#39;Bundle&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;collection&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">      { </span><span class="hl-5">resource:</span><span class="hl-1"> { </span><span class="hl-5">resourceType:</span><span class="hl-1"> </span><span class="hl-2">&#39;Patient&#39;</span><span class="hl-1">, </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-2">&#39;123&#39;</span><span class="hl-1">, ... } },</span><br/><span class="hl-1">      </span><span class="hl-3">// ... more resources</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Added FHIR resource:&#39;</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">storagePath</span><span class="hl-1">, </span><span class="hl-2">&#39;Size:&#39;</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">ciphertextLength</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Add without compression</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addFHIRResource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">content:</span><span class="hl-1"> </span><span class="hl-5">myFhirResource</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">enableCompression:</span><span class="hl-1"> </span><span class="hl-6">false</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L277">src/shl/manifest-builder.ts:277</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="addhealthcard"><span>add<wbr/>Health<wbr/>Card</span><a href="#addhealthcard" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="addhealthcard-1"><span class="tsd-kind-call-signature">addHealthCard</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">params</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">enableCompression</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">boolean</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">shc</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <a href="SmartHealthCard.html" class="tsd-signature-type tsd-kind-class">SmartHealthCard</a> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><br/>    <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">ciphertextLength</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">encryptedFile</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SHLFileJWE.html" class="tsd-signature-type tsd-kind-interface">SHLFileJWE</a><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">storagePath</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><a href="#addhealthcard-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Add a SMART Health Card file to the manifest.</p>
<p>Encrypts the Smart Health Card as a JWE file and uploads it to storage.
The SHC is wrapped in a <code>verifiableCredential</code> array as per SMART Health Cards specification.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">params</span>: <span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">enableCompression</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">boolean</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">shc</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <a href="SmartHealthCard.html" class="tsd-signature-type tsd-kind-class">SmartHealthCard</a> <span class="tsd-signature-symbol">}</span></span><div class="tsd-comment tsd-typography"><p>Configuration for adding the health card. The object should contain:</p>
<ul>
<li><code>shc</code>: Smart Health Card to add (JWS string or SmartHealthCard object)</li>
<li><code>enableCompression</code>: Optional. Whether to compress the file content before encryption (defaults to false, as SHCs are typically already compressed)</li>
</ul>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><br/>    <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">ciphertextLength</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">encryptedFile</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SHLFileJWE.html" class="tsd-signature-type tsd-kind-interface">SHLFileJWE</a><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">storagePath</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span></h4><p>Promise resolving to object with encrypted file metadata and storage path</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-2">Throws<a href="#throws-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><a href="SHLError.html" class="tsd-kind-class">SHLError</a> When encryption fails</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-4">Example<a href="#example-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// Add from SmartHealthCard object</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addHealthCard</span><span class="hl-1">({ </span><span class="hl-5">shc:</span><span class="hl-1"> </span><span class="hl-5">mySmartHealthCard</span><span class="hl-1"> });</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Added file:&#39;</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">storagePath</span><span class="hl-1">, </span><span class="hl-2">&#39;Size:&#39;</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">ciphertextLength</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Add from JWS string</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addHealthCard</span><span class="hl-1">({ </span><span class="hl-5">shc:</span><span class="hl-1"> </span><span class="hl-2">&#39;eyJhbGciOiJFUzI1NiIsImtpZCI6IjNLZmRnLVh3UC03Z...&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Add with compression (not recommended for SHCs)</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addHealthCard</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">shc:</span><span class="hl-1"> </span><span class="hl-5">mySmartHealthCard</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">enableCompression:</span><span class="hl-1"> </span><span class="hl-6">true</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L215">src/shl/manifest-builder.ts:215</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="buildmanifest"><span>build<wbr/>Manifest</span><a href="#buildmanifest" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="buildmanifest-1"><span class="tsd-kind-call-signature">buildManifest</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">params</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">embeddedLengthMax</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../interfaces/SHLManifestV1.html" class="tsd-signature-type tsd-kind-interface">SHLManifestV1</a><span class="tsd-signature-symbol">&gt;</span><a href="#buildmanifest-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Build the manifest as JSON.</p>
<p>Generates a fresh manifest response with up-to-date file descriptors.
Files are either embedded directly in the manifest or referenced by
location URLs based on the size threshold. Location URLs are generated
fresh each time to ensure security and proper access control.
<code>embeddedLengthMax</code> may vary per request.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">params</span>: <span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">embeddedLengthMax</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol"> = {}</span></span><ul class="tsd-parameters"><li class="tsd-parameter"><h5><code class="tsd-tag">Optional</code><span class="tsd-kind-property">embeddedLengthMax</span><span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">number</span></h5><div class="tsd-comment tsd-typography"><p>Maximum size in bytes for embedded files.
Files with ciphertext length ≤ this value will be embedded directly in the manifest.
Files larger than this will be referenced by location URLs.
Defaults to 16384 (16 KiB). Typical range: 4096-32768.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../interfaces/SHLManifestV1.html" class="tsd-signature-type tsd-kind-interface">SHLManifestV1</a><span class="tsd-signature-symbol">&gt;</span></h4><p>Promise resolving to SHL manifest object conforming to v1 specification (<a href="../interfaces/SHLManifestV1.html" class="tsd-kind-interface">SHLManifestV1</a>)</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-3">Throws<a href="#throws-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><a href="SHLManifestError.html" class="tsd-kind-class">SHLManifestError</a> When a stored file cannot be loaded or content is missing</p>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-4">Throws<a href="#throws-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><a href="SHLNetworkError.html" class="tsd-kind-class">SHLNetworkError</a> When storage network requests fail</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-5">Example<a href="#example-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// Use default 16KB threshold</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">manifest</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">buildManifest</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Prefer smaller embedded files (4KB)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">manifest</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">buildManifest</span><span class="hl-1">({ </span><span class="hl-5">embeddedLengthMax:</span><span class="hl-1"> </span><span class="hl-8">4096</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Prefer larger embedded files (32KB)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">manifest</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">buildManifest</span><span class="hl-1">({ </span><span class="hl-5">embeddedLengthMax:</span><span class="hl-1"> </span><span class="hl-8">32768</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L414">src/shl/manifest-builder.ts:414</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="deserialize"><code class="tsd-tag">Static</code><span>deserialize</span><a href="#deserialize" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="deserialize-1"><span class="tsd-kind-call-signature">deserialize</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">params</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">data</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SerializedSHLManifestBuilder.html" class="tsd-signature-type tsd-kind-interface">SerializedSHLManifestBuilder</a><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">fetch</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">options</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">RequestInit</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Response</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">getFileURL</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">loadFile</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">uploadFile</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><br/>            <span class="tsd-kind-parameter">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>            <span class="tsd-kind-parameter">contentType</span><span class="tsd-signature-symbol">?:</span> <a href="../types/SHLFileContentType.html" class="tsd-signature-type tsd-kind-type-alias">SHLFileContentType</a><span class="tsd-signature-symbol">,</span><br/>        <span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a href="" class="tsd-signature-type tsd-kind-class">SHLManifestBuilder</a><a href="#deserialize-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Reconstruct a builder from serialized state returned by <a href="#serialize" class="tsd-kind-method">serialize</a> method.</p>
<p>Creates a new SHLManifestBuilder instance from previously serialized state.
The SHL instance is reconstructed from the saved payload, and the file
metadata is restored. The provided functions are used for future file operations.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">params</span>: <span class="tsd-signature-symbol">{</span><br/>    <span class="tsd-kind-property">data</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SerializedSHLManifestBuilder.html" class="tsd-signature-type tsd-kind-interface">SerializedSHLManifestBuilder</a><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">fetch</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">options</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">RequestInit</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Response</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">getFileURL</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">loadFile</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-kind-property">uploadFile</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><br/>        <span class="tsd-kind-parameter">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>        <span class="tsd-kind-parameter">contentType</span><span class="tsd-signature-symbol">?:</span> <a href="../types/SHLFileContentType.html" class="tsd-signature-type tsd-kind-type-alias">SHLFileContentType</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">;</span><br/><span class="tsd-signature-symbol">}</span></span><ul class="tsd-parameters"><li class="tsd-parameter"><h5><span class="tsd-kind-property">data</span><span class="tsd-signature-symbol">: </span><a href="../interfaces/SerializedSHLManifestBuilder.html" class="tsd-signature-type tsd-kind-interface">SerializedSHLManifestBuilder</a></h5><div class="tsd-comment tsd-typography"><p>Serialized builder state from a previous <code>serialize()</code> call</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><code class="tsd-tag">Optional</code><span class="tsd-kind-property">fetch</span><span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">options</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">RequestInit</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Response</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Optional fetch implementation for default loadFile (same signature as constructor)</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><span class="tsd-kind-property">getFileURL</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Function to generate file URLs (same signature as constructor)</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><code class="tsd-tag">Optional</code><span class="tsd-kind-property">loadFile</span><span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">path</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Optional function to load file content (same signature as constructor)</p>
</div><div class="tsd-comment tsd-typography"></div></li><li class="tsd-parameter"><h5><span class="tsd-kind-property">uploadFile</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">content</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">contentType</span><span class="tsd-signature-symbol">?:</span> <a href="../types/SHLFileContentType.html" class="tsd-signature-type tsd-kind-type-alias">SHLFileContentType</a><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">&gt;</span></h5><div class="tsd-comment tsd-typography"><p>Function to upload encrypted files (same signature as constructor)</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></li></ul></div><h4 class="tsd-returns-title">Returns <a href="" class="tsd-signature-type tsd-kind-class">SHLManifestBuilder</a></h4><p>New <code>SHLManifestBuilder</code> instance with restored state</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-6">Example<a href="#example-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// Load from database</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">savedState</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">database</span><span class="hl-1">.</span><span class="hl-0">loadSHLBuilder</span><span class="hl-1">(</span><span class="hl-5">shlId</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Reconstruct builder</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builder</span><span class="hl-1"> = </span><span class="hl-5">SHLManifestBuilder</span><span class="hl-1">.</span><span class="hl-0">deserialize</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> </span><span class="hl-5">savedState</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">uploadFile</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">content</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">storage</span><span class="hl-1">.</span><span class="hl-0">upload</span><span class="hl-1">(</span><span class="hl-5">content</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">getFileURL</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">path</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">storage</span><span class="hl-1">.</span><span class="hl-0">getSignedURL</span><span class="hl-1">(</span><span class="hl-5">path</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-0">loadFile</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">path</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">storage</span><span class="hl-1">.</span><span class="hl-0">download</span><span class="hl-1">(</span><span class="hl-5">path</span><span class="hl-1">)</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Builder is ready to use</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">manifest</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">buildManifest</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L521">src/shl/manifest-builder.ts:521</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="serialize"><span>serialize</span><a href="#serialize" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="serialize-1"><span class="tsd-kind-call-signature">serialize</span><span class="tsd-signature-symbol">()</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/SerializedSHLManifestBuilder.html" class="tsd-signature-type tsd-kind-interface">SerializedSHLManifestBuilder</a><a href="#serialize-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Return serialized builder state for persistence.
Use the <a href="#deserialize" class="tsd-kind-method">deserialize</a> method to reconstruct the builder later.</p>
<p>Returns a JSON-serializable object containing the SHL payload and file metadata.
This is NOT the same as an SHLManifestV1 - it's the builder's internal state
that can be stored in a database and used to reconstruct the builder later.</p>
<p>The serialized state includes:</p>
<ul>
<li>SHL payload (url, key, expiration, flags, label)</li>
<li>File metadata (content types, storage paths, ciphertext lengths)</li>
</ul>
<p>Does NOT include:</p>
<ul>
<li>Actual file content (stored separately via uploadFile)</li>
<li>Short-lived URLs (generated fresh via getFileURL)</li>
</ul>
</div><h4 class="tsd-returns-title">Returns <a href="../interfaces/SerializedSHLManifestBuilder.html" class="tsd-signature-type tsd-kind-interface">SerializedSHLManifestBuilder</a></h4><p>Serialized builder state suitable for database storage (<a href="../interfaces/SerializedSHLManifestBuilder.html" class="tsd-kind-interface">SerializedSHLManifestBuilder</a>)</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-7">Example<a href="#example-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// Serialize for storage</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builderState</span><span class="hl-1"> = </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">serialize</span><span class="hl-1">();</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">database</span><span class="hl-1">.</span><span class="hl-0">saveSHLBuilder</span><span class="hl-1">(</span><span class="hl-5">shlId</span><span class="hl-1">, </span><span class="hl-5">builderState</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Later, reconstruct the builder</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">savedState</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">database</span><span class="hl-1">.</span><span class="hl-0">loadSHLBuilder</span><span class="hl-1">(</span><span class="hl-5">shlId</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">reconstructedBuilder</span><span class="hl-1"> = </span><span class="hl-5">SHLManifestBuilder</span><span class="hl-1">.</span><span class="hl-0">deserialize</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> </span><span class="hl-5">savedState</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">uploadFile:</span><span class="hl-1"> </span><span class="hl-5">myUploadFunction</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">getFileURL:</span><span class="hl-1"> </span><span class="hl-5">myGetURLFunction</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/vintasoftware/kill-the-clipboard/blob/main/src/shl/manifest-builder.ts#L483">src/shl/manifest-builder.ts:483</a></li></ul></aside></div></li></ul></section></section></details></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-alpha" name="alpha"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Alpha</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-beta" name="beta"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Beta</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Accessors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Accessors</summary><div><a href="#files"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Accessor"><use href="../assets/icons.svg#icon-262144"></use></svg><span>files</span></a><a href="#manifestid"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Accessor"><use href="../assets/icons.svg#icon-262144"></use></svg><span>manifest<wbr/>Id</span></a><a href="#shl"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Accessor"><use href="../assets/icons.svg#icon-262144"></use></svg><span>shl</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Constructors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Constructors</summary><div><a href="#constructor"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Constructor"><use href="../assets/icons.svg#icon-512"></use></svg><span>constructor</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods</summary><div><a href="#addfhirresource"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>add<wbr/>FHIR<wbr/>Resource</span></a><a href="#addhealthcard"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>add<wbr/>Health<wbr/>Card</span></a><a href="#buildmanifest"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>build<wbr/>Manifest</span></a><a href="#deserialize"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>deserialize</span></a><a href="#serialize"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>serialize</span></a></div></details></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/vintasoftware/kill-the-clipboard" class="tsd-nav-link">GitHub</a><a href="https://www.vinta.com.br" class="tsd-nav-link">Maintained by Vinta Software</a></nav><nav class="tsd-navigation"><a href="../modules.html">Kill the Clipboard - SMART Health Cards Library - v0.0.1</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div><script>
          try {
            const generateLinkElement = document.querySelector(".tsd-generator a");
            const link = document.createElement("a");
            Object.assign(link, {
              href: "https://github.com/dmnsgn/typedoc-material-theme",
              target: "_blank",
              rel: "noreferrer",
              innerText: "typedoc-material-theme."
            });
            generateLinkElement.insertAdjacentElement("afterend", link);
            generateLinkElement.insertAdjacentText("afterend", " with ");
          } catch (error) {

          }
        </script></body></html>
