<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Kill the Clipboard - SMART Health Cards Library - v1.0.2</title><meta name="description" content="Documentation for Kill the Clipboard - SMART Health Cards Library"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script><style>
@media (prefers-color-scheme: dark) {
  :root {
    --md-sys-color-primary: #b7c4ff;
    --md-sys-color-on-primary: #002682;
    --md-sys-color-primary-container: #0038b6;
    --md-sys-color-on-primary-container: #dde1ff;
    --md-sys-color-secondary: #c2c5dd;
    --md-sys-color-on-secondary: #2c3042;
    --md-sys-color-secondary-container: #424659;
    --md-sys-color-on-secondary-container: #dee1f9;
    --md-sys-color-tertiary: #e4bada;
    --md-sys-color-on-tertiary: #43273f;
    --md-sys-color-tertiary-container: #5c3d56;
    --md-sys-color-on-tertiary-container: #ffd7f4;
    --md-sys-color-error: #ffb4ab;
    --md-sys-color-on-error: #690005;
    --md-sys-color-error-container: #93000a;
    --md-sys-color-on-error-container: #ffb4ab;
    --md-sys-color-background: #1b1b1f;
    --md-sys-color-on-background: #e4e1e6;
    --md-sys-color-surface: #1b1b1f;
    --md-sys-color-on-surface: #e4e1e6;
    --md-sys-color-surface-variant: #45464f;
    --md-sys-color-on-surface-variant: #c6c5d0;
    --md-sys-color-outline: #90909a;
    --md-sys-color-outline-variant: #45464f;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #e4e1e6;
    --md-sys-color-inverse-on-surface: #303034;
    --md-sys-color-inverse-primary: #004ced;
    --md-sys-color-surface-dim: #131316;
    --md-sys-color-surface-bright: #39393c;
    --md-sys-color-surface-container-lowest: #0e0e11;
    --md-sys-color-surface-container-low: #1b1b1f;
    --md-sys-color-surface-container: #1f1f23;
    --md-sys-color-surface-container-high: #2a2a2d;
    --md-sys-color-surface-container-highest: #343438
  }
}
:root[data-theme="dark"] {
  --md-sys-color-primary: #b7c4ff;
  --md-sys-color-on-primary: #002682;
  --md-sys-color-primary-container: #0038b6;
  --md-sys-color-on-primary-container: #dde1ff;
  --md-sys-color-secondary: #c2c5dd;
  --md-sys-color-on-secondary: #2c3042;
  --md-sys-color-secondary-container: #424659;
  --md-sys-color-on-secondary-container: #dee1f9;
  --md-sys-color-tertiary: #e4bada;
  --md-sys-color-on-tertiary: #43273f;
  --md-sys-color-tertiary-container: #5c3d56;
  --md-sys-color-on-tertiary-container: #ffd7f4;
  --md-sys-color-error: #ffb4ab;
  --md-sys-color-on-error: #690005;
  --md-sys-color-error-container: #93000a;
  --md-sys-color-on-error-container: #ffb4ab;
  --md-sys-color-background: #1b1b1f;
  --md-sys-color-on-background: #e4e1e6;
  --md-sys-color-surface: #1b1b1f;
  --md-sys-color-on-surface: #e4e1e6;
  --md-sys-color-surface-variant: #45464f;
  --md-sys-color-on-surface-variant: #c6c5d0;
  --md-sys-color-outline: #90909a;
  --md-sys-color-outline-variant: #45464f;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #e4e1e6;
  --md-sys-color-inverse-on-surface: #303034;
  --md-sys-color-inverse-primary: #004ced;
  --md-sys-color-surface-dim: #131316;
  --md-sys-color-surface-bright: #39393c;
  --md-sys-color-surface-container-lowest: #0e0e11;
  --md-sys-color-surface-container-low: #1b1b1f;
  --md-sys-color-surface-container: #1f1f23;
  --md-sys-color-surface-container-high: #2a2a2d;
  --md-sys-color-surface-container-highest: #343438
}

@media (prefers-color-scheme: light) {
  :root {
    --md-sys-color-primary: #004ced;
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #dde1ff;
    --md-sys-color-on-primary-container: #001452;
    --md-sys-color-secondary: #5a5d72;
    --md-sys-color-on-secondary: #ffffff;
    --md-sys-color-secondary-container: #dee1f9;
    --md-sys-color-on-secondary-container: #171b2c;
    --md-sys-color-tertiary: #75546f;
    --md-sys-color-on-tertiary: #ffffff;
    --md-sys-color-tertiary-container: #ffd7f4;
    --md-sys-color-on-tertiary-container: #2c1229;
    --md-sys-color-error: #ba1a1a;
    --md-sys-color-on-error: #ffffff;
    --md-sys-color-error-container: #ffdad6;
    --md-sys-color-on-error-container: #410002;
    --md-sys-color-background: #fefbff;
    --md-sys-color-on-background: #1b1b1f;
    --md-sys-color-surface: #fefbff;
    --md-sys-color-on-surface: #1b1b1f;
    --md-sys-color-surface-variant: #e2e1ec;
    --md-sys-color-on-surface-variant: #45464f;
    --md-sys-color-outline: #767680;
    --md-sys-color-outline-variant: #c6c5d0;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #303034;
    --md-sys-color-inverse-on-surface: #f2f0f4;
    --md-sys-color-inverse-primary: #b7c4ff;
    --md-sys-color-surface-dim: #dbd9de;
    --md-sys-color-surface-bright: #fbf8fd;
    --md-sys-color-surface-container-lowest: #ffffff;
    --md-sys-color-surface-container-low: #f5f3f7;
    --md-sys-color-surface-container: #efedf1;
    --md-sys-color-surface-container-high: #eae7ec;
    --md-sys-color-surface-container-highest: #e4e1e6
  }
}
:root[data-theme="light"] {
  --md-sys-color-primary: #004ced;
  --md-sys-color-on-primary: #ffffff;
  --md-sys-color-primary-container: #dde1ff;
  --md-sys-color-on-primary-container: #001452;
  --md-sys-color-secondary: #5a5d72;
  --md-sys-color-on-secondary: #ffffff;
  --md-sys-color-secondary-container: #dee1f9;
  --md-sys-color-on-secondary-container: #171b2c;
  --md-sys-color-tertiary: #75546f;
  --md-sys-color-on-tertiary: #ffffff;
  --md-sys-color-tertiary-container: #ffd7f4;
  --md-sys-color-on-tertiary-container: #2c1229;
  --md-sys-color-error: #ba1a1a;
  --md-sys-color-on-error: #ffffff;
  --md-sys-color-error-container: #ffdad6;
  --md-sys-color-on-error-container: #410002;
  --md-sys-color-background: #fefbff;
  --md-sys-color-on-background: #1b1b1f;
  --md-sys-color-surface: #fefbff;
  --md-sys-color-on-surface: #1b1b1f;
  --md-sys-color-surface-variant: #e2e1ec;
  --md-sys-color-on-surface-variant: #45464f;
  --md-sys-color-outline: #767680;
  --md-sys-color-outline-variant: #c6c5d0;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #303034;
  --md-sys-color-inverse-on-surface: #f2f0f4;
  --md-sys-color-inverse-primary: #b7c4ff;
  --md-sys-color-surface-dim: #dbd9de;
  --md-sys-color-surface-bright: #fbf8fd;
  --md-sys-color-surface-container-lowest: #ffffff;
  --md-sys-color-surface-container-low: #f5f3f7;
  --md-sys-color-surface-container: #efedf1;
  --md-sys-color-surface-container-high: #eae7ec;
  --md-sys-color-surface-container-highest: #e4e1e6
}
</style><link rel="stylesheet" href="assets/material-style.css"/><link rel="stylesheet" href="assets/version-select.css"/><script src="assets/version-select.js"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">Kill the Clipboard - SMART Health Cards Library - v1.0.2</a><select id="version-select" class="title loading"></select><div id="tsd-toolbar-links"><a href="https://github.com/vintasoftware/kill-the-clipboard">GitHub</a><a href="https://www.vinta.com.br">Maintained by Vinta Software</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>Kill the Clipboard - SMART Health Cards Library - v1.0.2</h1></div><div class="tsd-panel tsd-typography"><h1 id="kill-the-clipboard-typescript-library" class="tsd-anchor-link">Kill the Clipboard TypeScript Library<a href="#kill-the-clipboard-typescript-library" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><img src="https://github.com/vintasoftware/kill-the-clipboard/actions/workflows/test-coverage.yml/badge.svg" alt="Tests Badge"></p>
<p>JavaScript/TypeScript universal (browser and node) library to generate QR codes containing medical records for patients to share with providers. Implements both the <a href="https://smarthealth.cards/">SMART Health Cards Framework</a> and <a href="https://hl7.org/fhir/uv/smart-health-cards-and-links/links-specification.html">SMART Health Links Specification</a> for handling FHIR-based medical records, enabling patients to &quot;Kill the Clipboard&quot; by sharing health data via secure, verifiable QR codes.</p>
<p>This aligns with the <a href="https://www.cms.gov/health-technology-ecosystem/interoperability-framework">CMS Interoperability Framework</a> call to action for Patient Facing Apps to &quot;Kill the Clipboard&quot;:</p>
<blockquote>
<p>We pledge to empower patients to retrieve their health records from CMS Aligned Networks or personal health record apps and share them with providers via <strong>QR codes or SMART Health Cards/Links using FHIR bundles</strong>. When possible, we will return visit records to patients in the same format. We commit to seamless, secure data exchange—eliminating the need for patients to repeatedly recall and write out their medical history. We are committed to &quot;kill the clipboard,&quot; one encounter at a time.</p>
</blockquote>
<p><strong>This is a recently released library. While it's well tested, verify the functionality before using in production. Please report any issues or suggestions to the <a href="https://github.com/vintasoftware/kill-the-clipboard/issues">GitHub Issues</a> page. For sensitive security reports, please contact us at contact at <a href="http://vinta.com.br">vinta.com.br</a></strong></p>
<h2 id="features" class="tsd-anchor-link">Features<a href="#features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>SMART Health Cards (SHC)</strong></p>
<ul>
<li>Follows <a href="https://spec.smarthealth.cards/">SMART Health Cards Framework v1.4.0</a></li>
<li>JWS generation</li>
<li>File generation (.smart-health-card files)</li>
<li>QR code generation with optional chunking support</li>
<li>Decoding / Verification support</li>
</ul>
<p><strong>SMART Health Links (SHL)</strong></p>
<ul>
<li>Implements <a href="https://hl7.org/fhir/uv/smart-health-cards-and-links/links-specification.html">SMART Health Links Specification v1.0.0 STU 1</a></li>
<li>SHL URI generation per SHL specification</li>
<li><code>SHLManifestBuilder</code> for producing manifests with embedded and location file entries</li>
<li><code>SHLViewer</code> to resolve SHLs, fetch manifests, and decrypt content</li>
<li>QR code generation</li>
<li>Passcode flow supported at the application level (see SHL demo)</li>
</ul>
<p><strong>Great Developer Experience</strong></p>
<ul>
<li>TypeScript support with full type definitions</li>
<li>Comprehensive test suite</li>
<li>Proper error handling hierarchy</li>
<li>Built both for Node.js and browser environments</li>
</ul>
<h2 id="smart-health-links-demo" class="tsd-anchor-link">SMART Health Links Demo<a href="#smart-health-links-demo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="https://kill-the-clipboard.vercel.app/"><img height="200" alt="Kill the Clipboard JavaScript / TypeScript library - SMART Health Links demo screenshot" src="https://github.com/user-attachments/assets/c3f6e30c-c932-4c81-879c-cd0bb0cba922" /></a></p>
<p>Demo for SMART Health Link generation and view. Supports sharing International Patient Summary (IPS) FHIR data: allergies, medications, vitals, etc. via a passcode-protected SMART Health Link: <a href="https://kill-the-clipboard.vercel.app/">https://kill-the-clipboard.vercel.app/</a></p>
<h2 id="smart-health-cards-demo" class="tsd-anchor-link">SMART Health Cards Demo<a href="#smart-health-cards-demo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="https://vintasoftware.github.io/kill-the-clipboard/demo/shc/"><img height="200" alt="Kill the Clipboard JavaScript / TypeScript library - SMART Health Cards demo screenshot" src="https://github.com/user-attachments/assets/5e820583-9a23-4ff4-aa37-112254c8bfa5" /></a></p>
<p>Interactive browser demo that showcases QR code generation and camera-based scanning: <a href="https://vintasoftware.github.io/kill-the-clipboard/demo/shc/">https://vintasoftware.github.io/kill-the-clipboard/demo/shc/</a></p>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">kill-the-clipboard</span><br/><span class="hl-3"># or</span><br/><span class="hl-0">pnpm</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">kill-the-clipboard</span><br/><span class="hl-3"># or  </span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">kill-the-clipboard</span>
</code><button type="button">Copy</button></pre>

<h2 id="usage" class="tsd-anchor-link">Usage<a href="#usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="smart-health-cards-quick-start" class="tsd-anchor-link">SMART Health Cards Quick Start<a href="#smart-health-cards-quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Security warning</strong>: Issue/sign on a secure backend only; never expose the ES256 private key in browsers.</p>
<p>Use <code>SHCIssuer</code> on the server. Use <code>SHCReader</code> in the browser or server to verify and render QR.</p>
<p>Typical flow: client sends FHIR Bundle → server returns JWS/.smart-health-card or QR data.</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">SHCIssuer</span><span class="hl-1">, </span><span class="hl-5">SHCReader</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;kill-the-clipboard&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Configure issuer with your details and ES256 key pair</span><br/><span class="hl-3">// SECURITY: Use issuer on a secure backend only; never include privateKey in client-side code.</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">issuer</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHCIssuer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">issuer:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://your-healthcare-org.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">privateKey:</span><span class="hl-1"> </span><span class="hl-5">privateKeyPKCS8String</span><span class="hl-1">, </span><span class="hl-3">// ES256 private key in PKCS#8 format</span><br/><span class="hl-1">  </span><span class="hl-5">publicKey:</span><span class="hl-1"> </span><span class="hl-5">publicKeySPKIString</span><span class="hl-1">, </span><span class="hl-3">// ES256 public key in SPKI format</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Configure reader for verification (only needs public key)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">reader</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHCReader</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">publicKey:</span><span class="hl-1"> </span><span class="hl-5">publicKeySPKIString</span><span class="hl-1">, </span><span class="hl-3">// ES256 public key in SPKI format</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Create FHIR Bundle</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fhirBundle</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">resourceType:</span><span class="hl-1"> </span><span class="hl-2">&#39;Bundle&#39;</span><span class="hl-1">,  </span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;collection&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">fullUrl:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://example.org/fhir/Patient/123&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">resource:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">resourceType:</span><span class="hl-1"> </span><span class="hl-2">&#39;Patient&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-2">&#39;123&#39;</span><span class="hl-1">, </span><br/><span class="hl-1">        </span><span class="hl-5">name:</span><span class="hl-1"> [{ </span><span class="hl-5">family:</span><span class="hl-1"> </span><span class="hl-2">&#39;Doe&#39;</span><span class="hl-1">, </span><span class="hl-5">given:</span><span class="hl-1"> [</span><span class="hl-2">&#39;John&#39;</span><span class="hl-1">] }],</span><br/><span class="hl-1">        </span><span class="hl-5">birthDate:</span><span class="hl-1"> </span><span class="hl-2">&#39;1990-01-01&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">fullUrl:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://example.org/fhir/Immunization/456&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">resource:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">resourceType:</span><span class="hl-1"> </span><span class="hl-2">&#39;Immunization&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-2">&#39;456&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;completed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">vaccineCode:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">coding:</span><span class="hl-1"> [{</span><br/><span class="hl-1">            </span><span class="hl-5">system:</span><span class="hl-1"> </span><span class="hl-2">&#39;http://hl7.org/fhir/sid/cvx&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">code:</span><span class="hl-1"> </span><span class="hl-2">&#39;207&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">display:</span><span class="hl-1"> </span><span class="hl-2">&#39;COVID-19 vaccine&#39;</span><span class="hl-1">, </span><br/><span class="hl-1">          }],</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-5">patient:</span><span class="hl-1"> { </span><span class="hl-5">reference:</span><span class="hl-1"> </span><span class="hl-2">&#39;Patient/123&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-5">occurrenceDateTime:</span><span class="hl-1"> </span><span class="hl-2">&#39;2023-01-15&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">// Issue a new SMART Health Card</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">healthCard</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">issuer</span><span class="hl-1">.</span><span class="hl-0">issue</span><span class="hl-1">(</span><span class="hl-5">fhirBundle</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Health Card JWS:&#39;</span><span class="hl-1">, </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asJWS</span><span class="hl-1">());</span><br/><br/><span class="hl-3">// Generate QR codes</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">qrCodes</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asQR</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;QR code data URL:&#39;</span><span class="hl-1">, </span><span class="hl-5">qrCodes</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]);</span><br/><br/><span class="hl-3">// Generate numeric QR codes (shc:/ prefixed strings)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">qrNumericStrings</span><span class="hl-1"> = </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asQRNumeric</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Numeric QR code:&#39;</span><span class="hl-1">, </span><span class="hl-5">qrNumericStrings</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]);</span><br/><br/><span class="hl-3">// Create downloadable .smart-health-card file</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">blob</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asFileBlob</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;File blob created, type:&#39;</span><span class="hl-1">, </span><span class="hl-5">blob</span><span class="hl-1">.</span><span class="hl-5">type</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Verify and read the health card</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">verifiedHealthCard</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">reader</span><span class="hl-1">.</span><span class="hl-0">fromJWS</span><span class="hl-1">(</span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asJWS</span><span class="hl-1">());</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">verifiedBundle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">verifiedHealthCard</span><span class="hl-1">.</span><span class="hl-0">asBundle</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Verified FHIR Bundle:&#39;</span><span class="hl-1">, </span><span class="hl-5">verifiedBundle</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Read from file content</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fileContent</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asFileContent</span><span class="hl-1">();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">healthCardFromFile</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">reader</span><span class="hl-1">.</span><span class="hl-0">fromFileContent</span><span class="hl-1">(</span><span class="hl-5">fileContent</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Bundle from file:&#39;</span><span class="hl-1">, </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCardFromFile</span><span class="hl-1">.</span><span class="hl-0">asBundle</span><span class="hl-1">());</span><br/><br/><span class="hl-3">// Read from QR numeric data (simulate scanning QR codes)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">healthCardFromQR</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">reader</span><span class="hl-1">.</span><span class="hl-0">fromQRNumeric</span><span class="hl-1">(</span><span class="hl-5">qrNumericStrings</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Bundle from QR:&#39;</span><span class="hl-1">, </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCardFromQR</span><span class="hl-1">.</span><span class="hl-0">asBundle</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<h3 id="smart-health-links-quick-start" class="tsd-anchor-link">SMART Health Links Quick Start<a href="#smart-health-links-quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>SHLs enable encrypted, link-based sharing of health information. The flow involves:</p>
<ul>
<li>Server issues an SHL (creates state, attributes an ID to the SHL, persists SHL builder data, hosts a manifest endpoint, and stores encrypted files)</li>
<li>Client resolves the SHL using <code>SHLViewer</code>, providing the recipient identifier and (if applicable) a passcode</li>
</ul>
<p>Server responsibilities are required for a functional SHL implementation. Refer to the demo code in <code>demo/shl/</code> for a full working example (manifest endpoint, storage handlers, and passcode handling). In summary, the SHL generation and resolution flow involves:</p>
<ul>
<li>On the server side, during SHL creation:
<ol>
<li>Create an <code>SHL</code> instance with <code>SHL.generate({ baseManifestURL, manifestPath, expirationDate?, label?, flag? })</code></li>
<li>Attribute a server-generated ID to the SHL (useful to identify the SHL and related models in the database)</li>
<li>Use <code>SHLManifestBuilder</code> with implementations for <code>uploadFile</code>, <code>getFileURL</code>, and <code>loadFile</code> that persist encrypted files and return retrievable URLs</li>
<li>Add content: <code>addFHIRResource({ content, enableCompression? })</code>, <code>addHealthCard({ shc, enableCompression? })</code></li>
<li>Persist the builder state via <code>toDBAttrs()</code></li>
<li>Return the SHL URI to clients via <code>shl.toURI()</code></li>
</ol>
</li>
<li>On the client side, during SHL resolution:
<ol>
<li>Create a <code>SHLViewer</code> instance with the SHL URI</li>
<li>Resolve the SHL using <code>resolveSHL({ recipient, passcode?, embeddedLengthMax?, shcReaderConfig? })</code></li>
</ol>
</li>
<li>On the server side, after client resolves the SHL:
<ol>
<li>Implement a POST manifest endpoint at <code>baseManifestURL + manifestPath</code></li>
<li>On each manifest request, load the builder state from the database, reconstruct the builder with <code>fromDBAttrs()</code>, call <code>buildManifest({ embeddedLengthMax? })</code>, and return the manifest JSON</li>
</ol>
</li>
</ul>
<h4 id="complete-shl-end-to-end-example" class="tsd-anchor-link">Complete SHL End-to-End Example<a href="#complete-shl-end-to-end-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Here's a condensed single-file example demonstrating the complete SHL workflow from creation to resolution:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><br/><span class="hl-1">  </span><span class="hl-5">SHL</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-5">SHLManifestBuilder</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-5">SHLViewer</span><br/><span class="hl-1">} </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;kill-the-clipboard&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Mock storage for this example</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">uploadedFiles</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Map</span><span class="hl-1">&lt;</span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-9">string</span><span class="hl-1">&gt;();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">uploadFile</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">content</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">path</span><span class="hl-1"> = </span><span class="hl-2">`file-</span><span class="hl-6">${</span><span class="hl-5">uploadedFiles</span><span class="hl-10">.</span><span class="hl-5">size</span><span class="hl-10"> </span><span class="hl-1">+</span><span class="hl-10"> </span><span class="hl-8">1</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">uploadedFiles</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-5">path</span><span class="hl-1">, </span><span class="hl-5">content</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-5">path</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">getFileURL</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">path</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`https://files.example.org/</span><span class="hl-6">${</span><span class="hl-5">path</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">loadFile</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">path</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">uploadedFiles</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-5">path</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// 1. [Server side] Generate an SHL</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">shl</span><span class="hl-1"> = </span><span class="hl-7">SHL</span><span class="hl-1">.</span><span class="hl-0">generate</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-2">&#39;some-uuid&#39;</span><span class="hl-1">, </span><span class="hl-3">// Optional: server-generated ID for database</span><br/><span class="hl-1">  </span><span class="hl-5">baseManifestURL:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://shl.example.org/manifests/&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">manifestPath:</span><span class="hl-1"> </span><span class="hl-2">&#39;/manifest.json&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">label:</span><span class="hl-1"> </span><span class="hl-2">&#39;Complete Test Card&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// 2. [Server side] Create manifest builder with mocked file handling</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builder</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHLManifestBuilder</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">shl</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">uploadFile:</span><span class="hl-1"> </span><span class="hl-5">uploadFile</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">getFileURL:</span><span class="hl-1"> </span><span class="hl-5">getFileURL</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">loadFile:</span><span class="hl-1"> </span><span class="hl-5">loadFile</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// 3. [Server side] Add a FHIR bundle as content</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fhirBundle</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">resourceType:</span><span class="hl-1"> </span><span class="hl-2">&#39;Bundle&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;collection&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">fullUrl:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://example.org/fhir/Patient/123&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">resource:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">resourceType:</span><span class="hl-1"> </span><span class="hl-2">&#39;Patient&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-2">&#39;123&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">name:</span><span class="hl-1"> [{ </span><span class="hl-5">family:</span><span class="hl-1"> </span><span class="hl-2">&#39;Doe&#39;</span><span class="hl-1">, </span><span class="hl-5">given:</span><span class="hl-1"> [</span><span class="hl-2">&#39;John&#39;</span><span class="hl-1">] }],</span><br/><span class="hl-1">        </span><span class="hl-5">birthDate:</span><span class="hl-1"> </span><span class="hl-2">&#39;1990-01-01&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">};</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">addFHIRResource</span><span class="hl-1">({ </span><span class="hl-5">content:</span><span class="hl-1"> </span><span class="hl-5">fhirBundle</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// 4. [Server side] Persist the manifest builder state in the database</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builderAttrs</span><span class="hl-1"> = </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">toDBAttrs</span><span class="hl-1">();</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">storeBuilderAttrs</span><span class="hl-1">(</span><span class="hl-2">&#39;some-uuid&#39;</span><span class="hl-1">, </span><span class="hl-5">builderAttrs</span><span class="hl-1">); </span><span class="hl-3">// Implement your own function</span><br/><br/><span class="hl-3">// 5. [Server side] Generate the SHL URI for sharing</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">shlinkURI</span><span class="hl-1"> = </span><span class="hl-5">shl</span><span class="hl-1">.</span><span class="hl-0">toURI</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Share this SHL:&#39;</span><span class="hl-1">, </span><span class="hl-2">`https://viewer.example/#</span><span class="hl-6">${</span><span class="hl-5">shlinkURI</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// 6. [Server side] Implement manifest and file serving</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">fetchImpl</span><span class="hl-1"> = </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">url</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-5">init</span><span class="hl-1">?: </span><span class="hl-9">RequestInit</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// Handle manifest requests</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">init</span><span class="hl-1">?.</span><span class="hl-5">method</span><span class="hl-1"> === </span><span class="hl-2">&#39;POST&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-5">url</span><span class="hl-1"> === </span><span class="hl-5">shl</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">// Load the builder state from the database</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builderAttrs</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">loadBuilderAttrs</span><span class="hl-1">(</span><span class="hl-2">&#39;some-uuid&#39;</span><span class="hl-1">);  </span><span class="hl-3">// Implement your own function</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// Reconstruct the builder</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">builder</span><span class="hl-1"> = </span><span class="hl-5">SHLManifestBuilder</span><span class="hl-1">.</span><span class="hl-0">fromDBAttrs</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-5">attrs:</span><span class="hl-1"> </span><span class="hl-5">builderAttrs</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">uploadFile:</span><span class="hl-1"> </span><span class="hl-5">uploadFile</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">getFileURL:</span><span class="hl-1"> </span><span class="hl-5">getFileURL</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">loadFile:</span><span class="hl-1"> </span><span class="hl-5">loadFile</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// Build the manifest</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">body</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-5">init</span><span class="hl-1">.</span><span class="hl-5">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">manifest</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">builder</span><span class="hl-1">.</span><span class="hl-0">buildManifest</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-5">embeddedLengthMax:</span><span class="hl-1"> </span><span class="hl-5">body</span><span class="hl-1">.</span><span class="hl-5">embeddedLengthMax</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">ok:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">status:</span><span class="hl-1"> </span><span class="hl-8">200</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">text</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-5">manifest</span><span class="hl-1">),</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">// Handle file requests (could be an S3-like storage instead)</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fileId</span><span class="hl-1"> = </span><span class="hl-5">url</span><span class="hl-1">.</span><span class="hl-0">split</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">).</span><span class="hl-0">pop</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">init</span><span class="hl-1">?.</span><span class="hl-5">method</span><span class="hl-1"> === </span><span class="hl-2">&#39;GET&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-5">fileId</span><span class="hl-1"> &amp;&amp; </span><span class="hl-5">uploadedFiles</span><span class="hl-1">.</span><span class="hl-0">has</span><span class="hl-1">(</span><span class="hl-5">fileId</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">ok:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">status:</span><span class="hl-1"> </span><span class="hl-8">200</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">text</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">uploadedFiles</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-5">fileId</span><span class="hl-1">),</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> { </span><span class="hl-5">ok:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">, </span><span class="hl-5">status:</span><span class="hl-1"> </span><span class="hl-8">404</span><span class="hl-1">, </span><span class="hl-0">text</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&#39;&#39;</span><span class="hl-1"> };</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">// 7. Use SHLViewer to resolve the SHL (client-side)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">viewer</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHLViewer</span><span class="hl-1">({ </span><br/><span class="hl-1">  </span><span class="hl-5">shlinkURI:</span><span class="hl-1"> </span><span class="hl-2">`https://viewer.example/#</span><span class="hl-6">${</span><span class="hl-5">shlinkURI</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-3">// Note: No need to pass fetch implementation if you have a real server-side implementation:</span><br/><span class="hl-1">  </span><span class="hl-5">fetch:</span><span class="hl-1"> </span><span class="hl-5">fetchImpl</span><br/><span class="hl-1">});</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">resolved</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">viewer</span><span class="hl-1">.</span><span class="hl-0">resolveSHL</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">recipient:</span><span class="hl-1"> </span><span class="hl-2">&#39;alice@example.org&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">embeddedLengthMax:</span><span class="hl-1"> </span><span class="hl-8">4096</span><span class="hl-1"> </span><span class="hl-3">// Files smaller than this will be embedded</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// 8. Access the resolved content</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Resolved FHIR resources:&#39;</span><span class="hl-1">, </span><span class="hl-5">resolved</span><span class="hl-1">.</span><span class="hl-5">fhirResources</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>This example above demonstrates the complete lifecycle: SHL generation, content addition, manifest builder persistence in server-side database, manifest serving, and client-side resolution. In a real application, you would implement persistence for the manifest builder state and serve the manifest endpoint from your backend server.</p>
<h3 id="error-handling" class="tsd-anchor-link">Error Handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The library provides granular error handling with specific error codes for different failure scenarios. Check each method documentation for the specific errors that can be thrown.</p>
<h2 id="api-reference-documentation" class="tsd-anchor-link">API Reference Documentation<a href="#api-reference-documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Available at <a href="https://vintasoftware.github.io/kill-the-clipboard/">https://vintasoftware.github.io/kill-the-clipboard/</a>.</p>
<h3 id="generating-documentation" class="tsd-anchor-link">Generating Documentation<a href="#generating-documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To generate and view the full API documentation locally:</p>
<pre><code class="bash"><span class="hl-3"># Generate documentation</span><br/><span class="hl-0">pnpm</span><span class="hl-1"> </span><span class="hl-2">docs:build</span><br/><br/><span class="hl-3"># The documentation will be generated in the ./docs directory</span><br/><span class="hl-3"># Open docs/index.html in your browser to view the complete API reference</span>
</code><button type="button">Copy</button></pre>

<h2 id="advanced-usage" class="tsd-anchor-link">Advanced Usage<a href="#advanced-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="smart-health-cards-advanced-usage" class="tsd-anchor-link">SMART Health Cards Advanced Usage<a href="#smart-health-cards-advanced-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><br/><span class="hl-1">  </span><span class="hl-5">SHCIssuer</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">SHCReader</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">FHIRBundleProcessor</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-5">VerifiableCredentialProcessor</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">JWSProcessor</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">QRCodeGenerator</span><span class="hl-1"> </span><br/><span class="hl-1">} </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;kill-the-clipboard&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// High-level API with SHC object</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">issuer</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHCIssuer</span><span class="hl-1">(</span><span class="hl-5">config</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">healthCard</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">issuer</span><span class="hl-1">.</span><span class="hl-0">issue</span><span class="hl-1">(</span><span class="hl-5">fhirBundle</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-5">includeAdditionalTypes:</span><span class="hl-1"> [</span><span class="hl-2">&#39;https://smarthealth.cards#covid19&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// SHC provides various output formats</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">qrCodes</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asQR</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">enableChunking:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">encodeOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">errorCorrectionLevel:</span><span class="hl-1"> </span><span class="hl-2">&#39;L&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">scale:</span><span class="hl-1"> </span><span class="hl-8">4</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">bundle</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asBundle</span><span class="hl-1">({ </span><span class="hl-5">optimizeForQR:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-5">strictReferences:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fileContent</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asFileContent</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Use individual processors for more control</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">bundleProcessor</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">FHIRBundleProcessor</span><span class="hl-1">();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">vcProcessor</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">VerifiableCredentialProcessor</span><span class="hl-1">();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">jwsProcessor</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">JWSProcessor</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Process FHIR Bundle (standard processing)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">processedBundle</span><span class="hl-1"> = </span><span class="hl-5">bundleProcessor</span><span class="hl-1">.</span><span class="hl-0">process</span><span class="hl-1">(</span><span class="hl-5">fhirBundle</span><span class="hl-1">);</span><br/><span class="hl-5">bundleProcessor</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-5">processedBundle</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Or process with QR code optimizations (shorter resource references, removes unnecessary fields)</span><br/><span class="hl-3">// Use &#39;strictReferences&#39; option. When true, missing references throw an error.</span><br/><span class="hl-3">// When false, original references are preserved if target resource is not found in bundle.</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">optimizedBundle</span><span class="hl-1"> = </span><span class="hl-5">bundleProcessor</span><span class="hl-1">.</span><span class="hl-0">processForQR</span><span class="hl-1">(</span><span class="hl-5">fhirBundle</span><span class="hl-1">, { </span><span class="hl-5">strictReferences:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span><br/><span class="hl-5">bundleProcessor</span><span class="hl-1">.</span><span class="hl-0">validate</span><span class="hl-1">(</span><span class="hl-5">optimizedBundle</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Create Verifiable Credential</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">vc</span><span class="hl-1"> = </span><span class="hl-5">vcProcessor</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">(</span><span class="hl-5">processedBundle</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-5">fhirVersion:</span><span class="hl-1"> </span><span class="hl-2">&#39;4.0.1&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">includeAdditionalTypes:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;https://smarthealth.cards#immunization&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;https://smarthealth.cards#covid19&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Create JWT payload</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">jwtPayload</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">iss:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://your-org.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">nbf:</span><span class="hl-1"> </span><span class="hl-5">Math</span><span class="hl-1">.</span><span class="hl-0">floor</span><span class="hl-1">(</span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() / </span><span class="hl-8">1000</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">vc:</span><span class="hl-1"> </span><span class="hl-5">vc</span><span class="hl-1">.</span><span class="hl-5">vc</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">// Sign to create JWS</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">jws</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">jwsProcessor</span><span class="hl-1">.</span><span class="hl-0">sign</span><span class="hl-1">(</span><span class="hl-5">jwtPayload</span><span class="hl-1">, </span><span class="hl-5">privateKey</span><span class="hl-1">, </span><span class="hl-5">publicKey</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-5">enableCompression:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-3">// Enable compression per SMART Health Cards spec</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Verify JWS</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">verified</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">jwsProcessor</span><span class="hl-1">.</span><span class="hl-0">verify</span><span class="hl-1">(</span><span class="hl-5">jws</span><span class="hl-1">, </span><span class="hl-5">publicKey</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Generate QR codes</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">qrGenerator</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">QRCodeGenerator</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// maxSingleQRSize auto-derived from errorCorrectionLevel if not specified:</span><br/><span class="hl-1">  </span><span class="hl-3">// L: 1195, M: 927, Q: 670, H: 519 (V22 limits from SMART Health Cards QR FAQ)</span><br/><span class="hl-1">  </span><span class="hl-3">// See: https://github.com/smart-on-fhir/health-cards/blob/main/FAQ/qr.md</span><br/><span class="hl-1">  </span><span class="hl-5">enableChunking:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">, </span><span class="hl-3">// Use single QR mode (recommended)</span><br/><span class="hl-1">  </span><span class="hl-5">encodeOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">errorCorrectionLevel:</span><span class="hl-1"> </span><span class="hl-2">&#39;L&#39;</span><span class="hl-1">, </span><span class="hl-3">// L per SMART Health Cards spec</span><br/><span class="hl-1">    </span><span class="hl-5">scale:</span><span class="hl-1"> </span><span class="hl-8">4</span><span class="hl-1">, </span><span class="hl-3">// QR code scale factor</span><br/><span class="hl-1">    </span><span class="hl-5">margin:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-3">// Quiet zone size</span><br/><span class="hl-1">    </span><span class="hl-5">color:</span><span class="hl-1"> { </span><span class="hl-5">dark:</span><span class="hl-1"> </span><span class="hl-2">&#39;#000000ff&#39;</span><span class="hl-1">, </span><span class="hl-5">light:</span><span class="hl-1"> </span><span class="hl-2">&#39;#ffffffff&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-3">// Optional: version, maskPattern, width</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">qrDataUrls</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">qrGenerator</span><span class="hl-1">.</span><span class="hl-0">generateQR</span><span class="hl-1">(</span><span class="hl-5">jws</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Generated QR code data URL:&#39;</span><span class="hl-1">, </span><span class="hl-5">qrDataUrls</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]);</span><br/><br/><span class="hl-3">// Scan QR codes (simulate scanning with numeric data)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">scannedData</span><span class="hl-1"> = [</span><span class="hl-2">&#39;shc:/56762959532654603460292540772804336028702864716745...&#39;</span><span class="hl-1">];</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">reconstructedJWS</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">qrGenerator</span><span class="hl-1">.</span><span class="hl-0">decodeQR</span><span class="hl-1">(</span><span class="hl-5">scannedData</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Manual JWS chunking and numeric conversion</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">chunks</span><span class="hl-1"> = </span><span class="hl-5">qrGenerator</span><span class="hl-1">.</span><span class="hl-0">chunkJWS</span><span class="hl-1">(</span><span class="hl-5">jws</span><span class="hl-1">); </span><span class="hl-3">// Returns array of shc:/ prefixed strings</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">numericData</span><span class="hl-1"> = </span><span class="hl-5">qrGenerator</span><span class="hl-1">.</span><span class="hl-0">encodeJWSToNumeric</span><span class="hl-1">(</span><span class="hl-5">jws</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">decodedJWS</span><span class="hl-1"> = </span><span class="hl-5">qrGenerator</span><span class="hl-1">.</span><span class="hl-0">decodeNumericToJWS</span><span class="hl-1">(</span><span class="hl-5">numericData</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="smart-health-cards-file-operations" class="tsd-anchor-link">SMART Health Cards File Operations<a href="#smart-health-cards-file-operations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">SHCIssuer</span><span class="hl-1">, </span><span class="hl-5">SHCReader</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;kill-the-clipboard&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">issuer</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHCIssuer</span><span class="hl-1">(</span><span class="hl-5">config</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">reader</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SHCReader</span><span class="hl-1">({ </span><span class="hl-5">publicKey:</span><span class="hl-1"> </span><span class="hl-5">config</span><span class="hl-1">.</span><span class="hl-5">publicKey</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Issue a health card</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">healthCard</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">issuer</span><span class="hl-1">.</span><span class="hl-0">issue</span><span class="hl-1">(</span><span class="hl-5">fhirBundle</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Create SMART Health Card file content (JSON wrapper with verifiableCredential array)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fileContent</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asFileContent</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;File content:&#39;</span><span class="hl-1">, </span><span class="hl-5">fileContent</span><span class="hl-1">); </span><span class="hl-3">// JSON string with { verifiableCredential: [jws] }</span><br/><br/><span class="hl-3">// Create downloadable Blob (browser-compatible)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">blob</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">healthCard</span><span class="hl-1">.</span><span class="hl-0">asFileBlob</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Blob type:&#39;</span><span class="hl-1">, </span><span class="hl-5">blob</span><span class="hl-1">.</span><span class="hl-5">type</span><span class="hl-1">); </span><span class="hl-3">// &#39;application/smart-health-card&#39;</span><br/><br/><span class="hl-3">// Trigger download in browser (example implementation)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">url</span><span class="hl-1"> = </span><span class="hl-7">URL</span><span class="hl-1">.</span><span class="hl-0">createObjectURL</span><span class="hl-1">(</span><span class="hl-5">blob</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">a</span><span class="hl-1"> = </span><span class="hl-5">document</span><span class="hl-1">.</span><span class="hl-0">createElement</span><span class="hl-1">(</span><span class="hl-2">&#39;a&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">a</span><span class="hl-1">.</span><span class="hl-5">href</span><span class="hl-1"> = </span><span class="hl-5">url</span><span class="hl-1">;</span><br/><span class="hl-5">a</span><span class="hl-1">.</span><span class="hl-5">download</span><span class="hl-1"> = </span><span class="hl-2">&#39;vaccination-card.smart-health-card&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">document</span><span class="hl-1">.</span><span class="hl-5">body</span><span class="hl-1">.</span><span class="hl-0">appendChild</span><span class="hl-1">(</span><span class="hl-5">a</span><span class="hl-1">);</span><br/><span class="hl-5">a</span><span class="hl-1">.</span><span class="hl-0">click</span><span class="hl-1">();</span><br/><span class="hl-5">document</span><span class="hl-1">.</span><span class="hl-5">body</span><span class="hl-1">.</span><span class="hl-0">removeChild</span><span class="hl-1">(</span><span class="hl-5">a</span><span class="hl-1">);</span><br/><span class="hl-7">URL</span><span class="hl-1">.</span><span class="hl-0">revokeObjectURL</span><span class="hl-1">(</span><span class="hl-5">url</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Verify health card from file content</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">verifiedFromFile</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">reader</span><span class="hl-1">.</span><span class="hl-0">fromFileContent</span><span class="hl-1">(</span><span class="hl-5">fileContent</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Valid health card bundle:&#39;</span><span class="hl-1">, </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">verifiedFromFile</span><span class="hl-1">.</span><span class="hl-0">asBundle</span><span class="hl-1">());</span><br/><br/><span class="hl-3">// Verify health card from Blob (e.g., from file input)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fileInput</span><span class="hl-1"> = </span><span class="hl-5">document</span><span class="hl-1">.</span><span class="hl-0">querySelector</span><span class="hl-1">(</span><span class="hl-2">&#39;input[type=&quot;file&quot;]&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">fileInput</span><span class="hl-1">.</span><span class="hl-0">addEventListener</span><span class="hl-1">(</span><span class="hl-2">&#39;change&#39;</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">file</span><span class="hl-1"> = </span><span class="hl-5">event</span><span class="hl-1">.</span><span class="hl-5">target</span><span class="hl-1">.</span><span class="hl-5">files</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">file</span><span class="hl-1"> &amp;&amp; </span><span class="hl-5">file</span><span class="hl-1">.</span><span class="hl-5">name</span><span class="hl-1">.</span><span class="hl-0">endsWith</span><span class="hl-1">(</span><span class="hl-2">&#39;.smart-health-card&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">verified</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">reader</span><span class="hl-1">.</span><span class="hl-0">fromFileContent</span><span class="hl-1">(</span><span class="hl-5">file</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Valid health card:&#39;</span><span class="hl-1">, </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">verified</span><span class="hl-1">.</span><span class="hl-0">asBundle</span><span class="hl-1">());</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-3">// Or get QR codes from the verified health card</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">qrCodes</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">verified</span><span class="hl-1">.</span><span class="hl-0">asQR</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;QR code data URL:&#39;</span><span class="hl-1">, </span><span class="hl-5">qrCodes</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]);</span><br/><span class="hl-1">    } </span><span class="hl-4">catch</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Invalid health card file:&#39;</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="generating-es256-key-pairs-for-smart-health-cards" class="tsd-anchor-link">Generating ES256 Key Pairs for SMART Health Cards<a href="#generating-es256-key-pairs-for-smart-health-cards" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">// Generate ES256 key pair for testing (Node.js 18+)</span><br/><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-5">crypto</span><span class="hl-1"> </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;crypto&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">exportPKCS8</span><span class="hl-1">, </span><span class="hl-5">exportSPKI</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;jose&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Requires Node.js 18+ for crypto.webcrypto.subtle</span><br/><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">publicKey</span><span class="hl-1">, </span><span class="hl-7">privateKey</span><span class="hl-1"> } = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">crypto</span><span class="hl-1">.</span><span class="hl-5">webcrypto</span><span class="hl-1">.</span><span class="hl-5">subtle</span><span class="hl-1">.</span><span class="hl-0">generateKey</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;ECDSA&#39;</span><span class="hl-1">, </span><span class="hl-5">namedCurve:</span><span class="hl-1"> </span><span class="hl-2">&#39;P-256&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">  [</span><span class="hl-2">&#39;sign&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;verify&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">privateKeyPKCS8</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">exportPKCS8</span><span class="hl-1">(</span><span class="hl-5">privateKey</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">publicKeySPKI</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">exportSPKI</span><span class="hl-1">(</span><span class="hl-5">publicKey</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Use these keys in SHCIssuer config</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">issuer:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://your-org.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">privateKey:</span><span class="hl-1"> </span><span class="hl-5">privateKeyPKCS8</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">publicKey:</span><span class="hl-1"> </span><span class="hl-5">publicKeySPKI</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<h2 id="security-notes-and-limitations" class="tsd-anchor-link">Security notes and limitations<a href="#security-notes-and-limitations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Secure backend only</strong>: Issue/sign SHCs on a secure backend; never expose ES256 private keys in browsers. SHLs are not signed; encrypt SHL files (JWE) and serve manifests/files from a secure backend.</li>
<li><strong>No X.509 Certificate Validation</strong>: SHC verification uses a provided public key or the issuer's JWKS. X.509 certificate chain validation (x5c/PKI-based trust) is not implemented. If you require PKI-based trust, implement certificate validation out of band or extend the verification flow.</li>
<li><strong>Untrusted Content</strong>: Treat SHC content as untrusted until signature verification succeeds, and treat SHL payloads/manifests as untrusted until decryption succeeds.</li>
<li><strong>Passcode Security</strong>: The SHL <code>P</code> flag is server-side access control only. Passcodes are never part of encryption and are not present in payloads/manifests.</li>
<li><strong>HTTPS Only</strong>: All SHL manifest and file URLs must be served over HTTPS to prevent interception.</li>
<li><strong>Short-Lived file URLs</strong>: File location URLs should be short-lived and single-use to minimize exposure window.</li>
<li><strong>No Logging</strong>: Never log encryption keys, passcodes, or decrypted content in server logs.</li>
<li><strong>No Built-in Rate Limiting</strong>: Manifest endpoint rate limiting must be implemented separately.</li>
</ul>
<h3 id="production-deployment-requirements" class="tsd-anchor-link">Production Deployment Requirements<a href="#production-deployment-requirements" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Proper Database</strong>: Use a production database (PostgreSQL, MySQL, etc.) for manifest builder persistence.</li>
<li><strong>Secure Passcode Storage</strong>: Implement proper password hashing with salt and pepper (Argon2 recommended).</li>
<li><strong>Access Control</strong>: Implement proper authentication and authorization for manifest endpoints.</li>
<li><strong>Rate Limiting</strong>: Add rate limiting and abuse protection for manifest and file endpoints.</li>
<li><strong>Monitoring</strong>: Implement logging and monitoring while avoiding sensitive data exposure.</li>
<li><strong>Backup Strategy</strong>: Ensure encrypted files and DB records are properly backed up.</li>
<li><strong>Key Rotation</strong>: Plan for encryption key rotation and migration strategies.</li>
</ul>
<h2 id="future-work" class="tsd-anchor-link">Future Work<a href="#future-work" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>No <code>application/smart-api-access</code></strong>: SMART on FHIR API access tokens are not supported in content types.</li>
<li><strong>No Built-in Automatic Refresh for SHLs with <code>L</code> Flag</strong>: Long-term SHLs (<code>L</code> flag) require manual implementation of polling or push notifications for updates.</li>
</ul>
<h2 id="contributing" class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>See <a href="media/CONTRIBUTING.md">CONTRIBUTING.md</a> for development setup and guidelines.</p>
<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>MIT License - see <a href="media/LICENSE">LICENSE</a> file for details.</p>
<h2 id="commercial-support" class="tsd-anchor-link">Commercial Support<a href="#commercial-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="https://www.vinta.com.br/"><img src="https://avatars2.githubusercontent.com/u/5529080?s=80&amp;v=4" alt="alt text" title="Vinta Logo"></a></p>
<p>This project is maintained by <a href="https://www.vinta.com.br/">Vinta Software</a>. We offer design and development services for healthcare companies. If you need any commercial support, feel free to get in touch: <a href="mailto:contact@vinta.com.br">contact@vinta.com.br</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-alpha" name="alpha"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Alpha</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-beta" name="beta"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Beta</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#kill-the-clipboard-typescript-library"><span>Kill the <wbr/>Clipboard <wbr/>Type<wbr/>Script <wbr/>Library</span></a><ul><li><a href="#features"><span>Features</span></a></li><li><a href="#smart-health-links-demo"><span>SMART <wbr/>Health <wbr/>Links <wbr/>Demo</span></a></li><li><a href="#smart-health-cards-demo"><span>SMART <wbr/>Health <wbr/>Cards <wbr/>Demo</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#usage"><span>Usage</span></a></li><li><ul><li><a href="#smart-health-cards-quick-start"><span>SMART <wbr/>Health <wbr/>Cards <wbr/>Quick <wbr/>Start</span></a></li><li><a href="#smart-health-links-quick-start"><span>SMART <wbr/>Health <wbr/>Links <wbr/>Quick <wbr/>Start</span></a></li><li><ul><li><a href="#complete-shl-end-to-end-example"><span>Complete <wbr/>SHL <wbr/>End-<wbr/>to-<wbr/>End <wbr/>Example</span></a></li></ul></li><li><a href="#error-handling"><span>Error <wbr/>Handling</span></a></li></ul></li><li><a href="#api-reference-documentation"><span>API <wbr/>Reference <wbr/>Documentation</span></a></li><li><ul><li><a href="#generating-documentation"><span>Generating <wbr/>Documentation</span></a></li></ul></li><li><a href="#advanced-usage"><span>Advanced <wbr/>Usage</span></a></li><li><ul><li><a href="#smart-health-cards-advanced-usage"><span>SMART <wbr/>Health <wbr/>Cards <wbr/>Advanced <wbr/>Usage</span></a></li><li><a href="#smart-health-cards-file-operations"><span>SMART <wbr/>Health <wbr/>Cards <wbr/>File <wbr/>Operations</span></a></li><li><a href="#generating-es256-key-pairs-for-smart-health-cards"><span>Generating <wbr/>ES256 <wbr/>Key <wbr/>Pairs for <wbr/>SMART <wbr/>Health <wbr/>Cards</span></a></li></ul></li><li><a href="#security-notes-and-limitations"><span>Security notes and limitations</span></a></li><li><ul><li><a href="#production-deployment-requirements"><span>Production <wbr/>Deployment <wbr/>Requirements</span></a></li></ul></li><li><a href="#future-work"><span>Future <wbr/>Work</span></a></li><li><a href="#contributing"><span>Contributing</span></a></li><li><a href="#license"><span>License</span></a></li><li><a href="#commercial-support"><span>Commercial <wbr/>Support</span></a></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/vintasoftware/kill-the-clipboard" class="tsd-nav-link">GitHub</a><a href="https://www.vinta.com.br" class="tsd-nav-link">Maintained by Vinta Software</a></nav><nav class="tsd-navigation"><a href="modules.html">Kill the Clipboard - SMART Health Cards Library - v1.0.2</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div><script>
          try {
            const generateLinkElement = document.querySelector(".tsd-generator a");
            const link = document.createElement("a");
            Object.assign(link, {
              href: "https://github.com/dmnsgn/typedoc-material-theme",
              target: "_blank",
              rel: "noreferrer",
              innerText: "typedoc-material-theme."
            });
            generateLinkElement.insertAdjacentElement("afterend", link);
            generateLinkElement.insertAdjacentText("afterend", " with ");
          } catch (error) {

          }
        </script></body></html>
